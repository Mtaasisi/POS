# ðŸš€ Quick Setup Checklist

## Step 1: Run Database Migrations

Go to **Supabase Dashboard â†’ SQL Editor** and run these **5 migrations** in order:

### âœ… Migration 1: Fix Audit Logging
**File:** `supabase/migrations/20251001_fix_purchase_order_audit.sql`
- Fixes 400/401 errors
- Creates `log_purchase_order_audit` function
- **Status:** â¬œ Not Run

### âœ… Migration 2: Quality Check System  
**File:** `supabase/migrations/20251001_create_quality_check_system.sql`
- Creates 4 tables
- Creates 4 RPC functions
- Adds 3 default templates with 18 criteria
- **Status:** â¬œ Not Run

### âœ… Migration 3: Fix Duplicates
**File:** `supabase/migrations/20251001_fix_duplicate_quality_criteria.sql`
- Removes duplicate criteria
- Adds unique constraint
- **Status:** â¬œ Not Run

### âœ… Migration 4: Add to Inventory
**File:** `supabase/migrations/20251001_update_complete_quality_check_status.sql`
- Creates `add_quality_checked_items_to_inventory` function
- **Status:** â¬œ Not Run

### âœ… Migration 5: Fix Status Constraint (IMPORTANT!)
**File:** `supabase/migrations/20251001_fix_purchase_order_status_constraint.sql`
- Updates status constraint to include all workflow statuses
- Allows "completed" status
- **Status:** â¬œ Not Run

---

## Step 2: Verify Code Changes

All code changes are already applied:

- âœ… `src/features/lats/types/inventory.ts` - Updated types
- âœ… `src/features/lats/components/quality-check/QualityCheckModal.tsx` - New inventory step
- âœ… `src/features/lats/pages/PurchaseOrderDetailPage.tsx` - Add to inventory button & modal

---

## Step 3: Test the Workflow

### Create Test Purchase Order:

1. **Create PO**
   - Add 2-3 test products
   - Set cost prices (e.g., $10, $20, $30)

2. **Mark as Shipped**
   - Should see payment button

3. **Make Payment**
   - Record payment
   - Should see receive button

4. **Receive Order**
   - Mark as received
   - Should see quality check button

5. **Quality Check**
   - Select "Standard Quality Check" template
   - Mark items as "Pass"
   - Complete check
   - **Should see inventory form**

6. **Add to Inventory**
   - Set profit margin: 30%
   - Set location: "Test Warehouse"
   - Click "Add to Inventory"
   - **Should see success message**
   - **Status should change to "completed"**

7. **Verify**
   - Check product variants - selling price updated?
   - Check stock - quantity increased?
   - Check PO status - shows "completed"?

---

## ðŸ“‹ What to Check:

### In Supabase Dashboard:

```sql
-- Check templates created
SELECT * FROM quality_check_templates;
-- Should show 3 templates

-- Check criteria created
SELECT * FROM quality_check_criteria;
-- Should show 18 criteria (no duplicates)

-- Check RPC functions exist
SELECT routine_name FROM information_schema.routines 
WHERE routine_schema = 'public' 
AND routine_name LIKE '%quality%';
-- Should show 4 functions
```

### In Browser Console:

Look for:
- âœ… No 400 errors on audit logging
- âœ… No 401 errors on quality check
- âœ… Quality check items load correctly
- âœ… Inventory addition succeeds

---

## ðŸŽ¯ Success Criteria:

- [ ] All 4 migrations run without errors
- [ ] Can create and complete quality check
- [ ] Can add items to inventory
- [ ] Selling prices calculated correctly
- [ ] Stock quantities updated
- [ ] PO status changes to "completed"
- [ ] No console errors

---

## ðŸ†˜ Need Help?

See full documentation: `PURCHASE_ORDER_WORKFLOW_COMPLETE.md`

### Common Issues:

**Error 400 on audit?** â†’ Run Migration 1  
**Empty quality check?** â†’ Run Migration 2  
**Duplicate items?** â†’ Run Migration 3  
**No inventory button?** â†’ Check payment status  

---

**Ready to start?** Begin with Migration 1! ðŸš€

