var jd=Object.defineProperty;var Nd=(r,a,i)=>a in r?jd(r,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[a]=i;var ur=(r,a,i)=>Nd(r,typeof a!="symbol"?a+"":a,i);import{r as g,b as vd,R as Cd,d as Dr,c as sn,a as Sd}from"./vendor-CvllZvsw.js";import{c as _d,_ as Bo}from"./supabase-BQ31Rx_N.js";import{c as te,S as ns,a as Nn,C as yt,b as Il,d as un,T as Gi,P as Yr,W as Ss,M as js,e as ms,f as Tr,g as Ts,U as Ws,h as hr,D as Ns,i as ws,A as Ht,j as Ed,k as Cr,X as tr,l as vn,m as dr,n as Ti,o as Cn,p as $a,q as nr,r as cn,s as _s,E as cs,t as Ut,H as Un,u as mn,v as sa,Q as Hi,w as Nr,x as vr,G as qa,y as Ii,z as Ad,B as kd,F as Dd,I as zo,J as Qr,K as Fs,L as Td,N as Ar,O as Mr,R as Bs,V as us,Z as Kr,Y as Fr,_ as Br,$ as zr,a0 as Rr,a1 as hn,a2 as ei,a3 as zs,a4 as Id,a5 as Md,a6 as ti,a7 as Rd,a8 as Ld,a9 as si,aa as Uo,ab as Od,ac as Wi,ad as Yi,ae as ri,af as Xi,ag as Xr,ah as Ca,ai as da,aj as Js,ak as Ga,al as mr,am as Pd,an as fi,ao as xr,ap as Fd,aq as rn,ar as pr,as as Bd,at as ra,au as Bn,av as Ki,aw as zd,ax as Lr,ay as fr,az as Va,aA as Ud,aB as $d,aC as $n,aD as Ml,aE as Zi,aF as $o,aG as Sa,aH as er,aI as qd,aJ as Mi,aK as Vd,aL as Gd,aM as Hd,aN as qn,aO as Ft,aP as is,aQ as pi,aR as Hs,aS as Rl,aT as bi,aU as qo,aV as Vo,aW as xn,aX as dn,aY as an,aZ as La,a_ as Zr,a$ as Oa,b0 as Qi,b1 as Wd,b2 as Ll,b3 as Yd,b4 as Ea,b5 as Aa,b6 as Xd,b7 as Kd,b8 as Go,b9 as Ho,ba as Wo,bb as Ol}from"./ui-BKGweGX2.js";import{P as zn}from"./utils-JbXiv0AE.js";import{R as Rn,P as Pl,a as Fl,C as yi,T as Ln,L as Zd,b as Bl,X as zl,Y as Ul,c as Qd,d as $l,B as Jd,e as eu}from"./charts-D_tZePKn.js";function tu(r,a){for(var i=0;i<a.length;i++){const c=a[i];if(typeof c!="string"&&!Array.isArray(c)){for(const m in c)if(m!=="default"&&!(m in r)){const u=Object.getOwnPropertyDescriptor(c,m);u&&Object.defineProperty(r,m,u.get?u:{enumerable:!0,get:()=>c[m]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))c(m);new MutationObserver(m=>{for(const u of m)if(u.type==="childList")for(const x of u.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&c(x)}).observe(document,{childList:!0,subtree:!0});function i(m){const u={};return m.integrity&&(u.integrity=m.integrity),m.referrerPolicy&&(u.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?u.credentials="include":m.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function c(m){if(m.ep)return;m.ep=!0;const u=i(m);fetch(m.href,u)}})();var Yo={exports:{}},ai={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var su=g,ru=Symbol.for("react.element"),au=Symbol.for("react.fragment"),nu=Object.prototype.hasOwnProperty,iu=su.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,lu={key:!0,ref:!0,__self:!0,__source:!0};function Xo(r,a,i){var c,m={},u=null,x=null;i!==void 0&&(u=""+i),a.key!==void 0&&(u=""+a.key),a.ref!==void 0&&(x=a.ref);for(c in a)nu.call(a,c)&&!lu.hasOwnProperty(c)&&(m[c]=a[c]);if(r&&r.defaultProps)for(c in a=r.defaultProps,a)m[c]===void 0&&(m[c]=a[c]);return{$$typeof:ru,type:r,key:u,ref:x,props:m,_owner:iu.current}}ai.Fragment=au;ai.jsx=Xo;ai.jsxs=Xo;Yo.exports=ai;var e=Yo.exports,Ri={},ql=vd;Ri.createRoot=ql.createRoot,Ri.hydrateRoot=ql.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function gn(){return gn=Object.assign?Object.assign.bind():function(r){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(r[c]=i[c])}return r},gn.apply(this,arguments)}var ua;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(ua||(ua={}));const Vl="popstate";function ou(r){r===void 0&&(r={});function a(c,m){let{pathname:u,search:x,hash:j}=c.location;return Li("",{pathname:u,search:x,hash:j},m.state&&m.state.usr||null,m.state&&m.state.key||"default")}function i(c,m){return typeof m=="string"?m:Vn(m)}return du(a,i,null,r)}function Ys(r,a){if(r===!1||r===null||typeof r>"u")throw new Error(a)}function Ko(r,a){if(!r){typeof console<"u"&&console.warn(a);try{throw new Error(a)}catch{}}}function cu(){return Math.random().toString(36).substr(2,8)}function Gl(r,a){return{usr:r.state,key:r.key,idx:a}}function Li(r,a,i,c){return i===void 0&&(i=null),gn({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof a=="string"?Ha(a):a,{state:i,key:a&&a.key||c||cu()})}function Vn(r){let{pathname:a="/",search:i="",hash:c=""}=r;return i&&i!=="?"&&(a+=i.charAt(0)==="?"?i:"?"+i),c&&c!=="#"&&(a+=c.charAt(0)==="#"?c:"#"+c),a}function Ha(r){let a={};if(r){let i=r.indexOf("#");i>=0&&(a.hash=r.substr(i),r=r.substr(0,i));let c=r.indexOf("?");c>=0&&(a.search=r.substr(c),r=r.substr(0,c)),r&&(a.pathname=r)}return a}function du(r,a,i,c){c===void 0&&(c={});let{window:m=document.defaultView,v5Compat:u=!1}=c,x=m.history,j=ua.Pop,b=null,f=y();f==null&&(f=0,x.replaceState(gn({},x.state,{idx:f}),""));function y(){return(x.state||{idx:null}).idx}function N(){j=ua.Pop;let v=y(),U=v==null?null:v-f;f=v,b&&b({action:j,location:E.location,delta:U})}function I(v,U){j=ua.Push;let F=Li(E.location,v,U);f=y()+1;let L=Gl(F,f),C=E.createHref(F);try{x.pushState(L,"",C)}catch($){if($ instanceof DOMException&&$.name==="DataCloneError")throw $;m.location.assign(C)}u&&b&&b({action:j,location:E.location,delta:1})}function R(v,U){j=ua.Replace;let F=Li(E.location,v,U);f=y();let L=Gl(F,f),C=E.createHref(F);x.replaceState(L,"",C),u&&b&&b({action:j,location:E.location,delta:0})}function k(v){let U=m.location.origin!=="null"?m.location.origin:m.location.href,F=typeof v=="string"?v:Vn(v);return F=F.replace(/ $/,"%20"),Ys(U,"No window.location.(origin|href) available to create URL for href: "+F),new URL(F,U)}let E={get action(){return j},get location(){return r(m,x)},listen(v){if(b)throw new Error("A history only accepts one active listener");return m.addEventListener(Vl,N),b=v,()=>{m.removeEventListener(Vl,N),b=null}},createHref(v){return a(m,v)},createURL:k,encodeLocation(v){let U=k(v);return{pathname:U.pathname,search:U.search,hash:U.hash}},push:I,replace:R,go(v){return x.go(v)}};return E}var Hl;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(Hl||(Hl={}));function uu(r,a,i){return i===void 0&&(i="/"),mu(r,a,i)}function mu(r,a,i,c){let m=typeof a=="string"?Ha(a):a,u=Ji(m.pathname||"/",i);if(u==null)return null;let x=Zo(r);hu(x);let j=null;for(let b=0;j==null&&b<x.length;++b){let f=Su(u);j=Nu(x[b],f)}return j}function Zo(r,a,i,c){a===void 0&&(a=[]),i===void 0&&(i=[]),c===void 0&&(c="");let m=(u,x,j)=>{let b={relativePath:j===void 0?u.path||"":j,caseSensitive:u.caseSensitive===!0,childrenIndex:x,route:u};b.relativePath.startsWith("/")&&(Ys(b.relativePath.startsWith(c),'Absolute route path "'+b.relativePath+'" nested under path '+('"'+c+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),b.relativePath=b.relativePath.slice(c.length));let f=ha([c,b.relativePath]),y=i.concat(b);u.children&&u.children.length>0&&(Ys(u.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+f+'".')),Zo(u.children,a,y,f)),!(u.path==null&&!u.index)&&a.push({path:f,score:wu(f,u.index),routesMeta:y})};return r.forEach((u,x)=>{var j;if(u.path===""||!((j=u.path)!=null&&j.includes("?")))m(u,x);else for(let b of Qo(u.path))m(u,x,b)}),a}function Qo(r){let a=r.split("/");if(a.length===0)return[];let[i,...c]=a,m=i.endsWith("?"),u=i.replace(/\?$/,"");if(c.length===0)return m?[u,""]:[u];let x=Qo(c.join("/")),j=[];return j.push(...x.map(b=>b===""?u:[u,b].join("/"))),m&&j.push(...x),j.map(b=>r.startsWith("/")&&b===""?"/":b)}function hu(r){r.sort((a,i)=>a.score!==i.score?i.score-a.score:ju(a.routesMeta.map(c=>c.childrenIndex),i.routesMeta.map(c=>c.childrenIndex)))}const xu=/^:[\w-]+$/,gu=3,fu=2,pu=1,bu=10,yu=-2,Wl=r=>r==="*";function wu(r,a){let i=r.split("/"),c=i.length;return i.some(Wl)&&(c+=yu),a&&(c+=fu),i.filter(m=>!Wl(m)).reduce((m,u)=>m+(xu.test(u)?gu:u===""?pu:bu),c)}function ju(r,a){return r.length===a.length&&r.slice(0,-1).every((c,m)=>c===a[m])?r[r.length-1]-a[a.length-1]:0}function Nu(r,a,i){let{routesMeta:c}=r,m={},u="/",x=[];for(let j=0;j<c.length;++j){let b=c[j],f=j===c.length-1,y=u==="/"?a:a.slice(u.length)||"/",N=vu({path:b.relativePath,caseSensitive:b.caseSensitive,end:f},y),I=b.route;if(!N)return null;Object.assign(m,N.params),x.push({params:m,pathname:ha([u,N.pathname]),pathnameBase:ku(ha([u,N.pathnameBase])),route:I}),N.pathnameBase!=="/"&&(u=ha([u,N.pathnameBase]))}return x}function vu(r,a){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[i,c]=Cu(r.path,r.caseSensitive,r.end),m=a.match(i);if(!m)return null;let u=m[0],x=u.replace(/(.)\/+$/,"$1"),j=m.slice(1);return{params:c.reduce((f,y,N)=>{let{paramName:I,isOptional:R}=y;if(I==="*"){let E=j[N]||"";x=u.slice(0,u.length-E.length).replace(/(.)\/+$/,"$1")}const k=j[N];return R&&!k?f[I]=void 0:f[I]=(k||"").replace(/%2F/g,"/"),f},{}),pathname:u,pathnameBase:x,pattern:r}}function Cu(r,a,i){a===void 0&&(a=!1),i===void 0&&(i=!0),Ko(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let c=[],m="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(x,j,b)=>(c.push({paramName:j,isOptional:b!=null}),b?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(c.push({paramName:"*"}),m+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?m+="\\/*$":r!==""&&r!=="/"&&(m+="(?:(?=\\/|$))"),[new RegExp(m,a?void 0:"i"),c]}function Su(r){try{return r.split("/").map(a=>decodeURIComponent(a).replace(/\//g,"%2F")).join("/")}catch(a){return Ko(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+a+").")),r}}function Ji(r,a){if(a==="/")return r;if(!r.toLowerCase().startsWith(a.toLowerCase()))return null;let i=a.endsWith("/")?a.length-1:a.length,c=r.charAt(i);return c&&c!=="/"?null:r.slice(i)||"/"}function _u(r,a){a===void 0&&(a="/");let{pathname:i,search:c="",hash:m=""}=typeof r=="string"?Ha(r):r;return{pathname:i?i.startsWith("/")?i:Eu(i,a):a,search:Du(c),hash:Tu(m)}}function Eu(r,a){let i=a.replace(/\/+$/,"").split("/");return r.split("/").forEach(m=>{m===".."?i.length>1&&i.pop():m!=="."&&i.push(m)}),i.length>1?i.join("/"):"/"}function wi(r,a,i,c){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+a+"` field ["+JSON.stringify(c)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Au(r){return r.filter((a,i)=>i===0||a.route.path&&a.route.path.length>0)}function el(r,a){let i=Au(r);return a?i.map((c,m)=>m===i.length-1?c.pathname:c.pathnameBase):i.map(c=>c.pathnameBase)}function tl(r,a,i,c){c===void 0&&(c=!1);let m;typeof r=="string"?m=Ha(r):(m=gn({},r),Ys(!m.pathname||!m.pathname.includes("?"),wi("?","pathname","search",m)),Ys(!m.pathname||!m.pathname.includes("#"),wi("#","pathname","hash",m)),Ys(!m.search||!m.search.includes("#"),wi("#","search","hash",m)));let u=r===""||m.pathname==="",x=u?"/":m.pathname,j;if(x==null)j=i;else{let N=a.length-1;if(!c&&x.startsWith("..")){let I=x.split("/");for(;I[0]==="..";)I.shift(),N-=1;m.pathname=I.join("/")}j=N>=0?a[N]:"/"}let b=_u(m,j),f=x&&x!=="/"&&x.endsWith("/"),y=(u||x===".")&&i.endsWith("/");return!b.pathname.endsWith("/")&&(f||y)&&(b.pathname+="/"),b}const ha=r=>r.join("/").replace(/\/\/+/g,"/"),ku=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),Du=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,Tu=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function Iu(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const Jo=["post","put","patch","delete"];new Set(Jo);const Mu=["get",...Jo];new Set(Mu);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function fn(){return fn=Object.assign?Object.assign.bind():function(r){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(r[c]=i[c])}return r},fn.apply(this,arguments)}const sl=g.createContext(null),Ru=g.createContext(null),pa=g.createContext(null),ni=g.createContext(null),Jr=g.createContext({outlet:null,matches:[],isDataRoute:!1}),ec=g.createContext(null);function Lu(r,a){let{relative:i}=a===void 0?{}:a;Wa()||Ys(!1);let{basename:c,navigator:m}=g.useContext(pa),{hash:u,pathname:x,search:j}=sc(r,{relative:i}),b=x;return c!=="/"&&(b=x==="/"?c:ha([c,x])),m.createHref({pathname:b,search:j,hash:u})}function Wa(){return g.useContext(ni)!=null}function ba(){return Wa()||Ys(!1),g.useContext(ni).location}function tc(r){g.useContext(pa).static||g.useLayoutEffect(r)}function hs(){let{isDataRoute:r}=g.useContext(Jr);return r?Ku():Ou()}function Ou(){Wa()||Ys(!1);let r=g.useContext(sl),{basename:a,future:i,navigator:c}=g.useContext(pa),{matches:m}=g.useContext(Jr),{pathname:u}=ba(),x=JSON.stringify(el(m,i.v7_relativeSplatPath)),j=g.useRef(!1);return tc(()=>{j.current=!0}),g.useCallback(function(f,y){if(y===void 0&&(y={}),!j.current)return;if(typeof f=="number"){c.go(f);return}let N=tl(f,JSON.parse(x),u,y.relative==="path");r==null&&a!=="/"&&(N.pathname=N.pathname==="/"?a:ha([a,N.pathname])),(y.replace?c.replace:c.push)(N,y.state,y)},[a,c,x,u,r])}const Pu=g.createContext(null);function Fu(r){let a=g.useContext(Jr).outlet;return a&&g.createElement(Pu.Provider,{value:r},a)}function ka(){let{matches:r}=g.useContext(Jr),a=r[r.length-1];return a?a.params:{}}function sc(r,a){let{relative:i}=a===void 0?{}:a,{future:c}=g.useContext(pa),{matches:m}=g.useContext(Jr),{pathname:u}=ba(),x=JSON.stringify(el(m,c.v7_relativeSplatPath));return g.useMemo(()=>tl(r,JSON.parse(x),u,i==="path"),[r,x,u,i])}function Bu(r,a){return zu(r,a)}function zu(r,a,i,c){Wa()||Ys(!1);let{navigator:m}=g.useContext(pa),{matches:u}=g.useContext(Jr),x=u[u.length-1],j=x?x.params:{};x&&x.pathname;let b=x?x.pathnameBase:"/";x&&x.route;let f=ba(),y;if(a){var N;let v=typeof a=="string"?Ha(a):a;b==="/"||(N=v.pathname)!=null&&N.startsWith(b)||Ys(!1),y=v}else y=f;let I=y.pathname||"/",R=I;if(b!=="/"){let v=b.replace(/^\//,"").split("/");R="/"+I.replace(/^\//,"").split("/").slice(v.length).join("/")}let k=uu(r,{pathname:R}),E=Gu(k&&k.map(v=>Object.assign({},v,{params:Object.assign({},j,v.params),pathname:ha([b,m.encodeLocation?m.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?b:ha([b,m.encodeLocation?m.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),u,i,c);return a&&E?g.createElement(ni.Provider,{value:{location:fn({pathname:"/",search:"",hash:"",state:null,key:"default"},y),navigationType:ua.Pop}},E):E}function Uu(){let r=Xu(),a=Iu(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),i=r instanceof Error?r.stack:null,m={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return g.createElement(g.Fragment,null,g.createElement("h2",null,"Unexpected Application Error!"),g.createElement("h3",{style:{fontStyle:"italic"}},a),i?g.createElement("pre",{style:m},i):null,null)}const $u=g.createElement(Uu,null);class qu extends g.Component{constructor(a){super(a),this.state={location:a.location,revalidation:a.revalidation,error:a.error}}static getDerivedStateFromError(a){return{error:a}}static getDerivedStateFromProps(a,i){return i.location!==a.location||i.revalidation!=="idle"&&a.revalidation==="idle"?{error:a.error,location:a.location,revalidation:a.revalidation}:{error:a.error!==void 0?a.error:i.error,location:i.location,revalidation:a.revalidation||i.revalidation}}componentDidCatch(a,i){console.error("React Router caught the following error during render",a,i)}render(){return this.state.error!==void 0?g.createElement(Jr.Provider,{value:this.props.routeContext},g.createElement(ec.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Vu(r){let{routeContext:a,match:i,children:c}=r,m=g.useContext(sl);return m&&m.static&&m.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(m.staticContext._deepestRenderedBoundaryId=i.route.id),g.createElement(Jr.Provider,{value:a},c)}function Gu(r,a,i,c){var m;if(a===void 0&&(a=[]),i===void 0&&(i=null),c===void 0&&(c=null),r==null){var u;if(!i)return null;if(i.errors)r=i.matches;else if((u=c)!=null&&u.v7_partialHydration&&a.length===0&&!i.initialized&&i.matches.length>0)r=i.matches;else return null}let x=r,j=(m=i)==null?void 0:m.errors;if(j!=null){let y=x.findIndex(N=>N.route.id&&(j==null?void 0:j[N.route.id])!==void 0);y>=0||Ys(!1),x=x.slice(0,Math.min(x.length,y+1))}let b=!1,f=-1;if(i&&c&&c.v7_partialHydration)for(let y=0;y<x.length;y++){let N=x[y];if((N.route.HydrateFallback||N.route.hydrateFallbackElement)&&(f=y),N.route.id){let{loaderData:I,errors:R}=i,k=N.route.loader&&I[N.route.id]===void 0&&(!R||R[N.route.id]===void 0);if(N.route.lazy||k){b=!0,f>=0?x=x.slice(0,f+1):x=[x[0]];break}}}return x.reduceRight((y,N,I)=>{let R,k=!1,E=null,v=null;i&&(R=j&&N.route.id?j[N.route.id]:void 0,E=N.route.errorElement||$u,b&&(f<0&&I===0?(Zu("route-fallback"),k=!0,v=null):f===I&&(k=!0,v=N.route.hydrateFallbackElement||null)));let U=a.concat(x.slice(0,I+1)),F=()=>{let L;return R?L=E:k?L=v:N.route.Component?L=g.createElement(N.route.Component,null):N.route.element?L=N.route.element:L=y,g.createElement(Vu,{match:N,routeContext:{outlet:y,matches:U,isDataRoute:i!=null},children:L})};return i&&(N.route.ErrorBoundary||N.route.errorElement||I===0)?g.createElement(qu,{location:i.location,revalidation:i.revalidation,component:E,error:R,children:F(),routeContext:{outlet:null,matches:U,isDataRoute:!0}}):F()},null)}var rc=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(rc||{}),ac=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(ac||{});function Hu(r){let a=g.useContext(sl);return a||Ys(!1),a}function Wu(r){let a=g.useContext(Ru);return a||Ys(!1),a}function Yu(r){let a=g.useContext(Jr);return a||Ys(!1),a}function nc(r){let a=Yu(),i=a.matches[a.matches.length-1];return i.route.id||Ys(!1),i.route.id}function Xu(){var r;let a=g.useContext(ec),i=Wu(),c=nc();return a!==void 0?a:(r=i.errors)==null?void 0:r[c]}function Ku(){let{router:r}=Hu(rc.UseNavigateStable),a=nc(ac.UseNavigateStable),i=g.useRef(!1);return tc(()=>{i.current=!0}),g.useCallback(function(m,u){u===void 0&&(u={}),i.current&&(typeof m=="number"?r.navigate(m):r.navigate(m,fn({fromRouteId:a},u)))},[r,a])}const Yl={};function Zu(r,a,i){Yl[r]||(Yl[r]=!0)}function Qu(r,a){r==null||r.v7_startTransition,r==null||r.v7_relativeSplatPath}function pn(r){let{to:a,replace:i,state:c,relative:m}=r;Wa()||Ys(!1);let{future:u,static:x}=g.useContext(pa),{matches:j}=g.useContext(Jr),{pathname:b}=ba(),f=hs(),y=tl(a,el(j,u.v7_relativeSplatPath),b,m==="path"),N=JSON.stringify(y);return g.useEffect(()=>f(JSON.parse(N),{replace:i,state:c,relative:m}),[f,N,m,i,c]),null}function Ju(r){return Fu(r.context)}function zt(r){Ys(!1)}function em(r){let{basename:a="/",children:i=null,location:c,navigationType:m=ua.Pop,navigator:u,static:x=!1,future:j}=r;Wa()&&Ys(!1);let b=a.replace(/^\/*/,"/"),f=g.useMemo(()=>({basename:b,navigator:u,static:x,future:fn({v7_relativeSplatPath:!1},j)}),[b,j,u,x]);typeof c=="string"&&(c=Ha(c));let{pathname:y="/",search:N="",hash:I="",state:R=null,key:k="default"}=c,E=g.useMemo(()=>{let v=Ji(y,b);return v==null?null:{location:{pathname:v,search:N,hash:I,state:R,key:k},navigationType:m}},[b,y,N,I,R,k,m]);return E==null?null:g.createElement(pa.Provider,{value:f},g.createElement(ni.Provider,{children:i,value:E}))}function tm(r){let{children:a,location:i}=r;return Bu(Oi(a),i)}new Promise(()=>{});function Oi(r,a){a===void 0&&(a=[]);let i=[];return g.Children.forEach(r,(c,m)=>{if(!g.isValidElement(c))return;let u=[...a,m];if(c.type===g.Fragment){i.push.apply(i,Oi(c.props.children,u));return}c.type!==zt&&Ys(!1),!c.props.index||!c.props.children||Ys(!1);let x={id:c.props.id||u.join("-"),caseSensitive:c.props.caseSensitive,element:c.props.element,Component:c.props.Component,index:c.props.index,path:c.props.path,loader:c.props.loader,action:c.props.action,errorElement:c.props.errorElement,ErrorBoundary:c.props.ErrorBoundary,hasErrorBoundary:c.props.ErrorBoundary!=null||c.props.errorElement!=null,shouldRevalidate:c.props.shouldRevalidate,handle:c.props.handle,lazy:c.props.lazy};c.props.children&&(x.children=Oi(c.props.children,u)),i.push(x)}),i}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Pi(){return Pi=Object.assign?Object.assign.bind():function(r){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(r[c]=i[c])}return r},Pi.apply(this,arguments)}function sm(r,a){if(r==null)return{};var i={},c=Object.keys(r),m,u;for(u=0;u<c.length;u++)m=c[u],!(a.indexOf(m)>=0)&&(i[m]=r[m]);return i}function rm(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function am(r,a){return r.button===0&&(!a||a==="_self")&&!rm(r)}const nm=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],im="6";try{window.__reactRouterVersion=im}catch{}const lm="startTransition",Xl=Cd[lm];function om(r){let{basename:a,children:i,future:c,window:m}=r,u=g.useRef();u.current==null&&(u.current=ou({window:m,v5Compat:!0}));let x=u.current,[j,b]=g.useState({action:x.action,location:x.location}),{v7_startTransition:f}=c||{},y=g.useCallback(N=>{f&&Xl?Xl(()=>b(N)):b(N)},[b,f]);return g.useLayoutEffect(()=>x.listen(y),[x,y]),g.useEffect(()=>Qu(c),[c]),g.createElement(em,{basename:a,children:i,location:j.location,navigationType:j.action,navigator:x,future:c})}const cm=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",dm=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Zs=g.forwardRef(function(a,i){let{onClick:c,relative:m,reloadDocument:u,replace:x,state:j,target:b,to:f,preventScrollReset:y,viewTransition:N}=a,I=sm(a,nm),{basename:R}=g.useContext(pa),k,E=!1;if(typeof f=="string"&&dm.test(f)&&(k=f,cm))try{let L=new URL(window.location.href),C=f.startsWith("//")?new URL(L.protocol+f):new URL(f),$=Ji(C.pathname,R);C.origin===L.origin&&$!=null?f=$+C.search+C.hash:E=!0}catch{}let v=Lu(f,{relative:m}),U=um(f,{replace:x,state:j,target:b,preventScrollReset:y,relative:m,viewTransition:N});function F(L){c&&c(L),L.defaultPrevented||U(L)}return g.createElement("a",Pi({},I,{href:k||v,onClick:E||u?c:F,ref:i,target:b}))});var Kl;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(Kl||(Kl={}));var Zl;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(Zl||(Zl={}));function um(r,a){let{target:i,replace:c,state:m,preventScrollReset:u,relative:x,viewTransition:j}=a===void 0?{}:a,b=hs(),f=ba(),y=sc(r,{relative:x});return g.useCallback(N=>{if(am(N,i)){N.preventDefault();let I=c!==void 0?c:Vn(f)===Vn(y);b(r,{replace:I,state:m,preventScrollReset:u,relative:x,viewTransition:j})}},[f,b,y,c,m,i,r,u,x,j])}const mm=()=>(console.log("🔧 Using online Supabase configuration"),{url:"https://jxhzveborezjhsmzsgbc.supabase.co",key:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp4aHp2ZWJvcmV6amhzbXpzZ2JjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3MTE1MjQsImV4cCI6MjA2ODI4NzUyNH0.pIug4PlJ3Q14GxcYilW-u0blByYoyeOfN3q9RNIjgfw"});let ji=null;const G=(()=>{if(!ji){console.log("🔧 Creating Supabase client instance..."),typeof window<"u"&&(localStorage.removeItem("repair-app-auth-token"),localStorage.removeItem("supabase.auth.token"),console.log("🧹 Cleared cached auth data"));const r=mm(),a=typeof window<"u";if(ji=_d(r.url,r.key,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storageKey:"repair-app-auth-token",storage:a?window.localStorage:void 0},realtime:{params:{eventsPerSecond:10}},global:{headers:{"X-Client-Info":"repair-app"}},db:{schema:"public"}}),a){window.addEventListener("online",()=>{console.log("🌐 Network connection restored")}),window.addEventListener("offline",()=>{console.log("📴 Network connection lost")});const i=window.fetch;window.fetch=async(c,m)=>{try{return await i(c,m)}catch(u){if(u instanceof TypeError&&u.message.includes("Failed to fetch")&&(console.warn("🌐 Network error detected, attempting to use offline data"),typeof c=="string"&&c.includes("/auth/")))return new Response(JSON.stringify({error:"Network unavailable",message:"Please check your internet connection"}),{status:503,headers:{"Content-Type":"application/json"}});throw u}}}console.log("✅ Supabase client instance created successfully")}return ji})(),ic=g.createContext(void 0),Wt=()=>{const r=g.useContext(ic);if(!r)throw new Error("useAuth must be used within an AuthProvider");return r};let Ql=!1;function hm(r){const a=i=>{switch(i){case"admin":return["all"];case"technician":return["view_devices","update_device_status","view_customers"];case"customer-care":return["view_customers","create_customers","edit_customers","view_devices","assign_devices"];default:return["view_devices","update_device_status","view_customers"]}};return{...r,isActive:r.is_active,maxDevicesAllowed:r.max_devices_allowed||10,requireApproval:r.require_approval||!1,failedLoginAttempts:r.failed_login_attempts||0,twoFactorEnabled:r.two_factor_enabled||!1,twoFactorSecret:r.two_factor_secret,lastLogin:r.last_login,permissions:r.permissions&&Array.isArray(r.permissions)&&r.permissions.length>0?r.permissions:a(r.role),assignedDevices:[],assignedCustomers:[]}}const xm=({children:r})=>{const[a,i]=g.useState(null),[c,m]=g.useState(!0),[u,x]=g.useState(null),j=g.useRef(!1),b=g.useRef(0),f=async R=>{var k,E,v,U;try{console.log("🔍 Fetching user profile for:",R.id);let{data:F,error:L}=await G.from("auth_users").select("*").eq("id",R.id).single();if(L||!F){console.log("User not found in auth_users table, trying auth.users table...");const{data:$,error:Y}=await G.from("auth_users").select("*").eq("id",R.id).single();if(Y||!$){console.log("User not found in either table, creating default profile...");const A={id:R.id,email:R.email,username:((k=R.email)==null?void 0:k.split("@")[0])||"user",name:((E=R.email)==null?void 0:E.split("@")[0])||"User",role:"technician",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{error:Z}=await G.from("auth_users").insert([A]);Z?console.error("Error creating default profile:",Z):(console.log("Default user profile created successfully"),F=A)}else F=$}if(!F){console.log("No profile data found, setting default user");const $={...R,role:"technician",name:((v=R.email)==null?void 0:v.split("@")[0])||"User",is_active:!0,permissions:["view_devices","update_device_status","view_customers"]};i($),m(!1);return}const C=hm(F);console.log("✅ User profile loaded successfully:",C.name||C.email),console.log("🔍 User profile data:",F),console.log("🔍 Mapped user data:",C),i(C),m(!1)}catch(F){console.error("Error in fetchAndSetUserProfile:",F);const L={...R,role:"technician",name:((U=R.email)==null?void 0:U.split("@")[0])||"User",is_active:!0,permissions:["view_devices","update_device_status","view_customers"]};i(L),m(!1)}};g.useEffect(()=>{if(j.current||Ql){console.log("⚠️ AuthProvider already initialized, skipping...");return}Ql=!0,b.current++,console.log("🚀 Initializing AuthProvider (mount #",b.current,")");const R=async()=>{try{m(!0),console.log("🔐 Checking for existing session...");const{data:{session:E},error:v}=await G.auth.getSession();if(v){console.error("❌ Session error:",v),i(null),m(!1);return}E!=null&&E.user?(console.log("✅ Found existing session for user:",E.user.email),await f(E.user)):(console.log("ℹ️ No existing session found"),i(null)),m(!1),j.current=!0,console.log("✅ Auth initialization complete")}catch(E){console.error("❌ Error initializing auth:",E),i(null),m(!1),j.current=!0}},{data:{subscription:k}}=G.auth.onAuthStateChange((E,v)=>{var U;console.log("🔄 Auth state change:",E,(U=v==null?void 0:v.user)==null?void 0:U.email),E==="SIGNED_IN"&&(v!=null&&v.user)?(console.log("👤 User signed in:",v.user.email),f(v.user)):E==="SIGNED_OUT"?(console.log("👋 User signed out"),i(null),m(!1)):E==="TOKEN_REFRESHED"&&(v!=null&&v.user)&&(console.log("🔄 Token refreshed for user:",v.user.email),a||f(v.user))});return R(),()=>{console.log("🧹 Cleaning up AuthProvider"),k.unsubscribe(),b.current--}},[]);const y=async(R,k)=>{try{x(null),m(!0),console.log("🔐 Attempting login for:",R);const{data:E,error:v}=await G.auth.signInWithPassword({email:R,password:k});return v?(console.error("❌ Login error:",v),x(v.message||"Invalid email or password"),m(!1),!1):E.user?(console.log("✅ Login successful for:",E.user.email),await f(E.user),m(!1),!0):(x("Login failed"),m(!1),!1)}catch(E){return console.error("❌ Login error:",E),x("An unexpected error occurred during login"),m(!1),!1}},N=async()=>{try{console.log("👋 Logging out user"),m(!0),await G.auth.signOut(),i(null),x(null),console.log("✅ Logout successful")}catch(R){console.error("❌ Logout error:",R)}finally{m(!1)}},I=()=>x(null);return e.jsx(ic.Provider,{value:{currentUser:a,login:y,logout:N,isAuthenticated:!!a,error:u,clearError:I,loading:c},children:r})},gm=(r,a)=>a.some(i=>r instanceof i);let Jl,eo;function fm(){return Jl||(Jl=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function pm(){return eo||(eo=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const lc=new WeakMap,Fi=new WeakMap,oc=new WeakMap,Ni=new WeakMap,rl=new WeakMap;function bm(r){const a=new Promise((i,c)=>{const m=()=>{r.removeEventListener("success",u),r.removeEventListener("error",x)},u=()=>{i(xa(r.result)),m()},x=()=>{c(r.error),m()};r.addEventListener("success",u),r.addEventListener("error",x)});return a.then(i=>{i instanceof IDBCursor&&lc.set(i,r)}).catch(()=>{}),rl.set(a,r),a}function ym(r){if(Fi.has(r))return;const a=new Promise((i,c)=>{const m=()=>{r.removeEventListener("complete",u),r.removeEventListener("error",x),r.removeEventListener("abort",x)},u=()=>{i(),m()},x=()=>{c(r.error||new DOMException("AbortError","AbortError")),m()};r.addEventListener("complete",u),r.addEventListener("error",x),r.addEventListener("abort",x)});Fi.set(r,a)}let Bi={get(r,a,i){if(r instanceof IDBTransaction){if(a==="done")return Fi.get(r);if(a==="objectStoreNames")return r.objectStoreNames||oc.get(r);if(a==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return xa(r[a])},set(r,a,i){return r[a]=i,!0},has(r,a){return r instanceof IDBTransaction&&(a==="done"||a==="store")?!0:a in r}};function wm(r){Bi=r(Bi)}function jm(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(a,...i){const c=r.call(vi(this),a,...i);return oc.set(c,a.sort?a.sort():[a]),xa(c)}:pm().includes(r)?function(...a){return r.apply(vi(this),a),xa(lc.get(this))}:function(...a){return xa(r.apply(vi(this),a))}}function Nm(r){return typeof r=="function"?jm(r):(r instanceof IDBTransaction&&ym(r),gm(r,fm())?new Proxy(r,Bi):r)}function xa(r){if(r instanceof IDBRequest)return bm(r);if(Ni.has(r))return Ni.get(r);const a=Nm(r);return a!==r&&(Ni.set(r,a),rl.set(a,r)),a}const vi=r=>rl.get(r);function cc(r,a,{blocked:i,upgrade:c,blocking:m,terminated:u}={}){const x=indexedDB.open(r,a),j=xa(x);return c&&x.addEventListener("upgradeneeded",b=>{c(xa(x.result),b.oldVersion,b.newVersion,xa(x.transaction),b)}),i&&x.addEventListener("blocked",b=>i(b.oldVersion,b.newVersion,b)),j.then(b=>{u&&b.addEventListener("close",()=>u()),m&&b.addEventListener("versionchange",f=>m(f.oldVersion,f.newVersion,f))}).catch(()=>{}),j}const vm=["get","getKey","getAll","getAllKeys","count"],Cm=["put","add","delete","clear"],Ci=new Map;function to(r,a){if(!(r instanceof IDBDatabase&&!(a in r)&&typeof a=="string"))return;if(Ci.get(a))return Ci.get(a);const i=a.replace(/FromIndex$/,""),c=a!==i,m=Cm.includes(i);if(!(i in(c?IDBIndex:IDBObjectStore).prototype)||!(m||vm.includes(i)))return;const u=async function(x,...j){const b=this.transaction(x,m?"readwrite":"readonly");let f=b.store;return c&&(f=f.index(j.shift())),(await Promise.all([f[i](...j),m&&b.done]))[0]};return Ci.set(a,u),u}wm(r=>({...r,get:(a,i,c)=>to(a,i)||r.get(a,i,c),has:(a,i)=>!!to(a,i)||r.has(a,i)}));const dc="clean-app-cache",Gn=["customers","devices","returns"],al=5*60*1e3;async function aa(){return cc(dc,4,{upgrade(r,a,i){console.log(`Upgrading IndexedDB from version ${a} to ${i}`);for(const c of Gn)r.objectStoreNames.contains(c)||(console.log(`Creating object store: ${c}`),r.createObjectStore(c,{keyPath:"id"}));r.objectStoreNames.contains("cache_metadata")||(console.log("Creating cache_metadata object store"),r.createObjectStore("cache_metadata",{keyPath:"store"}))}})}async function Hn(r,a){try{const c=(await aa()).transaction([r,"cache_metadata"],"readwrite");await c.objectStore(r).clear();const m=Date.now();for(const u of a)await c.objectStore(r).put({...u,_cachedAt:m});await c.objectStore("cache_metadata").put({store:r,lastUpdated:m,itemCount:a.length}),await c.done}catch(i){console.warn(`Failed to cache data for ${r}:`,i)}}async function bn(r){try{const i=(await aa()).transaction([r,"cache_metadata"],"readonly"),c=await i.objectStore("cache_metadata").get(r);return c&&Date.now()-c.lastUpdated>al?[]:(await i.objectStore(r).getAll()).map(u=>{const{_cachedAt:x,...j}=u;return j})}catch(a){return console.warn(`Failed to get cached data for ${r}:`,a),[]}}async function Sm(r){try{const c=await(await aa()).transaction("cache_metadata","readonly").objectStore("cache_metadata").get(r);return c?Date.now()-c.lastUpdated<=al:!1}catch(a){return console.warn(`Failed to check cache validity for ${r}:`,a),!1}}async function _m(r){try{const i=(await aa()).transaction([r,"cache_metadata"],"readwrite");await i.objectStore(r).clear(),await i.objectStore("cache_metadata").delete(r),await i.done}catch(a){console.warn(`Failed to clear cache for ${r}:`,a)}}async function Em(){try{const r=await aa(),a={};for(const i of Gn){const m=await r.transaction("cache_metadata","readonly").objectStore("cache_metadata").get(i);m&&(a[i]={itemCount:m.itemCount,lastUpdated:new Date(m.lastUpdated),isValid:Date.now()-m.lastUpdated<=al})}return a}catch(r){return console.warn("Failed to get cache stats:",r),{}}}async function uc(){try{const a=(await aa()).transaction([...Gn,"cache_metadata"],"readwrite");for(const i of Gn)await a.objectStore(i).clear();await a.objectStore("cache_metadata").clear(),await a.done,console.log("All cache cleared successfully")}catch(r){console.warn("Failed to clear all cache:",r)}}async function nl(){try{await Am(dc),console.log("Cache database reset successfully")}catch(r){console.warn("Failed to reset cache database:",r)}}async function Am(r){return new Promise((a,i)=>{const c=indexedDB.deleteDatabase(r);c.onsuccess=()=>a(),c.onerror=()=>i(c.error)})}async function mc(){try{await(await aa()).transaction("cache_metadata","readonly").objectStore("cache_metadata").get("test"),console.log("Cache initialized successfully")}catch(r){console.warn("Cache initialization failed, resetting database:",r);try{await nl(),await aa(),console.log("Cache reset and reinitialized successfully")}catch(a){console.error("Failed to reset cache database:",a)}}}typeof window<"u"&&(window.resetCleanAppCache=async()=>{try{await nl(),console.log("Cache reset successfully. Please refresh the page.")}catch(r){console.error("Failed to reset cache:",r)}},window.clearCleanAppCache=async()=>{try{await uc(),console.log("Cache cleared successfully.")}catch(r){console.error("Failed to clear cache:",r)}});const km=Object.freeze(Object.defineProperty({__proto__:null,cacheClear:_m,cacheGetAll:bn,cacheGetStats:Em,cacheIsValid:Sm,cacheSetAll:Hn,clearAllCache:uc,getCacheDB:aa,initializeCache:mc,resetCacheDatabase:nl},Symbol.toStringTag,{value:"Module"}));async function Dm(){if(navigator.onLine)try{const{data:r,error:a}=await G.from("devices").select(`
          id,
          customer_id,
          brand,
          model,
          serial_number,
          issue_description,
          status,
          assigned_to,
          expected_return_date,
          created_at,
          updated_at,
          customers (id, name, phone, email),
          remarks:device_remarks(*),
          transitions:device_transitions(*),
          ratings:device_ratings(*)
        `).order("created_at",{ascending:!1});if(a){console.warn("Customer join failed, trying without customer data:",a);const{data:c,error:m}=await G.from("devices").select(`
            id,
            customer_id,
            brand,
            model,
            serial_number,
            issue_description,
            status,
            assigned_to,
            expected_return_date,
            created_at,
            updated_at,
            remarks:device_remarks(*),
            transitions:device_transitions(*),
            ratings:device_ratings(*)
          `).order("created_at",{ascending:!1});if(m)throw console.error("Error fetching devices:",m),m;const u=(c||[]).map(x=>{const j=(x.remarks||[]).map(y=>({id:y.id,content:y.content,createdBy:y.created_by,createdAt:y.created_at})),b=(x.transitions||[]).map(y=>({id:y.id,fromStatus:y.from_status,toStatus:y.to_status,performedBy:y.performed_by,timestamp:y.created_at,signature:y.signature||""})),f=(x.ratings||[]).map(y=>({id:y.id,deviceId:y.device_id,technicianId:y.technician_id,score:y.score,comment:y.comment,createdAt:y.created_at}));return{...x,serialNumber:x.serial_number,issueDescription:x.issue_description,customerId:x.customer_id,assignedTo:x.assigned_to,expectedReturnDate:x.expected_return_date,customerName:"",phoneNumber:"",remarks:j,transitions:b,ratings:f,createdAt:x.created_at,updatedAt:x.updated_at}});return await Hn("devices",u),u}const i=(r||[]).map(c=>{var j,b;const m=(c.remarks||[]).map(f=>({id:f.id,content:f.content,createdBy:f.created_by,createdAt:f.created_at})),u=(c.transitions||[]).map(f=>({id:f.id,fromStatus:f.from_status,toStatus:f.to_status,performedBy:f.performed_by,timestamp:f.created_at,signature:f.signature||""})),x=(c.ratings||[]).map(f=>({id:f.id,deviceId:f.device_id,technicianId:f.technician_id,score:f.score,comment:f.comment,createdAt:f.created_at}));return{...c,serialNumber:c.serial_number,issueDescription:c.issue_description,customerId:c.customer_id,assignedTo:c.assigned_to,expectedReturnDate:c.expected_return_date,customerName:Array.isArray(c.customers)&&c.customers.length>0&&((j=c.customers[0])==null?void 0:j.name)||"",phoneNumber:Array.isArray(c.customers)&&c.customers.length>0&&((b=c.customers[0])==null?void 0:b.phone)||"",remarks:m,transitions:u,ratings:x,createdAt:c.created_at,updatedAt:c.updated_at}});return await Hn("devices",i),i}catch(r){return console.error("Error fetching devices:",r),await bn("devices")}else return await bn("devices")}async function Tm(r){const a={id:r.id,customer_id:r.customerId,brand:r.brand,model:r.model,serial_number:r.serialNumber,issue_description:r.issueDescription,status:r.status,assigned_to:r.assignedTo||null,expected_return_date:r.expectedReturnDate===""?null:r.expectedReturnDate,created_at:r.createdAt,updated_at:r.updatedAt},{data:i,error:c}=await G.from("devices").insert([a]).select();if(c)throw c;return i&&i[0]?i[0]:null}async function zi(r,a){const i={...a};"assignedTo"in i&&(i.assigned_to=i.assignedTo,delete i.assignedTo),"serialNumber"in i&&(i.serial_number=i.serialNumber,delete i.serialNumber),"issueDescription"in i&&(i.issue_description=i.issueDescription,delete i.issueDescription),"customerId"in i&&(i.customer_id=i.customerId,delete i.customerId),"expectedReturnDate"in i&&(i.expected_return_date=i.expectedReturnDate,delete i.expectedReturnDate);const c=["id","customer_id","brand","model","serial_number","issue_description","status","assigned_to","estimated_hours","expected_return_date","created_at","updated_at"];Object.keys(i).forEach(x=>{c.includes(x)||delete i[x]}),console.log("[updateDeviceInDb] Sending update to DB:",i);const{data:m,error:u}=await G.from("devices").update(i).eq("id",r).select();if(u)throw u;return m&&m[0]?{...m[0],assignedTo:m[0].assigned_to}:null}async function Im(r){const{error:a}=await G.from("devices").delete().eq("id",r);if(a)throw a;return!0}const Na=class Na{static async initialize(){if(!this.isInitialized){if(!this.userInteracted){console.log("AudioContext: Waiting for user interaction");return}if(this.initializationPromise)return this.initializationPromise;this.initializationPromise=this.createAudioContext(),await this.initializationPromise}}static async createAudioContext(){try{this.canCreateAudioContext()&&(this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.audioContext.state==="suspended"&&await this.audioContext.resume(),this.isInitialized=!0,console.log("AudioContext: Initialized successfully"))}catch{this.isInitialized=!0}}static markUserInteracted(){this.userInteracted||(this.userInteracted=!0,console.log("AudioContext: User interaction detected"),this.initialize())}static canCreateAudioContext(){return this.userInteracted&&!this.isInitialized&&!this.audioContext}static async playRemarkSound(){if(this.userInteracted)if(this.markUserInteracted(),await this.initialize(),this.audioContext&&this.audioContext.state==="running"){const a=this.audioContext.createOscillator(),i=this.audioContext.createGain();a.connect(i),i.connect(this.audioContext.destination),a.frequency.setValueAtTime(800,this.audioContext.currentTime),a.frequency.setValueAtTime(600,this.audioContext.currentTime+.1),a.frequency.setValueAtTime(800,this.audioContext.currentTime+.2),i.gain.setValueAtTime(.3,this.audioContext.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.3),a.start(this.audioContext.currentTime),a.stop(this.audioContext.currentTime+.3)}else this.playFallbackSound()}static playFallbackSound(){try{console.log("Playing fallback sound")}catch(a){console.warn("Could not play remark sound:",a)}}static async playSuccessSound(){if(this.markUserInteracted(),await this.initialize(),this.audioContext&&this.audioContext.state==="running"){const a=this.audioContext.createOscillator(),i=this.audioContext.createGain();a.connect(i),i.connect(this.audioContext.destination),a.frequency.setValueAtTime(523,this.audioContext.currentTime),a.frequency.setValueAtTime(659,this.audioContext.currentTime+.1),a.frequency.setValueAtTime(784,this.audioContext.currentTime+.2),i.gain.setValueAtTime(.2,this.audioContext.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.3),a.start(this.audioContext.currentTime),a.stop(this.audioContext.currentTime+.3)}}static async playErrorSound(){if(this.markUserInteracted(),await this.initialize(),this.audioContext&&this.audioContext.state==="running"){const a=this.audioContext.createOscillator(),i=this.audioContext.createGain();a.connect(i),i.connect(this.audioContext.destination),a.frequency.setValueAtTime(784,this.audioContext.currentTime),a.frequency.setValueAtTime(659,this.audioContext.currentTime+.1),a.frequency.setValueAtTime(523,this.audioContext.currentTime+.2),i.gain.setValueAtTime(.2,this.audioContext.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.3),a.start(this.audioContext.currentTime),a.stop(this.audioContext.currentTime+.3)}}static async testSound(){console.log("Testing sound functionality...");try{await this.playRemarkSound(),console.log("✅ Sound test successful")}catch(a){console.error("❌ Sound test failed:",a)}}};ur(Na,"audioContext",null),ur(Na,"isInitialized",!1),ur(Na,"userInteracted",!1),ur(Na,"initializationPromise",null),(()=>{const a=()=>{Na.markUserInteracted(),document.removeEventListener("click",a),document.removeEventListener("keydown",a),document.removeEventListener("touchstart",a)};document.addEventListener("click",a),document.addEventListener("keydown",a),document.addEventListener("touchstart",a)})();let va=Na;async function Mm(r,a){const{data:i,error:c}=await G.from("customer_notes").insert([{...r,customer_id:a}]).select();if(c)throw c;try{await va.playRemarkSound()}catch(m){console.warn("Could not play remark sound:",m)}return i&&i[0]?i[0]:null}async function Rm(r,a){const{data:i,error:c}=await G.from("promo_messages").insert([{...r,customer_id:a}]).select();if(c)throw c;return i&&i[0]?i[0]:null}async function Lm(r){const{data:a,error:i}=await G.from("device_ratings").insert([r]).select();if(i)throw i;return a&&a[0]?a[0]:null}function hc(r){if(!r)return"normal";const a=r.trim().toLowerCase();return{normal:"normal",vip:"vip",complainer:"complainer",purchased:"purchased","not normal":"normal",new:"normal",regular:"normal",standard:"normal",basic:"normal",premium:"vip",important:"vip",priority:"vip",problem:"complainer",issue:"complainer",buyer:"purchased",customer:"purchased",buying:"purchased"}[a]||"normal"}function Vt(r){return"Tsh "+Number(r).toLocaleString("en-TZ",{maximumFractionDigits:0})}async function yn(){if(navigator.onLine)try{console.log("🔍 Fetching customers from database...");const{count:r,error:a}=await G.from("customers").select("*",{count:"exact",head:!0});if(a)throw console.error("❌ Error counting customers:",a),a;console.log(`📊 Total customers in database: ${r}`);const{data:i,error:c}=await G.from("customers").select(`
          id, name, email, phone, gender, city, joined_date, loyalty_level, color_tag, referred_by, total_spent, points, last_visit, is_active, whatsapp, birth_month, birth_day, referral_source, initial_notes, total_returns, profile_image, created_at, updated_at
        `).limit(1e3);if(c)throw console.error("❌ Error fetching customers:",c),c;console.log(`✅ Fetched ${i.length} customers from database`),i.length<r&&(console.warn(`⚠️ Warning: Fetched ${i.length} customers but database has ${r} total`),console.warn("This might be due to a default limit or complex join issues"));const m=i.map(u=>({...il(u),notes:[],payments:[],promoHistory:[],devices:[]}));return console.log(`✅ Successfully processed ${m.length} customers`),await Hn("customers",m),m}catch(r){console.error("❌ Error fetching customers:",r);const a=await bn("customers");if(a.length>0)return console.log(`📦 Using cached data: ${a.length} customers`),a;throw r}else return console.log("📱 Offline mode - using cached data"),await bn("customers")}function il(r){return{id:r.id,name:r.name,email:r.email,phone:r.phone,gender:r.gender,city:r.city,locationDescription:r.location_description,nationalId:r.national_id,joinedDate:r.joined_date,loyaltyLevel:r.loyalty_level,colorTag:r.color_tag,referredBy:r.referred_by,referrals:r.referrals||[],totalSpent:r.total_spent||0,points:r.points||0,lastVisit:r.last_visit,isActive:r.is_active,whatsapp:r.whatsapp,referralSource:r.referral_source,birthMonth:r.birth_month,birthDay:r.birth_day,initialNotes:r.initial_notes,notes:[],promoHistory:[],payments:[],devices:[],created_at:r.created_at,updated_at:r.updated_at}}async function ll(r){var m;const a=(typeof r.points=="number"?r.points:0)+10,i={id:r.id,name:r.name,email:r.email||null,phone:r.phone,gender:r.gender||null,city:r.city||null,location_description:null,national_id:null,joined_date:r.joinedDate,loyalty_level:r.loyaltyLevel,color_tag:hc(r.colorTag),referred_by:r.referredBy||null,total_spent:r.totalSpent,points:a,last_visit:r.lastVisit,is_active:r.isActive,whatsapp:r.whatsapp||null,birth_month:r.birthMonth||null,birth_day:r.birthDay||null,referral_source:r.referralSource||null,initial_notes:r.initialNotes||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};console.log("Sending customer data to database:",i);const{error:c}=await G.from("customers").insert([i]);if(c)throw console.error("Database error:",c),c;try{const{data:u}=await G.auth.getUser(),x=(m=u==null?void 0:u.user)==null?void 0:m.id;await G.from("customer_notes").insert({id:crypto.randomUUID(),content:"Added 10 initial loyalty points for new customer registration",created_by:x||"system",created_at:new Date().toISOString(),customer_id:i.id})}catch(u){console.warn("Could not add initial points note:",u)}return il(i)}async function Fa(r,a){const i={};a.name!==void 0&&(i.name=a.name),a.email!==void 0&&(i.email=a.email),a.phone!==void 0&&(i.phone=a.phone),a.gender!==void 0&&(i.gender=a.gender),a.city!==void 0&&(i.city=a.city),a.joinedDate!==void 0&&(i.joined_date=a.joinedDate),a.loyaltyLevel!==void 0&&(i.loyalty_level=a.loyaltyLevel),a.colorTag!==void 0&&(i.color_tag=hc(a.colorTag)),a.referredBy!==void 0&&(i.referred_by=a.referredBy),a.totalSpent!==void 0&&(i.total_spent=a.totalSpent),a.points!==void 0&&(i.points=a.points),a.lastVisit!==void 0&&(i.last_visit=a.lastVisit),a.isActive!==void 0&&(i.is_active=a.isActive),a.whatsapp!==void 0&&(i.whatsapp=a.whatsapp),a.referralSource!==void 0&&(i.referral_source=a.referralSource),a.birthMonth!==void 0&&(i.birth_month=a.birthMonth),a.birthDay!==void 0&&(i.birth_day=a.birthDay),a.initialNotes!==void 0&&(i.initial_notes=a.initialNotes),i.updated_at=new Date().toISOString();const{data:c,error:m}=await G.from("customers").update(i).eq("id",r).select();if(m)throw m;return c&&c[0]?il(c[0]):null}async function so(r,a){const{error:i}=await G.from("customer_checkins").insert({customer_id:r,staff_id:a});if(i)return i.code==="23505"?{success:!1,message:"Customer already checked in today."}:{success:!1,message:i.message};await G.from("customers").update({last_visit:new Date().toISOString(),is_active:!0}).eq("id",r);const{data:c,error:m}=await G.from("customers").select("points").eq("id",r).single();if(!m&&c&&typeof c.points=="number"){await G.from("customers").update({points:c.points+5}).eq("id",r);try{await G.from("customer_notes").insert({id:crypto.randomUUID(),content:"Added 5 loyalty points for customer check-in",created_by:a,created_at:new Date().toISOString(),customer_id:r})}catch(j){console.warn("Could not add check-in points note:",j)}}const{data:u,error:x}=await G.from("auth_users").select("points").eq("id",a).single();return!x&&u&&typeof u.points=="number"&&await G.from("auth_users").update({points:u.points+20}).eq("id",a),{success:!0,message:"Check-in successful. 20 points awarded to staff, 5 points to customer."}}const nn=[{name:"deviceReceived",message:`✅ Tumepokea Kimepokelewa!

Hellow Mtaasisi [Jina la Mteja],

Habari njema! [Model ya Kifaa] yako imepokelewa na sasa iko katika foleni ya ukarabati wa Inauzwa.

📋 Namba ya Kumbukumbu: #[Namba ya Tiketi]
📅 Tarehe ya Kupokea: [Tarehe]
🔧 Tatizo: [Maelezo mafupi]

Subiri ujumbe kupitia SMS kikiwa tayari!

Asante kwa kumtumaini Inauzwa 🚀`,variables:["Jina la Mteja","Model ya Kifaa","Namba ya Tiketi","Tarehe","Maelezo mafupi"]},{name:"deviceReady",message:`🎉 Kifaa Chako Tayari!

Habari Mtaasisi [Jina la Mteja],

Habari njema! [Model ya Kifaa] yako imekamilika na tayari kuchukuliwa.

📋 Namba ya Kumbukumbu: #[Namba ya Tiketi]
✅ Tarehe ya Kukamilisha: [Tarehe]

Tafadhali uje kuchukua kifaa chako katika ofisi yetu ndani ya muda ili kuepuka usumbufu.

Asante kwa kumtumaini Inauzwa! 🚀`,variables:["Jina la Mteja","Model ya Kifaa","Namba ya Tiketi","Tarehe"]},{name:"returnReceived",message:`📦 Kurudi Kimepokelewa!

Habari Mtaasisi [Jina la Mteja],

Habari njema! Tumepokea kurudi kwa [Model ya Kifaa] yako.

📋 Namba ya Return: #[Namba ya Return]
📅 Tarehe ya Kupokea: [Tarehe]
🔍 Sababu ya Kurudi: [Sababu ya Kurudi]

Tutaanza kuchunguza hali ya kifaa na kukupa majibu ndani ya siku 23.

Asante kwa kumtumaini Inauzwa! 🚀`,variables:["Jina la Mteja","Model ya Kifaa","Namba ya Return","Tarehe","Sababu ya Kurudi"]},{name:"returnStatusUpdate",message:`📊 Hali ya Return Imebadilika!

Habari Mtaasisi [Jina la Mteja],

Hali ya return yako imebadilika:

📋 Namba ya Return: #[Namba ya Return]
📱 Kifaa: [Model ya Kifaa]
🔄 Hali Mpya: [Hali ya Return]
📅 Tarehe: [Tarehe]

Tutakupa majibu zaidi hivi karibuni.

Asante kwa kumtumaini Inauzwa! 🚀`,variables:["Jina la Mteja","Model ya Kifaa","Namba ya Return","Tarehe","Hali ya Return"]},{name:"returnResolved",message:`✅ Return Imekamilika!

Habari Mtaasisi [Jina la Mteja],

Return yako imekamilika:

📋 Namba ya Return: #[Namba ya Return]
📱 Kifaa: [Model ya Kifaa]
📅 Tarehe: [Tarehe]
🎯 Uamuzi: [Uamuzi]

Tafadhali uje kuchukua kifaa chako au kupokea malipo yako.

Asante kwa kumtumaini Inauzwa! 🚀`,variables:["Jina la Mteja","Model ya Kifaa","Namba ya Return","Tarehe","Uamuzi"]}],Sn=r=>{if(!r)return"";const a=r.replace(/[\s\-\(\)\.]/g,"");if(a.startsWith("+255"))return a;if(a.startsWith("255"))return"+"+a;if(a.startsWith("0"))return"+255"+a.substring(1);if(a.length===9&&/^\d+$/.test(a))return"+255"+a;if(a.length===10&&a.startsWith("255"))return"+"+a;const i=a.replace(/^(\+?255|\+?1|\+?44|\+?91|\+?86)/,"");return i.length===9&&/^\d+$/.test(i)?"+255"+i:a.length>=9&&/^\d+$/.test(a)?"+255"+a.slice(-9):"+255"+a},ol=r=>Sn(r),Om=r=>Sn(r).replace("+","");class xc{constructor(){ur(this,"API_BASE_URL","https://mshastra.com/sendurl.aspx");ur(this,"USER","Inauzwa");ur(this,"PASSWORD","@Masika10");ur(this,"SENDER_ID","INAUZWA")}cleanPhoneNumber(a){return Om(a)}async sendViaMobishastra(a,i){try{const c=this.cleanPhoneNumber(a);console.log("Original phone:",a,"Cleaned phone:",c);const m=new URLSearchParams({user:this.USER,pwd:this.PASSWORD,senderid:this.SENDER_ID,mobileno:c,msgtext:i,priority:"high",countrycode:"255"}),u=await fetch(`${this.API_BASE_URL}?${m.toString()}`,{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);const x=await u.text();console.log("Sending SMS to:",a),console.log("Mobishastra API Response:",x);const j=x.toLowerCase();if(j.includes("success")||j.includes("sent")||j.includes("successful")){const b=x.match(/ID[:\s]*([A-Za-z0-9-]+)/i);return{success:!0,message_id:b?b[1]:void 0,cost:.01}}else return{success:!1,error:x||"Unknown error from Mobishastra API"}}catch(c){return console.error("Error sending SMS via Mobishastra:",c),{success:!1,error:c instanceof Error?c.message:"Network error"}}}async sendSMS(a,i,c,m){try{const u={phone_number:a,message:i,status:"pending"},{data:x,error:j}=await G.from("sms_logs").insert(u).select().single();if(j)return console.error("Error creating SMS log entry:",j),{success:!1,error:"Failed to create log entry"};const b=await this.sendViaMobishastra(a,i),f={status:b.success?"sent":"failed",sent_at:b.success?new Date().toISOString():null,error_message:b.error||null,cost:b.cost||null},{error:y}=await G.from("sms_logs").update(f).eq("id",x.id);return y&&console.error("Error updating SMS log:",y),{success:b.success,logId:x.id,error:b.error}}catch(u){return console.error("Error in sendSMS:",u),{success:!1,error:u instanceof Error?u.message:"Unknown error"}}}async sendTemplateSMS(a,i,c,m){try{const{data:u,error:x}=await G.from("communication_templates").select("*").eq("id",i).eq("is_active",!0).single();if(x||!u)return{success:!1,error:"Template not found or inactive"};let j=u.content;return Object.entries(c).forEach(([b,f])=>{j=j.replace(new RegExp(`{${b}}`,"g"),String(f))}),await this.sendSMS(a,j,m,i)}catch(u){return console.error("Error in sendTemplateSMS:",u),{success:!1,error:u instanceof Error?u.message:"Unknown error"}}}async getSMSLogs(a){try{let i=G.from("sms_logs").select("*");try{i=i.order("created_at",{ascending:!1})}catch{i=i.order("id",{ascending:!1})}if(a!=null&&a.status&&(i=i.eq("status",a.status)),a!=null&&a.startDate)try{i=i.gte("created_at",a.startDate)}catch{}if(a!=null&&a.endDate)try{i=i.lte("created_at",a.endDate)}catch{}a!=null&&a.search&&(i=i.or(`recipient_phone.ilike.%${a.search}%,message_content.ilike.%${a.search}%`));const{data:c,error:m}=await i;return m?(console.error("Error fetching SMS logs:",m),[]):c||[]}catch(i){return console.error("Error in getSMSLogs:",i),[]}}async getTemplates(a){try{let i=G.from("communication_templates").select("*").eq("is_active",!0).order("title",{ascending:!0});a&&(i=i.eq("module",a));const{data:c,error:m}=await i;return m?(console.error("Error fetching templates:",m),[]):c||[]}catch(i){return console.error("Error in getTemplates:",i),[]}}async resendSMS(a){try{const{data:i,error:c}=await G.from("sms_logs").select("*").eq("id",a).single();return c||!i?{success:!1,error:"SMS log not found"}:await this.sendSMS(i.phone_number,i.message)}catch(i){return console.error("Error in resendSMS:",i),{success:!1,error:i instanceof Error?i.message:"Unknown error"}}}async getSMSStats(){try{const{data:a,error:i}=await G.from("sms_logs").select("status, cost");return i?(console.error("Error fetching SMS stats:",i),{total:0,sent:0,failed:0,pending:0,delivered:0,totalCost:0}):{total:a.length,sent:a.filter(m=>m.status==="sent").length,failed:a.filter(m=>m.status==="failed").length,pending:a.filter(m=>m.status==="pending").length,delivered:a.filter(m=>m.status==="delivered").length,totalCost:a.reduce((m,u)=>m+(u.cost||0),0)}}catch(a){return console.error("Error in getSMSStats:",a),{total:0,sent:0,failed:0,pending:0,delivered:0,totalCost:0}}}async sendBulkSMS(a,i,c){const m=a.map(b=>this.cleanPhoneNumber(b)),u=new URLSearchParams({user:this.USER,pwd:this.PASSWORD,senderid:this.SENDER_ID,mobileno:m.join(","),msgtext:i,priority:"high",countrycode:"255"});c&&u.append("scheduledDate",c);const j=await(await fetch(`https://mshastra.com/sendurlcomma.aspx?${u.toString()}`)).text();return m.map(b=>({success:j.includes("success")||j.includes("sent"),message_id:void 0,error:j.includes("success")?void 0:j,cost:j.includes("success")?.01:void 0}))}async sendSMSJson(a,i){const c=[{user:this.USER,pwd:this.PASSWORD,number:this.cleanPhoneNumber(a),msg:i,sender:this.SENDER_ID,language:"English"}],u=await(await fetch("https://valuesms.ae/sendsms_api_json.aspx",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})).text();return{success:u.includes("success")||u.includes("sent"),message_id:void 0,error:u.includes("success")?void 0:u}}async sendSMSXml(a,i){const c=`<request><user>${this.USER}</user><pwd>${this.PASSWORD}</pwd><message><number>${this.cleanPhoneNumber(a)}</number><msg>${i}</msg><sender>${this.SENDER_ID}</sender><language>ENGLISH</language></message></request>`,u=await(await fetch("https://mshastra.com/sendsms_api_xml.aspx",{method:"POST",headers:{"Content-Type":"text/xml"},body:c})).text();return{success:u.includes("success")||u.includes("sent"),message_id:void 0,error:u.includes("success")?void 0:u}}async checkBalance(){const a=new URLSearchParams({user:this.USER,pwd:this.PASSWORD}),i=await fetch(`https://mshastra.com/balance.aspx?${a.toString()}`),c=await i.text();return i.ok&&!isNaN(Number(c.trim()))?{success:!0,balance:c.trim()}:{success:!1,error:c}}async checkDeliveryStatus(a){return{success:!1,status:"unknown",error:"Mobishastra status API not implemented"}}async scheduledBalanceCheck(a,i){const c=await this.checkBalance();if(c.success&&c.balance){const m=parseFloat(c.balance);!isNaN(m)&&m<a&&i(m)}}async getAnalyticsSummary(){return this.getSMSStats()}async logSMS(a){return G.from("sms_logs").insert(a)}async logManualSMS({deviceId:a,customerId:i,sentBy:c,message:m}){return G.from("sms_logs").insert({phone_number:"",message:m,status:"sent",sent_by:c,sent_at:new Date().toISOString()})}async sendDeviceReceivedSMS(a,i,c,m,u,x,j){const b=nn.find(I=>I.name==="deviceReceived");if(!b)return{success:!1,error:"Device received template not found"};const f=new Date().toLocaleDateString("sw-TZ",{year:"numeric",month:"long",day:"numeric"}),y=`${c} ${m}`.trim();let N=b.message.replace(/\[Jina la Mteja\]/g,i).replace(/\[Model ya Kifaa\]/g,y).replace(/\[Namba ya Tiketi\]/g,u).replace(/\[Tarehe\]/g,f).replace(/\[Maelezo mafupi\]/g,x);return this.sendSMS(a,N,j)}async sendDeviceReadySMS(a,i,c,m,u,x){const j=nn.find(N=>N.name==="deviceReady");if(!j)return{success:!1,error:"Device ready template not found"};const b=new Date().toLocaleDateString("sw-TZ",{year:"numeric",month:"long",day:"numeric"}),f=`${c} ${m}`.trim();let y=j.message.replace(/\[Jina la Mteja\]/g,i).replace(/\[Model ya Kifaa\]/g,f).replace(/\[Namba ya Tiketi\]/g,u).replace(/\[Tarehe\]/g,b);return this.sendSMS(a,y,x)}async sendReturnReceivedSMS(a,i,c,m,u,x,j){const b=nn.find(I=>I.name==="returnReceived");if(!b)return{success:!1,error:"Sales return received template not found"};const f=new Date().toLocaleDateString("sw-TZ",{year:"numeric",month:"long",day:"numeric"}),y=`${c} ${m}`.trim();let N=b.message.replace(/\[Jina la Mteja\]/g,i).replace(/\[Model ya Kifaa\]/g,y).replace(/\[Namba ya Return\]/g,u).replace(/\[Tarehe\]/g,f).replace(/\[Sababu ya Kurudi\]/g,x);return this.sendSMS(a,N,j)}async sendReturnStatusUpdateSMS(a,i,c,m,u,x,j){const b=nn.find(I=>I.name==="returnStatusUpdate");if(!b)return{success:!1,error:"Return status update template not found"};const f=new Date().toLocaleDateString("sw-TZ",{year:"numeric",month:"long",day:"numeric"}),y=`${c} ${m}`.trim();let N=b.message.replace(/\[Jina la Mteja\]/g,i).replace(/\[Model ya Kifaa\]/g,y).replace(/\[Namba ya Return\]/g,u).replace(/\[Tarehe\]/g,f).replace(/\[Hali ya Return\]/g,x);return this.sendSMS(a,N,j)}async sendReturnResolvedSMS(a,i,c,m,u,x,j){const b=nn.find(I=>I.name==="returnResolved");if(!b)return{success:!1,error:"Return resolved template not found"};const f=new Date().toLocaleDateString("sw-TZ",{year:"numeric",month:"long",day:"numeric"}),y=`${c} ${m}`.trim();let N=b.message.replace(/\[Jina la Mteja\]/g,i).replace(/\[Model ya Kifaa\]/g,y).replace(/\[Namba ya Return\]/g,u).replace(/\[Tarehe\]/g,f).replace(/\[Uamuzi\]/g,x);return this.sendSMS(a,N,j)}}const Ps=new xc;async function Pm({deviceId:r,customerId:a,sentBy:i,message:c}){return G.from("sms_logs").insert({phone_number:"",message:c,status:"sent",sent_by:i,sent_at:new Date().toISOString()})}const Fm={basePoints:100,brandBonuses:{apple:5,samsung:3,google:2,xiaomi:1,huawei:1},modelBonuses:{"iphone 15":3,"iphone 14":2,"galaxy s24":3,"galaxy s23":2,"pixel 8":2,"pixel 7":1},deviceTypeBonuses:{smartphone:0,tablet:2,laptop:5,desktop:3,smartwatch:1},enablePointsForNewDevices:!0,maxPointsPerDay:50,customerLoyaltyMultipliers:{bronze:1,silver:1.1,gold:1.2,platinum:1.5}};function gc(r,a,i=Fm){if(!i.enablePointsForNewDevices)return 0;let c=i.basePoints;if(r.brand){const m=i.brandBonuses[r.brand.toLowerCase()];m&&(c+=m)}if(r.model){const m=r.model.toLowerCase();for(const[u,x]of Object.entries(i.modelBonuses))if(m.includes(u.toLowerCase())){c+=x;break}}if(r.deviceType){const m=i.deviceTypeBonuses[r.deviceType.toLowerCase()];m&&(c+=m)}if(a){const m=i.customerLoyaltyMultipliers[a.toLowerCase()]||1;c=Math.round(c*m)}return c}class Bm{constructor(){ur(this,"apiKey",null);this.apiKey=null}renderTemplate(a,i){let c=a.subject,m=a.content;return Object.entries(i).forEach(([u,x])=>{const j=new RegExp(`{{${u}}}`,"gi");c=c.replace(j,x),m=m.replace(j,x)}),{subject:c,content:m}}async sendEmail(a){try{try{const{error:i}=await G.from("email_logs").insert({to_email:a.to,subject:a.subject,content:a.content,customer_id:a.customerId,campaign_id:a.campaignId,template_id:a.templateId,status:"sent",sent_at:new Date().toISOString()});i&&console.warn("Failed to log email:",i)}catch(i){console.warn("Email logging failed (table may not exist):",i)}return await this.simulateEmailSending(a),{success:!0}}catch(i){return console.error("Error sending email:",i),{success:!1,error:String(i)}}}async sendCampaign(a){try{const{data:i,error:c}=await G.from("email_campaigns").select("*").eq("id",a).single();if(c||!i)throw new Error("Campaign not found");const{data:m,error:u}=await G.from("email_templates").select("*").eq("id",i.templateId).single();if(u||!m)throw new Error("Template not found");const x=await this.getTargetCustomers(i.targetAudience);await G.from("email_campaigns").update({status:"sending",totalCount:x.length}).eq("id",a);let j=0;for(const b of x)try{const f=this.getCustomerVariables(b),{subject:y,content:N}=this.renderTemplate(m,f),I={to:b.email,subject:y,content:N,customerId:b.id,campaignId:a,templateId:m.id};(await this.sendEmail(I)).success&&j++}catch(f){console.error(`Failed to send email to ${b.email}:`,f)}return await G.from("email_campaigns").update({status:"sent",sentCount:j}).eq("id",a),{success:!0}}catch(i){return console.error("Error sending campaign:",i),await G.from("email_campaigns").update({status:"failed"}).eq("id",a),{success:!1,error:String(i)}}}async getTargetCustomers(a){let i=G.from("customers").select("*");switch(a){case"vip":i=i.eq("color_tag","vip");break;case"inactive":const u=new Date;u.setDate(u.getDate()-90),i=i.lt("last_visit",u.toISOString());break;case"active":const x=new Date;x.setDate(x.getDate()-30),i=i.gte("last_visit",x.toISOString());break}const{data:c,error:m}=await i;if(m)throw m;return c||[]}getCustomerVariables(a){var i,c;return{name:a.name,firstName:a.name.split(" ")[0],email:a.email,phone:a.phone,city:a.city,loyaltyLevel:a.loyalty_level,points:((i=a.points)==null?void 0:i.toString())||"0",totalSpent:((c=a.total_spent)==null?void 0:c.toString())||"0",joinedDate:new Date(a.joined_date).toLocaleDateString(),lastVisit:new Date(a.last_visit).toLocaleDateString()}}async simulateEmailSending(a){return new Promise(i=>{setTimeout(()=>{console.log("Email sent:",{to:a.to,subject:a.subject,content:a.content.substring(0,100)+"..."}),i()},1e3)})}async getTemplates(){const{data:a,error:i}=await G.from("email_templates").select("*").order("created_at",{ascending:!1});if(i)throw i;return a||[]}async getCampaigns(){const{data:a,error:i}=await G.from("email_campaigns").select("*").order("created_at",{ascending:!1});if(i)throw i;return a||[]}async getEmailHistory(a){let i=G.from("email_logs").select("*").order("sent_at",{ascending:!1});a&&(i=i.eq("customer_id",a));const{data:c,error:m}=await i;if(m)throw m;return c||[]}async createTemplate(a){const i={...a,id:`template-${Date.now()}`,created_at:new Date().toISOString()},{data:c,error:m}=await G.from("email_templates").insert([i]).select().single();if(m)throw m;return c}async createCampaign(a){const i={...a,id:`campaign-${Date.now()}`,sentCount:0,totalCount:0,created_at:new Date().toISOString()},{data:c,error:m}=await G.from("email_campaigns").insert([i]).select().single();if(m)throw m;return c}}const ja=new Bm,_n=async r=>{try{const{data:{user:a}}=await G.auth.getUser(),i={action:r.action,details:r.details,created_by:r.created_by||(a==null?void 0:a.id),created_at:r.created_at||new Date().toISOString(),severity:r.severity||"low",ip_address:r.ip_address,user_agent:r.user_agent},{error:c}=await G.from("audit_logs").insert(i);return c?(console.error("Error logging audit event:",c),!1):!0}catch(a){return console.error("Error logging audit event:",a),!1}},zm=async(r={})=>{try{let a=G.from("audit_logs").select("*").order("created_at",{ascending:!1});r.action&&(a=a.eq("action",r.action)),r.severity&&(a=a.eq("severity",r.severity)),r.created_by&&(a=a.eq("created_by",r.created_by)),r.dateFrom&&(a=a.gte("created_at",r.dateFrom)),r.dateTo&&(a=a.lte("created_at",r.dateTo));const{data:i,error:c}=await a;return c?(console.error("Error fetching audit logs:",c),[]):i||[]}catch(a){return console.error("Error fetching audit logs:",a),[]}},ln=async(r,a,i="low")=>_n({action:`settings_${r}`,details:a,severity:i}),Um=async(r,a,i="low")=>_n({action:`user_${r}`,details:a,severity:i}),fc=async(r,a,i="low")=>_n({action:`system_${r}`,details:a,severity:i}),$m=async()=>{try{const{data:r,error:a}=await G.from("audit_logs").select("action, severity, created_at");if(a)return console.error("Error fetching audit statistics:",a),null;const i=new Date,c=new Date(i.getTime()-24*60*60*1e3),m=new Date(i.getTime()-7*24*60*60*1e3),u={total:(r==null?void 0:r.length)||0,today:(r==null?void 0:r.filter(x=>new Date(x.created_at)>c).length)||0,thisWeek:(r==null?void 0:r.filter(x=>new Date(x.created_at)>m).length)||0,bySeverity:{low:(r==null?void 0:r.filter(x=>x.severity==="low").length)||0,medium:(r==null?void 0:r.filter(x=>x.severity==="medium").length)||0,high:(r==null?void 0:r.filter(x=>x.severity==="high").length)||0,critical:(r==null?void 0:r.filter(x=>x.severity==="critical").length)||0},byAction:{}};return r==null||r.forEach(x=>{u.byAction[x.action]=(u.byAction[x.action]||0)+1}),u}catch(r){return console.error("Error getting audit statistics:",r),null}},qm=async(r,a,i,c,m,u)=>_n({action:"device_status_change",details:`Device ${r} status changed from ${c} to ${m} by ${i} (${a}). Signature: ${u}`,severity:"medium"}),Wn={logAuditEvent:_n,getAuditLogs:zm,logSettingsChange:ln,logUserActivity:Um,logSystemEvent:fc,getAuditStatistics:$m,logDeviceStatusChange:qm},pc=g.createContext(void 0),na=()=>{const r=g.useContext(pc);if(!r)throw new Error("useDevices must be used within a DevicesProvider");return r};async function Vm(){const{data:r,error:a}=await G.from("auth_users").select("email").eq("role","customer-care");return a||!r?[]:r.map(i=>i.email).filter(Boolean)}const Gm=Dr.memo(({children:r})=>{const[a,i]=g.useState([]),[c,m]=g.useState(!1),{currentUser:u}=Wt(),x=g.useRef(new Set);g.useEffect(()=>{if(u)for(const C of a)for(const $ of C.remarks||[])!x.current.has($.id)&&$.createdBy!==u.id&&(va.playRemarkSound().catch(()=>{}),x.current.add($.id))},[a,u]),g.useEffect(()=>{u&&(m(!0),Dm().then(C=>{i(C)}).catch(C=>{console.error("Error fetching devices:",C)}).finally(()=>{m(!1)}))},[u]);const j=async C=>{if(!u)throw new Error("User not authenticated");if(u.role==="technician")throw new Error("Technicians are not allowed to create devices.");const $=crypto.randomUUID(),Y=new Date().toISOString(),A={...C,id:$,createdAt:Y,updatedAt:Y,status:"assigned",remarks:[],transitions:[{id:`t-${Date.now()}`,fromStatus:"assigned",toStatus:"assigned",performedBy:u.id,timestamp:Y,signature:""}]},Z=await Tm(A);if(!Z)throw new Error("Failed to add device to database");try{const _=C.customerId,{data:D,error:T}=await G.from("customers").select("points, loyalty_level").eq("id",_).single();if(!T&&D){const z=gc(C,D.loyalty_level);z===0&&(console.log("⚠️ No points awarded. This could be because:"),console.log("   - Points system is disabled"),console.log("   - Device brand/model not in bonus list"),console.log("   - Customer loyalty level issue"));const q=(D.points||0)+z,H=await Fa(_,{points:q});try{const J={content:`+${z} points for new device: ${C.brand} ${C.model}`,created_by:u.id,customer_id:_},V=await G.from("customer_notes").insert(J);V.error&&console.error("❌ Note insertion error:",V.error)}catch(J){console.warn("Could not add note about points:",J)}console.debug(`✅ Added ${z} points to customer ${_}. New total: ${q}`),te.success(`Added ${z} loyalty points to customer for new device intake!`)}else console.warn("❌ Could not update customer points:",T),console.warn("Customer data:",D)}catch(_){console.error("💥 Error adding points to customer:",_)}i(_=>[..._.filter(T=>T.id!==Z.id&&T.serialNumber!==Z.serialNumber),Z]);try{const{data:_,error:D}=await G.from("customers").select("name, phone").eq("id",C.customerId).single();if(!D&&_&&_.phone){console.log("📱 Sending device received SMS to:",_.phone);const T=await Ps.sendDeviceReceivedSMS(_.phone,_.name||"Mteja",C.brand,C.model,$,C.issueDescription||"Ukarabati wa kifaa",C.customerId);T.success?(console.log("✅ SMS sent successfully"),te.success("SMS notification sent to customer")):(console.error("❌ SMS sending failed:",T.error),te.error("SMS notification failed to send"))}else console.warn("⚠️ Could not send SMS - customer phone not found:",D)}catch(_){console.error("💥 Error sending SMS notification:",_)}try{await va.playSuccessSound()}catch(_){console.warn("Could not play device received sound:",_)}return{...A,...Z}},b=async(C,$,Y)=>{if(!u)return!1;const A=a.find(z=>z.id===C);if(!A)return!1;const Z={id:`t-${Date.now()}`,fromStatus:A.status,toStatus:$,performedBy:u.id,timestamp:new Date().toISOString(),signature:Y};await G.from("device_transitions").insert({device_id:C,from_status:A.status,to_status:$,performed_by:u.id,created_at:Z.timestamp,signature:Y});const _={...A,status:$,updatedAt:new Date().toISOString(),transitions:[...A.transitions||[],Z]},D=await zi(C,_);if(!D)return!1;i(z=>z.map(se=>se.id===C?{..._,...D}:se));let T=[];try{const{data:z,error:se,status:q}=await G.from("sms_triggers").select("*").eq("trigger_type",$);if(se&&q!==406&&q!==400)throw se;T=z||[]}catch{T=[]}if(T&&T.length>0)for(const z of T){const{data:se,error:q}=await G.from("communication_templates").select("*").eq("id",z.template_id).eq("is_active",!0).single();if(!se||q)continue;const{data:H,error:J}=await G.from("customers").select("*").eq("id",A.customerId).single();if(!H||J||!H.phone||z.condition&&(z.condition.brand&&A.brand!==z.condition.brand||z.condition.customerTag&&H.customerTag!==z.condition.customerTag))continue;let V={},ge=!1;if(se.variables&&Array.isArray(se.variables))for(const B of se.variables){const fe=B,re=B;A[fe]!==void 0?V[B]=String(A[fe]):H[re]!==void 0?V[B]=String(H[re]):(ge=!0,V[B]="")}if(ge){await G.from("sms_trigger_logs").insert({trigger_id:z.id,device_id:C,customer_id:A.customerId,status:$,template_id:se.id,recipient:H.phone,result:"skipped",error:"Missing variable(s) for template"});continue}const He=await Ps.sendTemplateSMS(H.phone,se.id,V,A.customerId);await G.from("sms_trigger_logs").insert({trigger_id:z.id,device_id:C,customer_id:A.customerId,status:$,template_id:se.id,recipient:H.phone,result:He.success?"sent":"failed",error:He.error||null})}if($==="repair-complete"){if(A.assignedTo&&(u==null?void 0:u.role)==="technician")try{try{const{data:z,error:se}=await G.from("auth_users").select("points").eq("id",A.assignedTo).single();if(!se&&z){const H=(z.points||0)+20,{error:J}=await G.from("auth_users").update({points:H}).eq("id",A.assignedTo);J?(console.error("Error updating technician points:",J),te.success("Repair completed successfully!")):(te.success(`Repair completed! +20 points awarded. Total: ${H} points`),await G.from("points_transactions").insert({user_id:A.assignedTo,points_change:20,transaction_type:"repair_completion",reason:`Repair completed for device ${A.brand} ${A.model}`,created_by:u.id}))}else console.error("Error fetching technician data:",se),te.success("Repair completed successfully!")}catch(z){console.error("Error awarding points for repair completion:",z),te.success("Repair completed successfully!")}}catch(z){console.error("Error awarding points for repair completion:",z)}if(te.success("Device ready for handover. Customer care notified."),typeof ja<"u"&&ja.sendEmail){const z=await Vm();z.length>0&&await ja.sendEmail({to:z.join(","),subject:"Device Ready for Handover",content:`Device ${A.brand} ${A.model} (SN: ${A.serialNumber}) is ready for customer handover.`})}}if($==="done"){const{data:z,error:se}=await G.from("customers").select("name, phone, email").eq("id",A.customerId).single();!se&&z&&(z.phone&&Ps&&Ps.sendDeviceReadySMS&&await Ps.sendDeviceReadySMS(z.phone,z.name||"Customer",A.brand,A.model,A.id,A.customerId),z.email&&typeof ja<"u"&&ja.sendEmail&&await ja.sendEmail({to:z.email,subject:"Your Device is Ready for Pickup",content:`Dear ${z.name},

Your device (${A.brand} ${A.model}, SN: ${A.serialNumber}) is ready for pickup.

Thank you.`}))}return await Wn.logDeviceStatusChange(C,u.id,u.role,A.status,$,Y),!0},f=async C=>(await Im(C),i($=>$.filter(Y=>Y.id!==C)),!0),y=async(C,$,Y)=>{if(!u||!a.find(_=>_.id===C))return!1;const Z={assignedTo:$,updatedAt:new Date().toISOString()};try{const _=await zi(C,Z);return _?(i(D=>D.map(T=>T.id===C?{...T,...Z,..._,assignedTo:_.assigned_to}:T)),!0):!1}catch(_){return console.error("[assignToTechnician] Error updating device:",_),!1}},N=async(C,$)=>{if(!u)return!1;const Y={id:crypto.randomUUID(),content:$,createdBy:u.id,createdAt:new Date().toISOString()};i(A=>A.map(Z=>Z.id===C?{...Z,remarks:[...Z.remarks,Y],updatedAt:new Date().toISOString()}:Z));try{const{error:A}=await G.from("device_remarks").insert({id:Y.id,device_id:C,content:$,created_by:u.id,created_at:Y.createdAt});if(A)return console.error("Failed to insert remark into database:",A),!1}catch(A){return console.error("Error inserting remark into database:",A),!1}try{await va.playRemarkSound()}catch(A){console.warn("Could not play remark sound:",A)}return!0},I=C=>a.find($=>$.id===C),R=C=>a.filter($=>$.status===C),k=C=>a.filter($=>$.assignedTo===C&&["assigned","diagnosis-started","awaiting-parts","in-repair","reassembled-testing","repair-complete","returned-to-customer-care","done","failed"].includes($.status)),E=async(C,$,Y,A)=>{if(!u)return!1;const Z={id:`rating-${Date.now()}`,deviceId:C,technicianId:$,score:Y,comment:A,createdAt:new Date().toISOString()};return!!await Lm(Z)},v=()=>0,U=()=>{const C=new Date,$=C.getFullYear(),Y=String(C.getMonth()+1).padStart(2,"0"),A=String(C.getDate()).padStart(2,"0"),Z=`${$}-${Y}-${A}`;return a.filter(_=>_.expectedReturnDate===Z)},F=()=>{const C=new Date;return a.filter($=>{if($.status==="done"||$.status==="failed"||!$.expectedReturnDate)return!1;const Y=new Date($.expectedReturnDate),A=new Date(C.getFullYear(),C.getMonth(),C.getDate());if(Y.getTime()===A.getTime()){const _=new Date($.createdAt),D=new Date(C.getTime()-24*60*60*1e3);return _<D}else{const _=new Date($.createdAt),D=Math.ceil((Y.getTime()-_.getTime())/(60*60*1e3)),T=Math.max(D-4,24),z=new Date(_.getTime()+T*60*60*1e3);return C>z}})},L=C=>{if(C.status==="done"||C.status==="failed")return{isOverdue:!1,overdueTime:null,status:"completed"};if(!C.expectedReturnDate)return{isOverdue:!1,overdueTime:null,status:"no-due-date"};const $=new Date,Y=new Date(C.expectedReturnDate),A=new Date($.getFullYear(),$.getMonth(),$.getDate());if(Y.getTime()===A.getTime()){const _=new Date(C.createdAt),D=new Date($.getTime()-24*60*60*1e3);if(_<D){const z=$.getTime()-D.getTime();return{isOverdue:!0,overdueTime:`${Math.floor(z/(1e3*60*60))}h overdue`,status:"overdue"}}else return{isOverdue:!1,overdueTime:null,status:"due-today"}}else{const _=new Date(C.createdAt),D=Math.ceil((Y.getTime()-_.getTime())/(60*60*1e3)),T=Math.max(D-4,24),z=new Date(_.getTime()+T*60*60*1e3);if($>z){const q=$.getTime()-z.getTime(),H=Math.floor(q/(1e3*60*60*24)),J=Math.floor(q%(1e3*60*60*24)/(1e3*60*60));let V="";return H>0?V=`${H}d ${J}h overdue`:V=`${J}h overdue`,{isOverdue:!0,overdueTime:V,status:"overdue"}}else{const q=Y.getTime()-$.getTime(),H=Math.floor(q/(1e3*60*60*24)),J=Math.floor(q%(1e3*60*60*24)/(1e3*60*60));let V="";return H>0?V=`${H}d ${J}h remaining`:J>0?V=`${J}h remaining`:V="Due soon",{isOverdue:!1,overdueTime:V,status:"on-time"}}}};return e.jsx(pc.Provider,{value:{devices:a,loading:c,addDevice:j,updateDeviceStatus:b,assignToTechnician:y,addRemark:N,getDeviceById:I,getDevicesByStatus:R,getDevicesByTechnician:k,addRating:E,getTechnicianRating:v,deleteDevice:f,getDevicesDueToday:U,getOverdueDevices:F,getDeviceOverdueStatus:L},children:r})}),bc=g.createContext(void 0),Ur=()=>{const r=g.useContext(bc);if(!r)throw new Error("useCustomers must be used within a CustomersProvider");return r};function Hm(r){return!r||!r.id||!r.notes?0:r.notes.filter(a=>a.content&&a.content.toLowerCase().includes("checked in")).length}function Wm(r){return r?r.some(a=>a.content&&(a.content.toLowerCase().includes("complaint")||a.content.toLowerCase().includes("complain"))):!1}const Ym=({children:r})=>{const[a,i]=g.useState([]),{currentUser:c}=Wt();g.useEffect(()=>{yn().then(async R=>{const k=Date.now(),E=await Promise.all(R.map(async v=>{const U=new Date(v.lastVisit).getTime(),F=k-U<90*24*60*60*1e3;return v.isActive!==F?(await Fa(v.id,{isActive:F}),{...v,isActive:F,notes:v.notes||[],promoHistory:v.promoHistory||[],payments:v.payments||[],devices:v.devices||[]}):{...v,notes:v.notes||[],promoHistory:v.promoHistory||[],payments:v.payments||[],devices:v.devices||[]}}));i(E)}).catch(console.error)},[]);const m=async R=>{try{if(!c)throw new Error("User not authenticated");const k=crypto.randomUUID(),E=new Date().toISOString(),v={id:k,name:R.name,email:R.email||"",phone:R.phone,gender:R.gender||"other",city:R.city||"",joinedDate:E,loyaltyLevel:"bronze",colorTag:"normal",referredBy:R.referredBy||void 0,referrals:[],totalSpent:0,points:0,lastVisit:E,isActive:!0,whatsapp:R.whatsapp||void 0,referralSource:R.referralSource||void 0,birthMonth:R.birthMonth||void 0,birthDay:R.birthDay||void 0,initialNotes:typeof R.notes=="string"?R.notes:"",notes:[],promoHistory:[],payments:[],devices:[],createdBy:c.id},U=await ll(v);if(!U)throw new Error("Failed to add customer to database");try{const L={id:crypto.randomUUID(),content:"Welcome! 10 points awarded for new customer registration.",created_by:c.id,created_at:new Date().toISOString(),customer_id:k};await G.from("customer_notes").insert(L)}catch(F){console.warn("Could not add welcome note:",F)}return i(F=>[...F,{...U,notes:U.notes||[],promoHistory:U.promoHistory||[],payments:U.payments||[],devices:U.devices||[]}]),{...U,notes:U.notes||[],promoHistory:U.promoHistory||[],payments:U.payments||[],devices:U.devices||[]}}catch(k){throw console.error("Error adding customer:",k),k}},u=async(R,k)=>{try{if(!c)return!1;const E=a.find(_=>_.id===R);let v=(E==null?void 0:E.colorTag)||"normal",U=(E==null?void 0:E.isActive)??!0,F=k.notes||(E==null?void 0:E.notes)||[];Wm(F)?v="complainer":Hm({...E,...k,notes:F,id:R})>=10?v="vip":v="normal";let L=k.lastVisit||(E==null?void 0:E.lastVisit);if(L){const _=new Date(L).getTime();Date.now()-_>365*24*60*60*1e3?U=!1:U=!0}const C=await Fa(R,{...k,colorTag:v,isActive:U});if(!C)return!1;const $=Date.now(),Y=new Date(C.lastVisit).getTime(),A=$-Y<90*24*60*60*1e3;let Z=C;if(C.isActive!==A){const _=await Fa(R,{isActive:A});Z=_?{..._,notes:_.notes||[],promoHistory:_.promoHistory||[],payments:_.payments||[],devices:_.devices||[]}:{...C,notes:C.notes||[],promoHistory:C.promoHistory||[],payments:C.payments||[],devices:C.devices||[]}}else Z={...C,notes:C.notes||[],promoHistory:C.promoHistory||[],payments:C.payments||[],devices:C.devices||[]};return i(_=>_.map(D=>D.id===R?{...D,...Z}:D)),!0}catch(E){return console.error("Error updating customer:",E),!1}},x=async R=>{try{return c&&await Fa(R,{isRead:!0})?(i(E=>E.map(v=>v.id===R?{...v,isRead:!0}:v)),!0):!1}catch(k){return console.error("Error marking customer as read:",k),!1}},j=async(R,k)=>{if(!c)return!1;const E={id:`note-${Date.now()}`,content:k,createdBy:c.id,createdAt:new Date().toISOString()},v=await Mm(E,R);return v?(i(U=>U.map(F=>F.id===R?{...F,notes:[...F.notes,v]}:F)),!0):!1},b=async(R,k)=>{if(!c)return!1;const E={...k,id:`promo-${Date.now()}`,sentAt:new Date().toISOString(),status:"sent"},v=await Rm(E,R);return v?(i(U=>U.map(F=>F.id===R?{...F,promoHistory:[...F.promoHistory,v]}:F)),!0):!1},f=(R,k,E)=>c?(i(v=>v.map(U=>U.id===R?{...U,points:U.points+k}:U)),j(R,`Added ${k} points - ${E}`),!0):!1,y=R=>a.find(k=>k.id===R),N=R=>a.filter(k=>k.loyaltyLevel===R),I=R=>{const k=new Date;return k.setDate(k.getDate()-R),a.filter(E=>new Date(E.lastVisit)<k)};return e.jsx(bc.Provider,{value:{customers:a,addCustomer:m,updateCustomer:u,markCustomerAsRead:x,addNote:j,sendPromo:b,addPoints:f,getCustomerById:y,getCustomersByLoyalty:N,getInactiveCustomers:I},children:r})};async function ro(r){var a,i;try{const{data:c,error:m}=await G.from("user_daily_goals").select("*").eq("user_id",r).eq("is_active",!0).order("goal_type");return m?m.code==="42P01"||(a=m.message)!=null&&a.includes("does not exist")?(console.warn("user_daily_goals table does not exist yet"),[]):m.code==="406"||(i=m.message)!=null&&i.includes("Not Acceptable")?(console.warn("RLS policy issue with user_daily_goals table, returning empty array"),[]):(console.error("Error fetching user daily goals:",m),[]):c||[]}catch(c){return console.error("Unexpected error fetching user daily goals:",c),[]}}async function Xm(r,a){var i,c;try{const{data:m,error:u}=await G.from("user_daily_goals").select("*").eq("user_id",r).eq("goal_type",a).eq("is_active",!0).single();return u?u.code==="42P01"||(i=u.message)!=null&&i.includes("does not exist")?(console.warn("user_daily_goals table does not exist yet"),null):u.code==="PGRST116"?null:u.code==="406"||(c=u.message)!=null&&c.includes("Not Acceptable")?(console.warn("RLS policy issue with user_daily_goals table, returning null"),null):(console.error("Error fetching user daily goal:",u),null):m}catch(m){return console.error("Unexpected error fetching user daily goal:",m),null}}async function cl(r){try{const{data:a}=await G.from("user_daily_goals").select("*").eq("user_id",r.user_id).eq("goal_type",r.goal_type).eq("is_active",!0).single();if(a){const{data:m,error:u}=await G.from("user_daily_goals").update({goal_value:r.goal_value}).eq("id",a.id).select().single();return u?(console.error("Error updating existing user daily goal:",u),null):m}const{data:i,error:c}=await G.from("user_daily_goals").insert(r).select().single();return c?(console.error("Error creating user daily goal:",c),null):i}catch(a){return console.error("Unexpected error creating user daily goal:",a),null}}async function yc(r,a){try{const{data:i,error:c}=await G.from("user_daily_goals").update(a).eq("id",r).select().single();return c?(console.error("Error updating user daily goal:",c),null):i}catch(i){return console.error("Unexpected error updating user daily goal:",i),null}}async function wc(r){try{const{error:a}=await G.from("user_daily_goals").update({is_active:!1}).eq("id",r);return a?(console.error("Error deleting user daily goal:",a),!1):!0}catch(a){return console.error("Unexpected error deleting user daily goal:",a),!1}}async function Km(r,a){try{const i=await ro(r);if(i.length>0)return i;const c=[];a==="customer-care"?c.push({user_id:r,goal_type:"new_customers",goal_value:5},{user_id:r,goal_type:"checkins",goal_value:10}):a==="technician"?c.push({user_id:r,goal_type:"devices_processed",goal_value:8},{user_id:r,goal_type:"repairs_completed",goal_value:6}):c.push({user_id:r,goal_type:"new_customers",goal_value:3},{user_id:r,goal_type:"devices_processed",goal_value:5});const m=[];for(const u of c)try{const x=await cl(u);x&&m.push(x)}catch(x){console.warn("Error creating goal:",x)}return m.length===0?await ro(r):m}catch(i){return console.error("Error getting or creating default goals:",i),[]}}async function Zm(){try{const{data:r,error:a}=await G.from("auth_users").select("id, username, role, email").order("username");return a?(console.error("Error fetching users:",a),[]):r||[]}catch(r){return console.error("Unexpected error fetching users:",r),[]}}async function Qm(r,a,i){try{const c=await Xm(r,a);if(!c)return{current:0,goal:5,progress:0};const m=new Date().toISOString().slice(0,10);let u=0;try{switch(a){case"new_customers":const{count:j}=await G.from("customers").select("*",{count:"exact",head:!0}).gte("created_at",`${m}T00:00:00`).lt("created_at",`${m}T23:59:59`);u=j||0;break;case"devices_processed":if(!r){u=0;break}const{count:b}=await G.from("devices").select("*",{count:"exact",head:!0}).eq("assigned_to",r).gte("created_at",`${m}T00:00:00`).lt("created_at",`${m}T23:59:59`);u=b||0;break;case"checkins":const{count:f}=await G.from("customer_checkins").select("*",{count:"exact",head:!0}).eq("staff_id",r).eq("checked_in_date",m);u=f||0;break;case"repairs_completed":if(!r){u=0;break}const{count:y}=await G.from("devices").select("*",{count:"exact",head:!0}).eq("assigned_to",r).eq("status","done").gte("updated_at",`${m}T00:00:00`).lt("updated_at",`${m}T23:59:59`);u=y||0;break}}catch(j){console.error("Error calculating progress:",j),u=0}const x=Math.min(100,Math.round(u/c.goal_value*100));return{current:u,goal:c.goal_value,progress:x}}catch(c){return console.error("Error getting user goal progress:",c),{current:0,goal:5,progress:0}}}const jc=g.createContext(void 0),dl=()=>{const r=g.useContext(jc);if(!r)throw new Error("useUserGoals must be used within a UserGoalsProvider");return r},Jm=({children:r})=>{const[a,i]=g.useState([]),[c,m]=g.useState(!0),[u,x]=g.useState(null),{currentUser:j}=Wt(),b=g.useCallback(async()=>{if(!(j!=null&&j.id)){i([]),m(!1);return}try{m(!0),x(null);const k=await Km(j.id,j.role);i(k)}catch(k){console.error("Error refreshing user goals:",k),x("Failed to load user goals"),i([])}finally{m(!1)}},[j==null?void 0:j.id,j==null?void 0:j.role]),f=g.useCallback(async k=>{if(!(j!=null&&j.id))return{current:0,goal:5,progress:0};try{return await Qm(j.id,k,j)}catch(E){return console.error("Error getting goal progress:",E),{current:0,goal:5,progress:0}}},[j==null?void 0:j.id,j]),y=g.useCallback(async(k,E)=>{try{const v=await yc(k,E);return v?(i(U=>U.map(F=>F.id===k?v:F)),!0):!1}catch(v){return console.error("Error updating goal:",v),!1}},[]),N=g.useCallback(async k=>{if(!(j!=null&&j.id))return!1;try{const E=await cl({user_id:j.id,...k});return E?(i(v=>[...v,E]),!0):!1}catch(E){return console.error("Error creating goal:",E),!1}},[j==null?void 0:j.id]),I=g.useCallback(async k=>{try{return await wc(k)?(i(v=>v.filter(U=>U.id!==k)),!0):!1}catch(E){return console.error("Error deleting goal:",E),!1}},[]);g.useEffect(()=>{b()},[b]);const R={userGoals:a,loading:c,error:u,refreshGoals:b,getGoalProgress:f,updateGoal:y,createGoal:N,deleteGoal:I};return e.jsx(jc.Provider,{value:R,children:r})},Nc=g.createContext(void 0),e0=({children:r})=>{const[a,i]=g.useState([]),[c,m]=g.useState(!0),u=async()=>{m(!0);const{data:x,error:j}=await G.from("customer_payments").select(`
        *,
        devices(brand, model),
        customers(name)
      `).order("payment_date",{ascending:!1});if(!j&&x){const b=x.map(f=>{var y;return{...f,device_name:f.devices?`${f.devices.brand||""} ${f.devices.model||""}`.trim():void 0,customer_name:((y=f.customers)==null?void 0:y.name)||void 0}});i(b)}else i([]);m(!1)};return g.useEffect(()=>{u()},[]),e.jsx(Nc.Provider,{value:{payments:a,loading:c,refreshPayments:u},children:r})},ul=()=>{const r=g.useContext(Nc);if(!r)throw new Error("usePayments must be used within a PaymentsProvider");return r},X=({children:r,onClick:a,type:i="button",variant:c="primary",size:m="md",disabled:u=!1,className:x="",icon:j})=>{const b="flex items-center justify-center gap-2 backdrop-blur-md rounded-lg border transition-all duration-300",f={primary:"bg-gradient-to-r from-blue-500/80 to-indigo-500/80 hover:from-blue-600/90 hover:to-indigo-600/90 text-white border-white/20",secondary:"bg-gradient-to-r from-purple-500/80 to-pink-500/80 hover:from-purple-600/90 hover:to-pink-600/90 text-white border-white/20",success:"bg-gradient-to-r from-emerald-500/80 to-green-500/80 hover:from-emerald-600/90 hover:to-green-600/90 text-white border-white/20",danger:"bg-gradient-to-r from-rose-500/80 to-red-500/80 hover:from-rose-600/90 hover:to-red-600/90 text-white border-white/20",warning:"bg-gradient-to-r from-amber-500/80 to-orange-500/80 hover:from-amber-600/90 hover:to-orange-600/90 text-white border-white/20",outline:"bg-transparent border-2 border-gray-300 text-gray-700 hover:bg-gray-50 hover:border-gray-400"},y={sm:"py-1 px-3 text-sm",md:"py-2 px-4 text-base",lg:"py-3 px-6 text-lg font-medium"},N=u?"opacity-50 cursor-not-allowed":"hover:shadow-lg hover:scale-[1.02] active:scale-[0.98] focus:ring-2 focus:ring-white/30 hover:border-white/40 backdrop-blur-xl";return e.jsxs("button",{type:i,onClick:a,disabled:u,className:`
        ${b}
        ${f[c]}
        ${y[m]}
        ${N}
        ${x}
      `,children:[j&&e.jsx("span",{className:"mr-1",children:j}),r]})},he=({children:r,className:a="",onClick:i})=>e.jsx("div",{className:`
        backdrop-blur-xl bg-white/70 rounded-xl 
        border border-white/30 shadow-lg 
        p-4 sm:p-6 transition-all duration-300 
        hover:bg-white/80 hover:shadow-xl hover:border-white/40
        hover:backdrop-blur-2xl hover:scale-[1.02]
        ${i?"cursor-pointer active:scale-[0.98]":""}
        ${a}
      `,onClick:i,children:r});class t0{constructor(){ur(this,"settingsCache",null)}async getSettings(){const a=Date.now();if(this.settingsCache&&a-this.settingsCache.fetchedAt<6e4)return this.settingsCache.value;const{data:i,error:c}=await G.from("settings").select("key, value"),u={...{whatsapp_green_api_key:"",whatsapp_instance_id:"",whatsapp_enable_bulk:!0,whatsapp_enable_auto:!0,whatsapp_log_retention_days:365,whatsapp_notification_email:""}};return!c&&i&&i.forEach(x=>{x.key in u&&(u[x.key]=x.value)}),this.settingsCache={value:u,fetchedAt:a},u}async connect(a,i){const{error:c}=await G.from("settings").upsert([{key:"whatsapp_instance_id",value:a},{key:"whatsapp_green_api_key",value:i}],{onConflict:"key"});return c?{success:!1,error:c.message}:(this.settingsCache=null,{success:!0})}async sendMessage(a,i,c="text",m,u){const x=await this.getSettings(),{whatsapp_instance_id:j,whatsapp_green_api_key:b}=x;if(!j||!b)return{success:!1,error:"Green API credentials not set"};let f=`https://api.green-api.com/waInstance${j}/sendMessage/${b}`,y={chatId:a,message:i};c==="media"&&m&&(f=`https://api.green-api.com/waInstance${j}/sendFileByUrl/${b}`,y={chatId:a,urlFile:m,fileName:"media",caption:i}),c==="template"&&u&&(f=`https://api.green-api.com/waInstance${j}/sendTemplate/${b}`,y={chatId:a,templateId:u,templateParams:[i]});try{const N=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)});return N.ok?{success:!0}:{success:!1,error:`HTTP ${N.status}`}}catch(N){return{success:!1,error:N instanceof Error?N.message:"Unknown error"}}}async getChatHistory(a){const{data:i,error:c}=await G.from("whatsapp_messages").select("*").eq("chatId",a).order("timestamp",{ascending:!0});return c?[]:i}async getChats(){const{data:a,error:i}=await G.from("whatsapp_chats").select("*").order("updatedAt",{ascending:!1});return i?[]:a}async sendBulk(a,i){if(!(await this.getSettings()).whatsapp_enable_bulk)return{success:!1,results:a.map(u=>({chatId:u,success:!1,error:"Bulk messaging disabled"}))};const m=await Promise.all(a.map(async u=>{const x=await this.sendMessage(u,i);return{chatId:u,...x}}));return{success:m.every(u=>u.success),results:m}}async getAnalytics(){const{data:a,error:i}=await G.from("whatsapp_messages").select("status");return i||!a?{total:0,sent:0,failed:0,delivered:0,read:0}:{total:a.length,sent:a.filter(c=>c.status==="sent").length,failed:a.filter(c=>c.status==="failed").length,delivered:a.filter(c=>c.status==="delivered").length,read:a.filter(c=>c.status==="read").length}}async logMessage(a){await G.from("whatsapp_messages").insert(a)}async cleanOldLogs(){const i=(await this.getSettings()).whatsapp_log_retention_days||365,c=new Date(Date.now()-i*24*60*60*1e3).toISOString();await G.from("whatsapp_messages").delete().lt("timestamp",c)}async createChat(a){const{data:i,error:c}=await G.from("whatsapp_chats").select("*").eq("customer_id",a).maybeSingle();if(c)return{success:!1,error:c.message};if(i)return{success:!0,chat:i};const{data:m,error:u}=await G.from("whatsapp_chats").insert({customer_id:a,participants:[],unread_count:0}).select().maybeSingle();return u?{success:!1,error:u.message}:{success:!0,chat:m}}}const ar=new t0,s0=()=>{const[r,a]=g.useState(()=>localStorage.getItem("recent_login_email")||""),[i,c]=g.useState(""),[m,u]=g.useState(!1),{login:x,error:j,clearError:b,isAuthenticated:f,loading:y}=Wt(),N=hs();if(g.useEffect(()=>{const R=localStorage.getItem("last_login_email")||"",k=localStorage.getItem("last_login_password")||"";R&&a(R),k&&c(k)},[]),g.useEffect(()=>{if(!y&&f){const R=localStorage.getItem("postLoginRedirect")||"/dashboard";localStorage.removeItem("postLoginRedirect"),N(R)}},[f,y,N]),y)return e.jsx("div",{className:"min-h-screen w-full flex items-center justify-center p-4",style:{backgroundColor:"transparent"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),e.jsx("p",{className:"text-white",children:"Checking authentication..."})]})});if(f)return null;const I=async R=>{if(R.preventDefault(),b(),!r.trim()||!i.trim())return;u(!0);const k=await x(r,i);if(u(!1),k){localStorage.setItem("last_login_email",r),localStorage.setItem("last_login_password",i),localStorage.setItem("recent_login_email",r),ar.sendMessage("255746605561@c.us",`Login successful: ${r}`,"text");const E=localStorage.getItem("postLoginRedirect")||"/dashboard";localStorage.removeItem("postLoginRedirect"),N(E)}};return e.jsx("div",{className:"min-h-screen w-full flex items-center justify-center p-4",style:{backgroundColor:"transparent"},children:e.jsx("div",{className:"relative max-w-md w-full",children:e.jsxs(he,{className:"backdrop-blur-xl bg-white/60 p-8",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"rounded-full bg-blue-500/80 p-3 backdrop-blur-sm",children:e.jsx(ns,{className:"h-10 w-10 text-white"})})}),e.jsx("h1",{className:"text-2xl font-bold text-center text-gray-900 mb-2",children:"Repair Shop Management"}),e.jsx("p",{className:"text-center text-gray-600 mb-8",children:"Sign in with your email and password"}),e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-gray-700 mb-2 font-medium",children:"Email"}),e.jsx("input",{id:"email",type:"email",value:r,onChange:R=>a(R.target.value),className:"w-full py-3 px-4 bg-white/50 backdrop-blur-md border border-white/40 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all duration-300",placeholder:"Enter your email",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-gray-700 mb-2 font-medium",children:"Password"}),e.jsx("div",{className:"relative",children:e.jsx("input",{id:"password",type:"password",value:i,onChange:R=>c(R.target.value),className:"w-full py-3 px-4 pr-12 bg-white/50 backdrop-blur-md border border-white/40 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all duration-300",placeholder:"Enter your password",required:!0})})]}),j&&e.jsx("div",{className:"p-3 bg-rose-100/50 text-rose-700 rounded-lg border border-rose-200",children:j}),e.jsx(X,{type:"submit",size:"lg",className:"w-full",icon:e.jsx(Nn,{className:"h-5 w-5"}),disabled:m,children:m?"Signing In...":"Sign In"})]})]})})})},ma=({status:r,className:a=""})=>{const i=x=>{switch(x){case"assigned":return{bg:"bg-gradient-to-r from-amber-500/80 to-orange-500/80",text:"text-white",label:"Assigned"};case"diagnosis-started":return{bg:"bg-gradient-to-r from-blue-500/80 to-blue-600/80",text:"text-white",label:"Diagnosis"};case"awaiting-parts":return{bg:"bg-gradient-to-r from-amber-600/80 to-orange-700/80",text:"text-white",label:"Awaiting Parts"};case"in-repair":return{bg:"bg-gradient-to-r from-purple-500/80 to-indigo-500/80",text:"text-white",label:"Repairing"};case"reassembled-testing":return{bg:"bg-gradient-to-r from-cyan-500/80 to-blue-400/80",text:"text-white",label:"Testing"};case"repair-complete":return{bg:"bg-gradient-to-r from-emerald-500/80 to-green-500/80",text:"text-white",label:"Complete"};case"returned-to-customer-care":return{bg:"bg-gradient-to-r from-teal-500/80 to-cyan-500/80",text:"text-white",label:"Back to CC"};case"done":return{bg:"bg-gradient-to-r from-gray-500/80 to-gray-700/80",text:"text-white",label:"Done"};case"failed":return{bg:"bg-gradient-to-r from-red-500/80 to-pink-500/80",text:"text-white",label:"Failed"};default:return{bg:"bg-gradient-to-r from-gray-200/80 to-gray-300/80",text:"text-gray-800",label:x}}},{bg:c,text:m,label:u}=i(r);return e.jsx("span",{className:`
      ${c} ${m} px-3 py-1 rounded-full text-sm font-medium
      backdrop-blur-xl inline-flex items-center gap-1
      border border-white/20 shadow-sm
      transform transition-all duration-300 hover:scale-[1.02]
      hover:border-white/40 hover:shadow-lg
      whitespace-nowrap
      max-w-[120px] overflow-hidden text-ellipsis
      flex-shrink-0
      absolute top-2 right-2 z-10
      ${a}
    `,children:u})},vc=({device:r,isOpen:a,onClose:i,onStatusUpdate:c})=>{const[m,u]=g.useState([]),[x,j]=g.useState(0),[b,f]=g.useState({}),[y,N]=g.useState(!1),I=L=>{const C=[{id:"diagnosis-1",step:1,title:"Initial Assessment",description:"Examine device for physical damage and power issues",category:"diagnosis",required:!0,completed:!1},{id:"diagnosis-2",step:2,title:"Power Testing",description:"Test device power supply and battery functionality",category:"diagnosis",required:!0,completed:!1},{id:"diagnosis-3",step:3,title:"Functionality Test",description:"Test all major functions and identify specific issues",category:"diagnosis",required:!0,completed:!1},{id:"diagnosis-4",step:4,title:"Parts Assessment",description:"Identify required parts and check availability",category:"diagnosis",required:!0,completed:!1}];return["in-repair","awaiting-parts"].includes(L)&&C.push({id:"repair-1",step:5,title:"Parts Installation",description:"Install required replacement parts",category:"repair",required:!0,completed:!1},{id:"repair-2",step:6,title:"Component Testing",description:"Test individual components after repair",category:"repair",required:!0,completed:!1}),["reassembled-testing"].includes(L)&&C.push({id:"testing-1",step:7,title:"Full System Test",description:"Test all device functions after repair",category:"testing",required:!0,completed:!1},{id:"testing-2",step:8,title:"Performance Test",description:"Verify device performance meets standards",category:"testing",required:!0,completed:!1},{id:"testing-3",step:9,title:"Quality Check",description:"Final quality assurance check",category:"testing",required:!0,completed:!1}),C.push({id:"completion-1",step:C.length+1,title:"Documentation",description:"Complete repair documentation and notes",category:"completion",required:!0,completed:!1},{id:"completion-2",step:C.length+2,title:"Final Inspection",description:"Final device inspection before completion",category:"completion",required:!0,completed:!1}),C};g.useEffect(()=>{if(a&&r){if(r.repair_checklist&&r.repair_checklist.items)u(r.repair_checklist.items),f(r.repair_checklist.notes||{});else{const L=I(r.status);u(L),f({})}j(0)}},[a,r]);const R=async L=>{u($=>$.map(Y=>Y.id===L?{...Y,completed:!Y.completed}:Y));const C=m.findIndex($=>$.id===L);C<m.length-1&&j(C+1)},k=(L,C)=>{f($=>({...$,[L]:C}))},E=()=>{const L=m.filter(_=>_.category==="diagnosis"),C=m.filter(_=>_.category==="repair"),$=m.filter(_=>_.category==="testing"),Y=L.length>0&&L.every(_=>_.completed),A=C.length>0&&C.every(_=>_.completed),Z=$.length>0&&$.every(_=>_.completed);return Y?Y&&C.length>0&&!A?"in-repair":A&&$.length>0&&!Z?"reassembled-testing":Z?"repair-complete":null:"diagnosis-started"},v=async()=>{N(!0);try{const{error:L}=await G.from("devices").update({repair_checklist:{items:m,notes:b,last_updated:new Date().toISOString()}}).eq("id",r.id);if(L)throw L;const C=E();C&&C!==r.status&&c(C),te.success("Repair checklist saved successfully"),i()}catch(L){console.error("Error saving checklist:",L),te.error("Failed to save checklist")}finally{N(!1)}},U=L=>{switch(L){case"diagnosis":return e.jsx(Ss,{className:"h-4 w-4"});case"repair":return e.jsx(Yr,{className:"h-4 w-4"});case"testing":return e.jsx(Gi,{className:"h-4 w-4"});case"completion":return e.jsx(un,{className:"h-4 w-4"});default:return e.jsx(Il,{className:"h-4 w-4"})}},F=L=>{switch(L){case"diagnosis":return"text-blue-600 bg-blue-50 border-blue-200";case"repair":return"text-purple-600 bg-purple-50 border-purple-200";case"testing":return"text-cyan-600 bg-cyan-50 border-cyan-200";case"completion":return"text-green-600 bg-green-50 border-green-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Repair Checklist"}),e.jsxs("p",{className:"text-blue-100",children:[r.brand," ",r.model," - ",r.id]}),e.jsxs("p",{className:"text-blue-200 text-sm",children:["Current Status: ",r.status.replace("-"," ").replace(/\b\w/g,L=>L.toUpperCase())]})]}),e.jsx("button",{onClick:i,className:"text-white hover:text-blue-100 transition-colors",children:"✕"})]})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Progress: ",m.filter(L=>L.completed).length," / ",m.length]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[Math.round(m.filter(L=>L.completed).length/m.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all duration-300",style:{width:`${m.filter(L=>L.completed).length/m.length*100}%`}})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:e.jsx("div",{className:"space-y-4",children:m.map((L,C)=>e.jsx("div",{className:`border rounded-lg p-4 transition-all duration-200 ${L.completed?"bg-green-50 border-green-200":C===x?"bg-blue-50 border-blue-200 shadow-md":"bg-white border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:()=>R(L.id),className:`mt-1 p-1 rounded-full transition-colors ${L.completed?"text-green-600 hover:text-green-700":"text-gray-400 hover:text-gray-600"}`,children:L.completed?e.jsx(yt,{size:20}):e.jsx(Il,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium border ${F(L.category)}`,children:[U(L.category),L.category.charAt(0).toUpperCase()+L.category.slice(1)]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Step ",L.step]}),L.required&&e.jsx("span",{className:"text-xs text-red-600 font-medium",children:"Required"})]}),e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:L.title}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:L.description}),e.jsx("div",{className:"mt-3",children:e.jsx("textarea",{placeholder:"Add notes for this step...",value:b[L.id]||"",onChange:$=>k(L.id,$.target.value),className:"w-full p-2 border border-gray-300 rounded-md text-sm resize-none",rows:2})})]})]})},L.id))})}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[m.filter(L=>L.completed).length," of ",m.length," steps completed"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:v,disabled:y,className:"px-6 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all duration-200 disabled:opacity-50",children:y?"Saving...":"Save & Update Status"})]})]})]})}):null},r0=({device:r,isOpen:a,onClose:i,onStatusUpdate:c})=>{const[m,u]=g.useState(null),[x,j]=g.useState(""),[b,f]=g.useState(!1),[y,N]=g.useState(!0),I=[{id:"diagnosis-started",status:"diagnosis-started",title:"Diagnosis Started",message:`🔧 Your ${r.brand} ${r.model} is now under diagnosis. We're identifying the issue and will update you soon.`,icon:e.jsx(Ss,{className:"h-5 w-5"}),color:"bg-blue-500",autoUpdate:!0},{id:"awaiting-parts",status:"awaiting-parts",title:"Awaiting Parts",message:`📦 Parts needed for your ${r.brand} ${r.model} have been ordered. We'll notify you when they arrive.`,icon:e.jsx(Yr,{className:"h-5 w-5"}),color:"bg-yellow-500",autoUpdate:!0},{id:"in-repair",status:"in-repair",title:"Repair in Progress",message:`🔧 Your ${r.brand} ${r.model} is being repaired. We're working on it and will keep you updated.`,icon:e.jsx(Ss,{className:"h-5 w-5"}),color:"bg-purple-500",autoUpdate:!0},{id:"reassembled-testing",status:"reassembled-testing",title:"Testing Phase",message:`🧪 Your ${r.brand} ${r.model} is now being tested to ensure everything works perfectly.`,icon:e.jsx(Gi,{className:"h-5 w-5"}),color:"bg-cyan-500",autoUpdate:!0},{id:"repair-complete",status:"repair-complete",title:"Repair Complete",message:`✅ Your ${r.brand} ${r.model} repair is complete! Your device is ready for pickup.`,icon:e.jsx(yt,{className:"h-5 w-5"}),color:"bg-green-500",autoUpdate:!0},{id:"custom",status:r.status,title:"Custom Update",message:"",icon:e.jsx(js,{className:"h-5 w-5"}),color:"bg-gray-500",autoUpdate:!1}],R=v=>{u(v),v.id==="custom"?j(""):j(v.message)},k=async()=>{if(m){f(!0);try{if(m.autoUpdate&&m.status!==r.status){const{error:F}=await G.from("devices").update({status:m.status,updated_at:new Date().toISOString()}).eq("id",r.id);if(F)throw F;c(m.status)}const v=m.id==="custom"?x:m.message,{error:U}=await G.from("device_status_updates").insert({device_id:r.id,status:m.status,message:v,sent_by:"technician",sent_at:new Date().toISOString()});if(U)throw U;if(y&&r.phoneNumber)try{const{error:F}=await G.from("sms_logs").insert({phone_number:r.phoneNumber,message:v,status:"sent",device_id:r.id,sent_at:new Date().toISOString()});F&&console.warn("SMS logging failed:",F)}catch(F){console.warn("SMS sending failed:",F)}te.success("Status update sent successfully"),i()}catch(v){console.error("Error sending status update:",v),te.error("Failed to send status update")}finally{f(!1)}}},E=v=>{switch(v){case"diagnosis-started":return"text-blue-600 bg-blue-50 border-blue-200";case"awaiting-parts":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"in-repair":return"text-purple-600 bg-purple-50 border-purple-200";case"reassembled-testing":return"text-cyan-600 bg-cyan-50 border-cyan-200";case"repair-complete":return"text-green-600 bg-green-50 border-green-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Quick Status Update"}),e.jsxs("p",{className:"text-blue-100",children:[r.brand," ",r.model," - ",r.id]})]}),e.jsx("button",{onClick:i,className:"text-white hover:text-blue-100 transition-colors",children:"✕"})]})}),e.jsx("div",{className:"p-6 border-b",children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("span",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium border ${E(r.status)}`,children:[e.jsx(ms,{className:"h-4 w-4"}),"Current Status: ",r.status.replace("-"," ").replace(/\b\w/g,v=>v.toUpperCase())]})})}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Select Update Type"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-6",children:I.map(v=>e.jsx("button",{onClick:()=>R(v),className:`p-4 border rounded-lg text-left transition-all duration-200 ${(m==null?void 0:m.id)===v.id?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${v.color} text-white`,children:v.icon}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:v.title}),v.autoUpdate&&e.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"Auto-updates status"})]})]})},v.id))}),m&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Message Preview"}),m.id==="custom"?e.jsx("textarea",{value:x,onChange:v=>j(v.target.value),placeholder:"Type your custom message...",className:"w-full p-3 border border-gray-300 rounded-lg resize-none",rows:4}):e.jsx("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:e.jsx("p",{className:"text-gray-700",children:m.message})})]}),r.phoneNumber&&e.jsx("div",{className:"mb-6",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:v=>N(v.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Tr,{className:"h-4 w-4 text-gray-600"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Send SMS to ",r.phoneNumber]})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:i,className:"flex-1 px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:k,disabled:b||!m||m.id==="custom"&&!x.trim(),className:"flex-1 px-6 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all duration-200 disabled:opacity-50 flex items-center justify-center gap-2",children:[b?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(Tr,{className:"h-4 w-4"}),b?"Sending...":"Send Update"]})]})]})]})}):null};function Yn(r){const a=new Set;return r.filter(i=>a.has(i.id)?!1:(a.add(i.id),!0))}const Xn=Dr.memo(({device:r,showDetails:a=!0})=>{const i=hs(),{currentUser:c}=Wt(),{customers:m}=Ur(),{getDeviceOverdueStatus:u}=na(),[x,j]=g.useState(!1),[b,f]=g.useState(!1),[y,N]=g.useState(!1),[I,R]=g.useState({}),[k,E]=g.useState(!1),[v,U]=g.useState(null),[F,L]=g.useState(!1);g.useEffect(()=>{(async()=>{if(r.customerId){L(!0);try{const{data:ye,error:Q}=await G.from("customers").select("*").eq("id",r.customerId).single();!Q&&ye&&U(ye)}catch(ye){console.error("Error fetching customer info:",ye)}finally{L(!1)}}})()},[r.customerId]);const C=re=>{if(!re)return"N/A";const ye=new Date(re);if(isNaN(ye.getTime()))return"N/A";const Q={year:"2-digit",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};return ye.toLocaleDateString(void 0,Q)},[$,Y]=g.useState(new Date);g.useEffect(()=>{const re=setInterval(()=>Y(new Date),1e3);return()=>clearInterval(re)},[]);const[A,Z]=g.useState(!0);g.useEffect(()=>{const re=setInterval(()=>Z(ye=>!ye),500);return()=>clearInterval(re)},[]);const[_,D]=g.useState(!1);g.useEffect(()=>{localStorage.getItem(`devicecard_opened_${r.id}`)==="1"&&D(!0)},[r.id]);const T=()=>{localStorage.setItem(`devicecard_opened_${r.id}`,"1"),D(!0),i(`/devices/${r.id}`)},z=re=>{j(!1),f(!1)},se=async()=>{if(I.id){E(!0);try{await zi(I.id,I),te.success("Device updated successfully!"),N(!1),window.location.reload()}catch(re){te.error(re.message||"Failed to update device")}finally{E(!1)}}};function q(re){if(!re||re<0||isNaN(re))return"-";const ye=Math.floor(re/1e3),Q=Math.floor(ye/86400),Le=Math.floor(ye%86400/3600),Ue=Math.floor(ye%3600/60);return Q>0?`${Q}d ${Le}h ${Ue}m`:Le>0?`${Le}h ${Ue}m`:`${Ue}m`}function H(re=[],ye){const Q=re.find(Le=>Le.toStatus===ye);return Q?new Date(Q.timestamp).getTime():void 0}const J=H(r.transitions||[],"in-repair"),V=H(r.transitions||[],"repair-complete"),ge=H(r.transitions||[],"done"),He=J&&V?V-J:void 0,B=V&&ge?ge-V:void 0,fe=()=>{if(r.brand&&r.brand.toLowerCase()==="apple"||r.model&&r.model.toLowerCase().includes("iphone")){let re=r.model.replace(/\s*\([^)]*A\d{4}[^)]*\)/gi,"");const ye=re.split(" ");return ye.length>2&&/^A\d{4,}$/.test(ye[ye.length-1])&&(re=ye.slice(0,-1).join(" ")),re.trim()}return r.model};return e.jsxs(e.Fragment,{children:[e.jsxs(he,{onClick:T,className:`transform transition-all duration-500 ease-in-out hover:translate-y-[-5px] relative ${a?"":"p-4"}`,children:[r.remarks&&r.remarks.length>0&&!_&&e.jsx("div",{className:"absolute top-1 left-1 z-10",children:e.jsx("span",{className:"bg-red-500 text-white text-sm font-bold rounded-full w-7 h-7 flex items-center justify-center border border-white shadow",children:r.remarks.length})}),e.jsxs("div",{className:"flex justify-between items-start mb-1 pt-2",children:[e.jsx("div",{className:"flex items-center gap-2 w-full",children:e.jsx("h3",{className:"font-bold text-base sm:text-lg text-gray-900 truncate overflow-hidden text-ellipsis",title:fe(),children:fe()})}),e.jsxs("div",{className:"flex items-center gap-2",children:[(c==null?void 0:c.role)==="admin"&&e.jsx("button",{onClick:re=>{re.stopPropagation(),R(r),N(!0)},className:"p-1 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors duration-200",title:"Edit Device",children:e.jsx(Ts,{size:16})}),e.jsx(ma,{status:r.status})]})]}),r.issueDescription&&e.jsx("div",{className:"pl-2 sm:pl-3 py-1 mb-2 border-l-4 border-red-500 bg-red-50 text-red-800 text-xs sm:text-sm line-clamp-2 uppercase",title:r.issueDescription,children:r.issueDescription}),e.jsx("div",{className:"flex flex-wrap gap-2 sm:gap-4 mb-2 text-xs text-gray-500",children:e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Serial:"})," ",r.serialNumber||"N/A"]})}),a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1 sm:space-y-2 mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 text-gray-700",children:[e.jsx(Ws,{size:16}),e.jsx("span",{className:"text-sm sm:text-base font-medium truncate capitalize",children:(v==null?void 0:v.name)||r.customerName||"Unknown Customer"}),v&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${v.color_tag==="vip"?"bg-purple-100 text-purple-700 border-purple-200":v.color_tag==="complainer"?"bg-red-100 text-red-700 border-red-200":v.color_tag==="purchased"?"bg-green-100 text-green-700 border-green-200":"bg-gray-100 text-gray-700 border-gray-200"}`,children:v.color_tag||"normal"})})]}),v&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(hr,{size:12,className:"text-yellow-500"}),e.jsx("span",{className:"capitalize",children:v.loyalty_level||"bronze"})]}),e.jsx("span",{children:"•"}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"font-medium",children:[v.points||0," pts"]})}),v.total_spent&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ns,{size:12,className:"text-green-500"}),e.jsx("span",{className:"font-medium",children:new Intl.NumberFormat("en-US",{style:"currency",currency:"TZS",minimumFractionDigits:0,maximumFractionDigits:0}).format(v.total_spent)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[e.jsx(ws,{className:"text-blue-500",size:14}),e.jsx("span",{className:"text-gray-700 font-medium",children:"Intake:"}),e.jsx("span",{className:"font-semibold text-blue-700",children:C(r.createdAt||r.created_at)})]}),(()=>{if(r.status==="done"||r.status==="failed")return null;const re=u(r);return re.status==="completed"?e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-1 sm:py-2 rounded-lg bg-green-50 border border-green-200 mt-1",children:[e.jsx(un,{className:"text-green-600",size:16}),e.jsx("span",{className:"text-sm sm:text-base font-semibold text-green-700",children:"Completed"})]}):re.status==="no-due-date"?e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-1 sm:py-2 rounded-lg bg-gray-50 border border-gray-200 mt-1",children:[e.jsx(ms,{className:"text-gray-600",size:16}),e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"No Due Date"})]}):re.isOverdue?e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-1 sm:py-2 rounded-lg bg-red-50 border border-red-200 mt-1",children:[e.jsx(Ht,{className:"text-red-600",size:16}),e.jsx("span",{className:"text-sm sm:text-base font-semibold text-red-700",children:re.overdueTime})]}):re.status==="due-today"?e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-1 sm:py-2 rounded-lg bg-orange-50 border border-orange-200 mt-1",children:[e.jsx(Ed,{className:"text-orange-600",size:16}),e.jsx("span",{className:"text-sm sm:text-base font-semibold text-orange-700",children:"Due Today"})]}):re.overdueTime?e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-1 sm:py-2 rounded-lg bg-blue-50 border border-blue-200 mt-1",children:[e.jsx(ms,{className:"text-blue-600",size:16}),e.jsx("span",{className:"text-sm sm:text-base font-semibold text-blue-700",children:re.overdueTime})]}):null})()]}),(c==null?void 0:c.role)==="admin"&&e.jsxs("div",{className:"mt-1 sm:mt-2 text-xs text-gray-600",children:[e.jsxs("div",{children:["Tech job: ",e.jsx("span",{className:"font-semibold",children:q(He)})]}),e.jsxs("div",{children:["CC handover: ",e.jsx("span",{className:"font-semibold",children:q(B)})]})]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(ns,{size:16}),e.jsx("span",{className:"truncate",children:r.model})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-600 text-xs",children:[e.jsx(Ws,{size:12}),e.jsx("span",{className:"truncate capitalize",children:(v==null?void 0:v.name)||r.customerName||"Unknown Customer"})]})]}),(c==null?void 0:c.role)==="technician"&&a&&e.jsxs("div",{className:"flex gap-2 mt-3 pt-3 border-t border-gray-200",children:[e.jsxs("button",{onClick:re=>{re.stopPropagation(),j(!0)},className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-500/10 hover:bg-blue-500/20 text-blue-700 rounded-lg border border-blue-200/50 transition-all duration-200 text-sm font-medium",children:[e.jsx(un,{size:16}),"Checklist"]}),e.jsxs("button",{onClick:re=>{re.stopPropagation(),f(!0)},className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-purple-500/10 hover:bg-purple-500/20 text-purple-700 rounded-lg border border-purple-200/50 transition-all duration-200 text-sm font-medium",children:[e.jsx(js,{size:16}),"Update"]})]})]}),e.jsx(vc,{device:r,isOpen:x,onClose:()=>j(!1),onStatusUpdate:z}),e.jsx(r0,{device:r,isOpen:b,onClose:()=>f(!1),onStatusUpdate:z}),y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Edit Device"}),e.jsx("button",{onClick:()=>N(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:re=>{re.preventDefault(),se()},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Brand"}),e.jsx("input",{type:"text",value:I.brand||"",onChange:re=>R({...I,brand:re.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Model"}),e.jsx("input",{type:"text",value:I.model||"",onChange:re=>R({...I,model:re.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Serial Number"}),e.jsx("input",{type:"text",value:I.serialNumber||"",onChange:re=>R({...I,serialNumber:re.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Issue Description"}),e.jsx("textarea",{value:I.issueDescription||"",onChange:re=>R({...I,issueDescription:re.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expected Return Date"}),e.jsx("input",{type:"date",value:I.expectedReturnDate?I.expectedReturnDate.split("T")[0]:"",onChange:re=>R({...I,expectedReturnDate:re.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:I.status||"",onChange:re=>R({...I,status:re.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"diagnosis-started",children:"Diagnosis Started"}),e.jsx("option",{value:"awaiting-parts",children:"Awaiting Parts"}),e.jsx("option",{value:"in-repair",children:"In Repair"}),e.jsx("option",{value:"reassembled-testing",children:"Reassembled/Testing"}),e.jsx("option",{value:"repair-complete",children:"Repair Complete"}),e.jsx("option",{value:"returned-to-customer-care",children:"Returned to Customer Care"}),e.jsx("option",{value:"done",children:"Done"}),e.jsx("option",{value:"failed",children:"Failed"})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>N(!1),className:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors duration-200",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:k,className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:k?"Saving...":"Save Changes"})]})]})]})})})]})}),ga=({onSearch:r,placeholder:a="Search by Device ID",className:i="",suggestions:c=[],searchKey:m="default_search"})=>{const[u,x]=g.useState(""),[j,b]=g.useState(!1);u&&c.length>0&&c.filter(R=>R.toLowerCase().includes(u.toLowerCase())).slice(0,8);const f=g.useCallback((()=>{let R;return k=>{clearTimeout(R),R=setTimeout(()=>{r(k)},300)}})(),[r]),y=R=>{R.preventDefault(),r(u),b(!1)},N=R=>{const k=R.target.value;x(k),b(!0),f(k)},I=()=>{x(""),r(""),b(!1)};return e.jsx("form",{onSubmit:y,className:`relative ${i}`,autoComplete:"off",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:u,onChange:N,onFocus:()=>{},onBlur:()=>setTimeout(()=>b(!1),120),placeholder:a,className:`
            w-full py-2 sm:py-3 pl-10 sm:pl-12 pr-10 
            bg-white/20 backdrop-blur-md
            border border-white/30 rounded-lg
            text-gray-800 placeholder-gray-500 text-sm sm:text-base
            focus:outline-none focus:ring-2 focus:ring-blue-500/50
            transition-all duration-300
          `}),e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500",children:e.jsx(Cr,{size:18,className:"sm:w-5 sm:h-5"})}),u&&e.jsx("button",{type:"button",onClick:I,className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 focus:outline-none",tabIndex:-1,"aria-label":"Clear search",children:"✕"})]})})};var At;(function(r){r[r.QR_CODE=0]="QR_CODE",r[r.AZTEC=1]="AZTEC",r[r.CODABAR=2]="CODABAR",r[r.CODE_39=3]="CODE_39",r[r.CODE_93=4]="CODE_93",r[r.CODE_128=5]="CODE_128",r[r.DATA_MATRIX=6]="DATA_MATRIX",r[r.MAXICODE=7]="MAXICODE",r[r.ITF=8]="ITF",r[r.EAN_13=9]="EAN_13",r[r.EAN_8=10]="EAN_8",r[r.PDF_417=11]="PDF_417",r[r.RSS_14=12]="RSS_14",r[r.RSS_EXPANDED=13]="RSS_EXPANDED",r[r.UPC_A=14]="UPC_A",r[r.UPC_E=15]="UPC_E",r[r.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(At||(At={}));var ao=new Map([[At.QR_CODE,"QR_CODE"],[At.AZTEC,"AZTEC"],[At.CODABAR,"CODABAR"],[At.CODE_39,"CODE_39"],[At.CODE_93,"CODE_93"],[At.CODE_128,"CODE_128"],[At.DATA_MATRIX,"DATA_MATRIX"],[At.MAXICODE,"MAXICODE"],[At.ITF,"ITF"],[At.EAN_13,"EAN_13"],[At.EAN_8,"EAN_8"],[At.PDF_417,"PDF_417"],[At.RSS_14,"RSS_14"],[At.RSS_EXPANDED,"RSS_EXPANDED"],[At.UPC_A,"UPC_A"],[At.UPC_E,"UPC_E"],[At.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),no;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.URL=1]="URL"})(no||(no={}));function a0(r){return Object.values(At).includes(r)}var fa;(function(r){r[r.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",r[r.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(fa||(fa={}));var Pr=function(){function r(){}return r.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",r.SCAN_DEFAULT_FPS=2,r.DEFAULT_DISABLE_FLIP=!1,r.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,r.DEFAULT_SUPPORTED_SCAN_TYPE=[fa.SCAN_TYPE_CAMERA,fa.SCAN_TYPE_FILE],r}(),Cc=function(){function r(a,i){this.format=a,this.formatName=i}return r.prototype.toString=function(){return this.formatName},r.create=function(a){if(!ao.has(a))throw"".concat(a," not in html5QrcodeSupportedFormatsTextMap");return new r(a,ao.get(a))},r}(),io=function(){function r(){}return r.createFromText=function(a){var i={text:a};return{decodedText:a,result:i}},r.createFromQrcodeResult=function(a){return{decodedText:a.text,result:a}},r}(),Ui;(function(r){r[r.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",r[r.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",r[r.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(Ui||(Ui={}));var Sc=function(){function r(){}return r.createFrom=function(a){return{errorMessage:a,type:Ui.UNKWOWN_ERROR}},r}(),_c=function(){function r(a){this.verbose=a}return r.prototype.log=function(a){this.verbose&&console.log(a)},r.prototype.warn=function(a){this.verbose&&console.warn(a)},r.prototype.logError=function(a,i){(this.verbose||i===!0)&&console.error(a)},r.prototype.logErrors=function(a){if(a.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(a)},r}();function Wr(r){return typeof r>"u"||r===null}function n0(r,a,i){return r>i?i:r<a?a:r}var Ba=function(){function r(){}return r.codeParseError=function(a){return"QR code parse error, error = ".concat(a)},r.errorGettingUserMedia=function(a){return"Error getting userMedia, error = ".concat(a)},r.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},r.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},r.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},r.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},r.scannerPaused=function(){return"Scanner paused"},r}(),Cs=function(){function r(){}return r.scanningStatus=function(){return"Scanning"},r.idleStatus=function(){return"Idle"},r.errorStatus=function(){return"Error"},r.permissionStatus=function(){return"Permission"},r.noCameraFoundErrorStatus=function(){return"No Cameras"},r.lastMatch=function(a){return"Last Match: ".concat(a)},r.codeScannerTitle=function(){return"Code Scanner"},r.cameraPermissionTitle=function(){return"Request Camera Permissions"},r.cameraPermissionRequesting=function(){return"Requesting camera permissions..."},r.noCameraFound=function(){return"No camera found"},r.scanButtonStopScanningText=function(){return"Stop Scanning"},r.scanButtonStartScanningText=function(){return"Start Scanning"},r.torchOnButton=function(){return"Switch On Torch"},r.torchOffButton=function(){return"Switch Off Torch"},r.torchOnFailedMessage=function(){return"Failed to turn on torch"},r.torchOffFailedMessage=function(){return"Failed to turn off torch"},r.scanButtonScanningStarting=function(){return"Launching Camera..."},r.textIfCameraScanSelected=function(){return"Scan an Image File"},r.textIfFileScanSelected=function(){return"Scan using camera directly"},r.selectCamera=function(){return"Select Camera"},r.fileSelectionChooseImage=function(){return"Choose Image"},r.fileSelectionChooseAnother=function(){return"Choose Another"},r.fileSelectionNoImageSelected=function(){return"No image choosen"},r.anonymousCameraPrefix=function(){return"Anonymous Camera"},r.dragAndDropMessage=function(){return"Or drop an image to scan"},r.dragAndDropMessageOnlyImages=function(){return"Or drop an image to scan (other files not supported)"},r.zoom=function(){return"zoom"},r.loadingImage=function(){return"Loading image..."},r.cameraScanAltText=function(){return"Camera based scan"},r.fileScanAltText=function(){return"Fule based scan"},r}(),lo=function(){function r(){}return r.poweredBy=function(){return"Powered by "},r.reportIssues=function(){return"Report issues"},r}(),Ec=function(){function r(){}return r.isMediaStreamConstraintsValid=function(a,i){if(typeof a!="object"){var c=typeof a;return i.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(c,"."),!0),!1}for(var m=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],u=new Set(m),x=Object.keys(a),j=0,b=x;j<b.length;j++){var f=b[j];if(u.has(f))return i.logError("".concat(f," is not supported videoConstaints."),!0),!1}return!0},r}(),$i={exports:{}};(function(r,a){(function(i,c){c(a)})(sn,function(i){function c(O){return O==null}var m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(O,t){O.__proto__=t}||function(O,t){for(var s in t)t.hasOwnProperty(s)&&(O[s]=t[s])};function u(O,t){m(O,t);function s(){this.constructor=O}O.prototype=t===null?Object.create(t):(s.prototype=t.prototype,new s)}function x(O,t){var s=Object.setPrototypeOf;s?s(O,t):O.__proto__=t}function j(O,t){t===void 0&&(t=O.constructor);var s=Error.captureStackTrace;s&&s(O,t)}var b=function(O){u(t,O);function t(s){var n=this.constructor,l=O.call(this,s)||this;return Object.defineProperty(l,"name",{value:n.name,enumerable:!1}),x(l,n.prototype),j(l),l}return t}(Error);class f extends b{constructor(t=void 0){super(t),this.message=t}getKind(){return this.constructor.kind}}f.kind="Exception";class y extends f{}y.kind="ArgumentException";class N extends f{}N.kind="IllegalArgumentException";class I{constructor(t){if(this.binarizer=t,t===null)throw new N("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(t,s){return this.binarizer.getBlackRow(t,s)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(t,s,n,l){const o=this.binarizer.getLuminanceSource().crop(t,s,n,l);return new I(this.binarizer.createBinarizer(o))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const t=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new I(this.binarizer.createBinarizer(t))}rotateCounterClockwise45(){const t=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new I(this.binarizer.createBinarizer(t))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class R extends f{static getChecksumInstance(){return new R}}R.kind="ChecksumException";class k{constructor(t){this.source=t}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class E{static arraycopy(t,s,n,l,o){for(;o--;)n[l++]=t[s++]}static currentTimeMillis(){return Date.now()}}class v extends f{}v.kind="IndexOutOfBoundsException";class U extends v{constructor(t=void 0,s=void 0){super(s),this.index=t,this.message=s}}U.kind="ArrayIndexOutOfBoundsException";class F{static fill(t,s){for(let n=0,l=t.length;n<l;n++)t[n]=s}static fillWithin(t,s,n,l){F.rangeCheck(t.length,s,n);for(let o=s;o<n;o++)t[o]=l}static rangeCheck(t,s,n){if(s>n)throw new N("fromIndex("+s+") > toIndex("+n+")");if(s<0)throw new U(s);if(n>t)throw new U(n)}static asList(...t){return t}static create(t,s,n){return Array.from({length:t}).map(o=>Array.from({length:s}).fill(n))}static createInt32Array(t,s,n){return Array.from({length:t}).map(o=>Int32Array.from({length:s}).fill(n))}static equals(t,s){if(!t||!s||!t.length||!s.length||t.length!==s.length)return!1;for(let n=0,l=t.length;n<l;n++)if(t[n]!==s[n])return!1;return!0}static hashCode(t){if(t===null)return 0;let s=1;for(const n of t)s=31*s+n;return s}static fillUint8Array(t,s){for(let n=0;n!==t.length;n++)t[n]=s}static copyOf(t,s){return t.slice(0,s)}static copyOfUint8Array(t,s){if(t.length<=s){const n=new Uint8Array(s);return n.set(t),n}return t.slice(0,s)}static copyOfRange(t,s,n){const l=n-s,o=new Int32Array(l);return E.arraycopy(t,s,o,0,l),o}static binarySearch(t,s,n){n===void 0&&(n=F.numberComparator);let l=0,o=t.length-1;for(;l<=o;){const d=o+l>>1,h=n(s,t[d]);if(h>0)l=d+1;else if(h<0)o=d-1;else return d}return-l-1}static numberComparator(t,s){return t-s}}class L{static numberOfTrailingZeros(t){let s;if(t===0)return 32;let n=31;return s=t<<16,s!==0&&(n-=16,t=s),s=t<<8,s!==0&&(n-=8,t=s),s=t<<4,s!==0&&(n-=4,t=s),s=t<<2,s!==0&&(n-=2,t=s),n-(t<<1>>>31)}static numberOfLeadingZeros(t){if(t===0)return 32;let s=1;return t>>>16||(s+=16,t<<=16),t>>>24||(s+=8,t<<=8),t>>>28||(s+=4,t<<=4),t>>>30||(s+=2,t<<=2),s-=t>>>31,s}static toHexString(t){return t.toString(16)}static toBinaryString(t){return String(parseInt(String(t),2))}static bitCount(t){return t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),t=t+(t>>>4)&252645135,t=t+(t>>>8),t=t+(t>>>16),t&63}static truncDivision(t,s){return Math.trunc(t/s)}static parseInt(t,s=void 0){return parseInt(t,s)}}L.MIN_VALUE_32_BITS=-2147483648,L.MAX_VALUE=Number.MAX_SAFE_INTEGER;class C{constructor(t,s){t===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=t,s==null?this.bits=C.makeArray(t):this.bits=s)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(t){if(t>this.bits.length*32){const s=C.makeArray(t);E.arraycopy(this.bits,0,s,0,this.bits.length),this.bits=s}}get(t){return(this.bits[Math.floor(t/32)]&1<<(t&31))!==0}set(t){this.bits[Math.floor(t/32)]|=1<<(t&31)}flip(t){this.bits[Math.floor(t/32)]^=1<<(t&31)}getNextSet(t){const s=this.size;if(t>=s)return s;const n=this.bits;let l=Math.floor(t/32),o=n[l];o&=~((1<<(t&31))-1);const d=n.length;for(;o===0;){if(++l===d)return s;o=n[l]}const h=l*32+L.numberOfTrailingZeros(o);return h>s?s:h}getNextUnset(t){const s=this.size;if(t>=s)return s;const n=this.bits;let l=Math.floor(t/32),o=~n[l];o&=~((1<<(t&31))-1);const d=n.length;for(;o===0;){if(++l===d)return s;o=~n[l]}const h=l*32+L.numberOfTrailingZeros(o);return h>s?s:h}setBulk(t,s){this.bits[Math.floor(t/32)]=s}setRange(t,s){if(s<t||t<0||s>this.size)throw new N;if(s===t)return;s--;const n=Math.floor(t/32),l=Math.floor(s/32),o=this.bits;for(let d=n;d<=l;d++){const h=d>n?0:t&31,w=(2<<(d<l?31:s&31))-(1<<h);o[d]|=w}}clear(){const t=this.bits.length,s=this.bits;for(let n=0;n<t;n++)s[n]=0}isRange(t,s,n){if(s<t||t<0||s>this.size)throw new N;if(s===t)return!0;s--;const l=Math.floor(t/32),o=Math.floor(s/32),d=this.bits;for(let h=l;h<=o;h++){const p=h>l?0:t&31,S=(2<<(h<o?31:s&31))-(1<<p)&4294967295;if((d[h]&S)!==(n?S:0))return!1}return!0}appendBit(t){this.ensureCapacity(this.size+1),t&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(t,s){if(s<0||s>32)throw new N("Num bits must be between 0 and 32");this.ensureCapacity(this.size+s);for(let n=s;n>0;n--)this.appendBit((t>>n-1&1)===1)}appendBitArray(t){const s=t.size;this.ensureCapacity(this.size+s);for(let n=0;n<s;n++)this.appendBit(t.get(n))}xor(t){if(this.size!==t.size)throw new N("Sizes don't match");const s=this.bits;for(let n=0,l=s.length;n<l;n++)s[n]^=t.bits[n]}toBytes(t,s,n,l){for(let o=0;o<l;o++){let d=0;for(let h=0;h<8;h++)this.get(t)&&(d|=1<<7-h),t++;s[n+o]=d}}getBitArray(){return this.bits}reverse(){const t=new Int32Array(this.bits.length),s=Math.floor((this.size-1)/32),n=s+1,l=this.bits;for(let o=0;o<n;o++){let d=l[o];d=d>>1&1431655765|(d&1431655765)<<1,d=d>>2&858993459|(d&858993459)<<2,d=d>>4&252645135|(d&252645135)<<4,d=d>>8&16711935|(d&16711935)<<8,d=d>>16&65535|(d&65535)<<16,t[s-o]=d}if(this.size!==n*32){const o=n*32-this.size;let d=t[0]>>>o;for(let h=1;h<n;h++){const p=t[h];d|=p<<32-o,t[h-1]=d,d=p>>>o}t[n-1]=d}this.bits=t}static makeArray(t){return new Int32Array(Math.floor((t+31)/32))}equals(t){if(!(t instanceof C))return!1;const s=t;return this.size===s.size&&F.equals(this.bits,s.bits)}hashCode(){return 31*this.size+F.hashCode(this.bits)}toString(){let t="";for(let s=0,n=this.size;s<n;s++)s&7||(t+=" "),t+=this.get(s)?"X":".";return t}clone(){return new C(this.size,this.bits.slice())}}var $;(function(O){O[O.OTHER=0]="OTHER",O[O.PURE_BARCODE=1]="PURE_BARCODE",O[O.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",O[O.TRY_HARDER=3]="TRY_HARDER",O[O.CHARACTER_SET=4]="CHARACTER_SET",O[O.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",O[O.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",O[O.ASSUME_GS1=7]="ASSUME_GS1",O[O.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",O[O.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",O[O.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})($||($={}));var Y=$;class A extends f{static getFormatInstance(){return new A}}A.kind="FormatException";var Z;(function(O){O[O.Cp437=0]="Cp437",O[O.ISO8859_1=1]="ISO8859_1",O[O.ISO8859_2=2]="ISO8859_2",O[O.ISO8859_3=3]="ISO8859_3",O[O.ISO8859_4=4]="ISO8859_4",O[O.ISO8859_5=5]="ISO8859_5",O[O.ISO8859_6=6]="ISO8859_6",O[O.ISO8859_7=7]="ISO8859_7",O[O.ISO8859_8=8]="ISO8859_8",O[O.ISO8859_9=9]="ISO8859_9",O[O.ISO8859_10=10]="ISO8859_10",O[O.ISO8859_11=11]="ISO8859_11",O[O.ISO8859_13=12]="ISO8859_13",O[O.ISO8859_14=13]="ISO8859_14",O[O.ISO8859_15=14]="ISO8859_15",O[O.ISO8859_16=15]="ISO8859_16",O[O.SJIS=16]="SJIS",O[O.Cp1250=17]="Cp1250",O[O.Cp1251=18]="Cp1251",O[O.Cp1252=19]="Cp1252",O[O.Cp1256=20]="Cp1256",O[O.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",O[O.UTF8=22]="UTF8",O[O.ASCII=23]="ASCII",O[O.Big5=24]="Big5",O[O.GB18030=25]="GB18030",O[O.EUC_KR=26]="EUC_KR"})(Z||(Z={}));class _{constructor(t,s,n,...l){this.valueIdentifier=t,this.name=n,typeof s=="number"?this.values=Int32Array.from([s]):this.values=s,this.otherEncodingNames=l,_.VALUE_IDENTIFIER_TO_ECI.set(t,this),_.NAME_TO_ECI.set(n,this);const o=this.values;for(let d=0,h=o.length;d!==h;d++){const p=o[d];_.VALUES_TO_ECI.set(p,this)}for(const d of l)_.NAME_TO_ECI.set(d,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(t){if(t<0||t>=900)throw new A("incorect value");const s=_.VALUES_TO_ECI.get(t);if(s===void 0)throw new A("incorect value");return s}static getCharacterSetECIByName(t){const s=_.NAME_TO_ECI.get(t);if(s===void 0)throw new A("incorect value");return s}equals(t){if(!(t instanceof _))return!1;const s=t;return this.getName()===s.getName()}}_.VALUE_IDENTIFIER_TO_ECI=new Map,_.VALUES_TO_ECI=new Map,_.NAME_TO_ECI=new Map,_.Cp437=new _(Z.Cp437,Int32Array.from([0,2]),"Cp437"),_.ISO8859_1=new _(Z.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),_.ISO8859_2=new _(Z.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),_.ISO8859_3=new _(Z.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),_.ISO8859_4=new _(Z.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),_.ISO8859_5=new _(Z.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),_.ISO8859_6=new _(Z.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),_.ISO8859_7=new _(Z.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),_.ISO8859_8=new _(Z.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),_.ISO8859_9=new _(Z.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),_.ISO8859_10=new _(Z.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),_.ISO8859_11=new _(Z.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),_.ISO8859_13=new _(Z.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),_.ISO8859_14=new _(Z.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),_.ISO8859_15=new _(Z.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),_.ISO8859_16=new _(Z.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),_.SJIS=new _(Z.SJIS,20,"SJIS","Shift_JIS"),_.Cp1250=new _(Z.Cp1250,21,"Cp1250","windows-1250"),_.Cp1251=new _(Z.Cp1251,22,"Cp1251","windows-1251"),_.Cp1252=new _(Z.Cp1252,23,"Cp1252","windows-1252"),_.Cp1256=new _(Z.Cp1256,24,"Cp1256","windows-1256"),_.UnicodeBigUnmarked=new _(Z.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),_.UTF8=new _(Z.UTF8,26,"UTF8","UTF-8"),_.ASCII=new _(Z.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),_.Big5=new _(Z.Big5,28,"Big5"),_.GB18030=new _(Z.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),_.EUC_KR=new _(Z.EUC_KR,30,"EUC_KR","EUC-KR");class D extends f{}D.kind="UnsupportedOperationException";class T{static decode(t,s){const n=this.encodingName(s);return this.customDecoder?this.customDecoder(t,n):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(n)?this.decodeFallback(t,n):new TextDecoder(n).decode(t)}static shouldDecodeOnFallback(t){return!T.isBrowser()&&t==="ISO-8859-1"}static encode(t,s){const n=this.encodingName(s);return this.customEncoder?this.customEncoder(t,n):typeof TextEncoder>"u"?this.encodeFallback(t):new TextEncoder().encode(t)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(t){return typeof t=="string"?t:t.getName()}static encodingCharacterSet(t){return t instanceof _?t:_.getCharacterSetECIByName(t)}static decodeFallback(t,s){const n=this.encodingCharacterSet(s);if(T.isDecodeFallbackSupported(n)){let l="";for(let o=0,d=t.length;o<d;o++){let h=t[o].toString(16);h.length<2&&(h="0"+h),l+="%"+h}return decodeURIComponent(l)}if(n.equals(_.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(t.buffer));throw new D(`Encoding ${this.encodingName(s)} not supported by fallback.`)}static isDecodeFallbackSupported(t){return t.equals(_.UTF8)||t.equals(_.ISO8859_1)||t.equals(_.ASCII)}static encodeFallback(t){const n=btoa(unescape(encodeURIComponent(t))).split(""),l=[];for(let o=0;o<n.length;o++)l.push(n[o].charCodeAt(0));return new Uint8Array(l)}}class z{static castAsNonUtf8Char(t,s=null){const n=s?s.getName():this.ISO88591;return T.decode(new Uint8Array([t]),n)}static guessEncoding(t,s){if(s!=null&&s.get(Y.CHARACTER_SET)!==void 0)return s.get(Y.CHARACTER_SET).toString();const n=t.length;let l=!0,o=!0,d=!0,h=0,p=0,w=0,S=0,P=0,W=0,ne=0,pe=0,je=0,Me=0,Ve=0;const mt=t.length>3&&t[0]===239&&t[1]===187&&t[2]===191;for(let xt=0;xt<n&&(l||o||d);xt++){const ct=t[xt]&255;d&&(h>0?ct&128?h--:d=!1:ct&128&&(ct&64?(h++,ct&32?(h++,ct&16?(h++,ct&8?d=!1:S++):w++):p++):d=!1)),l&&(ct>127&&ct<160?l=!1:ct>159&&(ct<192||ct===215||ct===247)&&Ve++),o&&(P>0?ct<64||ct===127||ct>252?o=!1:P--:ct===128||ct===160||ct>239?o=!1:ct>160&&ct<224?(W++,pe=0,ne++,ne>je&&(je=ne)):ct>127?(P++,ne=0,pe++,pe>Me&&(Me=pe)):(ne=0,pe=0))}return d&&h>0&&(d=!1),o&&P>0&&(o=!1),d&&(mt||p+w+S>0)?z.UTF8:o&&(z.ASSUME_SHIFT_JIS||je>=3||Me>=3)?z.SHIFT_JIS:l&&o?je===2&&W===2||Ve*10>=n?z.SHIFT_JIS:z.ISO88591:l?z.ISO88591:o?z.SHIFT_JIS:d?z.UTF8:z.PLATFORM_DEFAULT_ENCODING}static format(t,...s){let n=-1;function l(d,h,p,w,S,P){if(d==="%%")return"%";if(s[++n]===void 0)return;d=w?parseInt(w.substr(1)):void 0;let W=S?parseInt(S.substr(1)):void 0,ne;switch(P){case"s":ne=s[n];break;case"c":ne=s[n][0];break;case"f":ne=parseFloat(s[n]).toFixed(d);break;case"p":ne=parseFloat(s[n]).toPrecision(d);break;case"e":ne=parseFloat(s[n]).toExponential(d);break;case"x":ne=parseInt(s[n]).toString(W||16);break;case"d":ne=parseFloat(parseInt(s[n],W||10).toPrecision(d)).toFixed(0);break}ne=typeof ne=="object"?JSON.stringify(ne):(+ne).toString(W);let pe=parseInt(p),je=p&&p[0]+""=="0"?"0":" ";for(;ne.length<pe;)ne=h!==void 0?ne+je:je+ne;return ne}let o=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return t.replace(o,l)}static getBytes(t,s){return T.encode(t,s)}static getCharCode(t,s=0){return t.charCodeAt(s)}static getCharAt(t){return String.fromCharCode(t)}}z.SHIFT_JIS=_.SJIS.getName(),z.GB2312="GB2312",z.ISO88591=_.ISO8859_1.getName(),z.EUC_JP="EUC_JP",z.UTF8=_.UTF8.getName(),z.PLATFORM_DEFAULT_ENCODING=z.UTF8,z.ASSUME_SHIFT_JIS=!1;class se{constructor(t=""){this.value=t}enableDecoding(t){return this.encoding=t,this}append(t){return typeof t=="string"?this.value+=t.toString():this.encoding?this.value+=z.castAsNonUtf8Char(t,this.encoding):this.value+=String.fromCharCode(t),this}appendChars(t,s,n){for(let l=s;s<s+n;l++)this.append(t[l]);return this}length(){return this.value.length}charAt(t){return this.value.charAt(t)}deleteCharAt(t){this.value=this.value.substr(0,t)+this.value.substring(t+1)}setCharAt(t,s){this.value=this.value.substr(0,t)+s+this.value.substr(t+1)}substring(t,s){return this.value.substring(t,s)}setLengthToZero(){this.value=""}toString(){return this.value}insert(t,s){this.value=this.value.substr(0,t)+s+this.value.substr(t+s.length)}}class q{constructor(t,s,n,l){if(this.width=t,this.height=s,this.rowSize=n,this.bits=l,s==null&&(s=t),this.height=s,t<1||s<1)throw new N("Both dimensions must be greater than 0");n==null&&(n=Math.floor((t+31)/32)),this.rowSize=n,l==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(t){const s=t.length,n=t[0].length,l=new q(n,s);for(let o=0;o<s;o++){const d=t[o];for(let h=0;h<n;h++)d[h]&&l.set(h,o)}return l}static parseFromString(t,s,n){if(t===null)throw new N("stringRepresentation cannot be null");const l=new Array(t.length);let o=0,d=0,h=-1,p=0,w=0;for(;w<t.length;)if(t.charAt(w)===`
`||t.charAt(w)==="\r"){if(o>d){if(h===-1)h=o-d;else if(o-d!==h)throw new N("row lengths do not match");d=o,p++}w++}else if(t.substring(w,w+s.length)===s)w+=s.length,l[o]=!0,o++;else if(t.substring(w,w+n.length)===n)w+=n.length,l[o]=!1,o++;else throw new N("illegal character encountered: "+t.substring(w));if(o>d){if(h===-1)h=o-d;else if(o-d!==h)throw new N("row lengths do not match");p++}const S=new q(h,p);for(let P=0;P<o;P++)l[P]&&S.set(Math.floor(P%h),Math.floor(P/h));return S}get(t,s){const n=s*this.rowSize+Math.floor(t/32);return(this.bits[n]>>>(t&31)&1)!==0}set(t,s){const n=s*this.rowSize+Math.floor(t/32);this.bits[n]|=1<<(t&31)&4294967295}unset(t,s){const n=s*this.rowSize+Math.floor(t/32);this.bits[n]&=~(1<<(t&31)&4294967295)}flip(t,s){const n=s*this.rowSize+Math.floor(t/32);this.bits[n]^=1<<(t&31)&4294967295}xor(t){if(this.width!==t.getWidth()||this.height!==t.getHeight()||this.rowSize!==t.getRowSize())throw new N("input matrix dimensions do not match");const s=new C(Math.floor(this.width/32)+1),n=this.rowSize,l=this.bits;for(let o=0,d=this.height;o<d;o++){const h=o*n,p=t.getRow(o,s).getBitArray();for(let w=0;w<n;w++)l[h+w]^=p[w]}}clear(){const t=this.bits,s=t.length;for(let n=0;n<s;n++)t[n]=0}setRegion(t,s,n,l){if(s<0||t<0)throw new N("Left and top must be nonnegative");if(l<1||n<1)throw new N("Height and width must be at least 1");const o=t+n,d=s+l;if(d>this.height||o>this.width)throw new N("The region must fit inside the matrix");const h=this.rowSize,p=this.bits;for(let w=s;w<d;w++){const S=w*h;for(let P=t;P<o;P++)p[S+Math.floor(P/32)]|=1<<(P&31)&4294967295}}getRow(t,s){s==null||s.getSize()<this.width?s=new C(this.width):s.clear();const n=this.rowSize,l=this.bits,o=t*n;for(let d=0;d<n;d++)s.setBulk(d*32,l[o+d]);return s}setRow(t,s){E.arraycopy(s.getBitArray(),0,this.bits,t*this.rowSize,this.rowSize)}rotate180(){const t=this.getWidth(),s=this.getHeight();let n=new C(t),l=new C(t);for(let o=0,d=Math.floor((s+1)/2);o<d;o++)n=this.getRow(o,n),l=this.getRow(s-1-o,l),n.reverse(),l.reverse(),this.setRow(o,l),this.setRow(s-1-o,n)}getEnclosingRectangle(){const t=this.width,s=this.height,n=this.rowSize,l=this.bits;let o=t,d=s,h=-1,p=-1;for(let w=0;w<s;w++)for(let S=0;S<n;S++){const P=l[w*n+S];if(P!==0){if(w<d&&(d=w),w>p&&(p=w),S*32<o){let W=0;for(;!(P<<31-W&4294967295);)W++;S*32+W<o&&(o=S*32+W)}if(S*32+31>h){let W=31;for(;!(P>>>W);)W--;S*32+W>h&&(h=S*32+W)}}}return h<o||p<d?null:Int32Array.from([o,d,h-o+1,p-d+1])}getTopLeftOnBit(){const t=this.rowSize,s=this.bits;let n=0;for(;n<s.length&&s[n]===0;)n++;if(n===s.length)return null;const l=n/t;let o=n%t*32;const d=s[n];let h=0;for(;!(d<<31-h&4294967295);)h++;return o+=h,Int32Array.from([o,l])}getBottomRightOnBit(){const t=this.rowSize,s=this.bits;let n=s.length-1;for(;n>=0&&s[n]===0;)n--;if(n<0)return null;const l=Math.floor(n/t);let o=Math.floor(n%t)*32;const d=s[n];let h=31;for(;!(d>>>h);)h--;return o+=h,Int32Array.from([o,l])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(t){if(!(t instanceof q))return!1;const s=t;return this.width===s.width&&this.height===s.height&&this.rowSize===s.rowSize&&F.equals(this.bits,s.bits)}hashCode(){let t=this.width;return t=31*t+this.width,t=31*t+this.height,t=31*t+this.rowSize,t=31*t+F.hashCode(this.bits),t}toString(t="X ",s="  ",n=`
`){return this.buildToString(t,s,n)}buildToString(t,s,n){let l=new se;for(let o=0,d=this.height;o<d;o++){for(let h=0,p=this.width;h<p;h++)l.append(this.get(h,o)?t:s);l.append(n)}return l.toString()}clone(){return new q(this.width,this.height,this.rowSize,this.bits.slice())}}class H extends f{static getNotFoundInstance(){return new H}}H.kind="NotFoundException";class J extends k{constructor(t){super(t),this.luminances=J.EMPTY,this.buckets=new Int32Array(J.LUMINANCE_BUCKETS)}getBlackRow(t,s){const n=this.getLuminanceSource(),l=n.getWidth();s==null||s.getSize()<l?s=new C(l):s.clear(),this.initArrays(l);const o=n.getRow(t,this.luminances),d=this.buckets;for(let p=0;p<l;p++)d[(o[p]&255)>>J.LUMINANCE_SHIFT]++;const h=J.estimateBlackPoint(d);if(l<3)for(let p=0;p<l;p++)(o[p]&255)<h&&s.set(p);else{let p=o[0]&255,w=o[1]&255;for(let S=1;S<l-1;S++){const P=o[S+1]&255;(w*4-p-P)/2<h&&s.set(S),p=w,w=P}}return s}getBlackMatrix(){const t=this.getLuminanceSource(),s=t.getWidth(),n=t.getHeight(),l=new q(s,n);this.initArrays(s);const o=this.buckets;for(let p=1;p<5;p++){const w=Math.floor(n*p/5),S=t.getRow(w,this.luminances),P=Math.floor(s*4/5);for(let W=Math.floor(s/5);W<P;W++){const ne=S[W]&255;o[ne>>J.LUMINANCE_SHIFT]++}}const d=J.estimateBlackPoint(o),h=t.getMatrix();for(let p=0;p<n;p++){const w=p*s;for(let S=0;S<s;S++)(h[w+S]&255)<d&&l.set(S,p)}return l}createBinarizer(t){return new J(t)}initArrays(t){this.luminances.length<t&&(this.luminances=new Uint8ClampedArray(t));const s=this.buckets;for(let n=0;n<J.LUMINANCE_BUCKETS;n++)s[n]=0}static estimateBlackPoint(t){const s=t.length;let n=0,l=0,o=0;for(let S=0;S<s;S++)t[S]>o&&(l=S,o=t[S]),t[S]>n&&(n=t[S]);let d=0,h=0;for(let S=0;S<s;S++){const P=S-l,W=t[S]*P*P;W>h&&(d=S,h=W)}if(l>d){const S=l;l=d,d=S}if(d-l<=s/16)throw new H;let p=d-1,w=-1;for(let S=d-1;S>l;S--){const P=S-l,W=P*P*(d-S)*(n-t[S]);W>w&&(p=S,w=W)}return p<<J.LUMINANCE_SHIFT}}J.LUMINANCE_BITS=5,J.LUMINANCE_SHIFT=8-J.LUMINANCE_BITS,J.LUMINANCE_BUCKETS=1<<J.LUMINANCE_BITS,J.EMPTY=Uint8ClampedArray.from([0]);class V extends J{constructor(t){super(t),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const t=this.getLuminanceSource(),s=t.getWidth(),n=t.getHeight();if(s>=V.MINIMUM_DIMENSION&&n>=V.MINIMUM_DIMENSION){const l=t.getMatrix();let o=s>>V.BLOCK_SIZE_POWER;s&V.BLOCK_SIZE_MASK&&o++;let d=n>>V.BLOCK_SIZE_POWER;n&V.BLOCK_SIZE_MASK&&d++;const h=V.calculateBlackPoints(l,o,d,s,n),p=new q(s,n);V.calculateThresholdForBlock(l,o,d,s,n,h,p),this.matrix=p}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(t){return new V(t)}static calculateThresholdForBlock(t,s,n,l,o,d,h){const p=o-V.BLOCK_SIZE,w=l-V.BLOCK_SIZE;for(let S=0;S<n;S++){let P=S<<V.BLOCK_SIZE_POWER;P>p&&(P=p);const W=V.cap(S,2,n-3);for(let ne=0;ne<s;ne++){let pe=ne<<V.BLOCK_SIZE_POWER;pe>w&&(pe=w);const je=V.cap(ne,2,s-3);let Me=0;for(let mt=-2;mt<=2;mt++){const xt=d[W+mt];Me+=xt[je-2]+xt[je-1]+xt[je]+xt[je+1]+xt[je+2]}const Ve=Me/25;V.thresholdBlock(t,pe,P,Ve,l,h)}}}static cap(t,s,n){return t<s?s:t>n?n:t}static thresholdBlock(t,s,n,l,o,d){for(let h=0,p=n*o+s;h<V.BLOCK_SIZE;h++,p+=o)for(let w=0;w<V.BLOCK_SIZE;w++)(t[p+w]&255)<=l&&d.set(s+w,n+h)}static calculateBlackPoints(t,s,n,l,o){const d=o-V.BLOCK_SIZE,h=l-V.BLOCK_SIZE,p=new Array(n);for(let w=0;w<n;w++){p[w]=new Int32Array(s);let S=w<<V.BLOCK_SIZE_POWER;S>d&&(S=d);for(let P=0;P<s;P++){let W=P<<V.BLOCK_SIZE_POWER;W>h&&(W=h);let ne=0,pe=255,je=0;for(let Ve=0,mt=S*l+W;Ve<V.BLOCK_SIZE;Ve++,mt+=l){for(let xt=0;xt<V.BLOCK_SIZE;xt++){const ct=t[mt+xt]&255;ne+=ct,ct<pe&&(pe=ct),ct>je&&(je=ct)}if(je-pe>V.MIN_DYNAMIC_RANGE)for(Ve++,mt+=l;Ve<V.BLOCK_SIZE;Ve++,mt+=l)for(let xt=0;xt<V.BLOCK_SIZE;xt++)ne+=t[mt+xt]&255}let Me=ne>>V.BLOCK_SIZE_POWER*2;if(je-pe<=V.MIN_DYNAMIC_RANGE&&(Me=pe/2,w>0&&P>0)){const Ve=(p[w-1][P]+2*p[w][P-1]+p[w-1][P-1])/4;pe<Ve&&(Me=Ve)}p[w][P]=Me}}return p}}V.BLOCK_SIZE_POWER=3,V.BLOCK_SIZE=1<<V.BLOCK_SIZE_POWER,V.BLOCK_SIZE_MASK=V.BLOCK_SIZE-1,V.MINIMUM_DIMENSION=V.BLOCK_SIZE*5,V.MIN_DYNAMIC_RANGE=24;class ge{constructor(t,s){this.width=t,this.height=s}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(t,s,n,l){throw new D("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new D("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new D("This luminance source does not support rotation by 45 degrees.")}toString(){const t=new Uint8ClampedArray(this.width);let s=new se;for(let n=0;n<this.height;n++){const l=this.getRow(n,t);for(let o=0;o<this.width;o++){const d=l[o]&255;let h;d<64?h="#":d<128?h="+":d<192?h=".":h=" ",s.append(h)}s.append(`
`)}return s.toString()}}class He extends ge{constructor(t){super(t.getWidth(),t.getHeight()),this.delegate=t}getRow(t,s){const n=this.delegate.getRow(t,s),l=this.getWidth();for(let o=0;o<l;o++)n[o]=255-(n[o]&255);return n}getMatrix(){const t=this.delegate.getMatrix(),s=this.getWidth()*this.getHeight(),n=new Uint8ClampedArray(s);for(let l=0;l<s;l++)n[l]=255-(t[l]&255);return n}isCropSupported(){return this.delegate.isCropSupported()}crop(t,s,n,l){return new He(this.delegate.crop(t,s,n,l))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new He(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new He(this.delegate.rotateCounterClockwise45())}}class B extends ge{constructor(t){super(t.width,t.height),this.canvas=t,this.tempCanvasElement=null,this.buffer=B.makeBufferFromCanvasImageData(t)}static makeBufferFromCanvasImageData(t){const s=t.getContext("2d").getImageData(0,0,t.width,t.height);return B.toGrayscaleBuffer(s.data,t.width,t.height)}static toGrayscaleBuffer(t,s,n){const l=new Uint8ClampedArray(s*n);for(let o=0,d=0,h=t.length;o<h;o+=4,d++){let p;if(t[o+3]===0)p=255;else{const S=t[o],P=t[o+1],W=t[o+2];p=306*S+601*P+117*W+512>>10}l[d]=p}return l}getRow(t,s){if(t<0||t>=this.getHeight())throw new N("Requested row is outside the image: "+t);const n=this.getWidth(),l=t*n;return s===null?s=this.buffer.slice(l,l+n):(s.length<n&&(s=new Uint8ClampedArray(n)),s.set(this.buffer.slice(l,l+n))),s}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(t,s,n,l){return super.crop(t,s,n,l),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const t=this.canvas.ownerDocument.createElement("canvas");t.width=this.canvas.width,t.height=this.canvas.height,this.tempCanvasElement=t}return this.tempCanvasElement}rotate(t){const s=this.getTempCanvasElement(),n=s.getContext("2d"),l=t*B.DEGREE_TO_RADIANS,o=this.canvas.width,d=this.canvas.height,h=Math.ceil(Math.abs(Math.cos(l))*o+Math.abs(Math.sin(l))*d),p=Math.ceil(Math.abs(Math.sin(l))*o+Math.abs(Math.cos(l))*d);return s.width=h,s.height=p,n.translate(h/2,p/2),n.rotate(l),n.drawImage(this.canvas,o/-2,d/-2),this.buffer=B.makeBufferFromCanvasImageData(s),this}invert(){return new He(this)}}B.DEGREE_TO_RADIANS=Math.PI/180;class fe{constructor(t,s,n){this.deviceId=t,this.label=s,this.kind="videoinput",this.groupId=n||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var re=(globalThis||sn||self||window||void 0)&&(globalThis||sn||self||window||void 0).__awaiter||function(O,t,s,n){function l(o){return o instanceof s?o:new s(function(d){d(o)})}return new(s||(s=Promise))(function(o,d){function h(S){try{w(n.next(S))}catch(P){d(P)}}function p(S){try{w(n.throw(S))}catch(P){d(P)}}function w(S){S.done?o(S.value):l(S.value).then(h,p)}w((n=n.apply(O,t||[])).next())})};class ye{constructor(t,s=500,n){this.reader=t,this.timeBetweenScansMillis=s,this._hints=n,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(t){this._timeBetweenDecodingAttempts=t<0?0:t}set hints(t){this._hints=t||null}get hints(){return this._hints}listVideoInputDevices(){return re(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const t=yield navigator.mediaDevices.enumerateDevices(),s=[];for(const n of t){const l=n.kind==="video"?"videoinput":n.kind;if(l!=="videoinput")continue;const o=n.deviceId||n.id,d=n.label||`Video device ${s.length+1}`,h=n.groupId,p={deviceId:o,label:d,kind:l,groupId:h};s.push(p)}return s})}getVideoInputDevices(){return re(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(s=>new fe(s.deviceId,s.label))})}findDeviceById(t){return re(this,void 0,void 0,function*(){const s=yield this.listVideoInputDevices();return s?s.find(n=>n.deviceId===t):null})}decodeFromInputVideoDevice(t,s){return re(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(t,s)})}decodeOnceFromVideoDevice(t,s){return re(this,void 0,void 0,function*(){this.reset();let n;t?n={deviceId:{exact:t}}:n={facingMode:"environment"};const l={video:n};return yield this.decodeOnceFromConstraints(l,s)})}decodeOnceFromConstraints(t,s){return re(this,void 0,void 0,function*(){const n=yield navigator.mediaDevices.getUserMedia(t);return yield this.decodeOnceFromStream(n,s)})}decodeOnceFromStream(t,s){return re(this,void 0,void 0,function*(){this.reset();const n=yield this.attachStreamToVideo(t,s);return yield this.decodeOnce(n)})}decodeFromInputVideoDeviceContinuously(t,s,n){return re(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(t,s,n)})}decodeFromVideoDevice(t,s,n){return re(this,void 0,void 0,function*(){let l;t?l={deviceId:{exact:t}}:l={facingMode:"environment"};const o={video:l};return yield this.decodeFromConstraints(o,s,n)})}decodeFromConstraints(t,s,n){return re(this,void 0,void 0,function*(){const l=yield navigator.mediaDevices.getUserMedia(t);return yield this.decodeFromStream(l,s,n)})}decodeFromStream(t,s,n){return re(this,void 0,void 0,function*(){this.reset();const l=yield this.attachStreamToVideo(t,s);return yield this.decodeContinuously(l,n)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(t,s){return re(this,void 0,void 0,function*(){const n=this.prepareVideoElement(s);return this.addVideoSource(n,t),this.videoElement=n,this.stream=t,yield this.playVideoOnLoadAsync(n),n})}playVideoOnLoadAsync(t){return new Promise((s,n)=>this.playVideoOnLoad(t,()=>s()))}playVideoOnLoad(t,s){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(t),t.addEventListener("ended",this.videoEndedListener),t.addEventListener("canplay",this.videoCanPlayListener),t.addEventListener("playing",s),this.tryPlayVideo(t)}isVideoPlaying(t){return t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2}tryPlayVideo(t){return re(this,void 0,void 0,function*(){if(this.isVideoPlaying(t)){console.warn("Trying to play video that is already playing.");return}try{yield t.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(t,s){const n=document.getElementById(t);if(!n)throw new y(`element with id '${t}' not found`);if(n.nodeName.toLowerCase()!==s.toLowerCase())throw new y(`element with id '${t}' must be an ${s} element`);return n}decodeFromImage(t,s){if(!t&&!s)throw new y("either imageElement with a src set or an url must be provided");return s&&!t?this.decodeFromImageUrl(s):this.decodeFromImageElement(t)}decodeFromVideo(t,s){if(!t&&!s)throw new y("Either an element with a src set or an URL must be provided");return s&&!t?this.decodeFromVideoUrl(s):this.decodeFromVideoElement(t)}decodeFromVideoContinuously(t,s,n){if(t===void 0&&s===void 0)throw new y("Either an element with a src set or an URL must be provided");return s&&!t?this.decodeFromVideoUrlContinuously(s,n):this.decodeFromVideoElementContinuously(t,n)}decodeFromImageElement(t){if(!t)throw new y("An image element must be provided.");this.reset();const s=this.prepareImageElement(t);this.imageElement=s;let n;return this.isImageLoaded(s)?n=this.decodeOnce(s,!1,!0):n=this._decodeOnLoadImage(s),n}decodeFromVideoElement(t){const s=this._decodeFromVideoElementSetup(t);return this._decodeOnLoadVideo(s)}decodeFromVideoElementContinuously(t,s){const n=this._decodeFromVideoElementSetup(t);return this._decodeOnLoadVideoContinuously(n,s)}_decodeFromVideoElementSetup(t){if(!t)throw new y("A video element must be provided.");this.reset();const s=this.prepareVideoElement(t);return this.videoElement=s,s}decodeFromImageUrl(t){if(!t)throw new y("An URL must be provided.");this.reset();const s=this.prepareImageElement();this.imageElement=s;const n=this._decodeOnLoadImage(s);return s.src=t,n}decodeFromVideoUrl(t){if(!t)throw new y("An URL must be provided.");this.reset();const s=this.prepareVideoElement(),n=this.decodeFromVideoElement(s);return s.src=t,n}decodeFromVideoUrlContinuously(t,s){if(!t)throw new y("An URL must be provided.");this.reset();const n=this.prepareVideoElement(),l=this.decodeFromVideoElementContinuously(n,s);return n.src=t,l}_decodeOnLoadImage(t){return new Promise((s,n)=>{this.imageLoadedListener=()=>this.decodeOnce(t,!1,!0).then(s,n),t.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(t){return re(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(t),yield this.decodeOnce(t)})}_decodeOnLoadVideoContinuously(t,s){return re(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(t),this.decodeContinuously(t,s)})}isImageLoaded(t){return!(!t.complete||t.naturalWidth===0)}prepareImageElement(t){let s;return typeof t>"u"&&(s=document.createElement("img"),s.width=200,s.height=200),typeof t=="string"&&(s=this.getMediaElement(t,"img")),t instanceof HTMLImageElement&&(s=t),s}prepareVideoElement(t){let s;return!t&&typeof document<"u"&&(s=document.createElement("video"),s.width=200,s.height=200),typeof t=="string"&&(s=this.getMediaElement(t,"video")),t instanceof HTMLVideoElement&&(s=t),s.setAttribute("autoplay","true"),s.setAttribute("muted","true"),s.setAttribute("playsinline","true"),s}decodeOnce(t,s=!0,n=!0){this._stopAsyncDecode=!1;const l=(o,d)=>{if(this._stopAsyncDecode){d(new H("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const h=this.decode(t);o(h)}catch(h){const p=s&&h instanceof H,S=(h instanceof R||h instanceof A)&&n;if(p||S)return setTimeout(l,this._timeBetweenDecodingAttempts,o,d);d(h)}};return new Promise((o,d)=>l(o,d))}decodeContinuously(t,s){this._stopContinuousDecode=!1;const n=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const l=this.decode(t);s(l,null),setTimeout(n,this.timeBetweenScansMillis)}catch(l){s(null,l);const o=l instanceof R||l instanceof A,d=l instanceof H;(o||d)&&setTimeout(n,this._timeBetweenDecodingAttempts)}};n()}decode(t){const s=this.createBinaryBitmap(t);return this.decodeBitmap(s)}_isHTMLVideoElement(t){return t.videoWidth!==0}drawFrameOnCanvas(t,s,n){s||(s={sx:0,sy:0,sWidth:t.videoWidth,sHeight:t.videoHeight,dx:0,dy:0,dWidth:t.videoWidth,dHeight:t.videoHeight}),n||(n=this.captureCanvasContext),n.drawImage(t,s.sx,s.sy,s.sWidth,s.sHeight,s.dx,s.dy,s.dWidth,s.dHeight)}drawImageOnCanvas(t,s,n=this.captureCanvasContext){s||(s={sx:0,sy:0,sWidth:t.naturalWidth,sHeight:t.naturalHeight,dx:0,dy:0,dWidth:t.naturalWidth,dHeight:t.naturalHeight}),n||(n=this.captureCanvasContext),n.drawImage(t,s.sx,s.sy,s.sWidth,s.sHeight,s.dx,s.dy,s.dWidth,s.dHeight)}createBinaryBitmap(t){this.getCaptureCanvasContext(t),this._isHTMLVideoElement(t)?this.drawFrameOnCanvas(t):this.drawImageOnCanvas(t);const s=this.getCaptureCanvas(t),n=new B(s),l=new V(n);return new I(l)}getCaptureCanvasContext(t){if(!this.captureCanvasContext){const n=this.getCaptureCanvas(t).getContext("2d");this.captureCanvasContext=n}return this.captureCanvasContext}getCaptureCanvas(t){if(!this.captureCanvas){const s=this.createCaptureCanvas(t);this.captureCanvas=s}return this.captureCanvas}decodeBitmap(t){return this.reader.decode(t,this._hints)}createCaptureCanvas(t){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const s=document.createElement("canvas");let n,l;return typeof t<"u"&&(t instanceof HTMLVideoElement?(n=t.videoWidth,l=t.videoHeight):t instanceof HTMLImageElement&&(n=t.naturalWidth||t.width,l=t.naturalHeight||t.height)),s.style.width=n+"px",s.style.height=l+"px",s.width=n,s.height=l,s}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(t=>t.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(t,s){try{t.srcObject=s}catch{t.src=URL.createObjectURL(s)}}cleanVideoSource(t){try{t.srcObject=null}catch{t.src=""}this.videoElement.removeAttribute("src")}}class Q{constructor(t,s,n=s==null?0:8*s.length,l,o,d=E.currentTimeMillis()){this.text=t,this.rawBytes=s,this.numBits=n,this.resultPoints=l,this.format=o,this.timestamp=d,this.text=t,this.rawBytes=s,n==null?this.numBits=s==null?0:8*s.length:this.numBits=n,this.resultPoints=l,this.format=o,this.resultMetadata=null,d==null?this.timestamp=E.currentTimeMillis():this.timestamp=d}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(t,s){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(t,s)}putAllMetadata(t){t!==null&&(this.resultMetadata===null?this.resultMetadata=t:this.resultMetadata=new Map(t))}addResultPoints(t){const s=this.resultPoints;if(s===null)this.resultPoints=t;else if(t!==null&&t.length>0){const n=new Array(s.length+t.length);E.arraycopy(s,0,n,0,s.length),E.arraycopy(t,0,n,s.length,t.length),this.resultPoints=n}}getTimestamp(){return this.timestamp}toString(){return this.text}}var Le;(function(O){O[O.AZTEC=0]="AZTEC",O[O.CODABAR=1]="CODABAR",O[O.CODE_39=2]="CODE_39",O[O.CODE_93=3]="CODE_93",O[O.CODE_128=4]="CODE_128",O[O.DATA_MATRIX=5]="DATA_MATRIX",O[O.EAN_8=6]="EAN_8",O[O.EAN_13=7]="EAN_13",O[O.ITF=8]="ITF",O[O.MAXICODE=9]="MAXICODE",O[O.PDF_417=10]="PDF_417",O[O.QR_CODE=11]="QR_CODE",O[O.RSS_14=12]="RSS_14",O[O.RSS_EXPANDED=13]="RSS_EXPANDED",O[O.UPC_A=14]="UPC_A",O[O.UPC_E=15]="UPC_E",O[O.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(Le||(Le={}));var Ue=Le,Ct;(function(O){O[O.OTHER=0]="OTHER",O[O.ORIENTATION=1]="ORIENTATION",O[O.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",O[O.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",O[O.ISSUE_NUMBER=4]="ISSUE_NUMBER",O[O.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",O[O.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",O[O.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",O[O.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",O[O.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",O[O.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(Ct||(Ct={}));var Re=Ct;class ut{constructor(t,s,n,l,o=-1,d=-1){this.rawBytes=t,this.text=s,this.byteSegments=n,this.ecLevel=l,this.structuredAppendSequenceNumber=o,this.structuredAppendParity=d,this.numBits=t==null?0:8*t.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(t){this.numBits=t}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(t){this.errorsCorrected=t}getErasures(){return this.erasures}setErasures(t){this.erasures=t}getOther(){return this.other}setOther(t){this.other=t}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class Ee{exp(t){return this.expTable[t]}log(t){if(t===0)throw new N;return this.logTable[t]}static addOrSubtract(t,s){return t^s}}class Oe{constructor(t,s){if(s.length===0)throw new N;this.field=t;const n=s.length;if(n>1&&s[0]===0){let l=1;for(;l<n&&s[l]===0;)l++;l===n?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(n-l),E.arraycopy(s,l,this.coefficients,0,this.coefficients.length))}else this.coefficients=s}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(t){return this.coefficients[this.coefficients.length-1-t]}evaluateAt(t){if(t===0)return this.getCoefficient(0);const s=this.coefficients;let n;if(t===1){n=0;for(let d=0,h=s.length;d!==h;d++){const p=s[d];n=Ee.addOrSubtract(n,p)}return n}n=s[0];const l=s.length,o=this.field;for(let d=1;d<l;d++)n=Ee.addOrSubtract(o.multiply(t,n),s[d]);return n}addOrSubtract(t){if(!this.field.equals(t.field))throw new N("GenericGFPolys do not have same GenericGF field");if(this.isZero())return t;if(t.isZero())return this;let s=this.coefficients,n=t.coefficients;if(s.length>n.length){const d=s;s=n,n=d}let l=new Int32Array(n.length);const o=n.length-s.length;E.arraycopy(n,0,l,0,o);for(let d=o;d<n.length;d++)l[d]=Ee.addOrSubtract(s[d-o],n[d]);return new Oe(this.field,l)}multiply(t){if(!this.field.equals(t.field))throw new N("GenericGFPolys do not have same GenericGF field");if(this.isZero()||t.isZero())return this.field.getZero();const s=this.coefficients,n=s.length,l=t.coefficients,o=l.length,d=new Int32Array(n+o-1),h=this.field;for(let p=0;p<n;p++){const w=s[p];for(let S=0;S<o;S++)d[p+S]=Ee.addOrSubtract(d[p+S],h.multiply(w,l[S]))}return new Oe(h,d)}multiplyScalar(t){if(t===0)return this.field.getZero();if(t===1)return this;const s=this.coefficients.length,n=this.field,l=new Int32Array(s),o=this.coefficients;for(let d=0;d<s;d++)l[d]=n.multiply(o[d],t);return new Oe(n,l)}multiplyByMonomial(t,s){if(t<0)throw new N;if(s===0)return this.field.getZero();const n=this.coefficients,l=n.length,o=new Int32Array(l+t),d=this.field;for(let h=0;h<l;h++)o[h]=d.multiply(n[h],s);return new Oe(d,o)}divide(t){if(!this.field.equals(t.field))throw new N("GenericGFPolys do not have same GenericGF field");if(t.isZero())throw new N("Divide by 0");const s=this.field;let n=s.getZero(),l=this;const o=t.getCoefficient(t.getDegree()),d=s.inverse(o);for(;l.getDegree()>=t.getDegree()&&!l.isZero();){const h=l.getDegree()-t.getDegree(),p=s.multiply(l.getCoefficient(l.getDegree()),d),w=t.multiplyByMonomial(h,p),S=s.buildMonomial(h,p);n=n.addOrSubtract(S),l=l.addOrSubtract(w)}return[n,l]}toString(){let t="";for(let s=this.getDegree();s>=0;s--){let n=this.getCoefficient(s);if(n!==0){if(n<0?(t+=" - ",n=-n):t.length>0&&(t+=" + "),s===0||n!==1){const l=this.field.log(n);l===0?t+="1":l===1?t+="a":(t+="a^",t+=l)}s!==0&&(s===1?t+="x":(t+="x^",t+=s))}}return t}}class Xe extends f{}Xe.kind="ArithmeticException";class Be extends Ee{constructor(t,s,n){super(),this.primitive=t,this.size=s,this.generatorBase=n;const l=new Int32Array(s);let o=1;for(let h=0;h<s;h++)l[h]=o,o*=2,o>=s&&(o^=t,o&=s-1);this.expTable=l;const d=new Int32Array(s);for(let h=0;h<s-1;h++)d[l[h]]=h;this.logTable=d,this.zero=new Oe(this,Int32Array.from([0])),this.one=new Oe(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(t,s){if(t<0)throw new N;if(s===0)return this.zero;const n=new Int32Array(t+1);return n[0]=s,new Oe(this,n)}inverse(t){if(t===0)throw new Xe;return this.expTable[this.size-this.logTable[t]-1]}multiply(t,s){return t===0||s===0?0:this.expTable[(this.logTable[t]+this.logTable[s])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+L.toHexString(this.primitive)+","+this.size+")"}equals(t){return t===this}}Be.AZTEC_DATA_12=new Be(4201,4096,1),Be.AZTEC_DATA_10=new Be(1033,1024,1),Be.AZTEC_DATA_6=new Be(67,64,1),Be.AZTEC_PARAM=new Be(19,16,1),Be.QR_CODE_FIELD_256=new Be(285,256,0),Be.DATA_MATRIX_FIELD_256=new Be(301,256,1),Be.AZTEC_DATA_8=Be.DATA_MATRIX_FIELD_256,Be.MAXICODE_FIELD_64=Be.AZTEC_DATA_6;class Ce extends f{}Ce.kind="ReedSolomonException";class Ze extends f{}Ze.kind="IllegalStateException";class $e{constructor(t){this.field=t}decode(t,s){const n=this.field,l=new Oe(n,t),o=new Int32Array(s);let d=!0;for(let ne=0;ne<s;ne++){const pe=l.evaluateAt(n.exp(ne+n.getGeneratorBase()));o[o.length-1-ne]=pe,pe!==0&&(d=!1)}if(d)return;const h=new Oe(n,o),p=this.runEuclideanAlgorithm(n.buildMonomial(s,1),h,s),w=p[0],S=p[1],P=this.findErrorLocations(w),W=this.findErrorMagnitudes(S,P);for(let ne=0;ne<P.length;ne++){const pe=t.length-1-n.log(P[ne]);if(pe<0)throw new Ce("Bad error location");t[pe]=Be.addOrSubtract(t[pe],W[ne])}}runEuclideanAlgorithm(t,s,n){if(t.getDegree()<s.getDegree()){const ne=t;t=s,s=ne}const l=this.field;let o=t,d=s,h=l.getZero(),p=l.getOne();for(;d.getDegree()>=(n/2|0);){let ne=o,pe=h;if(o=d,h=p,o.isZero())throw new Ce("r_{i-1} was zero");d=ne;let je=l.getZero();const Me=o.getCoefficient(o.getDegree()),Ve=l.inverse(Me);for(;d.getDegree()>=o.getDegree()&&!d.isZero();){const mt=d.getDegree()-o.getDegree(),xt=l.multiply(d.getCoefficient(d.getDegree()),Ve);je=je.addOrSubtract(l.buildMonomial(mt,xt)),d=d.addOrSubtract(o.multiplyByMonomial(mt,xt))}if(p=je.multiply(h).addOrSubtract(pe),d.getDegree()>=o.getDegree())throw new Ze("Division algorithm failed to reduce polynomial?")}const w=p.getCoefficient(0);if(w===0)throw new Ce("sigmaTilde(0) was zero");const S=l.inverse(w),P=p.multiplyScalar(S),W=d.multiplyScalar(S);return[P,W]}findErrorLocations(t){const s=t.getDegree();if(s===1)return Int32Array.from([t.getCoefficient(1)]);const n=new Int32Array(s);let l=0;const o=this.field;for(let d=1;d<o.getSize()&&l<s;d++)t.evaluateAt(d)===0&&(n[l]=o.inverse(d),l++);if(l!==s)throw new Ce("Error locator degree does not match number of roots");return n}findErrorMagnitudes(t,s){const n=s.length,l=new Int32Array(n),o=this.field;for(let d=0;d<n;d++){const h=o.inverse(s[d]);let p=1;for(let w=0;w<n;w++)if(d!==w){const S=o.multiply(s[w],h),P=S&1?S&-2:S|1;p=o.multiply(p,P)}l[d]=o.multiply(t.evaluateAt(h),o.inverse(p)),o.getGeneratorBase()!==0&&(l[d]=o.multiply(l[d],h))}return l}}var K;(function(O){O[O.UPPER=0]="UPPER",O[O.LOWER=1]="LOWER",O[O.MIXED=2]="MIXED",O[O.DIGIT=3]="DIGIT",O[O.PUNCT=4]="PUNCT",O[O.BINARY=5]="BINARY"})(K||(K={}));class be{decode(t){this.ddata=t;let s=t.getBits(),n=this.extractBits(s),l=this.correctBits(n),o=be.convertBoolArrayToByteArray(l),d=be.getEncodedData(l),h=new ut(o,d,null,null);return h.setNumBits(l.length),h}static highLevelDecode(t){return this.getEncodedData(t)}static getEncodedData(t){let s=t.length,n=K.UPPER,l=K.UPPER,o="",d=0;for(;d<s;)if(l===K.BINARY){if(s-d<5)break;let h=be.readCode(t,d,5);if(d+=5,h===0){if(s-d<11)break;h=be.readCode(t,d,11)+31,d+=11}for(let p=0;p<h;p++){if(s-d<8){d=s;break}const w=be.readCode(t,d,8);o+=z.castAsNonUtf8Char(w),d+=8}l=n}else{let h=l===K.DIGIT?4:5;if(s-d<h)break;let p=be.readCode(t,d,h);d+=h;let w=be.getCharacter(l,p);w.startsWith("CTRL_")?(n=l,l=be.getTable(w.charAt(5)),w.charAt(6)==="L"&&(n=l)):(o+=w,l=n)}return o}static getTable(t){switch(t){case"L":return K.LOWER;case"P":return K.PUNCT;case"M":return K.MIXED;case"D":return K.DIGIT;case"B":return K.BINARY;case"U":default:return K.UPPER}}static getCharacter(t,s){switch(t){case K.UPPER:return be.UPPER_TABLE[s];case K.LOWER:return be.LOWER_TABLE[s];case K.MIXED:return be.MIXED_TABLE[s];case K.PUNCT:return be.PUNCT_TABLE[s];case K.DIGIT:return be.DIGIT_TABLE[s];default:throw new Ze("Bad table")}}correctBits(t){let s,n;this.ddata.getNbLayers()<=2?(n=6,s=Be.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(n=8,s=Be.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(n=10,s=Be.AZTEC_DATA_10):(n=12,s=Be.AZTEC_DATA_12);let l=this.ddata.getNbDatablocks(),o=t.length/n;if(o<l)throw new A;let d=t.length%n,h=new Int32Array(o);for(let W=0;W<o;W++,d+=n)h[W]=be.readCode(t,d,n);try{new $e(s).decode(h,o-l)}catch(W){throw new A(W)}let p=(1<<n)-1,w=0;for(let W=0;W<l;W++){let ne=h[W];if(ne===0||ne===p)throw new A;(ne===1||ne===p-1)&&w++}let S=new Array(l*n-w),P=0;for(let W=0;W<l;W++){let ne=h[W];if(ne===1||ne===p-1)S.fill(ne>1,P,P+n-1),P+=n-1;else for(let pe=n-1;pe>=0;--pe)S[P++]=(ne&1<<pe)!==0}return S}extractBits(t){let s=this.ddata.isCompact(),n=this.ddata.getNbLayers(),l=(s?11:14)+n*4,o=new Int32Array(l),d=new Array(this.totalBitsInLayer(n,s));if(s)for(let h=0;h<o.length;h++)o[h]=h;else{let h=l+1+2*L.truncDivision(L.truncDivision(l,2)-1,15),p=l/2,w=L.truncDivision(h,2);for(let S=0;S<p;S++){let P=S+L.truncDivision(S,15);o[p-S-1]=w-P-1,o[p+S]=w+P+1}}for(let h=0,p=0;h<n;h++){let w=(n-h)*4+(s?9:12),S=h*2,P=l-1-S;for(let W=0;W<w;W++){let ne=W*2;for(let pe=0;pe<2;pe++)d[p+ne+pe]=t.get(o[S+pe],o[S+W]),d[p+2*w+ne+pe]=t.get(o[S+W],o[P-pe]),d[p+4*w+ne+pe]=t.get(o[P-pe],o[P-W]),d[p+6*w+ne+pe]=t.get(o[P-W],o[S+pe])}p+=w*8}return d}static readCode(t,s,n){let l=0;for(let o=s;o<s+n;o++)l<<=1,t[o]&&(l|=1);return l}static readByte(t,s){let n=t.length-s;return n>=8?be.readCode(t,s,8):be.readCode(t,s,n)<<8-n}static convertBoolArrayToByteArray(t){let s=new Uint8Array((t.length+7)/8);for(let n=0;n<s.length;n++)s[n]=be.readByte(t,8*n);return s}totalBitsInLayer(t,s){return((s?88:112)+16*t)*t}}be.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],be.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],be.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],be.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],be.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class ue{constructor(){}static round(t){return t===NaN?0:t<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:t>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:t+(t<0?-.5:.5)|0}static distance(t,s,n,l){const o=t-n,d=s-l;return Math.sqrt(o*o+d*d)}static sum(t){let s=0;for(let n=0,l=t.length;n!==l;n++){const o=t[n];s+=o}return s}}class Ye{static floatToIntBits(t){return t}}Ye.MAX_VALUE=Number.MAX_SAFE_INTEGER;class ae{constructor(t,s){this.x=t,this.y=s}getX(){return this.x}getY(){return this.y}equals(t){if(t instanceof ae){const s=t;return this.x===s.x&&this.y===s.y}return!1}hashCode(){return 31*Ye.floatToIntBits(this.x)+Ye.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(t){const s=this.distance(t[0],t[1]),n=this.distance(t[1],t[2]),l=this.distance(t[0],t[2]);let o,d,h;if(n>=s&&n>=l?(d=t[0],o=t[1],h=t[2]):l>=n&&l>=s?(d=t[1],o=t[0],h=t[2]):(d=t[2],o=t[0],h=t[1]),this.crossProductZ(o,d,h)<0){const p=o;o=h,h=p}t[0]=o,t[1]=d,t[2]=h}static distance(t,s){return ue.distance(t.x,t.y,s.x,s.y)}static crossProductZ(t,s,n){const l=s.x,o=s.y;return(n.x-l)*(t.y-o)-(n.y-o)*(t.x-l)}}class ke{constructor(t,s){this.bits=t,this.points=s}getBits(){return this.bits}getPoints(){return this.points}}class Ke extends ke{constructor(t,s,n,l,o){super(t,s),this.compact=n,this.nbDatablocks=l,this.nbLayers=o}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class le{constructor(t,s,n,l){this.image=t,this.height=t.getHeight(),this.width=t.getWidth(),s==null&&(s=le.INIT_SIZE),n==null&&(n=t.getWidth()/2|0),l==null&&(l=t.getHeight()/2|0);const o=s/2|0;if(this.leftInit=n-o,this.rightInit=n+o,this.upInit=l-o,this.downInit=l+o,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new H}detect(){let t=this.leftInit,s=this.rightInit,n=this.upInit,l=this.downInit,o=!1,d=!0,h=!1,p=!1,w=!1,S=!1,P=!1;const W=this.width,ne=this.height;for(;d;){d=!1;let pe=!0;for(;(pe||!p)&&s<W;)pe=this.containsBlackPoint(n,l,s,!1),pe?(s++,d=!0,p=!0):p||s++;if(s>=W){o=!0;break}let je=!0;for(;(je||!w)&&l<ne;)je=this.containsBlackPoint(t,s,l,!0),je?(l++,d=!0,w=!0):w||l++;if(l>=ne){o=!0;break}let Me=!0;for(;(Me||!S)&&t>=0;)Me=this.containsBlackPoint(n,l,t,!1),Me?(t--,d=!0,S=!0):S||t--;if(t<0){o=!0;break}let Ve=!0;for(;(Ve||!P)&&n>=0;)Ve=this.containsBlackPoint(t,s,n,!0),Ve?(n--,d=!0,P=!0):P||n--;if(n<0){o=!0;break}d&&(h=!0)}if(!o&&h){const pe=s-t;let je=null;for(let xt=1;je===null&&xt<pe;xt++)je=this.getBlackPointOnSegment(t,l-xt,t+xt,l);if(je==null)throw new H;let Me=null;for(let xt=1;Me===null&&xt<pe;xt++)Me=this.getBlackPointOnSegment(t,n+xt,t+xt,n);if(Me==null)throw new H;let Ve=null;for(let xt=1;Ve===null&&xt<pe;xt++)Ve=this.getBlackPointOnSegment(s,n+xt,s-xt,n);if(Ve==null)throw new H;let mt=null;for(let xt=1;mt===null&&xt<pe;xt++)mt=this.getBlackPointOnSegment(s,l-xt,s-xt,l);if(mt==null)throw new H;return this.centerEdges(mt,je,Ve,Me)}else throw new H}getBlackPointOnSegment(t,s,n,l){const o=ue.round(ue.distance(t,s,n,l)),d=(n-t)/o,h=(l-s)/o,p=this.image;for(let w=0;w<o;w++){const S=ue.round(t+w*d),P=ue.round(s+w*h);if(p.get(S,P))return new ae(S,P)}return null}centerEdges(t,s,n,l){const o=t.getX(),d=t.getY(),h=s.getX(),p=s.getY(),w=n.getX(),S=n.getY(),P=l.getX(),W=l.getY(),ne=le.CORR;return o<this.width/2?[new ae(P-ne,W+ne),new ae(h+ne,p+ne),new ae(w-ne,S-ne),new ae(o+ne,d-ne)]:[new ae(P+ne,W+ne),new ae(h+ne,p-ne),new ae(w-ne,S+ne),new ae(o-ne,d-ne)]}containsBlackPoint(t,s,n,l){const o=this.image;if(l){for(let d=t;d<=s;d++)if(o.get(d,n))return!0}else for(let d=t;d<=s;d++)if(o.get(n,d))return!0;return!1}}le.INIT_SIZE=10,le.CORR=1;class Ne{static checkAndNudgePoints(t,s){const n=t.getWidth(),l=t.getHeight();let o=!0;for(let d=0;d<s.length&&o;d+=2){const h=Math.floor(s[d]),p=Math.floor(s[d+1]);if(h<-1||h>n||p<-1||p>l)throw new H;o=!1,h===-1?(s[d]=0,o=!0):h===n&&(s[d]=n-1,o=!0),p===-1?(s[d+1]=0,o=!0):p===l&&(s[d+1]=l-1,o=!0)}o=!0;for(let d=s.length-2;d>=0&&o;d-=2){const h=Math.floor(s[d]),p=Math.floor(s[d+1]);if(h<-1||h>n||p<-1||p>l)throw new H;o=!1,h===-1?(s[d]=0,o=!0):h===n&&(s[d]=n-1,o=!0),p===-1?(s[d+1]=0,o=!0):p===l&&(s[d+1]=l-1,o=!0)}}}class Te{constructor(t,s,n,l,o,d,h,p,w){this.a11=t,this.a21=s,this.a31=n,this.a12=l,this.a22=o,this.a32=d,this.a13=h,this.a23=p,this.a33=w}static quadrilateralToQuadrilateral(t,s,n,l,o,d,h,p,w,S,P,W,ne,pe,je,Me){const Ve=Te.quadrilateralToSquare(t,s,n,l,o,d,h,p);return Te.squareToQuadrilateral(w,S,P,W,ne,pe,je,Me).times(Ve)}transformPoints(t){const s=t.length,n=this.a11,l=this.a12,o=this.a13,d=this.a21,h=this.a22,p=this.a23,w=this.a31,S=this.a32,P=this.a33;for(let W=0;W<s;W+=2){const ne=t[W],pe=t[W+1],je=o*ne+p*pe+P;t[W]=(n*ne+d*pe+w)/je,t[W+1]=(l*ne+h*pe+S)/je}}transformPointsWithValues(t,s){const n=this.a11,l=this.a12,o=this.a13,d=this.a21,h=this.a22,p=this.a23,w=this.a31,S=this.a32,P=this.a33,W=t.length;for(let ne=0;ne<W;ne++){const pe=t[ne],je=s[ne],Me=o*pe+p*je+P;t[ne]=(n*pe+d*je+w)/Me,s[ne]=(l*pe+h*je+S)/Me}}static squareToQuadrilateral(t,s,n,l,o,d,h,p){const w=t-n+o-h,S=s-l+d-p;if(w===0&&S===0)return new Te(n-t,o-n,t,l-s,d-l,s,0,0,1);{const P=n-o,W=h-o,ne=l-d,pe=p-d,je=P*pe-W*ne,Me=(w*pe-W*S)/je,Ve=(P*S-w*ne)/je;return new Te(n-t+Me*n,h-t+Ve*h,t,l-s+Me*l,p-s+Ve*p,s,Me,Ve,1)}}static quadrilateralToSquare(t,s,n,l,o,d,h,p){return Te.squareToQuadrilateral(t,s,n,l,o,d,h,p).buildAdjoint()}buildAdjoint(){return new Te(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(t){return new Te(this.a11*t.a11+this.a21*t.a12+this.a31*t.a13,this.a11*t.a21+this.a21*t.a22+this.a31*t.a23,this.a11*t.a31+this.a21*t.a32+this.a31*t.a33,this.a12*t.a11+this.a22*t.a12+this.a32*t.a13,this.a12*t.a21+this.a22*t.a22+this.a32*t.a23,this.a12*t.a31+this.a22*t.a32+this.a32*t.a33,this.a13*t.a11+this.a23*t.a12+this.a33*t.a13,this.a13*t.a21+this.a23*t.a22+this.a33*t.a23,this.a13*t.a31+this.a23*t.a32+this.a33*t.a33)}}class Qe extends Ne{sampleGrid(t,s,n,l,o,d,h,p,w,S,P,W,ne,pe,je,Me,Ve,mt,xt){const ct=Te.quadrilateralToQuadrilateral(l,o,d,h,p,w,S,P,W,ne,pe,je,Me,Ve,mt,xt);return this.sampleGridWithTransform(t,s,n,ct)}sampleGridWithTransform(t,s,n,l){if(s<=0||n<=0)throw new H;const o=new q(s,n),d=new Float32Array(2*s);for(let h=0;h<n;h++){const p=d.length,w=h+.5;for(let S=0;S<p;S+=2)d[S]=S/2+.5,d[S+1]=w;l.transformPoints(d),Ne.checkAndNudgePoints(t,d);try{for(let S=0;S<p;S+=2)t.get(Math.floor(d[S]),Math.floor(d[S+1]))&&o.set(S/2,h)}catch{throw new H}}return o}}class vt{static setGridSampler(t){vt.gridSampler=t}static getInstance(){return vt.gridSampler}}vt.gridSampler=new Qe;class Rt{constructor(t,s){this.x=t,this.y=s}toResultPoint(){return new ae(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class ht{constructor(t){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=t}detect(){return this.detectMirror(!1)}detectMirror(t){let s=this.getMatrixCenter(),n=this.getBullsEyeCorners(s);if(t){let d=n[0];n[0]=n[2],n[2]=d}this.extractParameters(n);let l=this.sampleGrid(this.image,n[this.shift%4],n[(this.shift+1)%4],n[(this.shift+2)%4],n[(this.shift+3)%4]),o=this.getMatrixCornerPoints(n);return new Ke(l,o,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(t){if(!this.isValidPoint(t[0])||!this.isValidPoint(t[1])||!this.isValidPoint(t[2])||!this.isValidPoint(t[3]))throw new H;let s=2*this.nbCenterLayers,n=new Int32Array([this.sampleLine(t[0],t[1],s),this.sampleLine(t[1],t[2],s),this.sampleLine(t[2],t[3],s),this.sampleLine(t[3],t[0],s)]);this.shift=this.getRotation(n,s);let l=0;for(let d=0;d<4;d++){let h=n[(this.shift+d)%4];this.compact?(l<<=7,l+=h>>1&127):(l<<=10,l+=(h>>2&992)+(h>>1&31))}let o=this.getCorrectedParameterData(l,this.compact);this.compact?(this.nbLayers=(o>>6)+1,this.nbDataBlocks=(o&63)+1):(this.nbLayers=(o>>11)+1,this.nbDataBlocks=(o&2047)+1)}getRotation(t,s){let n=0;t.forEach((l,o,d)=>{let h=(l>>s-2<<1)+(l&1);n=(n<<3)+h}),n=((n&1)<<11)+(n>>1);for(let l=0;l<4;l++)if(L.bitCount(n^this.EXPECTED_CORNER_BITS[l])<=2)return l;throw new H}getCorrectedParameterData(t,s){let n,l;s?(n=7,l=2):(n=10,l=4);let o=n-l,d=new Int32Array(n);for(let p=n-1;p>=0;--p)d[p]=t&15,t>>=4;try{new $e(Be.AZTEC_PARAM).decode(d,o)}catch{throw new H}let h=0;for(let p=0;p<l;p++)h=(h<<4)+d[p];return h}getBullsEyeCorners(t){let s=t,n=t,l=t,o=t,d=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let P=this.getFirstDifferent(s,d,1,-1),W=this.getFirstDifferent(n,d,1,1),ne=this.getFirstDifferent(l,d,-1,1),pe=this.getFirstDifferent(o,d,-1,-1);if(this.nbCenterLayers>2){let je=this.distancePoint(pe,P)*this.nbCenterLayers/(this.distancePoint(o,s)*(this.nbCenterLayers+2));if(je<.75||je>1.25||!this.isWhiteOrBlackRectangle(P,W,ne,pe))break}s=P,n=W,l=ne,o=pe,d=!d}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new H;this.compact=this.nbCenterLayers===5;let h=new ae(s.getX()+.5,s.getY()-.5),p=new ae(n.getX()+.5,n.getY()+.5),w=new ae(l.getX()-.5,l.getY()+.5),S=new ae(o.getX()-.5,o.getY()-.5);return this.expandSquare([h,p,w,S],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let t,s,n,l;try{let h=new le(this.image).detect();t=h[0],s=h[1],n=h[2],l=h[3]}catch{let p=this.image.getWidth()/2,w=this.image.getHeight()/2;t=this.getFirstDifferent(new Rt(p+7,w-7),!1,1,-1).toResultPoint(),s=this.getFirstDifferent(new Rt(p+7,w+7),!1,1,1).toResultPoint(),n=this.getFirstDifferent(new Rt(p-7,w+7),!1,-1,1).toResultPoint(),l=this.getFirstDifferent(new Rt(p-7,w-7),!1,-1,-1).toResultPoint()}let o=ue.round((t.getX()+l.getX()+s.getX()+n.getX())/4),d=ue.round((t.getY()+l.getY()+s.getY()+n.getY())/4);try{let h=new le(this.image,15,o,d).detect();t=h[0],s=h[1],n=h[2],l=h[3]}catch{t=this.getFirstDifferent(new Rt(o+7,d-7),!1,1,-1).toResultPoint(),s=this.getFirstDifferent(new Rt(o+7,d+7),!1,1,1).toResultPoint(),n=this.getFirstDifferent(new Rt(o-7,d+7),!1,-1,1).toResultPoint(),l=this.getFirstDifferent(new Rt(o-7,d-7),!1,-1,-1).toResultPoint()}return o=ue.round((t.getX()+l.getX()+s.getX()+n.getX())/4),d=ue.round((t.getY()+l.getY()+s.getY()+n.getY())/4),new Rt(o,d)}getMatrixCornerPoints(t){return this.expandSquare(t,2*this.nbCenterLayers,this.getDimension())}sampleGrid(t,s,n,l,o){let d=vt.getInstance(),h=this.getDimension(),p=h/2-this.nbCenterLayers,w=h/2+this.nbCenterLayers;return d.sampleGrid(t,h,h,p,p,w,p,w,w,p,w,s.getX(),s.getY(),n.getX(),n.getY(),l.getX(),l.getY(),o.getX(),o.getY())}sampleLine(t,s,n){let l=0,o=this.distanceResultPoint(t,s),d=o/n,h=t.getX(),p=t.getY(),w=d*(s.getX()-t.getX())/o,S=d*(s.getY()-t.getY())/o;for(let P=0;P<n;P++)this.image.get(ue.round(h+P*w),ue.round(p+P*S))&&(l|=1<<n-P-1);return l}isWhiteOrBlackRectangle(t,s,n,l){let o=3;t=new Rt(t.getX()-o,t.getY()+o),s=new Rt(s.getX()-o,s.getY()-o),n=new Rt(n.getX()+o,n.getY()-o),l=new Rt(l.getX()+o,l.getY()+o);let d=this.getColor(l,t);if(d===0)return!1;let h=this.getColor(t,s);return h!==d||(h=this.getColor(s,n),h!==d)?!1:(h=this.getColor(n,l),h===d)}getColor(t,s){let n=this.distancePoint(t,s),l=(s.getX()-t.getX())/n,o=(s.getY()-t.getY())/n,d=0,h=t.getX(),p=t.getY(),w=this.image.get(t.getX(),t.getY()),S=Math.ceil(n);for(let W=0;W<S;W++)h+=l,p+=o,this.image.get(ue.round(h),ue.round(p))!==w&&d++;let P=d/n;return P>.1&&P<.9?0:P<=.1===w?1:-1}getFirstDifferent(t,s,n,l){let o=t.getX()+n,d=t.getY()+l;for(;this.isValid(o,d)&&this.image.get(o,d)===s;)o+=n,d+=l;for(o-=n,d-=l;this.isValid(o,d)&&this.image.get(o,d)===s;)o+=n;for(o-=n;this.isValid(o,d)&&this.image.get(o,d)===s;)d+=l;return d-=l,new Rt(o,d)}expandSquare(t,s,n){let l=n/(2*s),o=t[0].getX()-t[2].getX(),d=t[0].getY()-t[2].getY(),h=(t[0].getX()+t[2].getX())/2,p=(t[0].getY()+t[2].getY())/2,w=new ae(h+l*o,p+l*d),S=new ae(h-l*o,p-l*d);o=t[1].getX()-t[3].getX(),d=t[1].getY()-t[3].getY(),h=(t[1].getX()+t[3].getX())/2,p=(t[1].getY()+t[3].getY())/2;let P=new ae(h+l*o,p+l*d),W=new ae(h-l*o,p-l*d);return[w,P,S,W]}isValid(t,s){return t>=0&&t<this.image.getWidth()&&s>0&&s<this.image.getHeight()}isValidPoint(t){let s=ue.round(t.getX()),n=ue.round(t.getY());return this.isValid(s,n)}distancePoint(t,s){return ue.distance(t.getX(),t.getY(),s.getX(),s.getY())}distanceResultPoint(t,s){return ue.distance(t.getX(),t.getY(),s.getX(),s.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(L.truncDivision(this.nbLayers-4,8)+1)+15}}class Se{decode(t,s=null){let n=null,l=new ht(t.getBlackMatrix()),o=null,d=null;try{let S=l.detectMirror(!1);o=S.getPoints(),this.reportFoundResultPoints(s,o),d=new be().decode(S)}catch(S){n=S}if(d==null)try{let S=l.detectMirror(!0);o=S.getPoints(),this.reportFoundResultPoints(s,o),d=new be().decode(S)}catch(S){throw n??S}let h=new Q(d.getText(),d.getRawBytes(),d.getNumBits(),o,Ue.AZTEC,E.currentTimeMillis()),p=d.getByteSegments();p!=null&&h.putMetadata(Re.BYTE_SEGMENTS,p);let w=d.getECLevel();return w!=null&&h.putMetadata(Re.ERROR_CORRECTION_LEVEL,w),h}reportFoundResultPoints(t,s){if(t!=null){let n=t.get(Y.NEED_RESULT_POINT_CALLBACK);n!=null&&s.forEach((l,o,d)=>{n.foundPossibleResultPoint(l)})}}reset(){}}class ve extends ye{constructor(t=500){super(new Se,t)}}class de{decode(t,s){try{return this.doDecode(t,s)}catch{if(s&&s.get(Y.TRY_HARDER)===!0&&t.isRotateSupported()){const o=t.rotateCounterClockwise(),d=this.doDecode(o,s),h=d.getResultMetadata();let p=270;h!==null&&h.get(Re.ORIENTATION)===!0&&(p=p+h.get(Re.ORIENTATION)%360),d.putMetadata(Re.ORIENTATION,p);const w=d.getResultPoints();if(w!==null){const S=o.getHeight();for(let P=0;P<w.length;P++)w[P]=new ae(S-w[P].getY()-1,w[P].getX())}return d}else throw new H}}reset(){}doDecode(t,s){const n=t.getWidth(),l=t.getHeight();let o=new C(n);const d=s&&s.get(Y.TRY_HARDER)===!0,h=Math.max(1,l>>(d?8:5));let p;d?p=l:p=15;const w=Math.trunc(l/2);for(let S=0;S<p;S++){const P=Math.trunc((S+1)/2),W=(S&1)===0,ne=w+h*(W?P:-P);if(ne<0||ne>=l)break;try{o=t.getBlackRow(ne,o)}catch{continue}for(let pe=0;pe<2;pe++){if(pe===1&&(o.reverse(),s&&s.get(Y.NEED_RESULT_POINT_CALLBACK)===!0)){const je=new Map;s.forEach((Me,Ve)=>je.set(Ve,Me)),je.delete(Y.NEED_RESULT_POINT_CALLBACK),s=je}try{const je=this.decodeRow(ne,o,s);if(pe===1){je.putMetadata(Re.ORIENTATION,180);const Me=je.getResultPoints();Me!==null&&(Me[0]=new ae(n-Me[0].getX()-1,Me[0].getY()),Me[1]=new ae(n-Me[1].getX()-1,Me[1].getY()))}return je}catch{}}}throw new H}static recordPattern(t,s,n){const l=n.length;for(let w=0;w<l;w++)n[w]=0;const o=t.getSize();if(s>=o)throw new H;let d=!t.get(s),h=0,p=s;for(;p<o;){if(t.get(p)!==d)n[h]++;else{if(++h===l)break;n[h]=1,d=!d}p++}if(!(h===l||h===l-1&&p===o))throw new H}static recordPatternInReverse(t,s,n){let l=n.length,o=t.get(s);for(;s>0&&l>=0;)t.get(--s)!==o&&(l--,o=!o);if(l>=0)throw new H;de.recordPattern(t,s+1,n)}static patternMatchVariance(t,s,n){const l=t.length;let o=0,d=0;for(let w=0;w<l;w++)o+=t[w],d+=s[w];if(o<d)return Number.POSITIVE_INFINITY;const h=o/d;n*=h;let p=0;for(let w=0;w<l;w++){const S=t[w],P=s[w]*h,W=S>P?S-P:P-S;if(W>n)return Number.POSITIVE_INFINITY;p+=W}return p/o}}class me extends de{static findStartPattern(t){const s=t.getSize(),n=t.getNextSet(0);let l=0,o=Int32Array.from([0,0,0,0,0,0]),d=n,h=!1;const p=6;for(let w=n;w<s;w++)if(t.get(w)!==h)o[l]++;else{if(l===p-1){let S=me.MAX_AVG_VARIANCE,P=-1;for(let W=me.CODE_START_A;W<=me.CODE_START_C;W++){const ne=de.patternMatchVariance(o,me.CODE_PATTERNS[W],me.MAX_INDIVIDUAL_VARIANCE);ne<S&&(S=ne,P=W)}if(P>=0&&t.isRange(Math.max(0,d-(w-d)/2),d,!1))return Int32Array.from([d,w,P]);d+=o[0]+o[1],o=o.slice(2,o.length-1),o[l-1]=0,o[l]=0,l--}else l++;o[l]=1,h=!h}throw new H}static decodeCode(t,s,n){de.recordPattern(t,n,s);let l=me.MAX_AVG_VARIANCE,o=-1;for(let d=0;d<me.CODE_PATTERNS.length;d++){const h=me.CODE_PATTERNS[d],p=this.patternMatchVariance(s,h,me.MAX_INDIVIDUAL_VARIANCE);p<l&&(l=p,o=d)}if(o>=0)return o;throw new H}decodeRow(t,s,n){const l=n&&n.get(Y.ASSUME_GS1)===!0,o=me.findStartPattern(s),d=o[2];let h=0;const p=new Uint8Array(20);p[h++]=d;let w;switch(d){case me.CODE_START_A:w=me.CODE_CODE_A;break;case me.CODE_START_B:w=me.CODE_CODE_B;break;case me.CODE_START_C:w=me.CODE_CODE_C;break;default:throw new A}let S=!1,P=!1,W="",ne=o[0],pe=o[1];const je=Int32Array.from([0,0,0,0,0,0]);let Me=0,Ve=0,mt=d,xt=0,ct=!0,ls=!1,Zt=!1;for(;!S;){const Ra=P;switch(P=!1,Me=Ve,Ve=me.decodeCode(s,je,pe),p[h++]=Ve,Ve!==me.CODE_STOP&&(ct=!0),Ve!==me.CODE_STOP&&(xt++,mt+=xt*Ve),ne=pe,pe+=je.reduce((yd,wd)=>yd+wd,0),Ve){case me.CODE_START_A:case me.CODE_START_B:case me.CODE_START_C:throw new A}switch(w){case me.CODE_CODE_A:if(Ve<64)Zt===ls?W+=String.fromCharCode(32+Ve):W+=String.fromCharCode(32+Ve+128),Zt=!1;else if(Ve<96)Zt===ls?W+=String.fromCharCode(Ve-64):W+=String.fromCharCode(Ve+64),Zt=!1;else switch(Ve!==me.CODE_STOP&&(ct=!1),Ve){case me.CODE_FNC_1:l&&(W.length===0?W+="]C1":W+="");break;case me.CODE_FNC_2:case me.CODE_FNC_3:break;case me.CODE_FNC_4_A:!ls&&Zt?(ls=!0,Zt=!1):ls&&Zt?(ls=!1,Zt=!1):Zt=!0;break;case me.CODE_SHIFT:P=!0,w=me.CODE_CODE_B;break;case me.CODE_CODE_B:w=me.CODE_CODE_B;break;case me.CODE_CODE_C:w=me.CODE_CODE_C;break;case me.CODE_STOP:S=!0;break}break;case me.CODE_CODE_B:if(Ve<96)Zt===ls?W+=String.fromCharCode(32+Ve):W+=String.fromCharCode(32+Ve+128),Zt=!1;else switch(Ve!==me.CODE_STOP&&(ct=!1),Ve){case me.CODE_FNC_1:l&&(W.length===0?W+="]C1":W+="");break;case me.CODE_FNC_2:case me.CODE_FNC_3:break;case me.CODE_FNC_4_B:!ls&&Zt?(ls=!0,Zt=!1):ls&&Zt?(ls=!1,Zt=!1):Zt=!0;break;case me.CODE_SHIFT:P=!0,w=me.CODE_CODE_A;break;case me.CODE_CODE_A:w=me.CODE_CODE_A;break;case me.CODE_CODE_C:w=me.CODE_CODE_C;break;case me.CODE_STOP:S=!0;break}break;case me.CODE_CODE_C:if(Ve<100)Ve<10&&(W+="0"),W+=Ve;else switch(Ve!==me.CODE_STOP&&(ct=!1),Ve){case me.CODE_FNC_1:l&&(W.length===0?W+="]C1":W+="");break;case me.CODE_CODE_A:w=me.CODE_CODE_A;break;case me.CODE_CODE_B:w=me.CODE_CODE_B;break;case me.CODE_STOP:S=!0;break}break}Ra&&(w=w===me.CODE_CODE_A?me.CODE_CODE_B:me.CODE_CODE_A)}const wr=pe-ne;if(pe=s.getNextUnset(pe),!s.isRange(pe,Math.min(s.getSize(),pe+(pe-ne)/2),!1))throw new H;if(mt-=xt*Me,mt%103!==Me)throw new R;const Or=W.length;if(Or===0)throw new H;Or>0&&ct&&(w===me.CODE_CODE_C?W=W.substring(0,Or-2):W=W.substring(0,Or-1));const jr=(o[1]+o[0])/2,Ds=ne+wr/2,or=p.length,Sr=new Uint8Array(or);for(let Ra=0;Ra<or;Ra++)Sr[Ra]=p[Ra];const Ma=[new ae(jr,t),new ae(Ds,t)];return new Q(W,Sr,0,Ma,Ue.CODE_128,new Date().getTime())}}me.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],me.MAX_AVG_VARIANCE=.25,me.MAX_INDIVIDUAL_VARIANCE=.7,me.CODE_SHIFT=98,me.CODE_CODE_C=99,me.CODE_CODE_B=100,me.CODE_CODE_A=101,me.CODE_FNC_1=102,me.CODE_FNC_2=97,me.CODE_FNC_3=96,me.CODE_FNC_4_A=101,me.CODE_FNC_4_B=100,me.CODE_START_A=103,me.CODE_START_B=104,me.CODE_START_C=105,me.CODE_STOP=106;class Ae extends de{constructor(t=!1,s=!1){super(),this.usingCheckDigit=t,this.extendedMode=s,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(t,s,n){let l=this.counters;l.fill(0),this.decodeRowResult="";let o=Ae.findAsteriskPattern(s,l),d=s.getNextSet(o[1]),h=s.getSize(),p,w;do{Ae.recordPattern(s,d,l);let je=Ae.toNarrowWidePattern(l);if(je<0)throw new H;p=Ae.patternToChar(je),this.decodeRowResult+=p,w=d;for(let Me of l)d+=Me;d=s.getNextSet(d)}while(p!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let S=0;for(let je of l)S+=je;let P=d-w-S;if(d!==h&&P*2<S)throw new H;if(this.usingCheckDigit){let je=this.decodeRowResult.length-1,Me=0;for(let Ve=0;Ve<je;Ve++)Me+=Ae.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(Ve));if(this.decodeRowResult.charAt(je)!==Ae.ALPHABET_STRING.charAt(Me%43))throw new R;this.decodeRowResult=this.decodeRowResult.substring(0,je)}if(this.decodeRowResult.length===0)throw new H;let W;this.extendedMode?W=Ae.decodeExtended(this.decodeRowResult):W=this.decodeRowResult;let ne=(o[1]+o[0])/2,pe=w+S/2;return new Q(W,null,0,[new ae(ne,t),new ae(pe,t)],Ue.CODE_39,new Date().getTime())}static findAsteriskPattern(t,s){let n=t.getSize(),l=t.getNextSet(0),o=0,d=l,h=!1,p=s.length;for(let w=l;w<n;w++)if(t.get(w)!==h)s[o]++;else{if(o===p-1){if(this.toNarrowWidePattern(s)===Ae.ASTERISK_ENCODING&&t.isRange(Math.max(0,d-Math.floor((w-d)/2)),d,!1))return[d,w];d+=s[0]+s[1],s.copyWithin(0,2,2+o-1),s[o-1]=0,s[o]=0,o--}else o++;s[o]=1,h=!h}throw new H}static toNarrowWidePattern(t){let s=t.length,n=0,l;do{let o=2147483647;for(let p of t)p<o&&p>n&&(o=p);n=o,l=0;let d=0,h=0;for(let p=0;p<s;p++){let w=t[p];w>n&&(h|=1<<s-1-p,l++,d+=w)}if(l===3){for(let p=0;p<s&&l>0;p++){let w=t[p];if(w>n&&(l--,w*2>=d))return-1}return h}}while(l>3);return-1}static patternToChar(t){for(let s=0;s<Ae.CHARACTER_ENCODINGS.length;s++)if(Ae.CHARACTER_ENCODINGS[s]===t)return Ae.ALPHABET_STRING.charAt(s);if(t===Ae.ASTERISK_ENCODING)return"*";throw new H}static decodeExtended(t){let s=t.length,n="";for(let l=0;l<s;l++){let o=t.charAt(l);if(o==="+"||o==="$"||o==="%"||o==="/"){let d=t.charAt(l+1),h="\0";switch(o){case"+":if(d>="A"&&d<="Z")h=String.fromCharCode(d.charCodeAt(0)+32);else throw new A;break;case"$":if(d>="A"&&d<="Z")h=String.fromCharCode(d.charCodeAt(0)-64);else throw new A;break;case"%":if(d>="A"&&d<="E")h=String.fromCharCode(d.charCodeAt(0)-38);else if(d>="F"&&d<="J")h=String.fromCharCode(d.charCodeAt(0)-11);else if(d>="K"&&d<="O")h=String.fromCharCode(d.charCodeAt(0)+16);else if(d>="P"&&d<="T")h=String.fromCharCode(d.charCodeAt(0)+43);else if(d==="U")h="\0";else if(d==="V")h="@";else if(d==="W")h="`";else if(d==="X"||d==="Y"||d==="Z")h="";else throw new A;break;case"/":if(d>="A"&&d<="O")h=String.fromCharCode(d.charCodeAt(0)-32);else if(d==="Z")h=":";else throw new A;break}n+=h,l++}else n+=o}return n}}Ae.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",Ae.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],Ae.ASTERISK_ENCODING=148;class it extends de{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(t,s,n){let l=this.decodeStart(s),o=this.decodeEnd(s),d=new se;it.decodeMiddle(s,l[1],o[0],d);let h=d.toString(),p=null;n!=null&&(p=n.get(Y.ALLOWED_LENGTHS)),p==null&&(p=it.DEFAULT_ALLOWED_LENGTHS);let w=h.length,S=!1,P=0;for(let pe of p){if(w===pe){S=!0;break}pe>P&&(P=pe)}if(!S&&w>P&&(S=!0),!S)throw new A;const W=[new ae(l[1],t),new ae(o[0],t)];return new Q(h,null,0,W,Ue.ITF,new Date().getTime())}static decodeMiddle(t,s,n,l){let o=new Int32Array(10),d=new Int32Array(5),h=new Int32Array(5);for(o.fill(0),d.fill(0),h.fill(0);s<n;){de.recordPattern(t,s,o);for(let w=0;w<5;w++){let S=2*w;d[w]=o[S],h[w]=o[S+1]}let p=it.decodeDigit(d);l.append(p.toString()),p=this.decodeDigit(h),l.append(p.toString()),o.forEach(function(w){s+=w})}}decodeStart(t){let s=it.skipWhiteSpace(t),n=it.findGuardPattern(t,s,it.START_PATTERN);return this.narrowLineWidth=(n[1]-n[0])/4,this.validateQuietZone(t,n[0]),n}validateQuietZone(t,s){let n=this.narrowLineWidth*10;n=n<s?n:s;for(let l=s-1;n>0&&l>=0&&!t.get(l);l--)n--;if(n!==0)throw new H}static skipWhiteSpace(t){const s=t.getSize(),n=t.getNextSet(0);if(n===s)throw new H;return n}decodeEnd(t){t.reverse();try{let s=it.skipWhiteSpace(t),n;try{n=it.findGuardPattern(t,s,it.END_PATTERN_REVERSED[0])}catch(o){o instanceof H&&(n=it.findGuardPattern(t,s,it.END_PATTERN_REVERSED[1]))}this.validateQuietZone(t,n[0]);let l=n[0];return n[0]=t.getSize()-n[1],n[1]=t.getSize()-l,n}finally{t.reverse()}}static findGuardPattern(t,s,n){let l=n.length,o=new Int32Array(l),d=t.getSize(),h=!1,p=0,w=s;o.fill(0);for(let S=s;S<d;S++)if(t.get(S)!==h)o[p]++;else{if(p===l-1){if(de.patternMatchVariance(o,n,it.MAX_INDIVIDUAL_VARIANCE)<it.MAX_AVG_VARIANCE)return[w,S];w+=o[0]+o[1],E.arraycopy(o,2,o,0,p-1),o[p-1]=0,o[p]=0,p--}else p++;o[p]=1,h=!h}throw new H}static decodeDigit(t){let s=it.MAX_AVG_VARIANCE,n=-1,l=it.PATTERNS.length;for(let o=0;o<l;o++){let d=it.PATTERNS[o],h=de.patternMatchVariance(t,d,it.MAX_INDIVIDUAL_VARIANCE);h<s?(s=h,n=o):h===s&&(n=-1)}if(n>=0)return n%10;throw new H}}it.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],it.MAX_AVG_VARIANCE=.38,it.MAX_INDIVIDUAL_VARIANCE=.5,it.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],it.START_PATTERN=Int32Array.from([1,1,1,1]),it.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class St extends de{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(t){let s=!1,n,l=0,o=Int32Array.from([0,0,0]);for(;!s;){o=Int32Array.from([0,0,0]),n=St.findGuardPattern(t,l,!1,this.START_END_PATTERN,o);let d=n[0];l=n[1];let h=d-(l-d);h>=0&&(s=t.isRange(h,d,!1))}return n}static checkChecksum(t){return St.checkStandardUPCEANChecksum(t)}static checkStandardUPCEANChecksum(t){let s=t.length;if(s===0)return!1;let n=parseInt(t.charAt(s-1),10);return St.getStandardUPCEANChecksum(t.substring(0,s-1))===n}static getStandardUPCEANChecksum(t){let s=t.length,n=0;for(let l=s-1;l>=0;l-=2){let o=t.charAt(l).charCodeAt(0)-48;if(o<0||o>9)throw new A;n+=o}n*=3;for(let l=s-2;l>=0;l-=2){let o=t.charAt(l).charCodeAt(0)-48;if(o<0||o>9)throw new A;n+=o}return(1e3-n)%10}static decodeEnd(t,s){return St.findGuardPattern(t,s,!1,St.START_END_PATTERN,new Int32Array(St.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(t,s,n,l){return this.findGuardPattern(t,s,n,l,new Int32Array(l.length))}static findGuardPattern(t,s,n,l,o){let d=t.getSize();s=n?t.getNextUnset(s):t.getNextSet(s);let h=0,p=s,w=l.length,S=n;for(let P=s;P<d;P++)if(t.get(P)!==S)o[h]++;else{if(h===w-1){if(de.patternMatchVariance(o,l,St.MAX_INDIVIDUAL_VARIANCE)<St.MAX_AVG_VARIANCE)return Int32Array.from([p,P]);p+=o[0]+o[1];let W=o.slice(2,o.length-1);for(let ne=0;ne<h-1;ne++)o[ne]=W[ne];o[h-1]=0,o[h]=0,h--}else h++;o[h]=1,S=!S}throw new H}static decodeDigit(t,s,n,l){this.recordPattern(t,n,s);let o=this.MAX_AVG_VARIANCE,d=-1,h=l.length;for(let p=0;p<h;p++){let w=l[p],S=de.patternMatchVariance(s,w,St.MAX_INDIVIDUAL_VARIANCE);S<o&&(o=S,d=p)}if(d>=0)return d;throw new H}}St.MAX_AVG_VARIANCE=.48,St.MAX_INDIVIDUAL_VARIANCE=.7,St.START_END_PATTERN=Int32Array.from([1,1,1]),St.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),St.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),St.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class kt{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(t,s,n){let l=this.decodeRowStringBuffer,o=this.decodeMiddle(s,n,l),d=l.toString(),h=kt.parseExtensionString(d),p=[new ae((n[0]+n[1])/2,t),new ae(o,t)],w=new Q(d,null,0,p,Ue.UPC_EAN_EXTENSION,new Date().getTime());return h!=null&&w.putAllMetadata(h),w}decodeMiddle(t,s,n){let l=this.decodeMiddleCounters;l[0]=0,l[1]=0,l[2]=0,l[3]=0;let o=t.getSize(),d=s[1],h=0;for(let w=0;w<5&&d<o;w++){let S=St.decodeDigit(t,l,d,St.L_AND_G_PATTERNS);n+=String.fromCharCode(48+S%10);for(let P of l)d+=P;S>=10&&(h|=1<<4-w),w!==4&&(d=t.getNextSet(d),d=t.getNextUnset(d))}if(n.length!==5)throw new H;let p=this.determineCheckDigit(h);if(kt.extensionChecksum(n.toString())!==p)throw new H;return d}static extensionChecksum(t){let s=t.length,n=0;for(let l=s-2;l>=0;l-=2)n+=t.charAt(l).charCodeAt(0)-48;n*=3;for(let l=s-1;l>=0;l-=2)n+=t.charAt(l).charCodeAt(0)-48;return n*=3,n%10}determineCheckDigit(t){for(let s=0;s<10;s++)if(t===this.CHECK_DIGIT_ENCODINGS[s])return s;throw new H}static parseExtensionString(t){if(t.length!==5)return null;let s=kt.parseExtension5String(t);return s==null?null:new Map([[Re.SUGGESTED_PRICE,s]])}static parseExtension5String(t){let s;switch(t.charAt(0)){case"0":s="£";break;case"5":s="$";break;case"9":switch(t){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}s="";break;default:s="";break}let n=parseInt(t.substring(1)),l=(n/100).toString(),o=n%100,d=o<10?"0"+o:o.toString();return s+l+"."+d}}class et{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(t,s,n){let l=this.decodeRowStringBuffer,o=this.decodeMiddle(s,n,l),d=l.toString(),h=et.parseExtensionString(d),p=[new ae((n[0]+n[1])/2,t),new ae(o,t)],w=new Q(d,null,0,p,Ue.UPC_EAN_EXTENSION,new Date().getTime());return h!=null&&w.putAllMetadata(h),w}decodeMiddle(t,s,n){let l=this.decodeMiddleCounters;l[0]=0,l[1]=0,l[2]=0,l[3]=0;let o=t.getSize(),d=s[1],h=0;for(let p=0;p<2&&d<o;p++){let w=St.decodeDigit(t,l,d,St.L_AND_G_PATTERNS);n+=String.fromCharCode(48+w%10);for(let S of l)d+=S;w>=10&&(h|=1<<1-p),p!==1&&(d=t.getNextSet(d),d=t.getNextUnset(d))}if(n.length!==2)throw new H;if(parseInt(n.toString())%4!==h)throw new H;return d}static parseExtensionString(t){return t.length!==2?null:new Map([[Re.ISSUE_NUMBER,parseInt(t)]])}}class xs{static decodeRow(t,s,n){let l=St.findGuardPattern(s,n,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new kt().decodeRow(t,s,l)}catch{return new et().decodeRow(t,s,l)}}}xs.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class Nt extends St{constructor(){super(),this.decodeRowStringBuffer="",Nt.L_AND_G_PATTERNS=Nt.L_PATTERNS.map(t=>Int32Array.from(t));for(let t=10;t<20;t++){let s=Nt.L_PATTERNS[t-10],n=new Int32Array(s.length);for(let l=0;l<s.length;l++)n[l]=s[s.length-l-1];Nt.L_AND_G_PATTERNS[t]=n}}decodeRow(t,s,n){let l=Nt.findStartGuardPattern(s),o=n==null?null:n.get(Y.NEED_RESULT_POINT_CALLBACK);if(o!=null){const ct=new ae((l[0]+l[1])/2,t);o.foundPossibleResultPoint(ct)}let d=this.decodeMiddle(s,l,this.decodeRowStringBuffer),h=d.rowOffset,p=d.resultString;if(o!=null){const ct=new ae(h,t);o.foundPossibleResultPoint(ct)}let w=this.decodeEnd(s,h);if(o!=null){const ct=new ae((w[0]+w[1])/2,t);o.foundPossibleResultPoint(ct)}let S=w[1],P=S+(S-w[0]);if(P>=s.getSize()||!s.isRange(S,P,!1))throw new H;let W=p.toString();if(W.length<8)throw new A;if(!Nt.checkChecksum(W))throw new R;let ne=(l[1]+l[0])/2,pe=(w[1]+w[0])/2,je=this.getBarcodeFormat(),Me=[new ae(ne,t),new ae(pe,t)],Ve=new Q(W,null,0,Me,je,new Date().getTime()),mt=0;try{let ct=xs.decodeRow(t,s,w[1]);Ve.putMetadata(Re.UPC_EAN_EXTENSION,ct.getText()),Ve.putAllMetadata(ct.getResultMetadata()),Ve.addResultPoints(ct.getResultPoints()),mt=ct.getText().length}catch{}let xt=n==null?null:n.get(Y.ALLOWED_EAN_EXTENSIONS);if(xt!=null){let ct=!1;for(let ls in xt)if(mt.toString()===ls){ct=!0;break}if(!ct)throw new H}return Ve}decodeEnd(t,s){return Nt.findGuardPattern(t,s,!1,Nt.START_END_PATTERN,new Int32Array(Nt.START_END_PATTERN.length).fill(0))}static checkChecksum(t){return Nt.checkStandardUPCEANChecksum(t)}static checkStandardUPCEANChecksum(t){let s=t.length;if(s===0)return!1;let n=parseInt(t.charAt(s-1),10);return Nt.getStandardUPCEANChecksum(t.substring(0,s-1))===n}static getStandardUPCEANChecksum(t){let s=t.length,n=0;for(let l=s-1;l>=0;l-=2){let o=t.charAt(l).charCodeAt(0)-48;if(o<0||o>9)throw new A;n+=o}n*=3;for(let l=s-2;l>=0;l-=2){let o=t.charAt(l).charCodeAt(0)-48;if(o<0||o>9)throw new A;n+=o}return(1e3-n)%10}}class ss extends Nt{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(t,s,n){let l=this.decodeMiddleCounters;l[0]=0,l[1]=0,l[2]=0,l[3]=0;let o=t.getSize(),d=s[1],h=0;for(let w=0;w<6&&d<o;w++){let S=Nt.decodeDigit(t,l,d,Nt.L_AND_G_PATTERNS);n+=String.fromCharCode(48+S%10);for(let P of l)d+=P;S>=10&&(h|=1<<5-w)}n=ss.determineFirstDigit(n,h),d=Nt.findGuardPattern(t,d,!0,Nt.MIDDLE_PATTERN,new Int32Array(Nt.MIDDLE_PATTERN.length).fill(0))[1];for(let w=0;w<6&&d<o;w++){let S=Nt.decodeDigit(t,l,d,Nt.L_PATTERNS);n+=String.fromCharCode(48+S);for(let P of l)d+=P}return{rowOffset:d,resultString:n}}getBarcodeFormat(){return Ue.EAN_13}static determineFirstDigit(t,s){for(let n=0;n<10;n++)if(s===this.FIRST_DIGIT_ENCODINGS[n])return t=String.fromCharCode(48+n)+t,t;throw new H}}ss.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class gt extends Nt{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(t,s,n){const l=this.decodeMiddleCounters;l[0]=0,l[1]=0,l[2]=0,l[3]=0;let o=t.getSize(),d=s[1];for(let p=0;p<4&&d<o;p++){let w=Nt.decodeDigit(t,l,d,Nt.L_PATTERNS);n+=String.fromCharCode(48+w);for(let S of l)d+=S}d=Nt.findGuardPattern(t,d,!0,Nt.MIDDLE_PATTERN,new Int32Array(Nt.MIDDLE_PATTERN.length).fill(0))[1];for(let p=0;p<4&&d<o;p++){let w=Nt.decodeDigit(t,l,d,Nt.L_PATTERNS);n+=String.fromCharCode(48+w);for(let S of l)d+=S}return{rowOffset:d,resultString:n}}getBarcodeFormat(){return Ue.EAN_8}}class Is extends Nt{constructor(){super(...arguments),this.ean13Reader=new ss}getBarcodeFormat(){return Ue.UPC_A}decode(t,s){return this.maybeReturnResult(this.ean13Reader.decode(t))}decodeRow(t,s,n){return this.maybeReturnResult(this.ean13Reader.decodeRow(t,s,n))}decodeMiddle(t,s,n){return this.ean13Reader.decodeMiddle(t,s,n)}maybeReturnResult(t){let s=t.getText();if(s.charAt(0)==="0"){let n=new Q(s.substring(1),null,null,t.getResultPoints(),Ue.UPC_A);return t.getResultMetadata()!=null&&n.putAllMetadata(t.getResultMetadata()),n}else throw new H}reset(){this.ean13Reader.reset()}}class ts extends Nt{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(t,s,n){const l=this.decodeMiddleCounters.map(w=>w);l[0]=0,l[1]=0,l[2]=0,l[3]=0;const o=t.getSize();let d=s[1],h=0;for(let w=0;w<6&&d<o;w++){const S=ts.decodeDigit(t,l,d,ts.L_AND_G_PATTERNS);n+=String.fromCharCode(48+S%10);for(let P of l)d+=P;S>=10&&(h|=1<<5-w)}let p=ts.determineNumSysAndCheckDigit(n,h);return{rowOffset:d,resultString:p}}decodeEnd(t,s){return ts.findGuardPatternWithoutCounters(t,s,!0,ts.MIDDLE_END_PATTERN)}checkChecksum(t){return Nt.checkChecksum(ts.convertUPCEtoUPCA(t))}static determineNumSysAndCheckDigit(t,s){for(let n=0;n<=1;n++)for(let l=0;l<10;l++)if(s===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[n][l]){let o=String.fromCharCode(48+n),d=String.fromCharCode(48+l);return o+t+d}throw H.getNotFoundInstance()}getBarcodeFormat(){return Ue.UPC_E}static convertUPCEtoUPCA(t){const s=t.slice(1,7).split("").map(o=>o.charCodeAt(0)),n=new se;n.append(t.charAt(0));let l=s[5];switch(l){case 0:case 1:case 2:n.appendChars(s,0,2),n.append(l),n.append("0000"),n.appendChars(s,2,3);break;case 3:n.appendChars(s,0,3),n.append("00000"),n.appendChars(s,3,2);break;case 4:n.appendChars(s,0,4),n.append("00000"),n.append(s[4]);break;default:n.appendChars(s,0,5),n.append("0000"),n.append(l);break}return t.length>=8&&n.append(t.charAt(7)),n.toString()}}ts.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),ts.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class bs extends de{constructor(t){super();let s=t==null?null:t.get(Y.POSSIBLE_FORMATS),n=[];c(s)?(n.push(new ss),n.push(new Is),n.push(new gt),n.push(new ts)):(s.indexOf(Ue.EAN_13)>-1&&n.push(new ss),s.indexOf(Ue.UPC_A)>-1&&n.push(new Is),s.indexOf(Ue.EAN_8)>-1&&n.push(new gt),s.indexOf(Ue.UPC_E)>-1&&n.push(new ts)),this.readers=n}decodeRow(t,s,n){for(let l of this.readers)try{const o=l.decodeRow(t,s,n),d=o.getBarcodeFormat()===Ue.EAN_13&&o.getText().charAt(0)==="0",h=n==null?null:n.get(Y.POSSIBLE_FORMATS),p=h==null||h.includes(Ue.UPC_A);if(d&&p){const w=o.getRawBytes(),S=new Q(o.getText().substring(1),w,w?w.length:null,o.getResultPoints(),Ue.UPC_A);return S.putAllMetadata(o.getResultMetadata()),S}return o}catch{}throw new H}reset(){for(let t of this.readers)t.reset()}}class Qt extends de{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(t,s){for(let n=0;n<s.length;n++)if(de.patternMatchVariance(t,s[n],Qt.MAX_INDIVIDUAL_VARIANCE)<Qt.MAX_AVG_VARIANCE)return n;throw new H}static count(t){return ue.sum(new Int32Array(t))}static increment(t,s){let n=0,l=s[0];for(let o=1;o<t.length;o++)s[o]>l&&(l=s[o],n=o);t[n]++}static decrement(t,s){let n=0,l=s[0];for(let o=1;o<t.length;o++)s[o]<l&&(l=s[o],n=o);t[n]--}static isFinderPattern(t){let s=t[0]+t[1],n=s+t[2]+t[3],l=s/n;if(l>=Qt.MIN_FINDER_PATTERN_RATIO&&l<=Qt.MAX_FINDER_PATTERN_RATIO){let o=Number.MAX_SAFE_INTEGER,d=Number.MIN_SAFE_INTEGER;for(let h of t)h>d&&(d=h),h<o&&(o=h);return d<10*o}return!1}}Qt.MAX_AVG_VARIANCE=.2,Qt.MAX_INDIVIDUAL_VARIANCE=.45,Qt.MIN_FINDER_PATTERN_RATIO=9.5/12,Qt.MAX_FINDER_PATTERN_RATIO=12.5/14;class Pe{constructor(t,s){this.value=t,this.checksumPortion=s}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(t){if(!(t instanceof Pe))return!1;const s=t;return this.value===s.value&&this.checksumPortion===s.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class ot{constructor(t,s,n,l,o){this.value=t,this.startEnd=s,this.value=t,this.startEnd=s,this.resultPoints=new Array,this.resultPoints.push(new ae(n,o)),this.resultPoints.push(new ae(l,o))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(t){if(!(t instanceof ot))return!1;const s=t;return this.value===s.value}hashCode(){return this.value}}class $t{constructor(){}static getRSSvalue(t,s,n){let l=0;for(let p of t)l+=p;let o=0,d=0,h=t.length;for(let p=0;p<h-1;p++){let w;for(w=1,d|=1<<p;w<t[p];w++,d&=~(1<<p)){let S=$t.combins(l-w-1,h-p-2);if(n&&d===0&&l-w-(h-p-1)>=h-p-1&&(S-=$t.combins(l-w-(h-p),h-p-2)),h-p-1>1){let P=0;for(let W=l-w-(h-p-2);W>s;W--)P+=$t.combins(l-w-W-1,h-p-3);S-=P*(h-1-p)}else l-w>s&&S--;o+=S}l-=w}return o}static combins(t,s){let n,l;t-s>s?(l=s,n=t-s):(l=t-s,n=s);let o=1,d=1;for(let h=t;h>n;h--)o*=h,d<=l&&(o/=d,d++);for(;d<=l;)o/=d,d++;return o}}class gs{static buildBitArray(t){let s=t.length*2-1;t[t.length-1].getRightChar()==null&&(s-=1);let n=12*s,l=new C(n),o=0,h=t[0].getRightChar().getValue();for(let p=11;p>=0;--p)h&1<<p&&l.set(o),o++;for(let p=1;p<t.length;++p){let w=t[p],S=w.getLeftChar().getValue();for(let P=11;P>=0;--P)S&1<<P&&l.set(o),o++;if(w.getRightChar()!=null){let P=w.getRightChar().getValue();for(let W=11;W>=0;--W)P&1<<W&&l.set(o),o++}}return l}}class Jt{constructor(t,s){s?this.decodedInformation=null:(this.finished=t,this.decodedInformation=s)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Es{constructor(t){this.newPosition=t}getNewPosition(){return this.newPosition}}class as extends Es{constructor(t,s){super(t),this.value=s}getValue(){return this.value}isFNC1(){return this.value===as.FNC1}}as.FNC1="$";class Us extends Es{constructor(t,s,n){super(t),n?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=s}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class ys extends Es{constructor(t,s,n){if(super(t),s<0||s>10||n<0||n>10)throw new A;this.firstDigit=s,this.secondDigit=n}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===ys.FNC1}isSecondDigitFNC1(){return this.secondDigit===ys.FNC1}isAnyFNC1(){return this.firstDigit===ys.FNC1||this.secondDigit===ys.FNC1}}ys.FNC1=10;class xe{constructor(){}static parseFieldsInGeneralPurpose(t){if(!t)return null;if(t.length<2)throw new H;let s=t.substring(0,2);for(let o of xe.TWO_DIGIT_DATA_LENGTH)if(o[0]===s)return o[1]===xe.VARIABLE_LENGTH?xe.processVariableAI(2,o[2],t):xe.processFixedAI(2,o[1],t);if(t.length<3)throw new H;let n=t.substring(0,3);for(let o of xe.THREE_DIGIT_DATA_LENGTH)if(o[0]===n)return o[1]===xe.VARIABLE_LENGTH?xe.processVariableAI(3,o[2],t):xe.processFixedAI(3,o[1],t);for(let o of xe.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(o[0]===n)return o[1]===xe.VARIABLE_LENGTH?xe.processVariableAI(4,o[2],t):xe.processFixedAI(4,o[1],t);if(t.length<4)throw new H;let l=t.substring(0,4);for(let o of xe.FOUR_DIGIT_DATA_LENGTH)if(o[0]===l)return o[1]===xe.VARIABLE_LENGTH?xe.processVariableAI(4,o[2],t):xe.processFixedAI(4,o[1],t);throw new H}static processFixedAI(t,s,n){if(n.length<t)throw new H;let l=n.substring(0,t);if(n.length<t+s)throw new H;let o=n.substring(t,t+s),d=n.substring(t+s),h="("+l+")"+o,p=xe.parseFieldsInGeneralPurpose(d);return p==null?h:h+p}static processVariableAI(t,s,n){let l=n.substring(0,t),o;n.length<t+s?o=n.length:o=t+s;let d=n.substring(t,o),h=n.substring(o),p="("+l+")"+d,w=xe.parseFieldsInGeneralPurpose(h);return w==null?p:p+w}}xe.VARIABLE_LENGTH=[],xe.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",xe.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",xe.VARIABLE_LENGTH,20],["22",xe.VARIABLE_LENGTH,29],["30",xe.VARIABLE_LENGTH,8],["37",xe.VARIABLE_LENGTH,8],["90",xe.VARIABLE_LENGTH,30],["91",xe.VARIABLE_LENGTH,30],["92",xe.VARIABLE_LENGTH,30],["93",xe.VARIABLE_LENGTH,30],["94",xe.VARIABLE_LENGTH,30],["95",xe.VARIABLE_LENGTH,30],["96",xe.VARIABLE_LENGTH,30],["97",xe.VARIABLE_LENGTH,3],["98",xe.VARIABLE_LENGTH,30],["99",xe.VARIABLE_LENGTH,30]],xe.THREE_DIGIT_DATA_LENGTH=[["240",xe.VARIABLE_LENGTH,30],["241",xe.VARIABLE_LENGTH,30],["242",xe.VARIABLE_LENGTH,6],["250",xe.VARIABLE_LENGTH,30],["251",xe.VARIABLE_LENGTH,30],["253",xe.VARIABLE_LENGTH,17],["254",xe.VARIABLE_LENGTH,20],["400",xe.VARIABLE_LENGTH,30],["401",xe.VARIABLE_LENGTH,30],["402",17],["403",xe.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",xe.VARIABLE_LENGTH,20],["421",xe.VARIABLE_LENGTH,15],["422",3],["423",xe.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],xe.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",xe.VARIABLE_LENGTH,15],["391",xe.VARIABLE_LENGTH,18],["392",xe.VARIABLE_LENGTH,15],["393",xe.VARIABLE_LENGTH,18],["703",xe.VARIABLE_LENGTH,30]],xe.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",xe.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",xe.VARIABLE_LENGTH,20],["8003",xe.VARIABLE_LENGTH,30],["8004",xe.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",xe.VARIABLE_LENGTH,30],["8008",xe.VARIABLE_LENGTH,12],["8018",18],["8020",xe.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",xe.VARIABLE_LENGTH,70],["8200",xe.VARIABLE_LENGTH,70]];class pt{constructor(t){this.buffer=new se,this.information=t}decodeAllCodes(t,s){let n=s,l=null;do{let o=this.decodeGeneralPurposeField(n,l),d=xe.parseFieldsInGeneralPurpose(o.getNewString());if(d!=null&&t.append(d),o.isRemaining()?l=""+o.getRemainingValue():l=null,n===o.getNewPosition())break;n=o.getNewPosition()}while(!0);return t.toString()}isStillNumeric(t){if(t+7>this.information.getSize())return t+4<=this.information.getSize();for(let s=t;s<t+3;++s)if(this.information.get(s))return!0;return this.information.get(t+3)}decodeNumeric(t){if(t+7>this.information.getSize()){let o=this.extractNumericValueFromBitArray(t,4);return o===0?new ys(this.information.getSize(),ys.FNC1,ys.FNC1):new ys(this.information.getSize(),o-1,ys.FNC1)}let s=this.extractNumericValueFromBitArray(t,7),n=(s-8)/11,l=(s-8)%11;return new ys(t+7,n,l)}extractNumericValueFromBitArray(t,s){return pt.extractNumericValueFromBitArray(this.information,t,s)}static extractNumericValueFromBitArray(t,s,n){let l=0;for(let o=0;o<n;++o)t.get(s+o)&&(l|=1<<n-o-1);return l}decodeGeneralPurposeField(t,s){this.buffer.setLengthToZero(),s!=null&&this.buffer.append(s),this.current.setPosition(t);let n=this.parseBlocks();return n!=null&&n.isRemaining()?new Us(this.current.getPosition(),this.buffer.toString(),n.getRemainingValue()):new Us(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let t,s;do{let n=this.current.getPosition();if(this.current.isAlpha()?(s=this.parseAlphaBlock(),t=s.isFinished()):this.current.isIsoIec646()?(s=this.parseIsoIec646Block(),t=s.isFinished()):(s=this.parseNumericBlock(),t=s.isFinished()),!(n!==this.current.getPosition())&&!t)break}while(!t);return s.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let t=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(t.getNewPosition()),t.isFirstDigitFNC1()){let s;return t.isSecondDigitFNC1()?s=new Us(this.current.getPosition(),this.buffer.toString()):s=new Us(this.current.getPosition(),this.buffer.toString(),t.getSecondDigit()),new Jt(!0,s)}if(this.buffer.append(t.getFirstDigit()),t.isSecondDigitFNC1()){let s=new Us(this.current.getPosition(),this.buffer.toString());return new Jt(!0,s)}this.buffer.append(t.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new Jt(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let t=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(t.getNewPosition()),t.isFNC1()){let s=new Us(this.current.getPosition(),this.buffer.toString());return new Jt(!0,s)}this.buffer.append(t.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new Jt(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let t=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(t.getNewPosition()),t.isFNC1()){let s=new Us(this.current.getPosition(),this.buffer.toString());return new Jt(!0,s)}this.buffer.append(t.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new Jt(!1)}isStillIsoIec646(t){if(t+5>this.information.getSize())return!1;let s=this.extractNumericValueFromBitArray(t,5);if(s>=5&&s<16)return!0;if(t+7>this.information.getSize())return!1;let n=this.extractNumericValueFromBitArray(t,7);if(n>=64&&n<116)return!0;if(t+8>this.information.getSize())return!1;let l=this.extractNumericValueFromBitArray(t,8);return l>=232&&l<253}decodeIsoIec646(t){let s=this.extractNumericValueFromBitArray(t,5);if(s===15)return new as(t+5,as.FNC1);if(s>=5&&s<15)return new as(t+5,"0"+(s-5));let n=this.extractNumericValueFromBitArray(t,7);if(n>=64&&n<90)return new as(t+7,""+(n+1));if(n>=90&&n<116)return new as(t+7,""+(n+7));let l=this.extractNumericValueFromBitArray(t,8),o;switch(l){case 232:o="!";break;case 233:o='"';break;case 234:o="%";break;case 235:o="&";break;case 236:o="'";break;case 237:o="(";break;case 238:o=")";break;case 239:o="*";break;case 240:o="+";break;case 241:o=",";break;case 242:o="-";break;case 243:o=".";break;case 244:o="/";break;case 245:o=":";break;case 246:o=";";break;case 247:o="<";break;case 248:o="=";break;case 249:o=">";break;case 250:o="?";break;case 251:o="_";break;case 252:o=" ";break;default:throw new A}return new as(t+8,o)}isStillAlpha(t){if(t+5>this.information.getSize())return!1;let s=this.extractNumericValueFromBitArray(t,5);if(s>=5&&s<16)return!0;if(t+6>this.information.getSize())return!1;let n=this.extractNumericValueFromBitArray(t,6);return n>=16&&n<63}decodeAlphanumeric(t){let s=this.extractNumericValueFromBitArray(t,5);if(s===15)return new as(t+5,as.FNC1);if(s>=5&&s<15)return new as(t+5,"0"+(s-5));let n=this.extractNumericValueFromBitArray(t,6);if(n>=32&&n<58)return new as(t+6,""+(n+33));let l;switch(n){case 58:l="*";break;case 59:l=",";break;case 60:l="-";break;case 61:l=".";break;case 62:l="/";break;default:throw new Ze("Decoding invalid alphanumeric value: "+n)}return new as(t+6,l)}isAlphaTo646ToAlphaLatch(t){if(t+1>this.information.getSize())return!1;for(let s=0;s<5&&s+t<this.information.getSize();++s)if(s===2){if(!this.information.get(t+2))return!1}else if(this.information.get(t+s))return!1;return!0}isAlphaOr646ToNumericLatch(t){if(t+3>this.information.getSize())return!1;for(let s=t;s<t+3;++s)if(this.information.get(s))return!1;return!0}isNumericToAlphaNumericLatch(t){if(t+1>this.information.getSize())return!1;for(let s=0;s<4&&s+t<this.information.getSize();++s)if(this.information.get(t+s))return!1;return!0}}class lt{constructor(t){this.information=t,this.generalDecoder=new pt(t)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class rt extends lt{constructor(t){super(t)}encodeCompressedGtin(t,s){t.append("(01)");let n=t.length();t.append("9"),this.encodeCompressedGtinWithoutAI(t,s,n)}encodeCompressedGtinWithoutAI(t,s,n){for(let l=0;l<4;++l){let o=this.getGeneralDecoder().extractNumericValueFromBitArray(s+10*l,10);o/100===0&&t.append("0"),o/10===0&&t.append("0"),t.append(o)}rt.appendCheckDigit(t,n)}static appendCheckDigit(t,s){let n=0;for(let l=0;l<13;l++){let o=t.charAt(l+s).charCodeAt(0)-48;n+=l&1?o:3*o}n=10-n%10,n===10&&(n=0),t.append(n)}}rt.GTIN_SIZE=40;class wt extends rt{constructor(t){super(t)}parseInformation(){let t=new se;t.append("(01)");let s=t.length(),n=this.getGeneralDecoder().extractNumericValueFromBitArray(wt.HEADER_SIZE,4);return t.append(n),this.encodeCompressedGtinWithoutAI(t,wt.HEADER_SIZE+4,s),this.getGeneralDecoder().decodeAllCodes(t,wt.HEADER_SIZE+44)}}wt.HEADER_SIZE=4;class Ot extends lt{constructor(t){super(t)}parseInformation(){let t=new se;return this.getGeneralDecoder().decodeAllCodes(t,Ot.HEADER_SIZE)}}Ot.HEADER_SIZE=5;class Gt extends rt{constructor(t){super(t)}encodeCompressedWeight(t,s,n){let l=this.getGeneralDecoder().extractNumericValueFromBitArray(s,n);this.addWeightCode(t,l);let o=this.checkWeight(l),d=1e5;for(let h=0;h<5;++h)o/d===0&&t.append("0"),d/=10;t.append(o)}}class we extends Gt{constructor(t){super(t)}parseInformation(){if(this.getInformation().getSize()!=we.HEADER_SIZE+Gt.GTIN_SIZE+we.WEIGHT_SIZE)throw new H;let t=new se;return this.encodeCompressedGtin(t,we.HEADER_SIZE),this.encodeCompressedWeight(t,we.HEADER_SIZE+Gt.GTIN_SIZE,we.WEIGHT_SIZE),t.toString()}}we.HEADER_SIZE=5,we.WEIGHT_SIZE=15;class Ge extends we{constructor(t){super(t)}addWeightCode(t,s){t.append("(3103)")}checkWeight(t){return t}}class tt extends we{constructor(t){super(t)}addWeightCode(t,s){s<1e4?t.append("(3202)"):t.append("(3203)")}checkWeight(t){return t<1e4?t:t-1e4}}class dt extends rt{constructor(t){super(t)}parseInformation(){if(this.getInformation().getSize()<dt.HEADER_SIZE+rt.GTIN_SIZE)throw new H;let t=new se;this.encodeCompressedGtin(t,dt.HEADER_SIZE);let s=this.getGeneralDecoder().extractNumericValueFromBitArray(dt.HEADER_SIZE+rt.GTIN_SIZE,dt.LAST_DIGIT_SIZE);t.append("(392"),t.append(s),t.append(")");let n=this.getGeneralDecoder().decodeGeneralPurposeField(dt.HEADER_SIZE+rt.GTIN_SIZE+dt.LAST_DIGIT_SIZE,null);return t.append(n.getNewString()),t.toString()}}dt.HEADER_SIZE=8,dt.LAST_DIGIT_SIZE=2;class jt extends rt{constructor(t){super(t)}parseInformation(){if(this.getInformation().getSize()<jt.HEADER_SIZE+rt.GTIN_SIZE)throw new H;let t=new se;this.encodeCompressedGtin(t,jt.HEADER_SIZE);let s=this.getGeneralDecoder().extractNumericValueFromBitArray(jt.HEADER_SIZE+rt.GTIN_SIZE,jt.LAST_DIGIT_SIZE);t.append("(393"),t.append(s),t.append(")");let n=this.getGeneralDecoder().extractNumericValueFromBitArray(jt.HEADER_SIZE+rt.GTIN_SIZE+jt.LAST_DIGIT_SIZE,jt.FIRST_THREE_DIGITS_SIZE);n/100==0&&t.append("0"),n/10==0&&t.append("0"),t.append(n);let l=this.getGeneralDecoder().decodeGeneralPurposeField(jt.HEADER_SIZE+rt.GTIN_SIZE+jt.LAST_DIGIT_SIZE+jt.FIRST_THREE_DIGITS_SIZE,null);return t.append(l.getNewString()),t.toString()}}jt.HEADER_SIZE=8,jt.LAST_DIGIT_SIZE=2,jt.FIRST_THREE_DIGITS_SIZE=10;class bt extends Gt{constructor(t,s,n){super(t),this.dateCode=n,this.firstAIdigits=s}parseInformation(){if(this.getInformation().getSize()!=bt.HEADER_SIZE+bt.GTIN_SIZE+bt.WEIGHT_SIZE+bt.DATE_SIZE)throw new H;let t=new se;return this.encodeCompressedGtin(t,bt.HEADER_SIZE),this.encodeCompressedWeight(t,bt.HEADER_SIZE+bt.GTIN_SIZE,bt.WEIGHT_SIZE),this.encodeCompressedDate(t,bt.HEADER_SIZE+bt.GTIN_SIZE+bt.WEIGHT_SIZE),t.toString()}encodeCompressedDate(t,s){let n=this.getGeneralDecoder().extractNumericValueFromBitArray(s,bt.DATE_SIZE);if(n==38400)return;t.append("("),t.append(this.dateCode),t.append(")");let l=n%32;n/=32;let o=n%12+1;n/=12;let d=n;d/10==0&&t.append("0"),t.append(d),o/10==0&&t.append("0"),t.append(o),l/10==0&&t.append("0"),t.append(l)}addWeightCode(t,s){t.append("("),t.append(this.firstAIdigits),t.append(s/1e5),t.append(")")}checkWeight(t){return t%1e5}}bt.HEADER_SIZE=8,bt.WEIGHT_SIZE=20,bt.DATE_SIZE=16;function Xt(O){try{if(O.get(1))return new wt(O);if(!O.get(2))return new Ot(O);switch(pt.extractNumericValueFromBitArray(O,1,4)){case 4:return new Ge(O);case 5:return new tt(O)}switch(pt.extractNumericValueFromBitArray(O,1,5)){case 12:return new dt(O);case 13:return new jt(O)}switch(pt.extractNumericValueFromBitArray(O,1,7)){case 56:return new bt(O,"310","11");case 57:return new bt(O,"320","11");case 58:return new bt(O,"310","13");case 59:return new bt(O,"320","13");case 60:return new bt(O,"310","15");case 61:return new bt(O,"320","15");case 62:return new bt(O,"310","17");case 63:return new bt(O,"320","17")}}catch(t){throw console.log(t),new Ze("unknown decoder: "+O)}}class ds{constructor(t,s,n,l){this.leftchar=t,this.rightchar=s,this.finderpattern=n,this.maybeLast=l}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(t,s){return t instanceof ds?ds.equalsOrNull(t.leftchar,s.leftchar)&&ds.equalsOrNull(t.rightchar,s.rightchar)&&ds.equalsOrNull(t.finderpattern,s.finderpattern):!1}static equalsOrNull(t,s){return t===null?s===null:ds.equals(t,s)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class fs{constructor(t,s,n){this.pairs=t,this.rowNumber=s,this.wasReversed=n}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(t){return this.checkEqualitity(this,t)}toString(){return"{ "+this.pairs+" }"}equals(t,s){return t instanceof fs?this.checkEqualitity(t,s)&&t.wasReversed===s.wasReversed:!1}checkEqualitity(t,s){if(!t||!s)return;let n;return t.forEach((l,o)=>{s.forEach(d=>{l.getLeftChar().getValue()===d.getLeftChar().getValue()&&l.getRightChar().getValue()===d.getRightChar().getValue()&&l.getFinderPatter().getValue()===d.getFinderPatter().getValue()&&(n=!0)})}),n}}class We extends Qt{constructor(t){super(...arguments),this.pairs=new Array(We.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=t===!0}decodeRow(t,s,n){this.pairs.length=0,this.startFromEven=!1;try{return We.constructResult(this.decodeRow2pairs(t,s))}catch(l){this.verbose&&console.log(l)}return this.pairs.length=0,this.startFromEven=!0,We.constructResult(this.decodeRow2pairs(t,s))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(t,s){let n=!1;for(;!n;)try{this.pairs.push(this.retrieveNextPair(s,this.pairs,t))}catch(o){if(o instanceof H){if(!this.pairs.length)throw new H;n=!0}}if(this.checkChecksum())return this.pairs;let l;if(this.rows.length?l=!0:l=!1,this.storeRow(t,!1),l){let o=this.checkRowsBoolean(!1);if(o!=null||(o=this.checkRowsBoolean(!0),o!=null))return o}throw new H}checkRowsBoolean(t){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,t&&(this.rows=this.rows.reverse());let s=null;try{s=this.checkRows(new Array,0)}catch(n){this.verbose&&console.log(n)}return t&&(this.rows=this.rows.reverse()),s}checkRows(t,s){for(let n=s;n<this.rows.length;n++){let l=this.rows[n];this.pairs.length=0;for(let d of t)this.pairs.push(d.getPairs());if(this.pairs.push(l.getPairs()),!We.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let o=new Array(t);o.push(l);try{return this.checkRows(o,n+1)}catch(d){this.verbose&&console.log(d)}}throw new H}static isValidSequence(t){for(let s of We.FINDER_PATTERN_SEQUENCES){if(t.length>s.length)continue;let n=!0;for(let l=0;l<t.length;l++)if(t[l].getFinderPattern().getValue()!=s[l]){n=!1;break}if(n)return!0}return!1}storeRow(t,s){let n=0,l=!1,o=!1;for(;n<this.rows.length;){let d=this.rows[n];if(d.getRowNumber()>t){o=d.isEquivalent(this.pairs);break}l=d.isEquivalent(this.pairs),n++}o||l||We.isPartialRow(this.pairs,this.rows)||(this.rows.push(n,new fs(this.pairs,t,s)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(t,s){for(let n of s)if(n.getPairs().length!==t.length){for(let l of n.getPairs())for(let o of t)if(ds.equals(l,o))break}}static isPartialRow(t,s){for(let n of s){let l=!0;for(let o of t){let d=!1;for(let h of n.getPairs())if(o.equals(h)){d=!0;break}if(!d){l=!1;break}}if(l)return!0}return!1}getRows(){return this.rows}static constructResult(t){let s=gs.buildBitArray(t),l=Xt(s).parseInformation(),o=t[0].getFinderPattern().getResultPoints(),d=t[t.length-1].getFinderPattern().getResultPoints(),h=[o[0],o[1],d[0],d[1]];return new Q(l,null,null,h,Ue.RSS_EXPANDED,null)}checkChecksum(){let t=this.pairs.get(0),s=t.getLeftChar(),n=t.getRightChar();if(n==null)return!1;let l=n.getChecksumPortion(),o=2;for(let h=1;h<this.pairs.size();++h){let p=this.pairs.get(h);l+=p.getLeftChar().getChecksumPortion(),o++;let w=p.getRightChar();w!=null&&(l+=w.getChecksumPortion(),o++)}return l%=211,211*(o-4)+l==s.getValue()}static getNextSecondBar(t,s){let n;return t.get(s)?(n=t.getNextUnset(s),n=t.getNextSet(n)):(n=t.getNextSet(s),n=t.getNextUnset(n)),n}retrieveNextPair(t,s,n){let l=s.length%2==0;this.startFromEven&&(l=!l);let o,d=!0,h=-1;do this.findNextPair(t,s,h),o=this.parseFoundFinderPattern(t,n,l),o==null?h=We.getNextSecondBar(t,this.startEnd[0]):d=!1;while(d);let p=this.decodeDataCharacter(t,o,l,!0);if(!this.isEmptyPair(s)&&s[s.length-1].mustBeLast())throw new H;let w;try{w=this.decodeDataCharacter(t,o,l,!1)}catch(S){w=null,this.verbose&&console.log(S)}return new ds(p,w,o,!0)}isEmptyPair(t){return t.length===0}findNextPair(t,s,n){let l=this.getDecodeFinderCounters();l[0]=0,l[1]=0,l[2]=0,l[3]=0;let o=t.getSize(),d;n>=0?d=n:this.isEmptyPair(s)?d=0:d=s[s.length-1].getFinderPattern().getStartEnd()[1];let h=s.length%2!=0;this.startFromEven&&(h=!h);let p=!1;for(;d<o&&(p=!t.get(d),!!p);)d++;let w=0,S=d;for(let P=d;P<o;P++)if(t.get(P)!=p)l[w]++;else{if(w==3){if(h&&We.reverseCounters(l),We.isFinderPattern(l)){this.startEnd[0]=S,this.startEnd[1]=P;return}h&&We.reverseCounters(l),S+=l[0]+l[1],l[0]=l[2],l[1]=l[3],l[2]=0,l[3]=0,w--}else w++;l[w]=1,p=!p}throw new H}static reverseCounters(t){let s=t.length;for(let n=0;n<s/2;++n){let l=t[n];t[n]=t[s-n-1],t[s-n-1]=l}}parseFoundFinderPattern(t,s,n){let l,o,d;if(n){let w=this.startEnd[0]-1;for(;w>=0&&!t.get(w);)w--;w++,l=this.startEnd[0]-w,o=w,d=this.startEnd[1]}else o=this.startEnd[0],d=t.getNextUnset(this.startEnd[1]+1),l=d-this.startEnd[1];let h=this.getDecodeFinderCounters();E.arraycopy(h,0,h,1,h.length-1),h[0]=l;let p;try{p=this.parseFinderValue(h,We.FINDER_PATTERNS)}catch{return null}return new ot(p,[o,d],o,d,s)}decodeDataCharacter(t,s,n,l){let o=this.getDataCharacterCounters();for(let Ds=0;Ds<o.length;Ds++)o[Ds]=0;if(l)We.recordPatternInReverse(t,s.getStartEnd()[0],o);else{We.recordPattern(t,s.getStartEnd()[1],o);for(let Ds=0,or=o.length-1;Ds<or;Ds++,or--){let Sr=o[Ds];o[Ds]=o[or],o[or]=Sr}}let d=17,h=ue.sum(new Int32Array(o))/d,p=(s.getStartEnd()[1]-s.getStartEnd()[0])/15;if(Math.abs(h-p)/p>.3)throw new H;let w=this.getOddCounts(),S=this.getEvenCounts(),P=this.getOddRoundingErrors(),W=this.getEvenRoundingErrors();for(let Ds=0;Ds<o.length;Ds++){let or=1*o[Ds]/h,Sr=or+.5;if(Sr<1){if(or<.3)throw new H;Sr=1}else if(Sr>8){if(or>8.7)throw new H;Sr=8}let Ma=Ds/2;Ds&1?(S[Ma]=Sr,W[Ma]=or-Sr):(w[Ma]=Sr,P[Ma]=or-Sr)}this.adjustOddEvenCounts(d);let ne=4*s.getValue()+(n?0:2)+(l?0:1)-1,pe=0,je=0;for(let Ds=w.length-1;Ds>=0;Ds--){if(We.isNotA1left(s,n,l)){let or=We.WEIGHTS[ne][2*Ds];je+=w[Ds]*or}pe+=w[Ds]}let Me=0;for(let Ds=S.length-1;Ds>=0;Ds--)if(We.isNotA1left(s,n,l)){let or=We.WEIGHTS[ne][2*Ds+1];Me+=S[Ds]*or}let Ve=je+Me;if(pe&1||pe>13||pe<4)throw new H;let mt=(13-pe)/2,xt=We.SYMBOL_WIDEST[mt],ct=9-xt,ls=$t.getRSSvalue(w,xt,!0),Zt=$t.getRSSvalue(S,ct,!1),wr=We.EVEN_TOTAL_SUBSET[mt],Or=We.GSUM[mt],jr=ls*wr+Zt+Or;return new Pe(jr,Ve)}static isNotA1left(t,s,n){return!(t.getValue()==0&&s&&n)}adjustOddEvenCounts(t){let s=ue.sum(new Int32Array(this.getOddCounts())),n=ue.sum(new Int32Array(this.getEvenCounts())),l=!1,o=!1;s>13?o=!0:s<4&&(l=!0);let d=!1,h=!1;n>13?h=!0:n<4&&(d=!0);let p=s+n-t,w=(s&1)==1,S=(n&1)==0;if(p==1)if(w){if(S)throw new H;o=!0}else{if(!S)throw new H;h=!0}else if(p==-1)if(w){if(S)throw new H;l=!0}else{if(!S)throw new H;d=!0}else if(p==0){if(w){if(!S)throw new H;s<n?(l=!0,h=!0):(o=!0,d=!0)}else if(S)throw new H}else throw new H;if(l){if(o)throw new H;We.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(o&&We.decrement(this.getOddCounts(),this.getOddRoundingErrors()),d){if(h)throw new H;We.increment(this.getEvenCounts(),this.getOddRoundingErrors())}h&&We.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}We.SYMBOL_WIDEST=[7,5,4,3,1],We.EVEN_TOTAL_SUBSET=[4,20,52,104,204],We.GSUM=[0,348,1388,2948,3988],We.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],We.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],We.FINDER_PAT_A=0,We.FINDER_PAT_B=1,We.FINDER_PAT_C=2,We.FINDER_PAT_D=3,We.FINDER_PAT_E=4,We.FINDER_PAT_F=5,We.FINDER_PATTERN_SEQUENCES=[[We.FINDER_PAT_A,We.FINDER_PAT_A],[We.FINDER_PAT_A,We.FINDER_PAT_B,We.FINDER_PAT_B],[We.FINDER_PAT_A,We.FINDER_PAT_C,We.FINDER_PAT_B,We.FINDER_PAT_D],[We.FINDER_PAT_A,We.FINDER_PAT_E,We.FINDER_PAT_B,We.FINDER_PAT_D,We.FINDER_PAT_C],[We.FINDER_PAT_A,We.FINDER_PAT_E,We.FINDER_PAT_B,We.FINDER_PAT_D,We.FINDER_PAT_D,We.FINDER_PAT_F],[We.FINDER_PAT_A,We.FINDER_PAT_E,We.FINDER_PAT_B,We.FINDER_PAT_D,We.FINDER_PAT_E,We.FINDER_PAT_F,We.FINDER_PAT_F],[We.FINDER_PAT_A,We.FINDER_PAT_A,We.FINDER_PAT_B,We.FINDER_PAT_B,We.FINDER_PAT_C,We.FINDER_PAT_C,We.FINDER_PAT_D,We.FINDER_PAT_D],[We.FINDER_PAT_A,We.FINDER_PAT_A,We.FINDER_PAT_B,We.FINDER_PAT_B,We.FINDER_PAT_C,We.FINDER_PAT_C,We.FINDER_PAT_D,We.FINDER_PAT_E,We.FINDER_PAT_E],[We.FINDER_PAT_A,We.FINDER_PAT_A,We.FINDER_PAT_B,We.FINDER_PAT_B,We.FINDER_PAT_C,We.FINDER_PAT_C,We.FINDER_PAT_D,We.FINDER_PAT_E,We.FINDER_PAT_F,We.FINDER_PAT_F],[We.FINDER_PAT_A,We.FINDER_PAT_A,We.FINDER_PAT_B,We.FINDER_PAT_B,We.FINDER_PAT_C,We.FINDER_PAT_D,We.FINDER_PAT_D,We.FINDER_PAT_E,We.FINDER_PAT_E,We.FINDER_PAT_F,We.FINDER_PAT_F]],We.MAX_PAIRS=11;class M extends Pe{constructor(t,s,n){super(t,s),this.count=0,this.finderPattern=n}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class ce extends Qt{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(t,s,n){const l=this.decodePair(s,!1,t,n);ce.addOrTally(this.possibleLeftPairs,l),s.reverse();let o=this.decodePair(s,!0,t,n);ce.addOrTally(this.possibleRightPairs,o),s.reverse();for(let d of this.possibleLeftPairs)if(d.getCount()>1){for(let h of this.possibleRightPairs)if(h.getCount()>1&&ce.checkChecksum(d,h))return ce.constructResult(d,h)}throw new H}static addOrTally(t,s){if(s==null)return;let n=!1;for(let l of t)if(l.getValue()===s.getValue()){l.incrementCount(),n=!0;break}n||t.push(s)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(t,s){let n=4537077*t.getValue()+s.getValue(),l=new String(n).toString(),o=new se;for(let w=13-l.length;w>0;w--)o.append("0");o.append(l);let d=0;for(let w=0;w<13;w++){let S=o.charAt(w).charCodeAt(0)-48;d+=w&1?S:3*S}d=10-d%10,d===10&&(d=0),o.append(d.toString());let h=t.getFinderPattern().getResultPoints(),p=s.getFinderPattern().getResultPoints();return new Q(o.toString(),null,0,[h[0],h[1],p[0],p[1]],Ue.RSS_14,new Date().getTime())}static checkChecksum(t,s){let n=(t.getChecksumPortion()+16*s.getChecksumPortion())%79,l=9*t.getFinderPattern().getValue()+s.getFinderPattern().getValue();return l>72&&l--,l>8&&l--,n===l}decodePair(t,s,n,l){try{let o=this.findFinderPattern(t,s),d=this.parseFoundFinderPattern(t,n,s,o),h=l==null?null:l.get(Y.NEED_RESULT_POINT_CALLBACK);if(h!=null){let S=(o[0]+o[1])/2;s&&(S=t.getSize()-1-S),h.foundPossibleResultPoint(new ae(S,n))}let p=this.decodeDataCharacter(t,d,!0),w=this.decodeDataCharacter(t,d,!1);return new M(1597*p.getValue()+w.getValue(),p.getChecksumPortion()+4*w.getChecksumPortion(),d)}catch{return null}}decodeDataCharacter(t,s,n){let l=this.getDataCharacterCounters();for(let Me=0;Me<l.length;Me++)l[Me]=0;if(n)de.recordPatternInReverse(t,s.getStartEnd()[0],l);else{de.recordPattern(t,s.getStartEnd()[1]+1,l);for(let Me=0,Ve=l.length-1;Me<Ve;Me++,Ve--){let mt=l[Me];l[Me]=l[Ve],l[Ve]=mt}}let o=n?16:15,d=ue.sum(new Int32Array(l))/o,h=this.getOddCounts(),p=this.getEvenCounts(),w=this.getOddRoundingErrors(),S=this.getEvenRoundingErrors();for(let Me=0;Me<l.length;Me++){let Ve=l[Me]/d,mt=Math.floor(Ve+.5);mt<1?mt=1:mt>8&&(mt=8);let xt=Math.floor(Me/2);Me&1?(p[xt]=mt,S[xt]=Ve-mt):(h[xt]=mt,w[xt]=Ve-mt)}this.adjustOddEvenCounts(n,o);let P=0,W=0;for(let Me=h.length-1;Me>=0;Me--)W*=9,W+=h[Me],P+=h[Me];let ne=0,pe=0;for(let Me=p.length-1;Me>=0;Me--)ne*=9,ne+=p[Me],pe+=p[Me];let je=W+3*ne;if(n){if(P&1||P>12||P<4)throw new H;let Me=(12-P)/2,Ve=ce.OUTSIDE_ODD_WIDEST[Me],mt=9-Ve,xt=$t.getRSSvalue(h,Ve,!1),ct=$t.getRSSvalue(p,mt,!0),ls=ce.OUTSIDE_EVEN_TOTAL_SUBSET[Me],Zt=ce.OUTSIDE_GSUM[Me];return new Pe(xt*ls+ct+Zt,je)}else{if(pe&1||pe>10||pe<4)throw new H;let Me=(10-pe)/2,Ve=ce.INSIDE_ODD_WIDEST[Me],mt=9-Ve,xt=$t.getRSSvalue(h,Ve,!0),ct=$t.getRSSvalue(p,mt,!1),ls=ce.INSIDE_ODD_TOTAL_SUBSET[Me],Zt=ce.INSIDE_GSUM[Me];return new Pe(ct*ls+xt+Zt,je)}}findFinderPattern(t,s){let n=this.getDecodeFinderCounters();n[0]=0,n[1]=0,n[2]=0,n[3]=0;let l=t.getSize(),o=!1,d=0;for(;d<l&&(o=!t.get(d),s!==o);)d++;let h=0,p=d;for(let w=d;w<l;w++)if(t.get(w)!==o)n[h]++;else{if(h===3){if(Qt.isFinderPattern(n))return[p,w];p+=n[0]+n[1],n[0]=n[2],n[1]=n[3],n[2]=0,n[3]=0,h--}else h++;n[h]=1,o=!o}throw new H}parseFoundFinderPattern(t,s,n,l){let o=t.get(l[0]),d=l[0]-1;for(;d>=0&&o!==t.get(d);)d--;d++;const h=l[0]-d,p=this.getDecodeFinderCounters(),w=new Int32Array(p.length);E.arraycopy(p,0,w,1,p.length-1),w[0]=h;const S=this.parseFinderValue(w,ce.FINDER_PATTERNS);let P=d,W=l[1];return n&&(P=t.getSize()-1-P,W=t.getSize()-1-W),new ot(S,[d,l[1]],P,W,s)}adjustOddEvenCounts(t,s){let n=ue.sum(new Int32Array(this.getOddCounts())),l=ue.sum(new Int32Array(this.getEvenCounts())),o=!1,d=!1,h=!1,p=!1;t?(n>12?d=!0:n<4&&(o=!0),l>12?p=!0:l<4&&(h=!0)):(n>11?d=!0:n<5&&(o=!0),l>10?p=!0:l<4&&(h=!0));let w=n+l-s,S=(n&1)===(t?1:0),P=(l&1)===1;if(w===1)if(S){if(P)throw new H;d=!0}else{if(!P)throw new H;p=!0}else if(w===-1)if(S){if(P)throw new H;o=!0}else{if(!P)throw new H;h=!0}else if(w===0){if(S){if(!P)throw new H;n<l?(o=!0,p=!0):(d=!0,h=!0)}else if(P)throw new H}else throw new H;if(o){if(d)throw new H;Qt.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(d&&Qt.decrement(this.getOddCounts(),this.getOddRoundingErrors()),h){if(p)throw new H;Qt.increment(this.getEvenCounts(),this.getOddRoundingErrors())}p&&Qt.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}ce.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],ce.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],ce.OUTSIDE_GSUM=[0,161,961,2015,2715],ce.INSIDE_GSUM=[0,336,1036,1516],ce.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],ce.INSIDE_ODD_WIDEST=[2,4,6,8],ce.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class Je extends de{constructor(t,s){super(),this.readers=[],this.verbose=s===!0;const n=t?t.get(Y.POSSIBLE_FORMATS):null,l=t&&t.get(Y.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;n?((n.includes(Ue.EAN_13)||n.includes(Ue.UPC_A)||n.includes(Ue.EAN_8)||n.includes(Ue.UPC_E))&&this.readers.push(new bs(t)),n.includes(Ue.CODE_39)&&this.readers.push(new Ae(l)),n.includes(Ue.CODE_128)&&this.readers.push(new me),n.includes(Ue.ITF)&&this.readers.push(new it),n.includes(Ue.RSS_14)&&this.readers.push(new ce),n.includes(Ue.RSS_EXPANDED)&&this.readers.push(new We(this.verbose))):(this.readers.push(new bs(t)),this.readers.push(new Ae),this.readers.push(new bs(t)),this.readers.push(new me),this.readers.push(new it),this.readers.push(new ce),this.readers.push(new We(this.verbose)))}decodeRow(t,s,n){for(let l=0;l<this.readers.length;l++)try{return this.readers[l].decodeRow(t,s,n)}catch{}throw new H}reset(){this.readers.forEach(t=>t.reset())}}class _t extends ye{constructor(t=500,s){super(new Je(s),t,s)}}class Dt{constructor(t,s,n){this.ecCodewords=t,this.ecBlocks=[s],n&&this.ecBlocks.push(n)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class at{constructor(t,s){this.count=t,this.dataCodewords=s}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Et{constructor(t,s,n,l,o,d){this.versionNumber=t,this.symbolSizeRows=s,this.symbolSizeColumns=n,this.dataRegionSizeRows=l,this.dataRegionSizeColumns=o,this.ecBlocks=d;let h=0;const p=d.getECCodewords(),w=d.getECBlocks();for(let S of w)h+=S.getCount()*(S.getDataCodewords()+p);this.totalCodewords=h}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(t,s){if(t&1||s&1)throw new A;for(let n of Et.VERSIONS)if(n.symbolSizeRows===t&&n.symbolSizeColumns===s)return n;throw new A}toString(){return""+this.versionNumber}static buildVersions(){return[new Et(1,10,10,8,8,new Dt(5,new at(1,3))),new Et(2,12,12,10,10,new Dt(7,new at(1,5))),new Et(3,14,14,12,12,new Dt(10,new at(1,8))),new Et(4,16,16,14,14,new Dt(12,new at(1,12))),new Et(5,18,18,16,16,new Dt(14,new at(1,18))),new Et(6,20,20,18,18,new Dt(18,new at(1,22))),new Et(7,22,22,20,20,new Dt(20,new at(1,30))),new Et(8,24,24,22,22,new Dt(24,new at(1,36))),new Et(9,26,26,24,24,new Dt(28,new at(1,44))),new Et(10,32,32,14,14,new Dt(36,new at(1,62))),new Et(11,36,36,16,16,new Dt(42,new at(1,86))),new Et(12,40,40,18,18,new Dt(48,new at(1,114))),new Et(13,44,44,20,20,new Dt(56,new at(1,144))),new Et(14,48,48,22,22,new Dt(68,new at(1,174))),new Et(15,52,52,24,24,new Dt(42,new at(2,102))),new Et(16,64,64,14,14,new Dt(56,new at(2,140))),new Et(17,72,72,16,16,new Dt(36,new at(4,92))),new Et(18,80,80,18,18,new Dt(48,new at(4,114))),new Et(19,88,88,20,20,new Dt(56,new at(4,144))),new Et(20,96,96,22,22,new Dt(68,new at(4,174))),new Et(21,104,104,24,24,new Dt(56,new at(6,136))),new Et(22,120,120,18,18,new Dt(68,new at(6,175))),new Et(23,132,132,20,20,new Dt(62,new at(8,163))),new Et(24,144,144,22,22,new Dt(62,new at(8,156),new at(2,155))),new Et(25,8,18,6,16,new Dt(7,new at(1,5))),new Et(26,8,32,6,14,new Dt(11,new at(1,10))),new Et(27,12,26,10,24,new Dt(14,new at(1,16))),new Et(28,12,36,10,16,new Dt(18,new at(1,22))),new Et(29,16,36,14,16,new Dt(24,new at(1,32))),new Et(30,16,48,14,22,new Dt(28,new at(1,49)))]}}Et.VERSIONS=Et.buildVersions();class sr{constructor(t){const s=t.getHeight();if(s<8||s>144||s&1)throw new A;this.version=sr.readVersion(t),this.mappingBitMatrix=this.extractDataRegion(t),this.readMappingMatrix=new q(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(t){const s=t.getHeight(),n=t.getWidth();return Et.getVersionForDimensions(s,n)}readCodewords(){const t=new Int8Array(this.version.getTotalCodewords());let s=0,n=4,l=0;const o=this.mappingBitMatrix.getHeight(),d=this.mappingBitMatrix.getWidth();let h=!1,p=!1,w=!1,S=!1;do if(n===o&&l===0&&!h)t[s++]=this.readCorner1(o,d)&255,n-=2,l+=2,h=!0;else if(n===o-2&&l===0&&d&3&&!p)t[s++]=this.readCorner2(o,d)&255,n-=2,l+=2,p=!0;else if(n===o+4&&l===2&&!(d&7)&&!w)t[s++]=this.readCorner3(o,d)&255,n-=2,l+=2,w=!0;else if(n===o-2&&l===0&&(d&7)===4&&!S)t[s++]=this.readCorner4(o,d)&255,n-=2,l+=2,S=!0;else{do n<o&&l>=0&&!this.readMappingMatrix.get(l,n)&&(t[s++]=this.readUtah(n,l,o,d)&255),n-=2,l+=2;while(n>=0&&l<d);n+=1,l+=3;do n>=0&&l<d&&!this.readMappingMatrix.get(l,n)&&(t[s++]=this.readUtah(n,l,o,d)&255),n+=2,l-=2;while(n<o&&l>=0);n+=3,l+=1}while(n<o||l<d);if(s!==this.version.getTotalCodewords())throw new A;return t}readModule(t,s,n,l){return t<0&&(t+=n,s+=4-(n+4&7)),s<0&&(s+=l,t+=4-(l+4&7)),this.readMappingMatrix.set(s,t),this.mappingBitMatrix.get(s,t)}readUtah(t,s,n,l){let o=0;return this.readModule(t-2,s-2,n,l)&&(o|=1),o<<=1,this.readModule(t-2,s-1,n,l)&&(o|=1),o<<=1,this.readModule(t-1,s-2,n,l)&&(o|=1),o<<=1,this.readModule(t-1,s-1,n,l)&&(o|=1),o<<=1,this.readModule(t-1,s,n,l)&&(o|=1),o<<=1,this.readModule(t,s-2,n,l)&&(o|=1),o<<=1,this.readModule(t,s-1,n,l)&&(o|=1),o<<=1,this.readModule(t,s,n,l)&&(o|=1),o}readCorner1(t,s){let n=0;return this.readModule(t-1,0,t,s)&&(n|=1),n<<=1,this.readModule(t-1,1,t,s)&&(n|=1),n<<=1,this.readModule(t-1,2,t,s)&&(n|=1),n<<=1,this.readModule(0,s-2,t,s)&&(n|=1),n<<=1,this.readModule(0,s-1,t,s)&&(n|=1),n<<=1,this.readModule(1,s-1,t,s)&&(n|=1),n<<=1,this.readModule(2,s-1,t,s)&&(n|=1),n<<=1,this.readModule(3,s-1,t,s)&&(n|=1),n}readCorner2(t,s){let n=0;return this.readModule(t-3,0,t,s)&&(n|=1),n<<=1,this.readModule(t-2,0,t,s)&&(n|=1),n<<=1,this.readModule(t-1,0,t,s)&&(n|=1),n<<=1,this.readModule(0,s-4,t,s)&&(n|=1),n<<=1,this.readModule(0,s-3,t,s)&&(n|=1),n<<=1,this.readModule(0,s-2,t,s)&&(n|=1),n<<=1,this.readModule(0,s-1,t,s)&&(n|=1),n<<=1,this.readModule(1,s-1,t,s)&&(n|=1),n}readCorner3(t,s){let n=0;return this.readModule(t-1,0,t,s)&&(n|=1),n<<=1,this.readModule(t-1,s-1,t,s)&&(n|=1),n<<=1,this.readModule(0,s-3,t,s)&&(n|=1),n<<=1,this.readModule(0,s-2,t,s)&&(n|=1),n<<=1,this.readModule(0,s-1,t,s)&&(n|=1),n<<=1,this.readModule(1,s-3,t,s)&&(n|=1),n<<=1,this.readModule(1,s-2,t,s)&&(n|=1),n<<=1,this.readModule(1,s-1,t,s)&&(n|=1),n}readCorner4(t,s){let n=0;return this.readModule(t-3,0,t,s)&&(n|=1),n<<=1,this.readModule(t-2,0,t,s)&&(n|=1),n<<=1,this.readModule(t-1,0,t,s)&&(n|=1),n<<=1,this.readModule(0,s-2,t,s)&&(n|=1),n<<=1,this.readModule(0,s-1,t,s)&&(n|=1),n<<=1,this.readModule(1,s-1,t,s)&&(n|=1),n<<=1,this.readModule(2,s-1,t,s)&&(n|=1),n<<=1,this.readModule(3,s-1,t,s)&&(n|=1),n}extractDataRegion(t){const s=this.version.getSymbolSizeRows(),n=this.version.getSymbolSizeColumns();if(t.getHeight()!==s)throw new N("Dimension of bitMatrix must match the version size");const l=this.version.getDataRegionSizeRows(),o=this.version.getDataRegionSizeColumns(),d=s/l|0,h=n/o|0,p=d*l,w=h*o,S=new q(w,p);for(let P=0;P<d;++P){const W=P*l;for(let ne=0;ne<h;++ne){const pe=ne*o;for(let je=0;je<l;++je){const Me=P*(l+2)+1+je,Ve=W+je;for(let mt=0;mt<o;++mt){const xt=ne*(o+2)+1+mt;if(t.get(xt,Me)){const ct=pe+mt;S.set(ct,Ve)}}}}}return S}}class gr{constructor(t,s){this.numDataCodewords=t,this.codewords=s}static getDataBlocks(t,s){const n=s.getECBlocks();let l=0;const o=n.getECBlocks();for(let je of o)l+=je.getCount();const d=new Array(l);let h=0;for(let je of o)for(let Me=0;Me<je.getCount();Me++){const Ve=je.getDataCodewords(),mt=n.getECCodewords()+Ve;d[h++]=new gr(Ve,new Uint8Array(mt))}const w=d[0].codewords.length-n.getECCodewords(),S=w-1;let P=0;for(let je=0;je<S;je++)for(let Me=0;Me<h;Me++)d[Me].codewords[je]=t[P++];const W=s.getVersionNumber()===24,ne=W?8:h;for(let je=0;je<ne;je++)d[je].codewords[w-1]=t[P++];const pe=d[0].codewords.length;for(let je=w;je<pe;je++)for(let Me=0;Me<h;Me++){const Ve=W?(Me+8)%h:Me,mt=W&&Ve>7?je-1:je;d[Ve].codewords[mt]=t[P++]}if(P!==t.length)throw new N;return d}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class Ie{constructor(t){this.bytes=t,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(t){if(t<1||t>32||t>this.available())throw new N(""+t);let s=0,n=this.bitOffset,l=this.byteOffset;const o=this.bytes;if(n>0){const d=8-n,h=t<d?t:d,p=d-h,w=255>>8-h<<p;s=(o[l]&w)>>p,t-=h,n+=h,n===8&&(n=0,l++)}if(t>0){for(;t>=8;)s=s<<8|o[l]&255,l++,t-=8;if(t>0){const d=8-t,h=255>>d<<d;s=s<<t|(o[l]&h)>>d,n+=t}}return this.bitOffset=n,this.byteOffset=l,s}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var ze;(function(O){O[O.PAD_ENCODE=0]="PAD_ENCODE",O[O.ASCII_ENCODE=1]="ASCII_ENCODE",O[O.C40_ENCODE=2]="C40_ENCODE",O[O.TEXT_ENCODE=3]="TEXT_ENCODE",O[O.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",O[O.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",O[O.BASE256_ENCODE=6]="BASE256_ENCODE"})(ze||(ze={}));class ft{static decode(t){const s=new Ie(t),n=new se,l=new se,o=new Array;let d=ze.ASCII_ENCODE;do if(d===ze.ASCII_ENCODE)d=this.decodeAsciiSegment(s,n,l);else{switch(d){case ze.C40_ENCODE:this.decodeC40Segment(s,n);break;case ze.TEXT_ENCODE:this.decodeTextSegment(s,n);break;case ze.ANSIX12_ENCODE:this.decodeAnsiX12Segment(s,n);break;case ze.EDIFACT_ENCODE:this.decodeEdifactSegment(s,n);break;case ze.BASE256_ENCODE:this.decodeBase256Segment(s,n,o);break;default:throw new A}d=ze.ASCII_ENCODE}while(d!==ze.PAD_ENCODE&&s.available()>0);return l.length()>0&&n.append(l.toString()),new ut(t,n.toString(),o.length===0?null:o,null)}static decodeAsciiSegment(t,s,n){let l=!1;do{let o=t.readBits(8);if(o===0)throw new A;if(o<=128)return l&&(o+=128),s.append(String.fromCharCode(o-1)),ze.ASCII_ENCODE;if(o===129)return ze.PAD_ENCODE;if(o<=229){const d=o-130;d<10&&s.append("0"),s.append(""+d)}else switch(o){case 230:return ze.C40_ENCODE;case 231:return ze.BASE256_ENCODE;case 232:s.append("");break;case 233:case 234:break;case 235:l=!0;break;case 236:s.append("[)>05"),n.insert(0,"");break;case 237:s.append("[)>06"),n.insert(0,"");break;case 238:return ze.ANSIX12_ENCODE;case 239:return ze.TEXT_ENCODE;case 240:return ze.EDIFACT_ENCODE;case 241:break;default:if(o!==254||t.available()!==0)throw new A;break}}while(t.available()>0);return ze.ASCII_ENCODE}static decodeC40Segment(t,s){let n=!1;const l=[];let o=0;do{if(t.available()===8)return;const d=t.readBits(8);if(d===254)return;this.parseTwoBytes(d,t.readBits(8),l);for(let h=0;h<3;h++){const p=l[h];switch(o){case 0:if(p<3)o=p+1;else if(p<this.C40_BASIC_SET_CHARS.length){const w=this.C40_BASIC_SET_CHARS[p];n?(s.append(String.fromCharCode(w.charCodeAt(0)+128)),n=!1):s.append(w)}else throw new A;break;case 1:n?(s.append(String.fromCharCode(p+128)),n=!1):s.append(String.fromCharCode(p)),o=0;break;case 2:if(p<this.C40_SHIFT2_SET_CHARS.length){const w=this.C40_SHIFT2_SET_CHARS[p];n?(s.append(String.fromCharCode(w.charCodeAt(0)+128)),n=!1):s.append(w)}else switch(p){case 27:s.append("");break;case 30:n=!0;break;default:throw new A}o=0;break;case 3:n?(s.append(String.fromCharCode(p+224)),n=!1):s.append(String.fromCharCode(p+96)),o=0;break;default:throw new A}}}while(t.available()>0)}static decodeTextSegment(t,s){let n=!1,l=[],o=0;do{if(t.available()===8)return;const d=t.readBits(8);if(d===254)return;this.parseTwoBytes(d,t.readBits(8),l);for(let h=0;h<3;h++){const p=l[h];switch(o){case 0:if(p<3)o=p+1;else if(p<this.TEXT_BASIC_SET_CHARS.length){const w=this.TEXT_BASIC_SET_CHARS[p];n?(s.append(String.fromCharCode(w.charCodeAt(0)+128)),n=!1):s.append(w)}else throw new A;break;case 1:n?(s.append(String.fromCharCode(p+128)),n=!1):s.append(String.fromCharCode(p)),o=0;break;case 2:if(p<this.TEXT_SHIFT2_SET_CHARS.length){const w=this.TEXT_SHIFT2_SET_CHARS[p];n?(s.append(String.fromCharCode(w.charCodeAt(0)+128)),n=!1):s.append(w)}else switch(p){case 27:s.append("");break;case 30:n=!0;break;default:throw new A}o=0;break;case 3:if(p<this.TEXT_SHIFT3_SET_CHARS.length){const w=this.TEXT_SHIFT3_SET_CHARS[p];n?(s.append(String.fromCharCode(w.charCodeAt(0)+128)),n=!1):s.append(w),o=0}else throw new A;break;default:throw new A}}}while(t.available()>0)}static decodeAnsiX12Segment(t,s){const n=[];do{if(t.available()===8)return;const l=t.readBits(8);if(l===254)return;this.parseTwoBytes(l,t.readBits(8),n);for(let o=0;o<3;o++){const d=n[o];switch(d){case 0:s.append("\r");break;case 1:s.append("*");break;case 2:s.append(">");break;case 3:s.append(" ");break;default:if(d<14)s.append(String.fromCharCode(d+44));else if(d<40)s.append(String.fromCharCode(d+51));else throw new A;break}}}while(t.available()>0)}static parseTwoBytes(t,s,n){let l=(t<<8)+s-1,o=Math.floor(l/1600);n[0]=o,l-=o*1600,o=Math.floor(l/40),n[1]=o,n[2]=l-o*40}static decodeEdifactSegment(t,s){do{if(t.available()<=16)return;for(let n=0;n<4;n++){let l=t.readBits(6);if(l===31){const o=8-t.getBitOffset();o!==8&&t.readBits(o);return}l&32||(l|=64),s.append(String.fromCharCode(l))}}while(t.available()>0)}static decodeBase256Segment(t,s,n){let l=1+t.getByteOffset();const o=this.unrandomize255State(t.readBits(8),l++);let d;if(o===0?d=t.available()/8|0:o<250?d=o:d=250*(o-249)+this.unrandomize255State(t.readBits(8),l++),d<0)throw new A;const h=new Uint8Array(d);for(let p=0;p<d;p++){if(t.available()<8)throw new A;h[p]=this.unrandomize255State(t.readBits(8),l++)}n.push(h);try{s.append(T.decode(h,z.ISO88591))}catch(p){throw new Ze("Platform does not support required encoding: "+p.message)}}static unrandomize255State(t,s){const n=149*s%255+1,l=t-n;return l>=0?l:l+256}}ft.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],ft.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],ft.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],ft.TEXT_SHIFT2_SET_CHARS=ft.C40_SHIFT2_SET_CHARS,ft.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",""];class oe{constructor(){this.rsDecoder=new $e(Be.DATA_MATRIX_FIELD_256)}decode(t){const s=new sr(t),n=s.getVersion(),l=s.readCodewords(),o=gr.getDataBlocks(l,n);let d=0;for(let w of o)d+=w.getNumDataCodewords();const h=new Uint8Array(d),p=o.length;for(let w=0;w<p;w++){const S=o[w],P=S.getCodewords(),W=S.getNumDataCodewords();this.correctErrors(P,W);for(let ne=0;ne<W;ne++)h[ne*p+w]=P[ne]}return ft.decode(h)}correctErrors(t,s){const n=new Int32Array(t);try{this.rsDecoder.decode(n,t.length-s)}catch{throw new R}for(let l=0;l<s;l++)t[l]=n[l]}}class De{constructor(t){this.image=t,this.rectangleDetector=new le(this.image)}detect(){const t=this.rectangleDetector.detect();let s=this.detectSolid1(t);if(s=this.detectSolid2(s),s[3]=this.correctTopRight(s),!s[3])throw new H;s=this.shiftToModuleCenter(s);const n=s[0],l=s[1],o=s[2],d=s[3];let h=this.transitionsBetween(n,d)+1,p=this.transitionsBetween(o,d)+1;(h&1)===1&&(h+=1),(p&1)===1&&(p+=1),4*h<7*p&&4*p<7*h&&(h=p=Math.max(h,p));let w=De.sampleGrid(this.image,n,l,o,d,h,p);return new ke(w,[n,l,o,d])}static shiftPoint(t,s,n){let l=(s.getX()-t.getX())/(n+1),o=(s.getY()-t.getY())/(n+1);return new ae(t.getX()+l,t.getY()+o)}static moveAway(t,s,n){let l=t.getX(),o=t.getY();return l<s?l-=1:l+=1,o<n?o-=1:o+=1,new ae(l,o)}detectSolid1(t){let s=t[0],n=t[1],l=t[3],o=t[2],d=this.transitionsBetween(s,n),h=this.transitionsBetween(n,l),p=this.transitionsBetween(l,o),w=this.transitionsBetween(o,s),S=d,P=[o,s,n,l];return S>h&&(S=h,P[0]=s,P[1]=n,P[2]=l,P[3]=o),S>p&&(S=p,P[0]=n,P[1]=l,P[2]=o,P[3]=s),S>w&&(P[0]=l,P[1]=o,P[2]=s,P[3]=n),P}detectSolid2(t){let s=t[0],n=t[1],l=t[2],o=t[3],d=this.transitionsBetween(s,o),h=De.shiftPoint(n,l,(d+1)*4),p=De.shiftPoint(l,n,(d+1)*4),w=this.transitionsBetween(h,s),S=this.transitionsBetween(p,o);return w<S?(t[0]=s,t[1]=n,t[2]=l,t[3]=o):(t[0]=n,t[1]=l,t[2]=o,t[3]=s),t}correctTopRight(t){let s=t[0],n=t[1],l=t[2],o=t[3],d=this.transitionsBetween(s,o),h=this.transitionsBetween(n,o),p=De.shiftPoint(s,n,(h+1)*4),w=De.shiftPoint(l,n,(d+1)*4);d=this.transitionsBetween(p,o),h=this.transitionsBetween(w,o);let S=new ae(o.getX()+(l.getX()-n.getX())/(d+1),o.getY()+(l.getY()-n.getY())/(d+1)),P=new ae(o.getX()+(s.getX()-n.getX())/(h+1),o.getY()+(s.getY()-n.getY())/(h+1));if(!this.isValid(S))return this.isValid(P)?P:null;if(!this.isValid(P))return S;let W=this.transitionsBetween(p,S)+this.transitionsBetween(w,S),ne=this.transitionsBetween(p,P)+this.transitionsBetween(w,P);return W>ne?S:P}shiftToModuleCenter(t){let s=t[0],n=t[1],l=t[2],o=t[3],d=this.transitionsBetween(s,o)+1,h=this.transitionsBetween(l,o)+1,p=De.shiftPoint(s,n,h*4),w=De.shiftPoint(l,n,d*4);d=this.transitionsBetween(p,o)+1,h=this.transitionsBetween(w,o)+1,(d&1)===1&&(d+=1),(h&1)===1&&(h+=1);let S=(s.getX()+n.getX()+l.getX()+o.getX())/4,P=(s.getY()+n.getY()+l.getY()+o.getY())/4;s=De.moveAway(s,S,P),n=De.moveAway(n,S,P),l=De.moveAway(l,S,P),o=De.moveAway(o,S,P);let W,ne;return p=De.shiftPoint(s,n,h*4),p=De.shiftPoint(p,o,d*4),W=De.shiftPoint(n,s,h*4),W=De.shiftPoint(W,l,d*4),w=De.shiftPoint(l,o,h*4),w=De.shiftPoint(w,n,d*4),ne=De.shiftPoint(o,l,h*4),ne=De.shiftPoint(ne,s,d*4),[p,W,w,ne]}isValid(t){return t.getX()>=0&&t.getX()<this.image.getWidth()&&t.getY()>0&&t.getY()<this.image.getHeight()}static sampleGrid(t,s,n,l,o,d,h){return vt.getInstance().sampleGrid(t,d,h,.5,.5,d-.5,.5,d-.5,h-.5,.5,h-.5,s.getX(),s.getY(),o.getX(),o.getY(),l.getX(),l.getY(),n.getX(),n.getY())}transitionsBetween(t,s){let n=Math.trunc(t.getX()),l=Math.trunc(t.getY()),o=Math.trunc(s.getX()),d=Math.trunc(s.getY()),h=Math.abs(d-l)>Math.abs(o-n);if(h){let je=n;n=l,l=je,je=o,o=d,d=je}let p=Math.abs(o-n),w=Math.abs(d-l),S=-p/2,P=l<d?1:-1,W=n<o?1:-1,ne=0,pe=this.image.get(h?l:n,h?n:l);for(let je=n,Me=l;je!==o;je+=W){let Ve=this.image.get(h?Me:je,h?je:Me);if(Ve!==pe&&(ne++,pe=Ve),S+=w,S>0){if(Me===d)break;Me+=P,S-=p}}return ne}}class Fe{constructor(){this.decoder=new oe}decode(t,s=null){let n,l;if(s!=null&&s.has(Y.PURE_BARCODE)){const w=Fe.extractPureBits(t.getBlackMatrix());n=this.decoder.decode(w),l=Fe.NO_POINTS}else{const w=new De(t.getBlackMatrix()).detect();n=this.decoder.decode(w.getBits()),l=w.getPoints()}const o=n.getRawBytes(),d=new Q(n.getText(),o,8*o.length,l,Ue.DATA_MATRIX,E.currentTimeMillis()),h=n.getByteSegments();h!=null&&d.putMetadata(Re.BYTE_SEGMENTS,h);const p=n.getECLevel();return p!=null&&d.putMetadata(Re.ERROR_CORRECTION_LEVEL,p),d}reset(){}static extractPureBits(t){const s=t.getTopLeftOnBit(),n=t.getBottomRightOnBit();if(s==null||n==null)throw new H;const l=this.moduleSize(s,t);let o=s[1];const d=n[1];let h=s[0];const w=(n[0]-h+1)/l,S=(d-o+1)/l;if(w<=0||S<=0)throw new H;const P=l/2;o+=P,h+=P;const W=new q(w,S);for(let ne=0;ne<S;ne++){const pe=o+ne*l;for(let je=0;je<w;je++)t.get(h+je*l,pe)&&W.set(je,ne)}return W}static moduleSize(t,s){const n=s.getWidth();let l=t[0];const o=t[1];for(;l<n&&s.get(l,o);)l++;if(l===n)throw new H;const d=l-t[0];if(d===0)throw new H;return d}}Fe.NO_POINTS=[];class Bt extends ye{constructor(t=500){super(new Fe,t)}}var vs;(function(O){O[O.L=0]="L",O[O.M=1]="M",O[O.Q=2]="Q",O[O.H=3]="H"})(vs||(vs={}));class Kt{constructor(t,s,n){this.value=t,this.stringValue=s,this.bits=n,Kt.FOR_BITS.set(n,this),Kt.FOR_VALUE.set(t,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(t){switch(t){case"L":return Kt.L;case"M":return Kt.M;case"Q":return Kt.Q;case"H":return Kt.H;default:throw new y(t+"not available")}}toString(){return this.stringValue}equals(t){if(!(t instanceof Kt))return!1;const s=t;return this.value===s.value}static forBits(t){if(t<0||t>=Kt.FOR_BITS.size)throw new N;return Kt.FOR_BITS.get(t)}}Kt.FOR_BITS=new Map,Kt.FOR_VALUE=new Map,Kt.L=new Kt(vs.L,"L",1),Kt.M=new Kt(vs.M,"M",0),Kt.Q=new Kt(vs.Q,"Q",3),Kt.H=new Kt(vs.H,"H",2);class Mt{constructor(t){this.errorCorrectionLevel=Kt.forBits(t>>3&3),this.dataMask=t&7}static numBitsDiffering(t,s){return L.bitCount(t^s)}static decodeFormatInformation(t,s){const n=Mt.doDecodeFormatInformation(t,s);return n!==null?n:Mt.doDecodeFormatInformation(t^Mt.FORMAT_INFO_MASK_QR,s^Mt.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(t,s){let n=Number.MAX_SAFE_INTEGER,l=0;for(const o of Mt.FORMAT_INFO_DECODE_LOOKUP){const d=o[0];if(d===t||d===s)return new Mt(o[1]);let h=Mt.numBitsDiffering(t,d);h<n&&(l=o[1],n=h),t!==s&&(h=Mt.numBitsDiffering(s,d),h<n&&(l=o[1],n=h))}return n<=3?new Mt(l):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(t){if(!(t instanceof Mt))return!1;const s=t;return this.errorCorrectionLevel===s.errorCorrectionLevel&&this.dataMask===s.dataMask}}Mt.FORMAT_INFO_MASK_QR=21522,Mt.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class _e{constructor(t,...s){this.ecCodewordsPerBlock=t,this.ecBlocks=s}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let t=0;const s=this.ecBlocks;for(const n of s)t+=n.getCount();return t}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class ee{constructor(t,s){this.count=t,this.dataCodewords=s}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Lt{constructor(t,s,...n){this.versionNumber=t,this.alignmentPatternCenters=s,this.ecBlocks=n;let l=0;const o=n[0].getECCodewordsPerBlock(),d=n[0].getECBlocks();for(const h of d)l+=h.getCount()*(h.getDataCodewords()+o);this.totalCodewords=l}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(t){return this.ecBlocks[t.getValue()]}static getProvisionalVersionForDimension(t){if(t%4!==1)throw new A;try{return this.getVersionForNumber((t-17)/4)}catch{throw new A}}static getVersionForNumber(t){if(t<1||t>40)throw new N;return Lt.VERSIONS[t-1]}static decodeVersionInformation(t){let s=Number.MAX_SAFE_INTEGER,n=0;for(let l=0;l<Lt.VERSION_DECODE_INFO.length;l++){const o=Lt.VERSION_DECODE_INFO[l];if(o===t)return Lt.getVersionForNumber(l+7);const d=Mt.numBitsDiffering(t,o);d<s&&(n=l+7,s=d)}return s<=3?Lt.getVersionForNumber(n):null}buildFunctionPattern(){const t=this.getDimensionForVersion(),s=new q(t);s.setRegion(0,0,9,9),s.setRegion(t-8,0,8,9),s.setRegion(0,t-8,9,8);const n=this.alignmentPatternCenters.length;for(let l=0;l<n;l++){const o=this.alignmentPatternCenters[l]-2;for(let d=0;d<n;d++)l===0&&(d===0||d===n-1)||l===n-1&&d===0||s.setRegion(this.alignmentPatternCenters[d]-2,o,5,5)}return s.setRegion(6,9,1,t-17),s.setRegion(9,6,t-17,1),this.versionNumber>6&&(s.setRegion(t-11,0,3,6),s.setRegion(0,t-11,6,3)),s}toString(){return""+this.versionNumber}}Lt.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),Lt.VERSIONS=[new Lt(1,new Int32Array(0),new _e(7,new ee(1,19)),new _e(10,new ee(1,16)),new _e(13,new ee(1,13)),new _e(17,new ee(1,9))),new Lt(2,Int32Array.from([6,18]),new _e(10,new ee(1,34)),new _e(16,new ee(1,28)),new _e(22,new ee(1,22)),new _e(28,new ee(1,16))),new Lt(3,Int32Array.from([6,22]),new _e(15,new ee(1,55)),new _e(26,new ee(1,44)),new _e(18,new ee(2,17)),new _e(22,new ee(2,13))),new Lt(4,Int32Array.from([6,26]),new _e(20,new ee(1,80)),new _e(18,new ee(2,32)),new _e(26,new ee(2,24)),new _e(16,new ee(4,9))),new Lt(5,Int32Array.from([6,30]),new _e(26,new ee(1,108)),new _e(24,new ee(2,43)),new _e(18,new ee(2,15),new ee(2,16)),new _e(22,new ee(2,11),new ee(2,12))),new Lt(6,Int32Array.from([6,34]),new _e(18,new ee(2,68)),new _e(16,new ee(4,27)),new _e(24,new ee(4,19)),new _e(28,new ee(4,15))),new Lt(7,Int32Array.from([6,22,38]),new _e(20,new ee(2,78)),new _e(18,new ee(4,31)),new _e(18,new ee(2,14),new ee(4,15)),new _e(26,new ee(4,13),new ee(1,14))),new Lt(8,Int32Array.from([6,24,42]),new _e(24,new ee(2,97)),new _e(22,new ee(2,38),new ee(2,39)),new _e(22,new ee(4,18),new ee(2,19)),new _e(26,new ee(4,14),new ee(2,15))),new Lt(9,Int32Array.from([6,26,46]),new _e(30,new ee(2,116)),new _e(22,new ee(3,36),new ee(2,37)),new _e(20,new ee(4,16),new ee(4,17)),new _e(24,new ee(4,12),new ee(4,13))),new Lt(10,Int32Array.from([6,28,50]),new _e(18,new ee(2,68),new ee(2,69)),new _e(26,new ee(4,43),new ee(1,44)),new _e(24,new ee(6,19),new ee(2,20)),new _e(28,new ee(6,15),new ee(2,16))),new Lt(11,Int32Array.from([6,30,54]),new _e(20,new ee(4,81)),new _e(30,new ee(1,50),new ee(4,51)),new _e(28,new ee(4,22),new ee(4,23)),new _e(24,new ee(3,12),new ee(8,13))),new Lt(12,Int32Array.from([6,32,58]),new _e(24,new ee(2,92),new ee(2,93)),new _e(22,new ee(6,36),new ee(2,37)),new _e(26,new ee(4,20),new ee(6,21)),new _e(28,new ee(7,14),new ee(4,15))),new Lt(13,Int32Array.from([6,34,62]),new _e(26,new ee(4,107)),new _e(22,new ee(8,37),new ee(1,38)),new _e(24,new ee(8,20),new ee(4,21)),new _e(22,new ee(12,11),new ee(4,12))),new Lt(14,Int32Array.from([6,26,46,66]),new _e(30,new ee(3,115),new ee(1,116)),new _e(24,new ee(4,40),new ee(5,41)),new _e(20,new ee(11,16),new ee(5,17)),new _e(24,new ee(11,12),new ee(5,13))),new Lt(15,Int32Array.from([6,26,48,70]),new _e(22,new ee(5,87),new ee(1,88)),new _e(24,new ee(5,41),new ee(5,42)),new _e(30,new ee(5,24),new ee(7,25)),new _e(24,new ee(11,12),new ee(7,13))),new Lt(16,Int32Array.from([6,26,50,74]),new _e(24,new ee(5,98),new ee(1,99)),new _e(28,new ee(7,45),new ee(3,46)),new _e(24,new ee(15,19),new ee(2,20)),new _e(30,new ee(3,15),new ee(13,16))),new Lt(17,Int32Array.from([6,30,54,78]),new _e(28,new ee(1,107),new ee(5,108)),new _e(28,new ee(10,46),new ee(1,47)),new _e(28,new ee(1,22),new ee(15,23)),new _e(28,new ee(2,14),new ee(17,15))),new Lt(18,Int32Array.from([6,30,56,82]),new _e(30,new ee(5,120),new ee(1,121)),new _e(26,new ee(9,43),new ee(4,44)),new _e(28,new ee(17,22),new ee(1,23)),new _e(28,new ee(2,14),new ee(19,15))),new Lt(19,Int32Array.from([6,30,58,86]),new _e(28,new ee(3,113),new ee(4,114)),new _e(26,new ee(3,44),new ee(11,45)),new _e(26,new ee(17,21),new ee(4,22)),new _e(26,new ee(9,13),new ee(16,14))),new Lt(20,Int32Array.from([6,34,62,90]),new _e(28,new ee(3,107),new ee(5,108)),new _e(26,new ee(3,41),new ee(13,42)),new _e(30,new ee(15,24),new ee(5,25)),new _e(28,new ee(15,15),new ee(10,16))),new Lt(21,Int32Array.from([6,28,50,72,94]),new _e(28,new ee(4,116),new ee(4,117)),new _e(26,new ee(17,42)),new _e(28,new ee(17,22),new ee(6,23)),new _e(30,new ee(19,16),new ee(6,17))),new Lt(22,Int32Array.from([6,26,50,74,98]),new _e(28,new ee(2,111),new ee(7,112)),new _e(28,new ee(17,46)),new _e(30,new ee(7,24),new ee(16,25)),new _e(24,new ee(34,13))),new Lt(23,Int32Array.from([6,30,54,78,102]),new _e(30,new ee(4,121),new ee(5,122)),new _e(28,new ee(4,47),new ee(14,48)),new _e(30,new ee(11,24),new ee(14,25)),new _e(30,new ee(16,15),new ee(14,16))),new Lt(24,Int32Array.from([6,28,54,80,106]),new _e(30,new ee(6,117),new ee(4,118)),new _e(28,new ee(6,45),new ee(14,46)),new _e(30,new ee(11,24),new ee(16,25)),new _e(30,new ee(30,16),new ee(2,17))),new Lt(25,Int32Array.from([6,32,58,84,110]),new _e(26,new ee(8,106),new ee(4,107)),new _e(28,new ee(8,47),new ee(13,48)),new _e(30,new ee(7,24),new ee(22,25)),new _e(30,new ee(22,15),new ee(13,16))),new Lt(26,Int32Array.from([6,30,58,86,114]),new _e(28,new ee(10,114),new ee(2,115)),new _e(28,new ee(19,46),new ee(4,47)),new _e(28,new ee(28,22),new ee(6,23)),new _e(30,new ee(33,16),new ee(4,17))),new Lt(27,Int32Array.from([6,34,62,90,118]),new _e(30,new ee(8,122),new ee(4,123)),new _e(28,new ee(22,45),new ee(3,46)),new _e(30,new ee(8,23),new ee(26,24)),new _e(30,new ee(12,15),new ee(28,16))),new Lt(28,Int32Array.from([6,26,50,74,98,122]),new _e(30,new ee(3,117),new ee(10,118)),new _e(28,new ee(3,45),new ee(23,46)),new _e(30,new ee(4,24),new ee(31,25)),new _e(30,new ee(11,15),new ee(31,16))),new Lt(29,Int32Array.from([6,30,54,78,102,126]),new _e(30,new ee(7,116),new ee(7,117)),new _e(28,new ee(21,45),new ee(7,46)),new _e(30,new ee(1,23),new ee(37,24)),new _e(30,new ee(19,15),new ee(26,16))),new Lt(30,Int32Array.from([6,26,52,78,104,130]),new _e(30,new ee(5,115),new ee(10,116)),new _e(28,new ee(19,47),new ee(10,48)),new _e(30,new ee(15,24),new ee(25,25)),new _e(30,new ee(23,15),new ee(25,16))),new Lt(31,Int32Array.from([6,30,56,82,108,134]),new _e(30,new ee(13,115),new ee(3,116)),new _e(28,new ee(2,46),new ee(29,47)),new _e(30,new ee(42,24),new ee(1,25)),new _e(30,new ee(23,15),new ee(28,16))),new Lt(32,Int32Array.from([6,34,60,86,112,138]),new _e(30,new ee(17,115)),new _e(28,new ee(10,46),new ee(23,47)),new _e(30,new ee(10,24),new ee(35,25)),new _e(30,new ee(19,15),new ee(35,16))),new Lt(33,Int32Array.from([6,30,58,86,114,142]),new _e(30,new ee(17,115),new ee(1,116)),new _e(28,new ee(14,46),new ee(21,47)),new _e(30,new ee(29,24),new ee(19,25)),new _e(30,new ee(11,15),new ee(46,16))),new Lt(34,Int32Array.from([6,34,62,90,118,146]),new _e(30,new ee(13,115),new ee(6,116)),new _e(28,new ee(14,46),new ee(23,47)),new _e(30,new ee(44,24),new ee(7,25)),new _e(30,new ee(59,16),new ee(1,17))),new Lt(35,Int32Array.from([6,30,54,78,102,126,150]),new _e(30,new ee(12,121),new ee(7,122)),new _e(28,new ee(12,47),new ee(26,48)),new _e(30,new ee(39,24),new ee(14,25)),new _e(30,new ee(22,15),new ee(41,16))),new Lt(36,Int32Array.from([6,24,50,76,102,128,154]),new _e(30,new ee(6,121),new ee(14,122)),new _e(28,new ee(6,47),new ee(34,48)),new _e(30,new ee(46,24),new ee(10,25)),new _e(30,new ee(2,15),new ee(64,16))),new Lt(37,Int32Array.from([6,28,54,80,106,132,158]),new _e(30,new ee(17,122),new ee(4,123)),new _e(28,new ee(29,46),new ee(14,47)),new _e(30,new ee(49,24),new ee(10,25)),new _e(30,new ee(24,15),new ee(46,16))),new Lt(38,Int32Array.from([6,32,58,84,110,136,162]),new _e(30,new ee(4,122),new ee(18,123)),new _e(28,new ee(13,46),new ee(32,47)),new _e(30,new ee(48,24),new ee(14,25)),new _e(30,new ee(42,15),new ee(32,16))),new Lt(39,Int32Array.from([6,26,54,82,110,138,166]),new _e(30,new ee(20,117),new ee(4,118)),new _e(28,new ee(40,47),new ee(7,48)),new _e(30,new ee(43,24),new ee(22,25)),new _e(30,new ee(10,15),new ee(67,16))),new Lt(40,Int32Array.from([6,30,58,86,114,142,170]),new _e(30,new ee(19,118),new ee(6,119)),new _e(28,new ee(18,47),new ee(31,48)),new _e(30,new ee(34,24),new ee(34,25)),new _e(30,new ee(20,15),new ee(61,16)))];var $s;(function(O){O[O.DATA_MASK_000=0]="DATA_MASK_000",O[O.DATA_MASK_001=1]="DATA_MASK_001",O[O.DATA_MASK_010=2]="DATA_MASK_010",O[O.DATA_MASK_011=3]="DATA_MASK_011",O[O.DATA_MASK_100=4]="DATA_MASK_100",O[O.DATA_MASK_101=5]="DATA_MASK_101",O[O.DATA_MASK_110=6]="DATA_MASK_110",O[O.DATA_MASK_111=7]="DATA_MASK_111"})($s||($s={}));class ir{constructor(t,s){this.value=t,this.isMasked=s}unmaskBitMatrix(t,s){for(let n=0;n<s;n++)for(let l=0;l<s;l++)this.isMasked(n,l)&&t.flip(l,n)}}ir.values=new Map([[$s.DATA_MASK_000,new ir($s.DATA_MASK_000,(O,t)=>(O+t&1)===0)],[$s.DATA_MASK_001,new ir($s.DATA_MASK_001,(O,t)=>(O&1)===0)],[$s.DATA_MASK_010,new ir($s.DATA_MASK_010,(O,t)=>t%3===0)],[$s.DATA_MASK_011,new ir($s.DATA_MASK_011,(O,t)=>(O+t)%3===0)],[$s.DATA_MASK_100,new ir($s.DATA_MASK_100,(O,t)=>(Math.floor(O/2)+Math.floor(t/3)&1)===0)],[$s.DATA_MASK_101,new ir($s.DATA_MASK_101,(O,t)=>O*t%6===0)],[$s.DATA_MASK_110,new ir($s.DATA_MASK_110,(O,t)=>O*t%6<3)],[$s.DATA_MASK_111,new ir($s.DATA_MASK_111,(O,t)=>(O+t+O*t%3&1)===0)]]);class ii{constructor(t){const s=t.getHeight();if(s<21||(s&3)!==1)throw new A;this.bitMatrix=t}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let t=0;for(let o=0;o<6;o++)t=this.copyBit(o,8,t);t=this.copyBit(7,8,t),t=this.copyBit(8,8,t),t=this.copyBit(8,7,t);for(let o=5;o>=0;o--)t=this.copyBit(8,o,t);const s=this.bitMatrix.getHeight();let n=0;const l=s-7;for(let o=s-1;o>=l;o--)n=this.copyBit(8,o,n);for(let o=s-8;o<s;o++)n=this.copyBit(o,8,n);if(this.parsedFormatInfo=Mt.decodeFormatInformation(t,n),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new A}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const t=this.bitMatrix.getHeight(),s=Math.floor((t-17)/4);if(s<=6)return Lt.getVersionForNumber(s);let n=0;const l=t-11;for(let d=5;d>=0;d--)for(let h=t-9;h>=l;h--)n=this.copyBit(h,d,n);let o=Lt.decodeVersionInformation(n);if(o!==null&&o.getDimensionForVersion()===t)return this.parsedVersion=o,o;n=0;for(let d=5;d>=0;d--)for(let h=t-9;h>=l;h--)n=this.copyBit(d,h,n);if(o=Lt.decodeVersionInformation(n),o!==null&&o.getDimensionForVersion()===t)return this.parsedVersion=o,o;throw new A}copyBit(t,s,n){return(this.isMirror?this.bitMatrix.get(s,t):this.bitMatrix.get(t,s))?n<<1|1:n<<1}readCodewords(){const t=this.readFormatInformation(),s=this.readVersion(),n=ir.values.get(t.getDataMask()),l=this.bitMatrix.getHeight();n.unmaskBitMatrix(this.bitMatrix,l);const o=s.buildFunctionPattern();let d=!0;const h=new Uint8Array(s.getTotalCodewords());let p=0,w=0,S=0;for(let P=l-1;P>0;P-=2){P===6&&P--;for(let W=0;W<l;W++){const ne=d?l-1-W:W;for(let pe=0;pe<2;pe++)o.get(P-pe,ne)||(S++,w<<=1,this.bitMatrix.get(P-pe,ne)&&(w|=1),S===8&&(h[p++]=w,S=0,w=0))}d=!d}if(p!==s.getTotalCodewords())throw new A;return h}remask(){if(this.parsedFormatInfo===null)return;const t=ir.values[this.parsedFormatInfo.getDataMask()],s=this.bitMatrix.getHeight();t.unmaskBitMatrix(this.bitMatrix,s)}setMirror(t){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=t}mirror(){const t=this.bitMatrix;for(let s=0,n=t.getWidth();s<n;s++)for(let l=s+1,o=t.getHeight();l<o;l++)t.get(s,l)!==t.get(l,s)&&(t.flip(l,s),t.flip(s,l))}}class ea{constructor(t,s){this.numDataCodewords=t,this.codewords=s}static getDataBlocks(t,s,n){if(t.length!==s.getTotalCodewords())throw new N;const l=s.getECBlocksForLevel(n);let o=0;const d=l.getECBlocks();for(const pe of d)o+=pe.getCount();const h=new Array(o);let p=0;for(const pe of d)for(let je=0;je<pe.getCount();je++){const Me=pe.getDataCodewords(),Ve=l.getECCodewordsPerBlock()+Me;h[p++]=new ea(Me,new Uint8Array(Ve))}const w=h[0].codewords.length;let S=h.length-1;for(;S>=0&&h[S].codewords.length!==w;)S--;S++;const P=w-l.getECCodewordsPerBlock();let W=0;for(let pe=0;pe<P;pe++)for(let je=0;je<p;je++)h[je].codewords[pe]=t[W++];for(let pe=S;pe<p;pe++)h[pe].codewords[P]=t[W++];const ne=h[0].codewords.length;for(let pe=P;pe<ne;pe++)for(let je=0;je<p;je++){const Me=je<S?pe:pe+1;h[je].codewords[Me]=t[W++]}return h}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var br;(function(O){O[O.TERMINATOR=0]="TERMINATOR",O[O.NUMERIC=1]="NUMERIC",O[O.ALPHANUMERIC=2]="ALPHANUMERIC",O[O.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",O[O.BYTE=4]="BYTE",O[O.ECI=5]="ECI",O[O.KANJI=6]="KANJI",O[O.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",O[O.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",O[O.HANZI=9]="HANZI"})(br||(br={}));class Pt{constructor(t,s,n,l){this.value=t,this.stringValue=s,this.characterCountBitsForVersions=n,this.bits=l,Pt.FOR_BITS.set(l,this),Pt.FOR_VALUE.set(t,this)}static forBits(t){const s=Pt.FOR_BITS.get(t);if(s===void 0)throw new N;return s}getCharacterCountBits(t){const s=t.getVersionNumber();let n;return s<=9?n=0:s<=26?n=1:n=2,this.characterCountBitsForVersions[n]}getValue(){return this.value}getBits(){return this.bits}equals(t){if(!(t instanceof Pt))return!1;const s=t;return this.value===s.value}toString(){return this.stringValue}}Pt.FOR_BITS=new Map,Pt.FOR_VALUE=new Map,Pt.TERMINATOR=new Pt(br.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),Pt.NUMERIC=new Pt(br.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),Pt.ALPHANUMERIC=new Pt(br.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),Pt.STRUCTURED_APPEND=new Pt(br.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),Pt.BYTE=new Pt(br.BYTE,"BYTE",Int32Array.from([8,16,16]),4),Pt.ECI=new Pt(br.ECI,"ECI",Int32Array.from([0,0,0]),7),Pt.KANJI=new Pt(br.KANJI,"KANJI",Int32Array.from([8,10,12]),8),Pt.FNC1_FIRST_POSITION=new Pt(br.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),Pt.FNC1_SECOND_POSITION=new Pt(br.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),Pt.HANZI=new Pt(br.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class Ms{static decode(t,s,n,l){const o=new Ie(t);let d=new se;const h=new Array;let p=-1,w=-1;try{let S=null,P=!1,W;do{if(o.available()<4)W=Pt.TERMINATOR;else{const ne=o.readBits(4);W=Pt.forBits(ne)}switch(W){case Pt.TERMINATOR:break;case Pt.FNC1_FIRST_POSITION:case Pt.FNC1_SECOND_POSITION:P=!0;break;case Pt.STRUCTURED_APPEND:if(o.available()<16)throw new A;p=o.readBits(8),w=o.readBits(8);break;case Pt.ECI:const ne=Ms.parseECIValue(o);if(S=_.getCharacterSetECIByValue(ne),S===null)throw new A;break;case Pt.HANZI:const pe=o.readBits(4),je=o.readBits(W.getCharacterCountBits(s));pe===Ms.GB2312_SUBSET&&Ms.decodeHanziSegment(o,d,je);break;default:const Me=o.readBits(W.getCharacterCountBits(s));switch(W){case Pt.NUMERIC:Ms.decodeNumericSegment(o,d,Me);break;case Pt.ALPHANUMERIC:Ms.decodeAlphanumericSegment(o,d,Me,P);break;case Pt.BYTE:Ms.decodeByteSegment(o,d,Me,S,h,l);break;case Pt.KANJI:Ms.decodeKanjiSegment(o,d,Me);break;default:throw new A}break}}while(W!==Pt.TERMINATOR)}catch{throw new A}return new ut(t,d.toString(),h.length===0?null:h,n===null?null:n.toString(),p,w)}static decodeHanziSegment(t,s,n){if(n*13>t.available())throw new A;const l=new Uint8Array(2*n);let o=0;for(;n>0;){const d=t.readBits(13);let h=d/96<<8&4294967295|d%96;h<959?h+=41377:h+=42657,l[o]=h>>8&255,l[o+1]=h&255,o+=2,n--}try{s.append(T.decode(l,z.GB2312))}catch(d){throw new A(d)}}static decodeKanjiSegment(t,s,n){if(n*13>t.available())throw new A;const l=new Uint8Array(2*n);let o=0;for(;n>0;){const d=t.readBits(13);let h=d/192<<8&4294967295|d%192;h<7936?h+=33088:h+=49472,l[o]=h>>8,l[o+1]=h,o+=2,n--}try{s.append(T.decode(l,z.SHIFT_JIS))}catch(d){throw new A(d)}}static decodeByteSegment(t,s,n,l,o,d){if(8*n>t.available())throw new A;const h=new Uint8Array(n);for(let w=0;w<n;w++)h[w]=t.readBits(8);let p;l===null?p=z.guessEncoding(h,d):p=l.getName();try{s.append(T.decode(h,p))}catch(w){throw new A(w)}o.push(h)}static toAlphaNumericChar(t){if(t>=Ms.ALPHANUMERIC_CHARS.length)throw new A;return Ms.ALPHANUMERIC_CHARS[t]}static decodeAlphanumericSegment(t,s,n,l){const o=s.length();for(;n>1;){if(t.available()<11)throw new A;const d=t.readBits(11);s.append(Ms.toAlphaNumericChar(Math.floor(d/45))),s.append(Ms.toAlphaNumericChar(d%45)),n-=2}if(n===1){if(t.available()<6)throw new A;s.append(Ms.toAlphaNumericChar(t.readBits(6)))}if(l)for(let d=o;d<s.length();d++)s.charAt(d)==="%"&&(d<s.length()-1&&s.charAt(d+1)==="%"?s.deleteCharAt(d+1):s.setCharAt(d,""))}static decodeNumericSegment(t,s,n){for(;n>=3;){if(t.available()<10)throw new A;const l=t.readBits(10);if(l>=1e3)throw new A;s.append(Ms.toAlphaNumericChar(Math.floor(l/100))),s.append(Ms.toAlphaNumericChar(Math.floor(l/10)%10)),s.append(Ms.toAlphaNumericChar(l%10)),n-=3}if(n===2){if(t.available()<7)throw new A;const l=t.readBits(7);if(l>=100)throw new A;s.append(Ms.toAlphaNumericChar(Math.floor(l/10))),s.append(Ms.toAlphaNumericChar(l%10))}else if(n===1){if(t.available()<4)throw new A;const l=t.readBits(4);if(l>=10)throw new A;s.append(Ms.toAlphaNumericChar(l))}}static parseECIValue(t){const s=t.readBits(8);if(!(s&128))return s&127;if((s&192)===128){const n=t.readBits(8);return(s&63)<<8&4294967295|n}if((s&224)===192){const n=t.readBits(16);return(s&31)<<16&4294967295|n}throw new A}}Ms.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Ms.GB2312_SUBSET=1;class An{constructor(t){this.mirrored=t}isMirrored(){return this.mirrored}applyMirroredCorrection(t){if(!this.mirrored||t===null||t.length<3)return;const s=t[0];t[0]=t[2],t[2]=s}}class li{constructor(){this.rsDecoder=new $e(Be.QR_CODE_FIELD_256)}decodeBooleanArray(t,s){return this.decodeBitMatrix(q.parseFromBooleanArray(t),s)}decodeBitMatrix(t,s){const n=new ii(t);let l=null;try{return this.decodeBitMatrixParser(n,s)}catch(o){l=o}try{n.remask(),n.setMirror(!0),n.readVersion(),n.readFormatInformation(),n.mirror();const o=this.decodeBitMatrixParser(n,s);return o.setOther(new An(!0)),o}catch(o){throw l!==null?l:o}}decodeBitMatrixParser(t,s){const n=t.readVersion(),l=t.readFormatInformation().getErrorCorrectionLevel(),o=t.readCodewords(),d=ea.getDataBlocks(o,n,l);let h=0;for(const S of d)h+=S.getNumDataCodewords();const p=new Uint8Array(h);let w=0;for(const S of d){const P=S.getCodewords(),W=S.getNumDataCodewords();this.correctErrors(P,W);for(let ne=0;ne<W;ne++)p[w++]=P[ne]}return Ms.decode(p,n,l,s)}correctErrors(t,s){const n=new Int32Array(t);try{this.rsDecoder.decode(n,t.length-s)}catch{throw new R}for(let l=0;l<s;l++)t[l]=n[l]}}class Ya extends ae{constructor(t,s,n){super(t,s),this.estimatedModuleSize=n}aboutEquals(t,s,n){if(Math.abs(s-this.getY())<=t&&Math.abs(n-this.getX())<=t){const l=Math.abs(t-this.estimatedModuleSize);return l<=1||l<=this.estimatedModuleSize}return!1}combineEstimate(t,s,n){const l=(this.getX()+s)/2,o=(this.getY()+t)/2,d=(this.estimatedModuleSize+n)/2;return new Ya(l,o,d)}}class Da{constructor(t,s,n,l,o,d,h){this.image=t,this.startX=s,this.startY=n,this.width=l,this.height=o,this.moduleSize=d,this.resultPointCallback=h,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const t=this.startX,s=this.height,n=this.width,l=t+n,o=this.startY+s/2,d=new Int32Array(3),h=this.image;for(let p=0;p<s;p++){const w=o+(p&1?-Math.floor((p+1)/2):Math.floor((p+1)/2));d[0]=0,d[1]=0,d[2]=0;let S=t;for(;S<l&&!h.get(S,w);)S++;let P=0;for(;S<l;){if(h.get(S,w))if(P===1)d[1]++;else if(P===2){if(this.foundPatternCross(d)){const W=this.handlePossibleCenter(d,w,S);if(W!==null)return W}d[0]=d[2],d[1]=1,d[2]=0,P=1}else d[++P]++;else P===1&&P++,d[P]++;S++}if(this.foundPatternCross(d)){const W=this.handlePossibleCenter(d,w,l);if(W!==null)return W}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new H}static centerFromEnd(t,s){return s-t[2]-t[1]/2}foundPatternCross(t){const s=this.moduleSize,n=s/2;for(let l=0;l<3;l++)if(Math.abs(s-t[l])>=n)return!1;return!0}crossCheckVertical(t,s,n,l){const o=this.image,d=o.getHeight(),h=this.crossCheckStateCount;h[0]=0,h[1]=0,h[2]=0;let p=t;for(;p>=0&&o.get(s,p)&&h[1]<=n;)h[1]++,p--;if(p<0||h[1]>n)return NaN;for(;p>=0&&!o.get(s,p)&&h[0]<=n;)h[0]++,p--;if(h[0]>n)return NaN;for(p=t+1;p<d&&o.get(s,p)&&h[1]<=n;)h[1]++,p++;if(p===d||h[1]>n)return NaN;for(;p<d&&!o.get(s,p)&&h[2]<=n;)h[2]++,p++;if(h[2]>n)return NaN;const w=h[0]+h[1]+h[2];return 5*Math.abs(w-l)>=2*l?NaN:this.foundPatternCross(h)?Da.centerFromEnd(h,p):NaN}handlePossibleCenter(t,s,n){const l=t[0]+t[1]+t[2],o=Da.centerFromEnd(t,n),d=this.crossCheckVertical(s,o,2*t[1],l);if(!isNaN(d)){const h=(t[0]+t[1]+t[2])/3;for(const w of this.possibleCenters)if(w.aboutEquals(h,d,o))return w.combineEstimate(d,o,h);const p=new Ya(o,d,h);this.possibleCenters.push(p),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(p)}return null}}class Xa extends ae{constructor(t,s,n,l){super(t,s),this.estimatedModuleSize=n,this.count=l,l===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(t,s,n){if(Math.abs(s-this.getY())<=t&&Math.abs(n-this.getX())<=t){const l=Math.abs(t-this.estimatedModuleSize);return l<=1||l<=this.estimatedModuleSize}return!1}combineEstimate(t,s,n){const l=this.count+1,o=(this.count*this.getX()+s)/l,d=(this.count*this.getY()+t)/l,h=(this.count*this.estimatedModuleSize+n)/l;return new Xa(o,d,h,l)}}class oi{constructor(t){this.bottomLeft=t[0],this.topLeft=t[1],this.topRight=t[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class Xs{constructor(t,s){this.image=t,this.resultPointCallback=s,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=s}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(t){const s=t!=null&&t.get(Y.TRY_HARDER)!==void 0,n=t!=null&&t.get(Y.PURE_BARCODE)!==void 0,l=this.image,o=l.getHeight(),d=l.getWidth();let h=Math.floor(3*o/(4*Xs.MAX_MODULES));(h<Xs.MIN_SKIP||s)&&(h=Xs.MIN_SKIP);let p=!1;const w=new Int32Array(5);for(let P=h-1;P<o&&!p;P+=h){w[0]=0,w[1]=0,w[2]=0,w[3]=0,w[4]=0;let W=0;for(let ne=0;ne<d;ne++)if(l.get(ne,P))(W&1)===1&&W++,w[W]++;else if(W&1)w[W]++;else if(W===4)if(Xs.foundPatternCross(w)){if(this.handlePossibleCenter(w,P,ne,n)===!0)if(h=2,this.hasSkipped===!0)p=this.haveMultiplyConfirmedCenters();else{const je=this.findRowSkip();je>w[2]&&(P+=je-w[2]-h,ne=d-1)}else{w[0]=w[2],w[1]=w[3],w[2]=w[4],w[3]=1,w[4]=0,W=3;continue}W=0,w[0]=0,w[1]=0,w[2]=0,w[3]=0,w[4]=0}else w[0]=w[2],w[1]=w[3],w[2]=w[4],w[3]=1,w[4]=0,W=3;else w[++W]++;Xs.foundPatternCross(w)&&this.handlePossibleCenter(w,P,d,n)===!0&&(h=w[0],this.hasSkipped&&(p=this.haveMultiplyConfirmedCenters()))}const S=this.selectBestPatterns();return ae.orderBestPatterns(S),new oi(S)}static centerFromEnd(t,s){return s-t[4]-t[3]-t[2]/2}static foundPatternCross(t){let s=0;for(let o=0;o<5;o++){const d=t[o];if(d===0)return!1;s+=d}if(s<7)return!1;const n=s/7,l=n/2;return Math.abs(n-t[0])<l&&Math.abs(n-t[1])<l&&Math.abs(3*n-t[2])<3*l&&Math.abs(n-t[3])<l&&Math.abs(n-t[4])<l}getCrossCheckStateCount(){const t=this.crossCheckStateCount;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t}crossCheckDiagonal(t,s,n,l){const o=this.getCrossCheckStateCount();let d=0;const h=this.image;for(;t>=d&&s>=d&&h.get(s-d,t-d);)o[2]++,d++;if(t<d||s<d)return!1;for(;t>=d&&s>=d&&!h.get(s-d,t-d)&&o[1]<=n;)o[1]++,d++;if(t<d||s<d||o[1]>n)return!1;for(;t>=d&&s>=d&&h.get(s-d,t-d)&&o[0]<=n;)o[0]++,d++;if(o[0]>n)return!1;const p=h.getHeight(),w=h.getWidth();for(d=1;t+d<p&&s+d<w&&h.get(s+d,t+d);)o[2]++,d++;if(t+d>=p||s+d>=w)return!1;for(;t+d<p&&s+d<w&&!h.get(s+d,t+d)&&o[3]<n;)o[3]++,d++;if(t+d>=p||s+d>=w||o[3]>=n)return!1;for(;t+d<p&&s+d<w&&h.get(s+d,t+d)&&o[4]<n;)o[4]++,d++;if(o[4]>=n)return!1;const S=o[0]+o[1]+o[2]+o[3]+o[4];return Math.abs(S-l)<2*l&&Xs.foundPatternCross(o)}crossCheckVertical(t,s,n,l){const o=this.image,d=o.getHeight(),h=this.getCrossCheckStateCount();let p=t;for(;p>=0&&o.get(s,p);)h[2]++,p--;if(p<0)return NaN;for(;p>=0&&!o.get(s,p)&&h[1]<=n;)h[1]++,p--;if(p<0||h[1]>n)return NaN;for(;p>=0&&o.get(s,p)&&h[0]<=n;)h[0]++,p--;if(h[0]>n)return NaN;for(p=t+1;p<d&&o.get(s,p);)h[2]++,p++;if(p===d)return NaN;for(;p<d&&!o.get(s,p)&&h[3]<n;)h[3]++,p++;if(p===d||h[3]>=n)return NaN;for(;p<d&&o.get(s,p)&&h[4]<n;)h[4]++,p++;if(h[4]>=n)return NaN;const w=h[0]+h[1]+h[2]+h[3]+h[4];return 5*Math.abs(w-l)>=2*l?NaN:Xs.foundPatternCross(h)?Xs.centerFromEnd(h,p):NaN}crossCheckHorizontal(t,s,n,l){const o=this.image,d=o.getWidth(),h=this.getCrossCheckStateCount();let p=t;for(;p>=0&&o.get(p,s);)h[2]++,p--;if(p<0)return NaN;for(;p>=0&&!o.get(p,s)&&h[1]<=n;)h[1]++,p--;if(p<0||h[1]>n)return NaN;for(;p>=0&&o.get(p,s)&&h[0]<=n;)h[0]++,p--;if(h[0]>n)return NaN;for(p=t+1;p<d&&o.get(p,s);)h[2]++,p++;if(p===d)return NaN;for(;p<d&&!o.get(p,s)&&h[3]<n;)h[3]++,p++;if(p===d||h[3]>=n)return NaN;for(;p<d&&o.get(p,s)&&h[4]<n;)h[4]++,p++;if(h[4]>=n)return NaN;const w=h[0]+h[1]+h[2]+h[3]+h[4];return 5*Math.abs(w-l)>=l?NaN:Xs.foundPatternCross(h)?Xs.centerFromEnd(h,p):NaN}handlePossibleCenter(t,s,n,l){const o=t[0]+t[1]+t[2]+t[3]+t[4];let d=Xs.centerFromEnd(t,n),h=this.crossCheckVertical(s,Math.floor(d),t[2],o);if(!isNaN(h)&&(d=this.crossCheckHorizontal(Math.floor(d),Math.floor(h),t[2],o),!isNaN(d)&&(!l||this.crossCheckDiagonal(Math.floor(h),Math.floor(d),t[2],o)))){const p=o/7;let w=!1;const S=this.possibleCenters;for(let P=0,W=S.length;P<W;P++){const ne=S[P];if(ne.aboutEquals(p,h,d)){S[P]=ne.combineEstimate(h,d,p),w=!0;break}}if(!w){const P=new Xa(d,h,p);S.push(P),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(P)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let s=null;for(const n of this.possibleCenters)if(n.getCount()>=Xs.CENTER_QUORUM)if(s==null)s=n;else return this.hasSkipped=!0,Math.floor((Math.abs(s.getX()-n.getX())-Math.abs(s.getY()-n.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let t=0,s=0;const n=this.possibleCenters.length;for(const d of this.possibleCenters)d.getCount()>=Xs.CENTER_QUORUM&&(t++,s+=d.getEstimatedModuleSize());if(t<3)return!1;const l=s/n;let o=0;for(const d of this.possibleCenters)o+=Math.abs(d.getEstimatedModuleSize()-l);return o<=.05*s}selectBestPatterns(){const t=this.possibleCenters.length;if(t<3)throw new H;const s=this.possibleCenters;let n;if(t>3){let l=0,o=0;for(const p of this.possibleCenters){const w=p.getEstimatedModuleSize();l+=w,o+=w*w}n=l/t;let d=Math.sqrt(o/t-n*n);s.sort((p,w)=>{const S=Math.abs(w.getEstimatedModuleSize()-n),P=Math.abs(p.getEstimatedModuleSize()-n);return S<P?-1:S>P?1:0});const h=Math.max(.2*n,d);for(let p=0;p<s.length&&s.length>3;p++){const w=s[p];Math.abs(w.getEstimatedModuleSize()-n)>h&&(s.splice(p,1),p--)}}if(s.length>3){let l=0;for(const o of s)l+=o.getEstimatedModuleSize();n=l/s.length,s.sort((o,d)=>{if(d.getCount()===o.getCount()){const h=Math.abs(d.getEstimatedModuleSize()-n),p=Math.abs(o.getEstimatedModuleSize()-n);return h<p?1:h>p?-1:0}else return d.getCount()-o.getCount()}),s.splice(3)}return[s[0],s[1],s[2]]}}Xs.CENTER_QUORUM=2,Xs.MIN_SKIP=3,Xs.MAX_MODULES=57;class $r{constructor(t){this.image=t}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(t){this.resultPointCallback=t==null?null:t.get(Y.NEED_RESULT_POINT_CALLBACK);const n=new Xs(this.image,this.resultPointCallback).find(t);return this.processFinderPatternInfo(n)}processFinderPatternInfo(t){const s=t.getTopLeft(),n=t.getTopRight(),l=t.getBottomLeft(),o=this.calculateModuleSize(s,n,l);if(o<1)throw new H("No pattern found in proccess finder.");const d=$r.computeDimension(s,n,l,o),h=Lt.getProvisionalVersionForDimension(d),p=h.getDimensionForVersion()-7;let w=null;if(h.getAlignmentPatternCenters().length>0){const ne=n.getX()-s.getX()+l.getX(),pe=n.getY()-s.getY()+l.getY(),je=1-3/p,Me=Math.floor(s.getX()+je*(ne-s.getX())),Ve=Math.floor(s.getY()+je*(pe-s.getY()));for(let mt=4;mt<=16;mt<<=1)try{w=this.findAlignmentInRegion(o,Me,Ve,mt);break}catch(xt){if(!(xt instanceof H))throw xt}}const S=$r.createTransform(s,n,l,w,d),P=$r.sampleGrid(this.image,S,d);let W;return w===null?W=[l,s,n]:W=[l,s,n,w],new ke(P,W)}static createTransform(t,s,n,l,o){const d=o-3.5;let h,p,w,S;return l!==null?(h=l.getX(),p=l.getY(),w=d-3,S=w):(h=s.getX()-t.getX()+n.getX(),p=s.getY()-t.getY()+n.getY(),w=d,S=d),Te.quadrilateralToQuadrilateral(3.5,3.5,d,3.5,w,S,3.5,d,t.getX(),t.getY(),s.getX(),s.getY(),h,p,n.getX(),n.getY())}static sampleGrid(t,s,n){return vt.getInstance().sampleGridWithTransform(t,n,n,s)}static computeDimension(t,s,n,l){const o=ue.round(ae.distance(t,s)/l),d=ue.round(ae.distance(t,n)/l);let h=Math.floor((o+d)/2)+7;switch(h&3){case 0:h++;break;case 2:h--;break;case 3:throw new H("Dimensions could be not found.")}return h}calculateModuleSize(t,s,n){return(this.calculateModuleSizeOneWay(t,s)+this.calculateModuleSizeOneWay(t,n))/2}calculateModuleSizeOneWay(t,s){const n=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.getX()),Math.floor(t.getY()),Math.floor(s.getX()),Math.floor(s.getY())),l=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(s.getX()),Math.floor(s.getY()),Math.floor(t.getX()),Math.floor(t.getY()));return isNaN(n)?l/7:isNaN(l)?n/7:(n+l)/14}sizeOfBlackWhiteBlackRunBothWays(t,s,n,l){let o=this.sizeOfBlackWhiteBlackRun(t,s,n,l),d=1,h=t-(n-t);h<0?(d=t/(t-h),h=0):h>=this.image.getWidth()&&(d=(this.image.getWidth()-1-t)/(h-t),h=this.image.getWidth()-1);let p=Math.floor(s-(l-s)*d);return d=1,p<0?(d=s/(s-p),p=0):p>=this.image.getHeight()&&(d=(this.image.getHeight()-1-s)/(p-s),p=this.image.getHeight()-1),h=Math.floor(t+(h-t)*d),o+=this.sizeOfBlackWhiteBlackRun(t,s,h,p),o-1}sizeOfBlackWhiteBlackRun(t,s,n,l){const o=Math.abs(l-s)>Math.abs(n-t);if(o){let ne=t;t=s,s=ne,ne=n,n=l,l=ne}const d=Math.abs(n-t),h=Math.abs(l-s);let p=-d/2;const w=t<n?1:-1,S=s<l?1:-1;let P=0;const W=n+w;for(let ne=t,pe=s;ne!==W;ne+=w){const je=o?pe:ne,Me=o?ne:pe;if(P===1===this.image.get(je,Me)){if(P===2)return ue.distance(ne,pe,t,s);P++}if(p+=h,p>0){if(pe===l)break;pe+=S,p-=d}}return P===2?ue.distance(n+w,l,t,s):NaN}findAlignmentInRegion(t,s,n,l){const o=Math.floor(l*t),d=Math.max(0,s-o),h=Math.min(this.image.getWidth()-1,s+o);if(h-d<t*3)throw new H("Alignment top exceeds estimated module size.");const p=Math.max(0,n-o),w=Math.min(this.image.getHeight()-1,n+o);if(w-p<t*3)throw new H("Alignment bottom exceeds estimated module size.");return new Da(this.image,d,p,h-d,w-p,t,this.resultPointCallback).find()}}class qr{constructor(){this.decoder=new li}getDecoder(){return this.decoder}decode(t,s){let n,l;if(s!=null&&s.get(Y.PURE_BARCODE)!==void 0){const p=qr.extractPureBits(t.getBlackMatrix());n=this.decoder.decodeBitMatrix(p,s),l=qr.NO_POINTS}else{const p=new $r(t.getBlackMatrix()).detect(s);n=this.decoder.decodeBitMatrix(p.getBits(),s),l=p.getPoints()}n.getOther()instanceof An&&n.getOther().applyMirroredCorrection(l);const o=new Q(n.getText(),n.getRawBytes(),void 0,l,Ue.QR_CODE,void 0),d=n.getByteSegments();d!==null&&o.putMetadata(Re.BYTE_SEGMENTS,d);const h=n.getECLevel();return h!==null&&o.putMetadata(Re.ERROR_CORRECTION_LEVEL,h),n.hasStructuredAppend()&&(o.putMetadata(Re.STRUCTURED_APPEND_SEQUENCE,n.getStructuredAppendSequenceNumber()),o.putMetadata(Re.STRUCTURED_APPEND_PARITY,n.getStructuredAppendParity())),o}reset(){}static extractPureBits(t){const s=t.getTopLeftOnBit(),n=t.getBottomRightOnBit();if(s===null||n===null)throw new H;const l=this.moduleSize(s,t);let o=s[1],d=n[1],h=s[0],p=n[0];if(h>=p||o>=d)throw new H;if(d-o!==p-h&&(p=h+(d-o),p>=t.getWidth()))throw new H;const w=Math.round((p-h+1)/l),S=Math.round((d-o+1)/l);if(w<=0||S<=0)throw new H;if(S!==w)throw new H;const P=Math.floor(l/2);o+=P,h+=P;const W=h+Math.floor((w-1)*l)-p;if(W>0){if(W>P)throw new H;h-=W}const ne=o+Math.floor((S-1)*l)-d;if(ne>0){if(ne>P)throw new H;o-=ne}const pe=new q(w,S);for(let je=0;je<S;je++){const Me=o+Math.floor(je*l);for(let Ve=0;Ve<w;Ve++)t.get(h+Math.floor(Ve*l),Me)&&pe.set(Ve,je)}return pe}static moduleSize(t,s){const n=s.getHeight(),l=s.getWidth();let o=t[0],d=t[1],h=!0,p=0;for(;o<l&&d<n;){if(h!==s.get(o,d)){if(++p===5)break;h=!h}o++,d++}if(o===l||d===n)throw new H;return(o-t[0])/7}}qr.NO_POINTS=new Array;class ie{PDF417Common(){}static getBitCountSum(t){return ue.sum(t)}static toIntArray(t){if(t==null||!t.length)return ie.EMPTY_INT_ARRAY;const s=new Int32Array(t.length);let n=0;for(const l of t)s[n++]=l;return s}static getCodeword(t){const s=F.binarySearch(ie.SYMBOL_TABLE,t&262143);return s<0?-1:(ie.CODEWORD_TABLE[s]-1)%ie.NUMBER_OF_CODEWORDS}}ie.NUMBER_OF_CODEWORDS=929,ie.MAX_CODEWORDS_IN_BARCODE=ie.NUMBER_OF_CODEWORDS-1,ie.MIN_ROWS_IN_BARCODE=3,ie.MAX_ROWS_IN_BARCODE=90,ie.MODULES_IN_CODEWORD=17,ie.MODULES_IN_STOP_PATTERN=18,ie.BARS_IN_MODULE=8,ie.EMPTY_INT_ARRAY=new Int32Array([]),ie.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),ie.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class st{constructor(t,s){this.bits=t,this.points=s}getBits(){return this.bits}getPoints(){return this.points}}class nt{static detectMultiple(t,s,n){let l=t.getBlackMatrix(),o=nt.detect(n,l);return o.length||(l=l.clone(),l.rotate180(),o=nt.detect(n,l)),new st(l,o)}static detect(t,s){const n=new Array;let l=0,o=0,d=!1;for(;l<s.getHeight();){const h=nt.findVertices(s,l,o);if(h[0]==null&&h[3]==null){if(!d)break;d=!1,o=0;for(const p of n)p[1]!=null&&(l=Math.trunc(Math.max(l,p[1].getY()))),p[3]!=null&&(l=Math.max(l,Math.trunc(p[3].getY())));l+=nt.ROW_STEP;continue}if(d=!0,n.push(h),!t)break;h[2]!=null?(o=Math.trunc(h[2].getX()),l=Math.trunc(h[2].getY())):(o=Math.trunc(h[4].getX()),l=Math.trunc(h[4].getY()))}return n}static findVertices(t,s,n){const l=t.getHeight(),o=t.getWidth(),d=new Array(8);return nt.copyToResult(d,nt.findRowsWithPattern(t,l,o,s,n,nt.START_PATTERN),nt.INDEXES_START_PATTERN),d[4]!=null&&(n=Math.trunc(d[4].getX()),s=Math.trunc(d[4].getY())),nt.copyToResult(d,nt.findRowsWithPattern(t,l,o,s,n,nt.STOP_PATTERN),nt.INDEXES_STOP_PATTERN),d}static copyToResult(t,s,n){for(let l=0;l<n.length;l++)t[n[l]]=s[l]}static findRowsWithPattern(t,s,n,l,o,d){const h=new Array(4);let p=!1;const w=new Int32Array(d.length);for(;l<s;l+=nt.ROW_STEP){let P=nt.findGuardPattern(t,o,l,n,!1,d,w);if(P!=null){for(;l>0;){const W=nt.findGuardPattern(t,o,--l,n,!1,d,w);if(W!=null)P=W;else{l++;break}}h[0]=new ae(P[0],l),h[1]=new ae(P[1],l),p=!0;break}}let S=l+1;if(p){let P=0,W=Int32Array.from([Math.trunc(h[0].getX()),Math.trunc(h[1].getX())]);for(;S<s;S++){const ne=nt.findGuardPattern(t,W[0],S,n,!1,d,w);if(ne!=null&&Math.abs(W[0]-ne[0])<nt.MAX_PATTERN_DRIFT&&Math.abs(W[1]-ne[1])<nt.MAX_PATTERN_DRIFT)W=ne,P=0;else{if(P>nt.SKIPPED_ROW_COUNT_MAX)break;P++}}S-=P+1,h[2]=new ae(W[0],S),h[3]=new ae(W[1],S)}return S-l<nt.BARCODE_MIN_HEIGHT&&F.fill(h,null),h}static findGuardPattern(t,s,n,l,o,d,h){F.fillWithin(h,0,h.length,0);let p=s,w=0;for(;t.get(p,n)&&p>0&&w++<nt.MAX_PIXEL_DRIFT;)p--;let S=p,P=0,W=d.length;for(let ne=o;S<l;S++)if(t.get(S,n)!==ne)h[P]++;else{if(P===W-1){if(nt.patternMatchVariance(h,d,nt.MAX_INDIVIDUAL_VARIANCE)<nt.MAX_AVG_VARIANCE)return new Int32Array([p,S]);p+=h[0]+h[1],E.arraycopy(h,2,h,0,P-1),h[P-1]=0,h[P]=0,P--}else P++;h[P]=1,ne=!ne}return P===W-1&&nt.patternMatchVariance(h,d,nt.MAX_INDIVIDUAL_VARIANCE)<nt.MAX_AVG_VARIANCE?new Int32Array([p,S-1]):null}static patternMatchVariance(t,s,n){let l=t.length,o=0,d=0;for(let w=0;w<l;w++)o+=t[w],d+=s[w];if(o<d)return 1/0;let h=o/d;n*=h;let p=0;for(let w=0;w<l;w++){let S=t[w],P=s[w]*h,W=S>P?S-P:P-S;if(W>n)return 1/0;p+=W}return p/o}}nt.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),nt.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),nt.MAX_AVG_VARIANCE=.42,nt.MAX_INDIVIDUAL_VARIANCE=.8,nt.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),nt.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),nt.MAX_PIXEL_DRIFT=3,nt.MAX_PATTERN_DRIFT=5,nt.SKIPPED_ROW_COUNT_MAX=25,nt.ROW_STEP=5,nt.BARCODE_MIN_HEIGHT=10;class It{constructor(t,s){if(s.length===0)throw new N;this.field=t;let n=s.length;if(n>1&&s[0]===0){let l=1;for(;l<n&&s[l]===0;)l++;l===n?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(n-l),E.arraycopy(s,l,this.coefficients,0,this.coefficients.length))}else this.coefficients=s}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(t){return this.coefficients[this.coefficients.length-1-t]}evaluateAt(t){if(t===0)return this.getCoefficient(0);if(t===1){let l=0;for(let o of this.coefficients)l=this.field.add(l,o);return l}let s=this.coefficients[0],n=this.coefficients.length;for(let l=1;l<n;l++)s=this.field.add(this.field.multiply(t,s),this.coefficients[l]);return s}add(t){if(!this.field.equals(t.field))throw new N("ModulusPolys do not have same ModulusGF field");if(this.isZero())return t;if(t.isZero())return this;let s=this.coefficients,n=t.coefficients;if(s.length>n.length){let d=s;s=n,n=d}let l=new Int32Array(n.length),o=n.length-s.length;E.arraycopy(n,0,l,0,o);for(let d=o;d<n.length;d++)l[d]=this.field.add(s[d-o],n[d]);return new It(this.field,l)}subtract(t){if(!this.field.equals(t.field))throw new N("ModulusPolys do not have same ModulusGF field");return t.isZero()?this:this.add(t.negative())}multiply(t){return t instanceof It?this.multiplyOther(t):this.multiplyScalar(t)}multiplyOther(t){if(!this.field.equals(t.field))throw new N("ModulusPolys do not have same ModulusGF field");if(this.isZero()||t.isZero())return new It(this.field,new Int32Array([0]));let s=this.coefficients,n=s.length,l=t.coefficients,o=l.length,d=new Int32Array(n+o-1);for(let h=0;h<n;h++){let p=s[h];for(let w=0;w<o;w++)d[h+w]=this.field.add(d[h+w],this.field.multiply(p,l[w]))}return new It(this.field,d)}negative(){let t=this.coefficients.length,s=new Int32Array(t);for(let n=0;n<t;n++)s[n]=this.field.subtract(0,this.coefficients[n]);return new It(this.field,s)}multiplyScalar(t){if(t===0)return new It(this.field,new Int32Array([0]));if(t===1)return this;let s=this.coefficients.length,n=new Int32Array(s);for(let l=0;l<s;l++)n[l]=this.field.multiply(this.coefficients[l],t);return new It(this.field,n)}multiplyByMonomial(t,s){if(t<0)throw new N;if(s===0)return new It(this.field,new Int32Array([0]));let n=this.coefficients.length,l=new Int32Array(n+t);for(let o=0;o<n;o++)l[o]=this.field.multiply(this.coefficients[o],s);return new It(this.field,l)}toString(){let t=new se;for(let s=this.getDegree();s>=0;s--){let n=this.getCoefficient(s);n!==0&&(n<0?(t.append(" - "),n=-n):t.length()>0&&t.append(" + "),(s===0||n!==1)&&t.append(n),s!==0&&(s===1?t.append("x"):(t.append("x^"),t.append(s))))}return t.toString()}}class Tt{add(t,s){return(t+s)%this.modulus}subtract(t,s){return(this.modulus+t-s)%this.modulus}exp(t){return this.expTable[t]}log(t){if(t===0)throw new N;return this.logTable[t]}inverse(t){if(t===0)throw new Xe;return this.expTable[this.modulus-this.logTable[t]-1]}multiply(t,s){return t===0||s===0?0:this.expTable[(this.logTable[t]+this.logTable[s])%(this.modulus-1)]}getSize(){return this.modulus}equals(t){return t===this}}class Yt extends Tt{constructor(t,s){super(),this.modulus=t,this.expTable=new Int32Array(t),this.logTable=new Int32Array(t);let n=1;for(let l=0;l<t;l++)this.expTable[l]=n,n=n*s%t;for(let l=0;l<t-1;l++)this.logTable[this.expTable[l]]=l;this.zero=new It(this,new Int32Array([0])),this.one=new It(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(t,s){if(t<0)throw new N;if(s===0)return this.zero;let n=new Int32Array(t+1);return n[0]=s,new It(this,n)}}Yt.PDF417_GF=new Yt(ie.NUMBER_OF_CODEWORDS,3);class Rs{constructor(){this.field=Yt.PDF417_GF}decode(t,s,n){let l=new It(this.field,t),o=new Int32Array(s),d=!1;for(let pe=s;pe>0;pe--){let je=l.evaluateAt(this.field.exp(pe));o[s-pe]=je,je!==0&&(d=!0)}if(!d)return 0;let h=this.field.getOne();if(n!=null)for(const pe of n){let je=this.field.exp(t.length-1-pe),Me=new It(this.field,new Int32Array([this.field.subtract(0,je),1]));h=h.multiply(Me)}let p=new It(this.field,o),w=this.runEuclideanAlgorithm(this.field.buildMonomial(s,1),p,s),S=w[0],P=w[1],W=this.findErrorLocations(S),ne=this.findErrorMagnitudes(P,S,W);for(let pe=0;pe<W.length;pe++){let je=t.length-1-this.field.log(W[pe]);if(je<0)throw R.getChecksumInstance();t[je]=this.field.subtract(t[je],ne[pe])}return W.length}runEuclideanAlgorithm(t,s,n){if(t.getDegree()<s.getDegree()){let W=t;t=s,s=W}let l=t,o=s,d=this.field.getZero(),h=this.field.getOne();for(;o.getDegree()>=Math.round(n/2);){let W=l,ne=d;if(l=o,d=h,l.isZero())throw R.getChecksumInstance();o=W;let pe=this.field.getZero(),je=l.getCoefficient(l.getDegree()),Me=this.field.inverse(je);for(;o.getDegree()>=l.getDegree()&&!o.isZero();){let Ve=o.getDegree()-l.getDegree(),mt=this.field.multiply(o.getCoefficient(o.getDegree()),Me);pe=pe.add(this.field.buildMonomial(Ve,mt)),o=o.subtract(l.multiplyByMonomial(Ve,mt))}h=pe.multiply(d).subtract(ne).negative()}let p=h.getCoefficient(0);if(p===0)throw R.getChecksumInstance();let w=this.field.inverse(p),S=h.multiply(w),P=o.multiply(w);return[S,P]}findErrorLocations(t){let s=t.getDegree(),n=new Int32Array(s),l=0;for(let o=1;o<this.field.getSize()&&l<s;o++)t.evaluateAt(o)===0&&(n[l]=this.field.inverse(o),l++);if(l!==s)throw R.getChecksumInstance();return n}findErrorMagnitudes(t,s,n){let l=s.getDegree(),o=new Int32Array(l);for(let w=1;w<=l;w++)o[l-w]=this.field.multiply(w,s.getCoefficient(w));let d=new It(this.field,o),h=n.length,p=new Int32Array(h);for(let w=0;w<h;w++){let S=this.field.inverse(n[w]),P=this.field.subtract(0,t.evaluateAt(S)),W=this.field.inverse(d.evaluateAt(S));p[w]=this.field.multiply(P,W)}return p}}class Ks{constructor(t,s,n,l,o){t instanceof Ks?this.constructor_2(t):this.constructor_1(t,s,n,l,o)}constructor_1(t,s,n,l,o){const d=s==null||n==null,h=l==null||o==null;if(d&&h)throw new H;d?(s=new ae(0,l.getY()),n=new ae(0,o.getY())):h&&(l=new ae(t.getWidth()-1,s.getY()),o=new ae(t.getWidth()-1,n.getY())),this.image=t,this.topLeft=s,this.bottomLeft=n,this.topRight=l,this.bottomRight=o,this.minX=Math.trunc(Math.min(s.getX(),n.getX())),this.maxX=Math.trunc(Math.max(l.getX(),o.getX())),this.minY=Math.trunc(Math.min(s.getY(),l.getY())),this.maxY=Math.trunc(Math.max(n.getY(),o.getY()))}constructor_2(t){this.image=t.image,this.topLeft=t.getTopLeft(),this.bottomLeft=t.getBottomLeft(),this.topRight=t.getTopRight(),this.bottomRight=t.getBottomRight(),this.minX=t.getMinX(),this.maxX=t.getMaxX(),this.minY=t.getMinY(),this.maxY=t.getMaxY()}static merge(t,s){return t==null?s:s==null?t:new Ks(t.image,t.topLeft,t.bottomLeft,s.topRight,s.bottomRight)}addMissingRows(t,s,n){let l=this.topLeft,o=this.bottomLeft,d=this.topRight,h=this.bottomRight;if(t>0){let p=n?this.topLeft:this.topRight,w=Math.trunc(p.getY()-t);w<0&&(w=0);let S=new ae(p.getX(),w);n?l=S:d=S}if(s>0){let p=n?this.bottomLeft:this.bottomRight,w=Math.trunc(p.getY()+s);w>=this.image.getHeight()&&(w=this.image.getHeight()-1);let S=new ae(p.getX(),w);n?o=S:h=S}return new Ks(this.image,l,o,d,h)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class rr{constructor(t,s,n,l){this.columnCount=t,this.errorCorrectionLevel=l,this.rowCountUpperPart=s,this.rowCountLowerPart=n,this.rowCount=s+n}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class ia{constructor(){this.buffer=""}static form(t,s){let n=-1;function l(d,h,p,w,S,P){if(d==="%%")return"%";if(s[++n]===void 0)return;d=w?parseInt(w.substr(1)):void 0;let W=S?parseInt(S.substr(1)):void 0,ne;switch(P){case"s":ne=s[n];break;case"c":ne=s[n][0];break;case"f":ne=parseFloat(s[n]).toFixed(d);break;case"p":ne=parseFloat(s[n]).toPrecision(d);break;case"e":ne=parseFloat(s[n]).toExponential(d);break;case"x":ne=parseInt(s[n]).toString(W||16);break;case"d":ne=parseFloat(parseInt(s[n],W||10).toPrecision(d)).toFixed(0);break}ne=typeof ne=="object"?JSON.stringify(ne):(+ne).toString(W);let pe=parseInt(p),je=p&&p[0]+""=="0"?"0":" ";for(;ne.length<pe;)ne=h!==void 0?ne+je:je+ne;return ne}let o=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return t.replace(o,l)}format(t,...s){this.buffer+=ia.form(t,s)}toString(){return this.buffer}}class Ka{constructor(t){this.boundingBox=new Ks(t),this.codewords=new Array(t.getMaxY()-t.getMinY()+1)}getCodewordNearby(t){let s=this.getCodeword(t);if(s!=null)return s;for(let n=1;n<Ka.MAX_NEARBY_DISTANCE;n++){let l=this.imageRowToCodewordIndex(t)-n;if(l>=0&&(s=this.codewords[l],s!=null)||(l=this.imageRowToCodewordIndex(t)+n,l<this.codewords.length&&(s=this.codewords[l],s!=null)))return s}return null}imageRowToCodewordIndex(t){return t-this.boundingBox.getMinY()}setCodeword(t,s){this.codewords[this.imageRowToCodewordIndex(t)]=s}getCodeword(t){return this.codewords[this.imageRowToCodewordIndex(t)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const t=new ia;let s=0;for(const n of this.codewords){if(n==null){t.format("%3d:    |   %n",s++);continue}t.format("%3d: %3d|%3d%n",s++,n.getRowNumber(),n.getValue())}return t.toString()}}Ka.MAX_NEARBY_DISTANCE=5;class Za{constructor(){this.values=new Map}setValue(t){t=Math.trunc(t);let s=this.values.get(t);s==null&&(s=0),s++,this.values.set(t,s)}getValue(){let t=-1,s=new Array;for(const[n,l]of this.values.entries()){const o={getKey:()=>n,getValue:()=>l};o.getValue()>t?(t=o.getValue(),s=[],s.push(o.getKey())):o.getValue()===t&&s.push(o.getKey())}return ie.toIntArray(s)}getConfidence(t){return this.values.get(t)}}class jl extends Ka{constructor(t,s){super(t),this._isLeft=s}setRowNumbers(){for(let t of this.getCodewords())t!=null&&t.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(t){let s=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(s,t);let n=this.getBoundingBox(),l=this._isLeft?n.getTopLeft():n.getTopRight(),o=this._isLeft?n.getBottomLeft():n.getBottomRight(),d=this.imageRowToCodewordIndex(Math.trunc(l.getY())),h=this.imageRowToCodewordIndex(Math.trunc(o.getY())),p=-1,w=1,S=0;for(let P=d;P<h;P++){if(s[P]==null)continue;let W=s[P],ne=W.getRowNumber()-p;if(ne===0)S++;else if(ne===1)w=Math.max(w,S),S=1,p=W.getRowNumber();else if(ne<0||W.getRowNumber()>=t.getRowCount()||ne>P)s[P]=null;else{let pe;w>2?pe=(w-2)*ne:pe=ne;let je=pe>=P;for(let Me=1;Me<=pe&&!je;Me++)je=s[P-Me]!=null;je?s[P]=null:(p=W.getRowNumber(),S=1)}}}getRowHeights(){let t=this.getBarcodeMetadata();if(t==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(t);let s=new Int32Array(t.getRowCount());for(let n of this.getCodewords())if(n!=null){let l=n.getRowNumber();if(l>=s.length)continue;s[l]++}return s}adjustIncompleteIndicatorColumnRowNumbers(t){let s=this.getBoundingBox(),n=this._isLeft?s.getTopLeft():s.getTopRight(),l=this._isLeft?s.getBottomLeft():s.getBottomRight(),o=this.imageRowToCodewordIndex(Math.trunc(n.getY())),d=this.imageRowToCodewordIndex(Math.trunc(l.getY())),h=this.getCodewords(),p=-1;for(let w=o;w<d;w++){if(h[w]==null)continue;let S=h[w];S.setRowNumberAsRowIndicatorColumn();let P=S.getRowNumber()-p;P===0||(P===1?p=S.getRowNumber():S.getRowNumber()>=t.getRowCount()?h[w]=null:p=S.getRowNumber())}}getBarcodeMetadata(){let t=this.getCodewords(),s=new Za,n=new Za,l=new Za,o=new Za;for(let h of t){if(h==null)continue;h.setRowNumberAsRowIndicatorColumn();let p=h.getValue()%30,w=h.getRowNumber();switch(this._isLeft||(w+=2),w%3){case 0:n.setValue(p*3+1);break;case 1:o.setValue(p/3),l.setValue(p%3);break;case 2:s.setValue(p+1);break}}if(s.getValue().length===0||n.getValue().length===0||l.getValue().length===0||o.getValue().length===0||s.getValue()[0]<1||n.getValue()[0]+l.getValue()[0]<ie.MIN_ROWS_IN_BARCODE||n.getValue()[0]+l.getValue()[0]>ie.MAX_ROWS_IN_BARCODE)return null;let d=new rr(s.getValue()[0],n.getValue()[0],l.getValue()[0],o.getValue()[0]);return this.removeIncorrectCodewords(t,d),d}removeIncorrectCodewords(t,s){for(let n=0;n<t.length;n++){let l=t[n];if(t[n]==null)continue;let o=l.getValue()%30,d=l.getRowNumber();if(d>s.getRowCount()){t[n]=null;continue}switch(this._isLeft||(d+=2),d%3){case 0:o*3+1!==s.getRowCountUpperPart()&&(t[n]=null);break;case 1:(Math.trunc(o/3)!==s.getErrorCorrectionLevel()||o%3!==s.getRowCountLowerPart())&&(t[n]=null);break;case 2:o+1!==s.getColumnCount()&&(t[n]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class Qa{constructor(t,s){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=t,this.barcodeColumnCount=t.getColumnCount(),this.boundingBox=s,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let t=ie.MAX_CODEWORDS_IN_BARCODE,s;do s=t,t=this.adjustRowNumbersAndGetCount();while(t>0&&t<s);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(t){t!=null&&t.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let t=this.adjustRowNumbersByRow();if(t===0)return 0;for(let s=1;s<this.barcodeColumnCount+1;s++){let n=this.detectionResultColumns[s].getCodewords();for(let l=0;l<n.length;l++)n[l]!=null&&(n[l].hasValidRowNumber()||this.adjustRowNumbers(s,l,n))}return t}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let t=this.detectionResultColumns[0].getCodewords(),s=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let n=0;n<t.length;n++)if(t[n]!=null&&s[n]!=null&&t[n].getRowNumber()===s[n].getRowNumber())for(let l=1;l<=this.barcodeColumnCount;l++){let o=this.detectionResultColumns[l].getCodewords()[n];o!=null&&(o.setRowNumber(t[n].getRowNumber()),o.hasValidRowNumber()||(this.detectionResultColumns[l].getCodewords()[n]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let t=0,s=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let n=0;n<s.length;n++){if(s[n]==null)continue;let l=s[n].getRowNumber(),o=0;for(let d=this.barcodeColumnCount+1;d>0&&o<this.ADJUST_ROW_NUMBER_SKIP;d--){let h=this.detectionResultColumns[d].getCodewords()[n];h!=null&&(o=Qa.adjustRowNumberIfValid(l,o,h),h.hasValidRowNumber()||t++)}}return t}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let t=0,s=this.detectionResultColumns[0].getCodewords();for(let n=0;n<s.length;n++){if(s[n]==null)continue;let l=s[n].getRowNumber(),o=0;for(let d=1;d<this.barcodeColumnCount+1&&o<this.ADJUST_ROW_NUMBER_SKIP;d++){let h=this.detectionResultColumns[d].getCodewords()[n];h!=null&&(o=Qa.adjustRowNumberIfValid(l,o,h),h.hasValidRowNumber()||t++)}}return t}static adjustRowNumberIfValid(t,s,n){return n==null||n.hasValidRowNumber()||(n.isValidRowNumber(t)?(n.setRowNumber(t),s=0):++s),s}adjustRowNumbers(t,s,n){if(!this.detectionResultColumns[t-1])return;let l=n[s],o=this.detectionResultColumns[t-1].getCodewords(),d=o;this.detectionResultColumns[t+1]!=null&&(d=this.detectionResultColumns[t+1].getCodewords());let h=new Array(14);h[2]=o[s],h[3]=d[s],s>0&&(h[0]=n[s-1],h[4]=o[s-1],h[5]=d[s-1]),s>1&&(h[8]=n[s-2],h[10]=o[s-2],h[11]=d[s-2]),s<n.length-1&&(h[1]=n[s+1],h[6]=o[s+1],h[7]=d[s+1]),s<n.length-2&&(h[9]=n[s+2],h[12]=o[s+2],h[13]=d[s+2]);for(let p of h)if(Qa.adjustRowNumber(l,p))return}static adjustRowNumber(t,s){return s==null?!1:s.hasValidRowNumber()&&s.getBucket()===t.getBucket()?(t.setRowNumber(s.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(t){this.boundingBox=t}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(t,s){this.detectionResultColumns[t]=s}getDetectionResultColumn(t){return this.detectionResultColumns[t]}toString(){let t=this.detectionResultColumns[0];t==null&&(t=this.detectionResultColumns[this.barcodeColumnCount+1]);let s=new ia;for(let n=0;n<t.getCodewords().length;n++){s.format("CW %3d:",n);for(let l=0;l<this.barcodeColumnCount+2;l++){if(this.detectionResultColumns[l]==null){s.format("    |   ");continue}let o=this.detectionResultColumns[l].getCodewords()[n];if(o==null){s.format("    |   ");continue}s.format(" %3d|%3d",o.getRowNumber(),o.getValue())}s.format("%n")}return s.toString()}}class Ja{constructor(t,s,n,l){this.rowNumber=Ja.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(t),this.endX=Math.trunc(s),this.bucket=Math.trunc(n),this.value=Math.trunc(l)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(t){return t!==Ja.BARCODE_ROW_UNKNOWN&&this.bucket===t%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(t){this.rowNumber=t}toString(){return this.rowNumber+"|"+this.value}}Ja.BARCODE_ROW_UNKNOWN=-1;class yr{static initialize(){for(let t=0;t<ie.SYMBOL_TABLE.length;t++){let s=ie.SYMBOL_TABLE[t],n=s&1;for(let l=0;l<ie.BARS_IN_MODULE;l++){let o=0;for(;(s&1)===n;)o+=1,s>>=1;n=s&1,yr.RATIOS_TABLE[t]||(yr.RATIOS_TABLE[t]=new Array(ie.BARS_IN_MODULE)),yr.RATIOS_TABLE[t][ie.BARS_IN_MODULE-l-1]=Math.fround(o/ie.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(t){let s=yr.getDecodedCodewordValue(yr.sampleBitCounts(t));return s!==-1?s:yr.getClosestDecodedValue(t)}static sampleBitCounts(t){let s=ue.sum(t),n=new Int32Array(ie.BARS_IN_MODULE),l=0,o=0;for(let d=0;d<ie.MODULES_IN_CODEWORD;d++){let h=s/(2*ie.MODULES_IN_CODEWORD)+d*s/ie.MODULES_IN_CODEWORD;o+t[l]<=h&&(o+=t[l],l++),n[l]++}return n}static getDecodedCodewordValue(t){let s=yr.getBitValue(t);return ie.getCodeword(s)===-1?-1:s}static getBitValue(t){let s=0;for(let n=0;n<t.length;n++)for(let l=0;l<t[n];l++)s=s<<1|(n%2===0?1:0);return Math.trunc(s)}static getClosestDecodedValue(t){let s=ue.sum(t),n=new Array(ie.BARS_IN_MODULE);if(s>1)for(let d=0;d<n.length;d++)n[d]=Math.fround(t[d]/s);let l=Ye.MAX_VALUE,o=-1;this.bSymbolTableReady||yr.initialize();for(let d=0;d<yr.RATIOS_TABLE.length;d++){let h=0,p=yr.RATIOS_TABLE[d];for(let w=0;w<ie.BARS_IN_MODULE;w++){let S=Math.fround(p[w]-n[w]);if(h+=Math.fround(S*S),h>=l)break}h<l&&(l=h,o=ie.SYMBOL_TABLE[d])}return o}}yr.bSymbolTableReady=!1,yr.RATIOS_TABLE=new Array(ie.SYMBOL_TABLE.length).map(O=>new Array(ie.BARS_IN_MODULE));class Nl{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(t){this.segmentIndex=t}getFileId(){return this.fileId}setFileId(t){this.fileId=t}getOptionalData(){return this.optionalData}setOptionalData(t){this.optionalData=t}isLastSegment(){return this.lastSegment}setLastSegment(t){this.lastSegment=t}getSegmentCount(){return this.segmentCount}setSegmentCount(t){this.segmentCount=t}getSender(){return this.sender||null}setSender(t){this.sender=t}getAddressee(){return this.addressee||null}setAddressee(t){this.addressee=t}getFileName(){return this.fileName}setFileName(t){this.fileName=t}getFileSize(){return this.fileSize}setFileSize(t){this.fileSize=t}getChecksum(){return this.checksum}setChecksum(t){this.checksum=t}getTimestamp(){return this.timestamp}setTimestamp(t){this.timestamp=t}}class vl{static parseLong(t,s=void 0){return parseInt(t,s)}}class Cl extends f{}Cl.kind="NullPointerException";class ad{writeBytes(t){this.writeBytesOffset(t,0,t.length)}writeBytesOffset(t,s,n){if(t==null)throw new Cl;if(s<0||s>t.length||n<0||s+n>t.length||s+n<0)throw new v;if(n===0)return;for(let l=0;l<n;l++)this.write(t[s+l])}flush(){}close(){}}class nd extends f{}class id extends ad{constructor(t=32){if(super(),this.count=0,t<0)throw new N("Negative initial size: "+t);this.buf=new Uint8Array(t)}ensureCapacity(t){t-this.buf.length>0&&this.grow(t)}grow(t){let n=this.buf.length<<1;if(n-t<0&&(n=t),n<0){if(t<0)throw new nd;n=L.MAX_VALUE}this.buf=F.copyOfUint8Array(this.buf,n)}write(t){this.ensureCapacity(this.count+1),this.buf[this.count]=t,this.count+=1}writeBytesOffset(t,s,n){if(s<0||s>t.length||n<0||s+n-t.length>0)throw new v;this.ensureCapacity(this.count+n),E.arraycopy(t,s,this.buf,this.count,n),this.count+=n}writeTo(t){t.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return F.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(t){return t?typeof t=="string"?this.toString_string(t):this.toString_number(t):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(t){return new String(this.buf).toString()}toString_number(t){return new String(this.buf).toString()}close(){}}var As;(function(O){O[O.ALPHA=0]="ALPHA",O[O.LOWER=1]="LOWER",O[O.MIXED=2]="MIXED",O[O.PUNCT=3]="PUNCT",O[O.ALPHA_SHIFT=4]="ALPHA_SHIFT",O[O.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(As||(As={}));function Sl(){if(typeof window<"u")return window.BigInt||null;if(typeof sn<"u")return sn.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let kn;function la(O){if(typeof kn>"u"&&(kn=Sl()),kn===null)throw new Error("BigInt is not supported!");return kn(O)}function ld(){let O=[];O[0]=la(1);let t=la(900);O[1]=t;for(let s=2;s<16;s++)O[s]=O[s-1]*t;return O}class qe{static decode(t,s){let n=new se(""),l=_.ISO8859_1;n.enableDecoding(l);let o=1,d=t[o++],h=new Nl;for(;o<t[0];){switch(d){case qe.TEXT_COMPACTION_MODE_LATCH:o=qe.textCompaction(t,o,n);break;case qe.BYTE_COMPACTION_MODE_LATCH:case qe.BYTE_COMPACTION_MODE_LATCH_6:o=qe.byteCompaction(d,t,l,o,n);break;case qe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[o++]);break;case qe.NUMERIC_COMPACTION_MODE_LATCH:o=qe.numericCompaction(t,o,n);break;case qe.ECI_CHARSET:_.getCharacterSetECIByValue(t[o++]);break;case qe.ECI_GENERAL_PURPOSE:o+=2;break;case qe.ECI_USER_DEFINED:o++;break;case qe.BEGIN_MACRO_PDF417_CONTROL_BLOCK:o=qe.decodeMacroBlock(t,o,h);break;case qe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case qe.MACRO_PDF417_TERMINATOR:throw new A;default:o--,o=qe.textCompaction(t,o,n);break}if(o<t.length)d=t[o++];else throw A.getFormatInstance()}if(n.length()===0)throw A.getFormatInstance();let p=new ut(null,n.toString(),null,s);return p.setOther(h),p}static decodeMacroBlock(t,s,n){if(s+qe.NUMBER_OF_SEQUENCE_CODEWORDS>t[0])throw A.getFormatInstance();let l=new Int32Array(qe.NUMBER_OF_SEQUENCE_CODEWORDS);for(let h=0;h<qe.NUMBER_OF_SEQUENCE_CODEWORDS;h++,s++)l[h]=t[s];n.setSegmentIndex(L.parseInt(qe.decodeBase900toBase10(l,qe.NUMBER_OF_SEQUENCE_CODEWORDS)));let o=new se;s=qe.textCompaction(t,s,o),n.setFileId(o.toString());let d=-1;for(t[s]===qe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(d=s+1);s<t[0];)switch(t[s]){case qe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(s++,t[s]){case qe.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let h=new se;s=qe.textCompaction(t,s+1,h),n.setFileName(h.toString());break;case qe.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let p=new se;s=qe.textCompaction(t,s+1,p),n.setSender(p.toString());break;case qe.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let w=new se;s=qe.textCompaction(t,s+1,w),n.setAddressee(w.toString());break;case qe.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let S=new se;s=qe.numericCompaction(t,s+1,S),n.setSegmentCount(L.parseInt(S.toString()));break;case qe.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let P=new se;s=qe.numericCompaction(t,s+1,P),n.setTimestamp(vl.parseLong(P.toString()));break;case qe.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let W=new se;s=qe.numericCompaction(t,s+1,W),n.setChecksum(L.parseInt(W.toString()));break;case qe.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let ne=new se;s=qe.numericCompaction(t,s+1,ne),n.setFileSize(vl.parseLong(ne.toString()));break;default:throw A.getFormatInstance()}break;case qe.MACRO_PDF417_TERMINATOR:s++,n.setLastSegment(!0);break;default:throw A.getFormatInstance()}if(d!==-1){let h=s-d;n.isLastSegment()&&h--,n.setOptionalData(F.copyOfRange(t,d,d+h))}return s}static textCompaction(t,s,n){let l=new Int32Array((t[0]-s)*2),o=new Int32Array((t[0]-s)*2),d=0,h=!1;for(;s<t[0]&&!h;){let p=t[s++];if(p<qe.TEXT_COMPACTION_MODE_LATCH)l[d]=p/30,l[d+1]=p%30,d+=2;else switch(p){case qe.TEXT_COMPACTION_MODE_LATCH:l[d++]=qe.TEXT_COMPACTION_MODE_LATCH;break;case qe.BYTE_COMPACTION_MODE_LATCH:case qe.BYTE_COMPACTION_MODE_LATCH_6:case qe.NUMERIC_COMPACTION_MODE_LATCH:case qe.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case qe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case qe.MACRO_PDF417_TERMINATOR:s--,h=!0;break;case qe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:l[d]=qe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,p=t[s++],o[d]=p,d++;break}}return qe.decodeTextCompaction(l,o,d,n),s}static decodeTextCompaction(t,s,n,l){let o=As.ALPHA,d=As.ALPHA,h=0;for(;h<n;){let p=t[h],w="";switch(o){case As.ALPHA:if(p<26)w=String.fromCharCode(65+p);else switch(p){case 26:w=" ";break;case qe.LL:o=As.LOWER;break;case qe.ML:o=As.MIXED;break;case qe.PS:d=o,o=As.PUNCT_SHIFT;break;case qe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:l.append(s[h]);break;case qe.TEXT_COMPACTION_MODE_LATCH:o=As.ALPHA;break}break;case As.LOWER:if(p<26)w=String.fromCharCode(97+p);else switch(p){case 26:w=" ";break;case qe.AS:d=o,o=As.ALPHA_SHIFT;break;case qe.ML:o=As.MIXED;break;case qe.PS:d=o,o=As.PUNCT_SHIFT;break;case qe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:l.append(s[h]);break;case qe.TEXT_COMPACTION_MODE_LATCH:o=As.ALPHA;break}break;case As.MIXED:if(p<qe.PL)w=qe.MIXED_CHARS[p];else switch(p){case qe.PL:o=As.PUNCT;break;case 26:w=" ";break;case qe.LL:o=As.LOWER;break;case qe.AL:o=As.ALPHA;break;case qe.PS:d=o,o=As.PUNCT_SHIFT;break;case qe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:l.append(s[h]);break;case qe.TEXT_COMPACTION_MODE_LATCH:o=As.ALPHA;break}break;case As.PUNCT:if(p<qe.PAL)w=qe.PUNCT_CHARS[p];else switch(p){case qe.PAL:o=As.ALPHA;break;case qe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:l.append(s[h]);break;case qe.TEXT_COMPACTION_MODE_LATCH:o=As.ALPHA;break}break;case As.ALPHA_SHIFT:if(o=d,p<26)w=String.fromCharCode(65+p);else switch(p){case 26:w=" ";break;case qe.TEXT_COMPACTION_MODE_LATCH:o=As.ALPHA;break}break;case As.PUNCT_SHIFT:if(o=d,p<qe.PAL)w=qe.PUNCT_CHARS[p];else switch(p){case qe.PAL:o=As.ALPHA;break;case qe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:l.append(s[h]);break;case qe.TEXT_COMPACTION_MODE_LATCH:o=As.ALPHA;break}break}w!==""&&l.append(w),h++}}static byteCompaction(t,s,n,l,o){let d=new id,h=0,p=0,w=!1;switch(t){case qe.BYTE_COMPACTION_MODE_LATCH:let S=new Int32Array(6),P=s[l++];for(;l<s[0]&&!w;)switch(S[h++]=P,p=900*p+P,P=s[l++],P){case qe.TEXT_COMPACTION_MODE_LATCH:case qe.BYTE_COMPACTION_MODE_LATCH:case qe.NUMERIC_COMPACTION_MODE_LATCH:case qe.BYTE_COMPACTION_MODE_LATCH_6:case qe.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case qe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case qe.MACRO_PDF417_TERMINATOR:l--,w=!0;break;default:if(h%5===0&&h>0){for(let W=0;W<6;++W)d.write(Number(la(p)>>la(8*(5-W))));p=0,h=0}break}l===s[0]&&P<qe.TEXT_COMPACTION_MODE_LATCH&&(S[h++]=P);for(let W=0;W<h;W++)d.write(S[W]);break;case qe.BYTE_COMPACTION_MODE_LATCH_6:for(;l<s[0]&&!w;){let W=s[l++];if(W<qe.TEXT_COMPACTION_MODE_LATCH)h++,p=900*p+W;else switch(W){case qe.TEXT_COMPACTION_MODE_LATCH:case qe.BYTE_COMPACTION_MODE_LATCH:case qe.NUMERIC_COMPACTION_MODE_LATCH:case qe.BYTE_COMPACTION_MODE_LATCH_6:case qe.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case qe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case qe.MACRO_PDF417_TERMINATOR:l--,w=!0;break}if(h%5===0&&h>0){for(let ne=0;ne<6;++ne)d.write(Number(la(p)>>la(8*(5-ne))));p=0,h=0}}break}return o.append(T.decode(d.toByteArray(),n)),l}static numericCompaction(t,s,n){let l=0,o=!1,d=new Int32Array(qe.MAX_NUMERIC_CODEWORDS);for(;s<t[0]&&!o;){let h=t[s++];if(s===t[0]&&(o=!0),h<qe.TEXT_COMPACTION_MODE_LATCH)d[l]=h,l++;else switch(h){case qe.TEXT_COMPACTION_MODE_LATCH:case qe.BYTE_COMPACTION_MODE_LATCH:case qe.BYTE_COMPACTION_MODE_LATCH_6:case qe.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case qe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case qe.MACRO_PDF417_TERMINATOR:s--,o=!0;break}(l%qe.MAX_NUMERIC_CODEWORDS===0||h===qe.NUMERIC_COMPACTION_MODE_LATCH||o)&&l>0&&(n.append(qe.decodeBase900toBase10(d,l)),l=0)}return s}static decodeBase900toBase10(t,s){let n=la(0);for(let o=0;o<s;o++)n+=qe.EXP900[s-o-1]*la(t[o]);let l=n.toString();if(l.charAt(0)!=="1")throw new A;return l.substring(1)}}qe.TEXT_COMPACTION_MODE_LATCH=900,qe.BYTE_COMPACTION_MODE_LATCH=901,qe.NUMERIC_COMPACTION_MODE_LATCH=902,qe.BYTE_COMPACTION_MODE_LATCH_6=924,qe.ECI_USER_DEFINED=925,qe.ECI_GENERAL_PURPOSE=926,qe.ECI_CHARSET=927,qe.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,qe.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,qe.MACRO_PDF417_TERMINATOR=922,qe.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,qe.MAX_NUMERIC_CODEWORDS=15,qe.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,qe.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,qe.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,qe.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,qe.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,qe.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,qe.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,qe.PL=25,qe.LL=27,qe.AS=27,qe.ML=28,qe.AL=28,qe.PS=29,qe.PAL=29,qe.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,qe.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",qe.EXP900=Sl()?ld():[],qe.NUMBER_OF_SEQUENCE_CODEWORDS=2;class rs{constructor(){}static decode(t,s,n,l,o,d,h){let p=new Ks(t,s,n,l,o),w=null,S=null,P;for(let pe=!0;;pe=!1){if(s!=null&&(w=rs.getRowIndicatorColumn(t,p,s,!0,d,h)),l!=null&&(S=rs.getRowIndicatorColumn(t,p,l,!1,d,h)),P=rs.merge(w,S),P==null)throw H.getNotFoundInstance();let je=P.getBoundingBox();if(pe&&je!=null&&(je.getMinY()<p.getMinY()||je.getMaxY()>p.getMaxY()))p=je;else break}P.setBoundingBox(p);let W=P.getBarcodeColumnCount()+1;P.setDetectionResultColumn(0,w),P.setDetectionResultColumn(W,S);let ne=w!=null;for(let pe=1;pe<=W;pe++){let je=ne?pe:W-pe;if(P.getDetectionResultColumn(je)!==void 0)continue;let Me;je===0||je===W?Me=new jl(p,je===0):Me=new Ka(p),P.setDetectionResultColumn(je,Me);let Ve=-1,mt=Ve;for(let xt=p.getMinY();xt<=p.getMaxY();xt++){if(Ve=rs.getStartColumn(P,je,xt,ne),Ve<0||Ve>p.getMaxX()){if(mt===-1)continue;Ve=mt}let ct=rs.detectCodeword(t,p.getMinX(),p.getMaxX(),ne,Ve,xt,d,h);ct!=null&&(Me.setCodeword(xt,ct),mt=Ve,d=Math.min(d,ct.getWidth()),h=Math.max(h,ct.getWidth()))}}return rs.createDecoderResult(P)}static merge(t,s){if(t==null&&s==null)return null;let n=rs.getBarcodeMetadata(t,s);if(n==null)return null;let l=Ks.merge(rs.adjustBoundingBox(t),rs.adjustBoundingBox(s));return new Qa(n,l)}static adjustBoundingBox(t){if(t==null)return null;let s=t.getRowHeights();if(s==null)return null;let n=rs.getMax(s),l=0;for(let h of s)if(l+=n-h,h>0)break;let o=t.getCodewords();for(let h=0;l>0&&o[h]==null;h++)l--;let d=0;for(let h=s.length-1;h>=0&&(d+=n-s[h],!(s[h]>0));h--);for(let h=o.length-1;d>0&&o[h]==null;h--)d--;return t.getBoundingBox().addMissingRows(l,d,t.isLeft())}static getMax(t){let s=-1;for(let n of t)s=Math.max(s,n);return s}static getBarcodeMetadata(t,s){let n;if(t==null||(n=t.getBarcodeMetadata())==null)return s==null?null:s.getBarcodeMetadata();let l;return s==null||(l=s.getBarcodeMetadata())==null?n:n.getColumnCount()!==l.getColumnCount()&&n.getErrorCorrectionLevel()!==l.getErrorCorrectionLevel()&&n.getRowCount()!==l.getRowCount()?null:n}static getRowIndicatorColumn(t,s,n,l,o,d){let h=new jl(s,l);for(let p=0;p<2;p++){let w=p===0?1:-1,S=Math.trunc(Math.trunc(n.getX()));for(let P=Math.trunc(Math.trunc(n.getY()));P<=s.getMaxY()&&P>=s.getMinY();P+=w){let W=rs.detectCodeword(t,0,t.getWidth(),l,S,P,o,d);W!=null&&(h.setCodeword(P,W),l?S=W.getStartX():S=W.getEndX())}}return h}static adjustCodewordCount(t,s){let n=s[0][1],l=n.getValue(),o=t.getBarcodeColumnCount()*t.getBarcodeRowCount()-rs.getNumberOfECCodeWords(t.getBarcodeECLevel());if(l.length===0){if(o<1||o>ie.MAX_CODEWORDS_IN_BARCODE)throw H.getNotFoundInstance();n.setValue(o)}else l[0]!==o&&n.setValue(o)}static createDecoderResult(t){let s=rs.createBarcodeMatrix(t);rs.adjustCodewordCount(t,s);let n=new Array,l=new Int32Array(t.getBarcodeRowCount()*t.getBarcodeColumnCount()),o=[],d=new Array;for(let p=0;p<t.getBarcodeRowCount();p++)for(let w=0;w<t.getBarcodeColumnCount();w++){let S=s[p][w+1].getValue(),P=p*t.getBarcodeColumnCount()+w;S.length===0?n.push(P):S.length===1?l[P]=S[0]:(d.push(P),o.push(S))}let h=new Array(o.length);for(let p=0;p<h.length;p++)h[p]=o[p];return rs.createDecoderResultFromAmbiguousValues(t.getBarcodeECLevel(),l,ie.toIntArray(n),ie.toIntArray(d),h)}static createDecoderResultFromAmbiguousValues(t,s,n,l,o){let d=new Int32Array(l.length),h=100;for(;h-- >0;){for(let p=0;p<d.length;p++)s[l[p]]=o[p][d[p]];try{return rs.decodeCodewords(s,t,n)}catch(p){if(!(p instanceof R))throw p}if(d.length===0)throw R.getChecksumInstance();for(let p=0;p<d.length;p++)if(d[p]<o[p].length-1){d[p]++;break}else if(d[p]=0,p===d.length-1)throw R.getChecksumInstance()}throw R.getChecksumInstance()}static createBarcodeMatrix(t){let s=Array.from({length:t.getBarcodeRowCount()},()=>new Array(t.getBarcodeColumnCount()+2));for(let l=0;l<s.length;l++)for(let o=0;o<s[l].length;o++)s[l][o]=new Za;let n=0;for(let l of t.getDetectionResultColumns()){if(l!=null){for(let o of l.getCodewords())if(o!=null){let d=o.getRowNumber();if(d>=0){if(d>=s.length)continue;s[d][n].setValue(o.getValue())}}}n++}return s}static isValidBarcodeColumn(t,s){return s>=0&&s<=t.getBarcodeColumnCount()+1}static getStartColumn(t,s,n,l){let o=l?1:-1,d=null;if(rs.isValidBarcodeColumn(t,s-o)&&(d=t.getDetectionResultColumn(s-o).getCodeword(n)),d!=null)return l?d.getEndX():d.getStartX();if(d=t.getDetectionResultColumn(s).getCodewordNearby(n),d!=null)return l?d.getStartX():d.getEndX();if(rs.isValidBarcodeColumn(t,s-o)&&(d=t.getDetectionResultColumn(s-o).getCodewordNearby(n)),d!=null)return l?d.getEndX():d.getStartX();let h=0;for(;rs.isValidBarcodeColumn(t,s-o);){s-=o;for(let p of t.getDetectionResultColumn(s).getCodewords())if(p!=null)return(l?p.getEndX():p.getStartX())+o*h*(p.getEndX()-p.getStartX());h++}return l?t.getBoundingBox().getMinX():t.getBoundingBox().getMaxX()}static detectCodeword(t,s,n,l,o,d,h,p){o=rs.adjustCodewordStartColumn(t,s,n,l,o,d);let w=rs.getModuleBitCount(t,s,n,l,o,d);if(w==null)return null;let S,P=ue.sum(w);if(l)S=o+P;else{for(let pe=0;pe<w.length/2;pe++){let je=w[pe];w[pe]=w[w.length-1-pe],w[w.length-1-pe]=je}S=o,o=S-P}if(!rs.checkCodewordSkew(P,h,p))return null;let W=yr.getDecodedValue(w),ne=ie.getCodeword(W);return ne===-1?null:new Ja(o,S,rs.getCodewordBucketNumber(W),ne)}static getModuleBitCount(t,s,n,l,o,d){let h=o,p=new Int32Array(8),w=0,S=l?1:-1,P=l;for(;(l?h<n:h>=s)&&w<p.length;)t.get(h,d)===P?(p[w]++,h+=S):(w++,P=!P);return w===p.length||h===(l?n:s)&&w===p.length-1?p:null}static getNumberOfECCodeWords(t){return 2<<t}static adjustCodewordStartColumn(t,s,n,l,o,d){let h=o,p=l?-1:1;for(let w=0;w<2;w++){for(;(l?h>=s:h<n)&&l===t.get(h,d);){if(Math.abs(o-h)>rs.CODEWORD_SKEW_SIZE)return o;h+=p}p=-p,l=!l}return h}static checkCodewordSkew(t,s,n){return s-rs.CODEWORD_SKEW_SIZE<=t&&t<=n+rs.CODEWORD_SKEW_SIZE}static decodeCodewords(t,s,n){if(t.length===0)throw A.getFormatInstance();let l=1<<s+1,o=rs.correctErrors(t,n,l);rs.verifyCodewordCount(t,l);let d=qe.decode(t,""+s);return d.setErrorsCorrected(o),d.setErasures(n.length),d}static correctErrors(t,s,n){if(s!=null&&s.length>n/2+rs.MAX_ERRORS||n<0||n>rs.MAX_EC_CODEWORDS)throw R.getChecksumInstance();return rs.errorCorrection.decode(t,n,s)}static verifyCodewordCount(t,s){if(t.length<4)throw A.getFormatInstance();let n=t[0];if(n>t.length)throw A.getFormatInstance();if(n===0)if(s<t.length)t[0]=t.length-s;else throw A.getFormatInstance()}static getBitCountForCodeword(t){let s=new Int32Array(8),n=0,l=s.length-1;for(;!((t&1)!==n&&(n=t&1,l--,l<0));)s[l]++,t>>=1;return s}static getCodewordBucketNumber(t){return t instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(t):this.getCodewordBucketNumber_number(t)}static getCodewordBucketNumber_number(t){return rs.getCodewordBucketNumber(rs.getBitCountForCodeword(t))}static getCodewordBucketNumber_Int32Array(t){return(t[0]-t[2]+t[4]-t[6]+9)%9}static toString(t){let s=new ia;for(let n=0;n<t.length;n++){s.format("Row %2d: ",n);for(let l=0;l<t[n].length;l++){let o=t[n][l];o.getValue().length===0?s.format("        ",null):s.format("%4d(%2d)",o.getValue()[0],o.getConfidence(o.getValue()[0]))}s.format("%n")}return s.toString()}}rs.CODEWORD_SKEW_SIZE=2,rs.MAX_ERRORS=3,rs.MAX_EC_CODEWORDS=512,rs.errorCorrection=new Rs;class lr{decode(t,s=null){let n=lr.decode(t,s,!1);if(n==null||n.length===0||n[0]==null)throw H.getNotFoundInstance();return n[0]}decodeMultiple(t,s=null){try{return lr.decode(t,s,!0)}catch(n){throw n instanceof A||n instanceof R?H.getNotFoundInstance():n}}static decode(t,s,n){const l=new Array,o=nt.detectMultiple(t,s,n);for(const d of o.getPoints()){const h=rs.decode(o.getBits(),d[4],d[5],d[6],d[7],lr.getMinCodewordWidth(d),lr.getMaxCodewordWidth(d)),p=new Q(h.getText(),h.getRawBytes(),void 0,d,Ue.PDF_417);p.putMetadata(Re.ERROR_CORRECTION_LEVEL,h.getECLevel());const w=h.getOther();w!=null&&p.putMetadata(Re.PDF417_EXTRA_METADATA,w),l.push(p)}return l.map(d=>d)}static getMaxWidth(t,s){return t==null||s==null?0:Math.trunc(Math.abs(t.getX()-s.getX()))}static getMinWidth(t,s){return t==null||s==null?L.MAX_VALUE:Math.trunc(Math.abs(t.getX()-s.getX()))}static getMaxCodewordWidth(t){return Math.floor(Math.max(Math.max(lr.getMaxWidth(t[0],t[4]),lr.getMaxWidth(t[6],t[2])*ie.MODULES_IN_CODEWORD/ie.MODULES_IN_STOP_PATTERN),Math.max(lr.getMaxWidth(t[1],t[5]),lr.getMaxWidth(t[7],t[3])*ie.MODULES_IN_CODEWORD/ie.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(t){return Math.floor(Math.min(Math.min(lr.getMinWidth(t[0],t[4]),lr.getMinWidth(t[6],t[2])*ie.MODULES_IN_CODEWORD/ie.MODULES_IN_STOP_PATTERN),Math.min(lr.getMinWidth(t[1],t[5]),lr.getMinWidth(t[7],t[3])*ie.MODULES_IN_CODEWORD/ie.MODULES_IN_STOP_PATTERN)))}reset(){}}class Dn extends f{}Dn.kind="ReaderException";class _l{constructor(t,s){this.verbose=t===!0,s&&this.setHints(s)}decode(t,s){return s&&this.setHints(s),this.decodeInternal(t)}decodeWithState(t){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(t)}setHints(t){this.hints=t;const s=!c(t)&&t.get(Y.TRY_HARDER)===!0,n=c(t)?null:t.get(Y.POSSIBLE_FORMATS),l=new Array;if(!c(n)){const o=n.some(d=>d===Ue.UPC_A||d===Ue.UPC_E||d===Ue.EAN_13||d===Ue.EAN_8||d===Ue.CODABAR||d===Ue.CODE_39||d===Ue.CODE_93||d===Ue.CODE_128||d===Ue.ITF||d===Ue.RSS_14||d===Ue.RSS_EXPANDED);o&&!s&&l.push(new Je(t,this.verbose)),n.includes(Ue.QR_CODE)&&l.push(new qr),n.includes(Ue.DATA_MATRIX)&&l.push(new Fe),n.includes(Ue.AZTEC)&&l.push(new Se),n.includes(Ue.PDF_417)&&l.push(new lr),o&&s&&l.push(new Je(t,this.verbose))}l.length===0&&(s||l.push(new Je(t,this.verbose)),l.push(new qr),l.push(new Fe),l.push(new Se),l.push(new lr),s&&l.push(new Je(t,this.verbose))),this.readers=l}reset(){if(this.readers!==null)for(const t of this.readers)t.reset()}decodeInternal(t){if(this.readers===null)throw new Dn("No readers where selected, nothing can be read.");for(const s of this.readers)try{return s.decode(t,this.hints)}catch(n){if(n instanceof Dn)continue}throw new H("No MultiFormat Readers were able to detect the code.")}}class od extends ye{constructor(t=null,s=500){const n=new _l;n.setHints(t),super(n,s)}decodeBitmap(t){return this.reader.decodeWithState(t)}}class cd extends ye{constructor(t=500){super(new lr,t)}}class dd extends ye{constructor(t=500){super(new qr,t)}}var ci;(function(O){O[O.ERROR_CORRECTION=0]="ERROR_CORRECTION",O[O.CHARACTER_SET=1]="CHARACTER_SET",O[O.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",O[O.MIN_SIZE=3]="MIN_SIZE",O[O.MAX_SIZE=4]="MAX_SIZE",O[O.MARGIN=5]="MARGIN",O[O.PDF417_COMPACT=6]="PDF417_COMPACT",O[O.PDF417_COMPACTION=7]="PDF417_COMPACTION",O[O.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",O[O.AZTEC_LAYERS=9]="AZTEC_LAYERS",O[O.QR_VERSION=10]="QR_VERSION"})(ci||(ci={}));var Qs=ci;class di{constructor(t){this.field=t,this.cachedGenerators=[],this.cachedGenerators.push(new Oe(t,Int32Array.from([1])))}buildGenerator(t){const s=this.cachedGenerators;if(t>=s.length){let n=s[s.length-1];const l=this.field;for(let o=s.length;o<=t;o++){const d=n.multiply(new Oe(l,Int32Array.from([1,l.exp(o-1+l.getGeneratorBase())])));s.push(d),n=d}}return s[t]}encode(t,s){if(s===0)throw new N("No error correction bytes");const n=t.length-s;if(n<=0)throw new N("No data bytes provided");const l=this.buildGenerator(s),o=new Int32Array(n);E.arraycopy(t,0,o,0,n);let d=new Oe(this.field,o);d=d.multiplyByMonomial(s,1);const p=d.divide(l)[1].getCoefficients(),w=s-p.length;for(let S=0;S<w;S++)t[n+S]=0;E.arraycopy(p,0,t,n+w,p.length)}}class qs{constructor(){}static applyMaskPenaltyRule1(t){return qs.applyMaskPenaltyRule1Internal(t,!0)+qs.applyMaskPenaltyRule1Internal(t,!1)}static applyMaskPenaltyRule2(t){let s=0;const n=t.getArray(),l=t.getWidth(),o=t.getHeight();for(let d=0;d<o-1;d++){const h=n[d];for(let p=0;p<l-1;p++){const w=h[p];w===h[p+1]&&w===n[d+1][p]&&w===n[d+1][p+1]&&s++}}return qs.N2*s}static applyMaskPenaltyRule3(t){let s=0;const n=t.getArray(),l=t.getWidth(),o=t.getHeight();for(let d=0;d<o;d++)for(let h=0;h<l;h++){const p=n[d];h+6<l&&p[h]===1&&p[h+1]===0&&p[h+2]===1&&p[h+3]===1&&p[h+4]===1&&p[h+5]===0&&p[h+6]===1&&(qs.isWhiteHorizontal(p,h-4,h)||qs.isWhiteHorizontal(p,h+7,h+11))&&s++,d+6<o&&n[d][h]===1&&n[d+1][h]===0&&n[d+2][h]===1&&n[d+3][h]===1&&n[d+4][h]===1&&n[d+5][h]===0&&n[d+6][h]===1&&(qs.isWhiteVertical(n,h,d-4,d)||qs.isWhiteVertical(n,h,d+7,d+11))&&s++}return s*qs.N3}static isWhiteHorizontal(t,s,n){s=Math.max(s,0),n=Math.min(n,t.length);for(let l=s;l<n;l++)if(t[l]===1)return!1;return!0}static isWhiteVertical(t,s,n,l){n=Math.max(n,0),l=Math.min(l,t.length);for(let o=n;o<l;o++)if(t[o][s]===1)return!1;return!0}static applyMaskPenaltyRule4(t){let s=0;const n=t.getArray(),l=t.getWidth(),o=t.getHeight();for(let p=0;p<o;p++){const w=n[p];for(let S=0;S<l;S++)w[S]===1&&s++}const d=t.getHeight()*t.getWidth();return Math.floor(Math.abs(s*2-d)*10/d)*qs.N4}static getDataMaskBit(t,s,n){let l,o;switch(t){case 0:l=n+s&1;break;case 1:l=n&1;break;case 2:l=s%3;break;case 3:l=(n+s)%3;break;case 4:l=Math.floor(n/2)+Math.floor(s/3)&1;break;case 5:o=n*s,l=(o&1)+o%3;break;case 6:o=n*s,l=(o&1)+o%3&1;break;case 7:o=n*s,l=o%3+(n+s&1)&1;break;default:throw new N("Invalid mask pattern: "+t)}return l===0}static applyMaskPenaltyRule1Internal(t,s){let n=0;const l=s?t.getHeight():t.getWidth(),o=s?t.getWidth():t.getHeight(),d=t.getArray();for(let h=0;h<l;h++){let p=0,w=-1;for(let S=0;S<o;S++){const P=s?d[h][S]:d[S][h];P===w?p++:(p>=5&&(n+=qs.N1+(p-5)),p=1,w=P)}p>=5&&(n+=qs.N1+(p-5))}return n}}qs.N1=3,qs.N2=3,qs.N3=40,qs.N4=10;class Tn{constructor(t,s){this.width=t,this.height=s;const n=new Array(s);for(let l=0;l!==s;l++)n[l]=new Uint8Array(t);this.bytes=n}getHeight(){return this.height}getWidth(){return this.width}get(t,s){return this.bytes[s][t]}getArray(){return this.bytes}setNumber(t,s,n){this.bytes[s][t]=n}setBoolean(t,s,n){this.bytes[s][t]=n?1:0}clear(t){for(const s of this.bytes)F.fill(s,t)}equals(t){if(!(t instanceof Tn))return!1;const s=t;if(this.width!==s.width||this.height!==s.height)return!1;for(let n=0,l=this.height;n<l;++n){const o=this.bytes[n],d=s.bytes[n];for(let h=0,p=this.width;h<p;++h)if(o[h]!==d[h])return!1}return!0}toString(){const t=new se;for(let s=0,n=this.height;s<n;++s){const l=this.bytes[s];for(let o=0,d=this.width;o<d;++o)switch(l[o]){case 0:t.append(" 0");break;case 1:t.append(" 1");break;default:t.append("  ");break}t.append(`
`)}return t.toString()}}class ya{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const t=new se;return t.append(`<<
`),t.append(" mode: "),t.append(this.mode?this.mode.toString():"null"),t.append(`
 ecLevel: `),t.append(this.ecLevel?this.ecLevel.toString():"null"),t.append(`
 version: `),t.append(this.version?this.version.toString():"null"),t.append(`
 maskPattern: `),t.append(this.maskPattern.toString()),this.matrix?(t.append(`
 matrix:
`),t.append(this.matrix.toString())):t.append(`
 matrix: null
`),t.append(`>>
`),t.toString()}setMode(t){this.mode=t}setECLevel(t){this.ecLevel=t}setVersion(t){this.version=t}setMaskPattern(t){this.maskPattern=t}setMatrix(t){this.matrix=t}static isValidMaskPattern(t){return t>=0&&t<ya.NUM_MASK_PATTERNS}}ya.NUM_MASK_PATTERNS=8;class ks extends f{}ks.kind="WriterException";class qt{constructor(){}static clearMatrix(t){t.clear(255)}static buildMatrix(t,s,n,l,o){qt.clearMatrix(o),qt.embedBasicPatterns(n,o),qt.embedTypeInfo(s,l,o),qt.maybeEmbedVersionInfo(n,o),qt.embedDataBits(t,l,o)}static embedBasicPatterns(t,s){qt.embedPositionDetectionPatternsAndSeparators(s),qt.embedDarkDotAtLeftBottomCorner(s),qt.maybeEmbedPositionAdjustmentPatterns(t,s),qt.embedTimingPatterns(s)}static embedTypeInfo(t,s,n){const l=new C;qt.makeTypeInfoBits(t,s,l);for(let o=0,d=l.getSize();o<d;++o){const h=l.get(l.getSize()-1-o),p=qt.TYPE_INFO_COORDINATES[o],w=p[0],S=p[1];if(n.setBoolean(w,S,h),o<8){const P=n.getWidth()-o-1;n.setBoolean(P,8,h)}else{const W=n.getHeight()-7+(o-8);n.setBoolean(8,W,h)}}}static maybeEmbedVersionInfo(t,s){if(t.getVersionNumber()<7)return;const n=new C;qt.makeVersionInfoBits(t,n);let l=6*3-1;for(let o=0;o<6;++o)for(let d=0;d<3;++d){const h=n.get(l);l--,s.setBoolean(o,s.getHeight()-11+d,h),s.setBoolean(s.getHeight()-11+d,o,h)}}static embedDataBits(t,s,n){let l=0,o=-1,d=n.getWidth()-1,h=n.getHeight()-1;for(;d>0;){for(d===6&&(d-=1);h>=0&&h<n.getHeight();){for(let p=0;p<2;++p){const w=d-p;if(!qt.isEmpty(n.get(w,h)))continue;let S;l<t.getSize()?(S=t.get(l),++l):S=!1,s!==255&&qs.getDataMaskBit(s,w,h)&&(S=!S),n.setBoolean(w,h,S)}h+=o}o=-o,h+=o,d-=2}if(l!==t.getSize())throw new ks("Not all bits consumed: "+l+"/"+t.getSize())}static findMSBSet(t){return 32-L.numberOfLeadingZeros(t)}static calculateBCHCode(t,s){if(s===0)throw new N("0 polynomial");const n=qt.findMSBSet(s);for(t<<=n-1;qt.findMSBSet(t)>=n;)t^=s<<qt.findMSBSet(t)-n;return t}static makeTypeInfoBits(t,s,n){if(!ya.isValidMaskPattern(s))throw new ks("Invalid mask pattern");const l=t.getBits()<<3|s;n.appendBits(l,5);const o=qt.calculateBCHCode(l,qt.TYPE_INFO_POLY);n.appendBits(o,10);const d=new C;if(d.appendBits(qt.TYPE_INFO_MASK_PATTERN,15),n.xor(d),n.getSize()!==15)throw new ks("should not happen but we got: "+n.getSize())}static makeVersionInfoBits(t,s){s.appendBits(t.getVersionNumber(),6);const n=qt.calculateBCHCode(t.getVersionNumber(),qt.VERSION_INFO_POLY);if(s.appendBits(n,12),s.getSize()!==18)throw new ks("should not happen but we got: "+s.getSize())}static isEmpty(t){return t===255}static embedTimingPatterns(t){for(let s=8;s<t.getWidth()-8;++s){const n=(s+1)%2;qt.isEmpty(t.get(s,6))&&t.setNumber(s,6,n),qt.isEmpty(t.get(6,s))&&t.setNumber(6,s,n)}}static embedDarkDotAtLeftBottomCorner(t){if(t.get(8,t.getHeight()-8)===0)throw new ks;t.setNumber(8,t.getHeight()-8,1)}static embedHorizontalSeparationPattern(t,s,n){for(let l=0;l<8;++l){if(!qt.isEmpty(n.get(t+l,s)))throw new ks;n.setNumber(t+l,s,0)}}static embedVerticalSeparationPattern(t,s,n){for(let l=0;l<7;++l){if(!qt.isEmpty(n.get(t,s+l)))throw new ks;n.setNumber(t,s+l,0)}}static embedPositionAdjustmentPattern(t,s,n){for(let l=0;l<5;++l){const o=qt.POSITION_ADJUSTMENT_PATTERN[l];for(let d=0;d<5;++d)n.setNumber(t+d,s+l,o[d])}}static embedPositionDetectionPattern(t,s,n){for(let l=0;l<7;++l){const o=qt.POSITION_DETECTION_PATTERN[l];for(let d=0;d<7;++d)n.setNumber(t+d,s+l,o[d])}}static embedPositionDetectionPatternsAndSeparators(t){const s=qt.POSITION_DETECTION_PATTERN[0].length;qt.embedPositionDetectionPattern(0,0,t),qt.embedPositionDetectionPattern(t.getWidth()-s,0,t),qt.embedPositionDetectionPattern(0,t.getWidth()-s,t);const n=8;qt.embedHorizontalSeparationPattern(0,n-1,t),qt.embedHorizontalSeparationPattern(t.getWidth()-n,n-1,t),qt.embedHorizontalSeparationPattern(0,t.getWidth()-n,t);const l=7;qt.embedVerticalSeparationPattern(l,0,t),qt.embedVerticalSeparationPattern(t.getHeight()-l-1,0,t),qt.embedVerticalSeparationPattern(l,t.getHeight()-l,t)}static maybeEmbedPositionAdjustmentPatterns(t,s){if(t.getVersionNumber()<2)return;const n=t.getVersionNumber()-1,l=qt.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[n];for(let o=0,d=l.length;o!==d;o++){const h=l[o];if(h>=0)for(let p=0;p!==d;p++){const w=l[p];w>=0&&qt.isEmpty(s.get(w,h))&&qt.embedPositionAdjustmentPattern(w-2,h-2,s)}}}}qt.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),qt.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),qt.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),qt.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),qt.VERSION_INFO_POLY=7973,qt.TYPE_INFO_POLY=1335,qt.TYPE_INFO_MASK_PATTERN=21522;class ud{constructor(t,s){this.dataBytes=t,this.errorCorrectionBytes=s}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class Ls{constructor(){}static calculateMaskPenalty(t){return qs.applyMaskPenaltyRule1(t)+qs.applyMaskPenaltyRule2(t)+qs.applyMaskPenaltyRule3(t)+qs.applyMaskPenaltyRule4(t)}static encode(t,s,n=null){let l=Ls.DEFAULT_BYTE_MODE_ENCODING;const o=n!==null&&n.get(Qs.CHARACTER_SET)!==void 0;o&&(l=n.get(Qs.CHARACTER_SET).toString());const d=this.chooseMode(t,l),h=new C;if(d===Pt.BYTE&&(o||Ls.DEFAULT_BYTE_MODE_ENCODING!==l)){const xt=_.getCharacterSetECIByName(l);xt!==void 0&&this.appendECI(xt,h)}this.appendModeInfo(d,h);const p=new C;this.appendBytes(t,d,p,l);let w;if(n!==null&&n.get(Qs.QR_VERSION)!==void 0){const xt=Number.parseInt(n.get(Qs.QR_VERSION).toString(),10);w=Lt.getVersionForNumber(xt);const ct=this.calculateBitsNeeded(d,h,p,w);if(!this.willFit(ct,w,s))throw new ks("Data too big for requested version")}else w=this.recommendVersion(s,d,h,p);const S=new C;S.appendBitArray(h);const P=d===Pt.BYTE?p.getSizeInBytes():t.length;this.appendLengthInfo(P,w,d,S),S.appendBitArray(p);const W=w.getECBlocksForLevel(s),ne=w.getTotalCodewords()-W.getTotalECCodewords();this.terminateBits(ne,S);const pe=this.interleaveWithECBytes(S,w.getTotalCodewords(),ne,W.getNumBlocks()),je=new ya;je.setECLevel(s),je.setMode(d),je.setVersion(w);const Me=w.getDimensionForVersion(),Ve=new Tn(Me,Me),mt=this.chooseMaskPattern(pe,s,w,Ve);return je.setMaskPattern(mt),qt.buildMatrix(pe,s,w,mt,Ve),je.setMatrix(Ve),je}static recommendVersion(t,s,n,l){const o=this.calculateBitsNeeded(s,n,l,Lt.getVersionForNumber(1)),d=this.chooseVersion(o,t),h=this.calculateBitsNeeded(s,n,l,d);return this.chooseVersion(h,t)}static calculateBitsNeeded(t,s,n,l){return s.getSize()+t.getCharacterCountBits(l)+n.getSize()}static getAlphanumericCode(t){return t<Ls.ALPHANUMERIC_TABLE.length?Ls.ALPHANUMERIC_TABLE[t]:-1}static chooseMode(t,s=null){if(_.SJIS.getName()===s&&this.isOnlyDoubleByteKanji(t))return Pt.KANJI;let n=!1,l=!1;for(let o=0,d=t.length;o<d;++o){const h=t.charAt(o);if(Ls.isDigit(h))n=!0;else if(this.getAlphanumericCode(h.charCodeAt(0))!==-1)l=!0;else return Pt.BYTE}return l?Pt.ALPHANUMERIC:n?Pt.NUMERIC:Pt.BYTE}static isOnlyDoubleByteKanji(t){let s;try{s=T.encode(t,_.SJIS)}catch{return!1}const n=s.length;if(n%2!==0)return!1;for(let l=0;l<n;l+=2){const o=s[l]&255;if((o<129||o>159)&&(o<224||o>235))return!1}return!0}static chooseMaskPattern(t,s,n,l){let o=Number.MAX_SAFE_INTEGER,d=-1;for(let h=0;h<ya.NUM_MASK_PATTERNS;h++){qt.buildMatrix(t,s,n,h,l);let p=this.calculateMaskPenalty(l);p<o&&(o=p,d=h)}return d}static chooseVersion(t,s){for(let n=1;n<=40;n++){const l=Lt.getVersionForNumber(n);if(Ls.willFit(t,l,s))return l}throw new ks("Data too big")}static willFit(t,s,n){const l=s.getTotalCodewords(),d=s.getECBlocksForLevel(n).getTotalECCodewords(),h=l-d,p=(t+7)/8;return h>=p}static terminateBits(t,s){const n=t*8;if(s.getSize()>n)throw new ks("data bits cannot fit in the QR Code"+s.getSize()+" > "+n);for(let d=0;d<4&&s.getSize()<n;++d)s.appendBit(!1);const l=s.getSize()&7;if(l>0)for(let d=l;d<8;d++)s.appendBit(!1);const o=t-s.getSizeInBytes();for(let d=0;d<o;++d)s.appendBits(d&1?17:236,8);if(s.getSize()!==n)throw new ks("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(t,s,n,l,o,d){if(l>=n)throw new ks("Block ID too large");const h=t%n,p=n-h,w=Math.floor(t/n),S=w+1,P=Math.floor(s/n),W=P+1,ne=w-P,pe=S-W;if(ne!==pe)throw new ks("EC bytes mismatch");if(n!==p+h)throw new ks("RS blocks mismatch");if(t!==(P+ne)*p+(W+pe)*h)throw new ks("Total bytes mismatch");l<p?(o[0]=P,d[0]=ne):(o[0]=W,d[0]=pe)}static interleaveWithECBytes(t,s,n,l){if(t.getSizeInBytes()!==n)throw new ks("Number of bits and data bytes does not match");let o=0,d=0,h=0;const p=new Array;for(let S=0;S<l;++S){const P=new Int32Array(1),W=new Int32Array(1);Ls.getNumDataBytesAndNumECBytesForBlockID(s,n,l,S,P,W);const ne=P[0],pe=new Uint8Array(ne);t.toBytes(8*o,pe,0,ne);const je=Ls.generateECBytes(pe,W[0]);p.push(new ud(pe,je)),d=Math.max(d,ne),h=Math.max(h,je.length),o+=P[0]}if(n!==o)throw new ks("Data bytes does not match offset");const w=new C;for(let S=0;S<d;++S)for(const P of p){const W=P.getDataBytes();S<W.length&&w.appendBits(W[S],8)}for(let S=0;S<h;++S)for(const P of p){const W=P.getErrorCorrectionBytes();S<W.length&&w.appendBits(W[S],8)}if(s!==w.getSizeInBytes())throw new ks("Interleaving error: "+s+" and "+w.getSizeInBytes()+" differ.");return w}static generateECBytes(t,s){const n=t.length,l=new Int32Array(n+s);for(let d=0;d<n;d++)l[d]=t[d]&255;new di(Be.QR_CODE_FIELD_256).encode(l,s);const o=new Uint8Array(s);for(let d=0;d<s;d++)o[d]=l[n+d];return o}static appendModeInfo(t,s){s.appendBits(t.getBits(),4)}static appendLengthInfo(t,s,n,l){const o=n.getCharacterCountBits(s);if(t>=1<<o)throw new ks(t+" is bigger than "+((1<<o)-1));l.appendBits(t,o)}static appendBytes(t,s,n,l){switch(s){case Pt.NUMERIC:Ls.appendNumericBytes(t,n);break;case Pt.ALPHANUMERIC:Ls.appendAlphanumericBytes(t,n);break;case Pt.BYTE:Ls.append8BitBytes(t,n,l);break;case Pt.KANJI:Ls.appendKanjiBytes(t,n);break;default:throw new ks("Invalid mode: "+s)}}static getDigit(t){return t.charCodeAt(0)-48}static isDigit(t){const s=Ls.getDigit(t);return s>=0&&s<=9}static appendNumericBytes(t,s){const n=t.length;let l=0;for(;l<n;){const o=Ls.getDigit(t.charAt(l));if(l+2<n){const d=Ls.getDigit(t.charAt(l+1)),h=Ls.getDigit(t.charAt(l+2));s.appendBits(o*100+d*10+h,10),l+=3}else if(l+1<n){const d=Ls.getDigit(t.charAt(l+1));s.appendBits(o*10+d,7),l+=2}else s.appendBits(o,4),l++}}static appendAlphanumericBytes(t,s){const n=t.length;let l=0;for(;l<n;){const o=Ls.getAlphanumericCode(t.charCodeAt(l));if(o===-1)throw new ks;if(l+1<n){const d=Ls.getAlphanumericCode(t.charCodeAt(l+1));if(d===-1)throw new ks;s.appendBits(o*45+d,11),l+=2}else s.appendBits(o,6),l++}}static append8BitBytes(t,s,n){let l;try{l=T.encode(t,n)}catch(o){throw new ks(o)}for(let o=0,d=l.length;o!==d;o++){const h=l[o];s.appendBits(h,8)}}static appendKanjiBytes(t,s){let n;try{n=T.encode(t,_.SJIS)}catch(o){throw new ks(o)}const l=n.length;for(let o=0;o<l;o+=2){const d=n[o]&255,h=n[o+1]&255,p=d<<8&4294967295|h;let w=-1;if(p>=33088&&p<=40956?w=p-33088:p>=57408&&p<=60351&&(w=p-49472),w===-1)throw new ks("Invalid byte sequence");const S=(w>>8)*192+(w&255);s.appendBits(S,13)}}static appendECI(t,s){s.appendBits(Pt.ECI.getBits(),4),s.appendBits(t.getValue(),8)}}Ls.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),Ls.DEFAULT_BYTE_MODE_ENCODING=_.UTF8.getName();class wa{write(t,s,n,l=null){if(t.length===0)throw new N("Found empty contents");if(s<0||n<0)throw new N("Requested dimensions are too small: "+s+"x"+n);let o=Kt.L,d=wa.QUIET_ZONE_SIZE;l!==null&&(l.get(Qs.ERROR_CORRECTION)!==void 0&&(o=Kt.fromString(l.get(Qs.ERROR_CORRECTION).toString())),l.get(Qs.MARGIN)!==void 0&&(d=Number.parseInt(l.get(Qs.MARGIN).toString(),10)));const h=Ls.encode(t,o,l);return this.renderResult(h,s,n,d)}writeToDom(t,s,n,l,o=null){typeof t=="string"&&(t=document.querySelector(t));const d=this.write(s,n,l,o);t&&t.appendChild(d)}renderResult(t,s,n,l){const o=t.getMatrix();if(o===null)throw new Ze;const d=o.getWidth(),h=o.getHeight(),p=d+l*2,w=h+l*2,S=Math.max(s,p),P=Math.max(n,w),W=Math.min(Math.floor(S/p),Math.floor(P/w)),ne=Math.floor((S-d*W)/2),pe=Math.floor((P-h*W)/2),je=this.createSVGElement(S,P);for(let Me=0,Ve=pe;Me<h;Me++,Ve+=W)for(let mt=0,xt=ne;mt<d;mt++,xt+=W)if(o.get(mt,Me)===1){const ct=this.createSvgRectElement(xt,Ve,W,W);je.appendChild(ct)}return je}createSVGElement(t,s){const n=document.createElementNS(wa.SVG_NS,"svg");return n.setAttributeNS(null,"height",t.toString()),n.setAttributeNS(null,"width",s.toString()),n}createSvgRectElement(t,s,n,l){const o=document.createElementNS(wa.SVG_NS,"rect");return o.setAttributeNS(null,"x",t.toString()),o.setAttributeNS(null,"y",s.toString()),o.setAttributeNS(null,"height",n.toString()),o.setAttributeNS(null,"width",l.toString()),o.setAttributeNS(null,"fill","#000000"),o}}wa.QUIET_ZONE_SIZE=4,wa.SVG_NS="http://www.w3.org/2000/svg";class Ta{encode(t,s,n,l,o){if(t.length===0)throw new N("Found empty contents");if(s!==Ue.QR_CODE)throw new N("Can only encode QR_CODE, but got "+s);if(n<0||l<0)throw new N(`Requested dimensions are too small: ${n}x${l}`);let d=Kt.L,h=Ta.QUIET_ZONE_SIZE;o!==null&&(o.get(Qs.ERROR_CORRECTION)!==void 0&&(d=Kt.fromString(o.get(Qs.ERROR_CORRECTION).toString())),o.get(Qs.MARGIN)!==void 0&&(h=Number.parseInt(o.get(Qs.MARGIN).toString(),10)));const p=Ls.encode(t,d,o);return Ta.renderResult(p,n,l,h)}static renderResult(t,s,n,l){const o=t.getMatrix();if(o===null)throw new Ze;const d=o.getWidth(),h=o.getHeight(),p=d+l*2,w=h+l*2,S=Math.max(s,p),P=Math.max(n,w),W=Math.min(Math.floor(S/p),Math.floor(P/w)),ne=Math.floor((S-d*W)/2),pe=Math.floor((P-h*W)/2),je=new q(S,P);for(let Me=0,Ve=pe;Me<h;Me++,Ve+=W)for(let mt=0,xt=ne;mt<d;mt++,xt+=W)o.get(mt,Me)===1&&je.setRegion(xt,Ve,W,W);return je}}Ta.QUIET_ZONE_SIZE=4;class md{encode(t,s,n,l,o){let d;switch(s){case Ue.QR_CODE:d=new Ta;break;default:throw new N("No encoder available for format "+s)}return d.encode(t,s,n,l,o)}}class Vr extends ge{constructor(t,s,n,l,o,d,h,p){if(super(d,h),this.yuvData=t,this.dataWidth=s,this.dataHeight=n,this.left=l,this.top=o,l+d>s||o+h>n)throw new N("Crop rectangle does not fit within image data.");p&&this.reverseHorizontal(d,h)}getRow(t,s){if(t<0||t>=this.getHeight())throw new N("Requested row is outside the image: "+t);const n=this.getWidth();(s==null||s.length<n)&&(s=new Uint8ClampedArray(n));const l=(t+this.top)*this.dataWidth+this.left;return E.arraycopy(this.yuvData,l,s,0,n),s}getMatrix(){const t=this.getWidth(),s=this.getHeight();if(t===this.dataWidth&&s===this.dataHeight)return this.yuvData;const n=t*s,l=new Uint8ClampedArray(n);let o=this.top*this.dataWidth+this.left;if(t===this.dataWidth)return E.arraycopy(this.yuvData,o,l,0,n),l;for(let d=0;d<s;d++){const h=d*t;E.arraycopy(this.yuvData,o,l,h,t),o+=this.dataWidth}return l}isCropSupported(){return!0}crop(t,s,n,l){return new Vr(this.yuvData,this.dataWidth,this.dataHeight,this.left+t,this.top+s,n,l,!1)}renderThumbnail(){const t=this.getWidth()/Vr.THUMBNAIL_SCALE_FACTOR,s=this.getHeight()/Vr.THUMBNAIL_SCALE_FACTOR,n=new Int32Array(t*s),l=this.yuvData;let o=this.top*this.dataWidth+this.left;for(let d=0;d<s;d++){const h=d*t;for(let p=0;p<t;p++){const w=l[o+p*Vr.THUMBNAIL_SCALE_FACTOR]&255;n[h+p]=4278190080|w*65793}o+=this.dataWidth*Vr.THUMBNAIL_SCALE_FACTOR}return n}getThumbnailWidth(){return this.getWidth()/Vr.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/Vr.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(t,s){const n=this.yuvData;for(let l=0,o=this.top*this.dataWidth+this.left;l<s;l++,o+=this.dataWidth){const d=o+t/2;for(let h=o,p=o+t-1;h<d;h++,p--){const w=n[h];n[h]=n[p],n[p]=w}}}invert(){return new He(this)}}Vr.THUMBNAIL_SCALE_FACTOR=2;class ui extends ge{constructor(t,s,n,l,o,d,h){if(super(s,n),this.dataWidth=l,this.dataHeight=o,this.left=d,this.top=h,t.BYTES_PER_ELEMENT===4){const p=s*n,w=new Uint8ClampedArray(p);for(let S=0;S<p;S++){const P=t[S],W=P>>16&255,ne=P>>7&510,pe=P&255;w[S]=(W+ne+pe)/4&255}this.luminances=w}else this.luminances=t;if(l===void 0&&(this.dataWidth=s),o===void 0&&(this.dataHeight=n),d===void 0&&(this.left=0),h===void 0&&(this.top=0),this.left+s>this.dataWidth||this.top+n>this.dataHeight)throw new N("Crop rectangle does not fit within image data.")}getRow(t,s){if(t<0||t>=this.getHeight())throw new N("Requested row is outside the image: "+t);const n=this.getWidth();(s==null||s.length<n)&&(s=new Uint8ClampedArray(n));const l=(t+this.top)*this.dataWidth+this.left;return E.arraycopy(this.luminances,l,s,0,n),s}getMatrix(){const t=this.getWidth(),s=this.getHeight();if(t===this.dataWidth&&s===this.dataHeight)return this.luminances;const n=t*s,l=new Uint8ClampedArray(n);let o=this.top*this.dataWidth+this.left;if(t===this.dataWidth)return E.arraycopy(this.luminances,o,l,0,n),l;for(let d=0;d<s;d++){const h=d*t;E.arraycopy(this.luminances,o,l,h,t),o+=this.dataWidth}return l}isCropSupported(){return!0}crop(t,s,n,l){return new ui(this.luminances,n,l,this.dataWidth,this.dataHeight,this.left+t,this.top+s)}invert(){return new He(this)}}class El extends _{static forName(t){return this.getCharacterSetECIByName(t)}}class mi{}mi.ISO_8859_1=_.ISO8859_1;class Al{isCompact(){return this.compact}setCompact(t){this.compact=t}getSize(){return this.size}setSize(t){this.size=t}getLayers(){return this.layers}setLayers(t){this.layers=t}getCodeWords(){return this.codeWords}setCodeWords(t){this.codeWords=t}getMatrix(){return this.matrix}setMatrix(t){this.matrix=t}}class kl{static singletonList(t){return[t]}static min(t,s){return t.sort(s)[0]}}class hd{constructor(t){this.previous=t}getPrevious(){return this.previous}}class Ia extends hd{constructor(t,s,n){super(t),this.value=s,this.bitCount=n}appendTo(t,s){t.appendBits(this.value,this.bitCount)}add(t,s){return new Ia(this,t,s)}addBinaryShift(t,s){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new Ia(this,t,s)}toString(){let t=this.value&(1<<this.bitCount)-1;return t|=1<<this.bitCount,"<"+L.toBinaryString(t|1<<this.bitCount).substring(1)+">"}}class hi extends Ia{constructor(t,s,n){super(t,0,0),this.binaryShiftStart=s,this.binaryShiftByteCount=n}appendTo(t,s){for(let n=0;n<this.binaryShiftByteCount;n++)(n===0||n===31&&this.binaryShiftByteCount<=62)&&(t.appendBits(31,5),this.binaryShiftByteCount>62?t.appendBits(this.binaryShiftByteCount-31,16):n===0?t.appendBits(Math.min(this.binaryShiftByteCount,31),5):t.appendBits(this.binaryShiftByteCount-31,5)),t.appendBits(s[this.binaryShiftStart+n],8)}addBinaryShift(t,s){return new hi(this,t,s)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function xd(O,t,s){return new hi(O,t,s)}function en(O,t,s){return new Ia(O,t,s)}const gd=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],oa=0,In=1,Ir=2,Dl=3,Gr=4,fd=new Ia(null,0,0),xi=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,932798]),Int32Array.from([(5<<16)+29,(5<<16)+28,656318,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,656380,656382,656381,0])];function pd(O){for(let t of O)F.fill(t,-1);return O[oa][Gr]=0,O[In][Gr]=0,O[In][oa]=28,O[Dl][Gr]=0,O[Ir][Gr]=0,O[Ir][oa]=15,O}const Tl=pd(F.createInt32Array(6,6));class Hr{constructor(t,s,n,l){this.token=t,this.mode=s,this.binaryShiftByteCount=n,this.bitCount=l}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(t,s){let n=this.bitCount,l=this.token;if(t!==this.mode){let d=xi[this.mode][t];l=en(l,d&65535,d>>16),n+=d>>16}let o=t===Ir?4:5;return l=en(l,s,o),new Hr(l,t,0,n+o)}shiftAndAppend(t,s){let n=this.token,l=this.mode===Ir?4:5;return n=en(n,Tl[this.mode][t],l),n=en(n,s,5),new Hr(n,this.mode,0,this.bitCount+l+5)}addBinaryShiftChar(t){let s=this.token,n=this.mode,l=this.bitCount;if(this.mode===Gr||this.mode===Ir){let h=xi[n][oa];s=en(s,h&65535,h>>16),l+=h>>16,n=oa}let o=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,d=new Hr(s,n,this.binaryShiftByteCount+1,l+o);return d.binaryShiftByteCount===2078&&(d=d.endBinaryShift(t+1)),d}endBinaryShift(t){if(this.binaryShiftByteCount===0)return this;let s=this.token;return s=xd(s,t-this.binaryShiftByteCount,this.binaryShiftByteCount),new Hr(s,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(t){let s=this.bitCount+(xi[this.mode][t.mode]>>16);return this.binaryShiftByteCount<t.binaryShiftByteCount?s+=Hr.calculateBinaryShiftCost(t)-Hr.calculateBinaryShiftCost(this):this.binaryShiftByteCount>t.binaryShiftByteCount&&t.binaryShiftByteCount>0&&(s+=10),s<=t.bitCount}toBitArray(t){let s=[];for(let l=this.endBinaryShift(t.length).token;l!==null;l=l.getPrevious())s.unshift(l);let n=new C;for(const l of s)l.appendTo(n,t);return n}toString(){return z.format("%s bits=%d bytes=%d",gd[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(t){return t.binaryShiftByteCount>62?21:t.binaryShiftByteCount>31?20:t.binaryShiftByteCount>0?10:0}}Hr.INITIAL_STATE=new Hr(fd,oa,0,0);function bd(O){const t=z.getCharCode(" "),s=z.getCharCode("."),n=z.getCharCode(",");O[oa][t]=1;const l=z.getCharCode("Z"),o=z.getCharCode("A");for(let W=o;W<=l;W++)O[oa][W]=W-o+2;O[In][t]=1;const d=z.getCharCode("z"),h=z.getCharCode("a");for(let W=h;W<=d;W++)O[In][W]=W-h+2;O[Ir][t]=1;const p=z.getCharCode("9"),w=z.getCharCode("0");for(let W=w;W<=p;W++)O[Ir][W]=W-w+2;O[Ir][n]=12,O[Ir][s]=13;const S=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let W=0;W<S.length;W++)O[Dl][z.getCharCode(S[W])]=W;const P=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let W=0;W<P.length;W++)z.getCharCode(P[W])>0&&(O[Gr][z.getCharCode(P[W])]=W);return O}const gi=bd(F.createInt32Array(5,256));class tn{constructor(t){this.text=t}encode(){const t=z.getCharCode(" "),s=z.getCharCode(`
`);let n=kl.singletonList(Hr.INITIAL_STATE);for(let o=0;o<this.text.length;o++){let d,h=o+1<this.text.length?this.text[o+1]:0;switch(this.text[o]){case z.getCharCode("\r"):d=h===s?2:0;break;case z.getCharCode("."):d=h===t?3:0;break;case z.getCharCode(","):d=h===t?4:0;break;case z.getCharCode(":"):d=h===t?5:0;break;default:d=0}d>0?(n=tn.updateStateListForPair(n,o,d),o++):n=this.updateStateListForChar(n,o)}return kl.min(n,(o,d)=>o.getBitCount()-d.getBitCount()).toBitArray(this.text)}updateStateListForChar(t,s){const n=[];for(let l of t)this.updateStateForChar(l,s,n);return tn.simplifyStates(n)}updateStateForChar(t,s,n){let l=this.text[s]&255,o=gi[t.getMode()][l]>0,d=null;for(let h=0;h<=Gr;h++){let p=gi[h][l];if(p>0){if(d==null&&(d=t.endBinaryShift(s)),!o||h===t.getMode()||h===Ir){const w=d.latchAndAppend(h,p);n.push(w)}if(!o&&Tl[t.getMode()][h]>=0){const w=d.shiftAndAppend(h,p);n.push(w)}}}if(t.getBinaryShiftByteCount()>0||gi[t.getMode()][l]===0){let h=t.addBinaryShiftChar(s);n.push(h)}}static updateStateListForPair(t,s,n){const l=[];for(let o of t)this.updateStateForPair(o,s,n,l);return this.simplifyStates(l)}static updateStateForPair(t,s,n,l){let o=t.endBinaryShift(s);if(l.push(o.latchAndAppend(Gr,n)),t.getMode()!==Gr&&l.push(o.shiftAndAppend(Gr,n)),n===3||n===4){let d=o.latchAndAppend(Ir,16-n).latchAndAppend(Ir,1);l.push(d)}if(t.getBinaryShiftByteCount()>0){let d=t.addBinaryShiftChar(s).addBinaryShiftChar(s+1);l.push(d)}}static simplifyStates(t){let s=[];for(const n of t){let l=!0;for(const o of s){if(o.isBetterThanOrEqualTo(n)){l=!1;break}n.isBetterThanOrEqualTo(o)&&(s=s.filter(d=>d!==o))}l&&s.push(n)}return s}}class ps{constructor(){}static encodeBytes(t){return ps.encode(t,ps.DEFAULT_EC_PERCENT,ps.DEFAULT_AZTEC_LAYERS)}static encode(t,s,n){let l=new tn(t).encode(),o=L.truncDivision(l.getSize()*s,100)+11,d=l.getSize()+o,h,p,w,S,P;if(n!==ps.DEFAULT_AZTEC_LAYERS){if(h=n<0,p=Math.abs(n),p>(h?ps.MAX_NB_BITS_COMPACT:ps.MAX_NB_BITS))throw new N(z.format("Illegal value %s for layers",n));w=ps.totalBitsInLayer(p,h),S=ps.WORD_SIZE[p];let ct=w-w%S;if(P=ps.stuffBits(l,S),P.getSize()+o>ct)throw new N("Data to large for user specified layer");if(h&&P.getSize()>S*64)throw new N("Data to large for user specified layer")}else{S=0,P=null;for(let ct=0;;ct++){if(ct>ps.MAX_NB_BITS)throw new N("Data too large for an Aztec code");if(h=ct<=3,p=h?ct+1:ct,w=ps.totalBitsInLayer(p,h),d>w)continue;(P==null||S!==ps.WORD_SIZE[p])&&(S=ps.WORD_SIZE[p],P=ps.stuffBits(l,S));let ls=w-w%S;if(!(h&&P.getSize()>S*64)&&P.getSize()+o<=ls)break}}let W=ps.generateCheckWords(P,w,S),ne=P.getSize()/S,pe=ps.generateModeMessage(h,p,ne),je=(h?11:14)+p*4,Me=new Int32Array(je),Ve;if(h){Ve=je;for(let ct=0;ct<Me.length;ct++)Me[ct]=ct}else{Ve=je+1+2*L.truncDivision(L.truncDivision(je,2)-1,15);let ct=L.truncDivision(je,2),ls=L.truncDivision(Ve,2);for(let Zt=0;Zt<ct;Zt++){let wr=Zt+L.truncDivision(Zt,15);Me[ct-Zt-1]=ls-wr-1,Me[ct+Zt]=ls+wr+1}}let mt=new q(Ve);for(let ct=0,ls=0;ct<p;ct++){let Zt=(p-ct)*4+(h?9:12);for(let wr=0;wr<Zt;wr++){let Or=wr*2;for(let jr=0;jr<2;jr++)W.get(ls+Or+jr)&&mt.set(Me[ct*2+jr],Me[ct*2+wr]),W.get(ls+Zt*2+Or+jr)&&mt.set(Me[ct*2+wr],Me[je-1-ct*2-jr]),W.get(ls+Zt*4+Or+jr)&&mt.set(Me[je-1-ct*2-jr],Me[je-1-ct*2-wr]),W.get(ls+Zt*6+Or+jr)&&mt.set(Me[je-1-ct*2-wr],Me[ct*2+jr])}ls+=Zt*8}if(ps.drawModeMessage(mt,h,Ve,pe),h)ps.drawBullsEye(mt,L.truncDivision(Ve,2),5);else{ps.drawBullsEye(mt,L.truncDivision(Ve,2),7);for(let ct=0,ls=0;ct<L.truncDivision(je,2)-1;ct+=15,ls+=16)for(let Zt=L.truncDivision(Ve,2)&1;Zt<Ve;Zt+=2)mt.set(L.truncDivision(Ve,2)-ls,Zt),mt.set(L.truncDivision(Ve,2)+ls,Zt),mt.set(Zt,L.truncDivision(Ve,2)-ls),mt.set(Zt,L.truncDivision(Ve,2)+ls)}let xt=new Al;return xt.setCompact(h),xt.setSize(Ve),xt.setLayers(p),xt.setCodeWords(ne),xt.setMatrix(mt),xt}static drawBullsEye(t,s,n){for(let l=0;l<n;l+=2)for(let o=s-l;o<=s+l;o++)t.set(o,s-l),t.set(o,s+l),t.set(s-l,o),t.set(s+l,o);t.set(s-n,s-n),t.set(s-n+1,s-n),t.set(s-n,s-n+1),t.set(s+n,s-n),t.set(s+n,s-n+1),t.set(s+n,s+n-1)}static generateModeMessage(t,s,n){let l=new C;return t?(l.appendBits(s-1,2),l.appendBits(n-1,6),l=ps.generateCheckWords(l,28,4)):(l.appendBits(s-1,5),l.appendBits(n-1,11),l=ps.generateCheckWords(l,40,4)),l}static drawModeMessage(t,s,n,l){let o=L.truncDivision(n,2);if(s)for(let d=0;d<7;d++){let h=o-3+d;l.get(d)&&t.set(h,o-5),l.get(d+7)&&t.set(o+5,h),l.get(20-d)&&t.set(h,o+5),l.get(27-d)&&t.set(o-5,h)}else for(let d=0;d<10;d++){let h=o-5+d+L.truncDivision(d,5);l.get(d)&&t.set(h,o-7),l.get(d+10)&&t.set(o+7,h),l.get(29-d)&&t.set(h,o+7),l.get(39-d)&&t.set(o-7,h)}}static generateCheckWords(t,s,n){let l=t.getSize()/n,o=new di(ps.getGF(n)),d=L.truncDivision(s,n),h=ps.bitsToWords(t,n,d);o.encode(h,d-l);let p=s%n,w=new C;w.appendBits(0,p);for(const S of Array.from(h))w.appendBits(S,n);return w}static bitsToWords(t,s,n){let l=new Int32Array(n),o,d;for(o=0,d=t.getSize()/s;o<d;o++){let h=0;for(let p=0;p<s;p++)h|=t.get(o*s+p)?1<<s-p-1:0;l[o]=h}return l}static getGF(t){switch(t){case 4:return Be.AZTEC_PARAM;case 6:return Be.AZTEC_DATA_6;case 8:return Be.AZTEC_DATA_8;case 10:return Be.AZTEC_DATA_10;case 12:return Be.AZTEC_DATA_12;default:throw new N("Unsupported word size "+t)}}static stuffBits(t,s){let n=new C,l=t.getSize(),o=(1<<s)-2;for(let d=0;d<l;d+=s){let h=0;for(let p=0;p<s;p++)(d+p>=l||t.get(d+p))&&(h|=1<<s-1-p);(h&o)===o?(n.appendBits(h&o,s),d--):h&o?n.appendBits(h,s):(n.appendBits(h|1,s),d--)}return n}static totalBitsInLayer(t,s){return((s?88:112)+16*t)*t}}ps.DEFAULT_EC_PERCENT=33,ps.DEFAULT_AZTEC_LAYERS=0,ps.MAX_NB_BITS=32,ps.MAX_NB_BITS_COMPACT=4,ps.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class Mn{encode(t,s,n,l){return this.encodeWithHints(t,s,n,l,null)}encodeWithHints(t,s,n,l,o){let d=mi.ISO_8859_1,h=ps.DEFAULT_EC_PERCENT,p=ps.DEFAULT_AZTEC_LAYERS;return o!=null&&(o.has(Qs.CHARACTER_SET)&&(d=El.forName(o.get(Qs.CHARACTER_SET).toString())),o.has(Qs.ERROR_CORRECTION)&&(h=L.parseInt(o.get(Qs.ERROR_CORRECTION).toString())),o.has(Qs.AZTEC_LAYERS)&&(p=L.parseInt(o.get(Qs.AZTEC_LAYERS).toString()))),Mn.encodeLayers(t,s,n,l,d,h,p)}static encodeLayers(t,s,n,l,o,d,h){if(s!==Ue.AZTEC)throw new N("Can only encode AZTEC, but got "+s);let p=ps.encode(z.getBytes(t,o),d,h);return Mn.renderResult(p,n,l)}static renderResult(t,s,n){let l=t.getMatrix();if(l==null)throw new Ze;let o=l.getWidth(),d=l.getHeight(),h=Math.max(s,o),p=Math.max(n,d),w=Math.min(h/o,p/d),S=(h-o*w)/2,P=(p-d*w)/2,W=new q(h,p);for(let ne=0,pe=P;ne<d;ne++,pe+=w)for(let je=0,Me=S;je<o;je++,Me+=w)l.get(je,ne)&&W.setRegion(Me,pe,w,w);return W}}i.AbstractExpandedDecoder=lt,i.ArgumentException=y,i.ArithmeticException=Xe,i.AztecCode=Al,i.AztecCodeReader=Se,i.AztecCodeWriter=Mn,i.AztecDecoder=be,i.AztecDetector=ht,i.AztecDetectorResult=Ke,i.AztecEncoder=ps,i.AztecHighLevelEncoder=tn,i.AztecPoint=Rt,i.BarcodeFormat=Ue,i.Binarizer=k,i.BinaryBitmap=I,i.BitArray=C,i.BitMatrix=q,i.BitSource=Ie,i.BrowserAztecCodeReader=ve,i.BrowserBarcodeReader=_t,i.BrowserCodeReader=ye,i.BrowserDatamatrixCodeReader=Bt,i.BrowserMultiFormatReader=od,i.BrowserPDF417Reader=cd,i.BrowserQRCodeReader=dd,i.BrowserQRCodeSvgWriter=wa,i.CharacterSetECI=_,i.ChecksumException=R,i.Code128Reader=me,i.Code39Reader=Ae,i.DataMatrixDecodedBitStreamParser=ft,i.DataMatrixReader=Fe,i.DecodeHintType=Y,i.DecoderResult=ut,i.DefaultGridSampler=Qe,i.DetectorResult=ke,i.EAN13Reader=ss,i.EncodeHintType=Qs,i.Exception=f,i.FormatException=A,i.GenericGF=Be,i.GenericGFPoly=Oe,i.GlobalHistogramBinarizer=J,i.GridSampler=Ne,i.GridSamplerInstance=vt,i.HTMLCanvasElementLuminanceSource=B,i.HybridBinarizer=V,i.ITFReader=it,i.IllegalArgumentException=N,i.IllegalStateException=Ze,i.InvertedLuminanceSource=He,i.LuminanceSource=ge,i.MathUtils=ue,i.MultiFormatOneDReader=Je,i.MultiFormatReader=_l,i.MultiFormatWriter=md,i.NotFoundException=H,i.OneDReader=de,i.PDF417DecodedBitStreamParser=qe,i.PDF417DecoderErrorCorrection=Rs,i.PDF417Reader=lr,i.PDF417ResultMetadata=Nl,i.PerspectiveTransform=Te,i.PlanarYUVLuminanceSource=Vr,i.QRCodeByteMatrix=Tn,i.QRCodeDataMask=ir,i.QRCodeDecodedBitStreamParser=Ms,i.QRCodeDecoderErrorCorrectionLevel=Kt,i.QRCodeDecoderFormatInformation=Mt,i.QRCodeEncoder=Ls,i.QRCodeEncoderQRCode=ya,i.QRCodeMaskUtil=qs,i.QRCodeMatrixUtil=qt,i.QRCodeMode=Pt,i.QRCodeReader=qr,i.QRCodeVersion=Lt,i.QRCodeWriter=Ta,i.RGBLuminanceSource=ui,i.RSS14Reader=ce,i.RSSExpandedReader=We,i.ReaderException=Dn,i.ReedSolomonDecoder=$e,i.ReedSolomonEncoder=di,i.ReedSolomonException=Ce,i.Result=Q,i.ResultMetadataType=Re,i.ResultPoint=ae,i.StringUtils=z,i.UnsupportedOperationException=D,i.VideoInputDevice=fe,i.WhiteRectangleDetector=le,i.WriterException=ks,i.ZXingArrays=F,i.ZXingCharset=El,i.ZXingInteger=L,i.ZXingStandardCharsets=mi,i.ZXingStringBuilder=se,i.ZXingStringEncoding=T,i.ZXingSystem=E,i.createAbstractExpandedDecoder=Xt,Object.defineProperty(i,"__esModule",{value:!0})})})($i,$i.exports);var Os=$i.exports;const i0=Sd(Os),l0=tu({__proto__:null,default:i0},[Os]);var oo=function(){function r(a,i,c){if(this.formatMap=new Map([[At.QR_CODE,Os.BarcodeFormat.QR_CODE],[At.AZTEC,Os.BarcodeFormat.AZTEC],[At.CODABAR,Os.BarcodeFormat.CODABAR],[At.CODE_39,Os.BarcodeFormat.CODE_39],[At.CODE_93,Os.BarcodeFormat.CODE_93],[At.CODE_128,Os.BarcodeFormat.CODE_128],[At.DATA_MATRIX,Os.BarcodeFormat.DATA_MATRIX],[At.MAXICODE,Os.BarcodeFormat.MAXICODE],[At.ITF,Os.BarcodeFormat.ITF],[At.EAN_13,Os.BarcodeFormat.EAN_13],[At.EAN_8,Os.BarcodeFormat.EAN_8],[At.PDF_417,Os.BarcodeFormat.PDF_417],[At.RSS_14,Os.BarcodeFormat.RSS_14],[At.RSS_EXPANDED,Os.BarcodeFormat.RSS_EXPANDED],[At.UPC_A,Os.BarcodeFormat.UPC_A],[At.UPC_E,Os.BarcodeFormat.UPC_E],[At.UPC_EAN_EXTENSION,Os.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!l0)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=i,this.logger=c;var m=this.createZXingFormats(a),u=new Map;u.set(Os.DecodeHintType.POSSIBLE_FORMATS,m),u.set(Os.DecodeHintType.TRY_HARDER,!1),this.hints=u}return r.prototype.decodeAsync=function(a){var i=this;return new Promise(function(c,m){try{c(i.decode(a))}catch(u){m(u)}})},r.prototype.decode=function(a){var i=new Os.MultiFormatReader(this.verbose,this.hints),c=new Os.HTMLCanvasElementLuminanceSource(a),m=new Os.BinaryBitmap(new Os.HybridBinarizer(c)),u=i.decode(m);return{text:u.text,format:Cc.create(this.toHtml5QrcodeSupportedFormats(u.format)),debugData:this.createDebugData()}},r.prototype.createReverseFormatMap=function(){var a=new Map;return this.formatMap.forEach(function(i,c,m){a.set(i,c)}),a},r.prototype.toHtml5QrcodeSupportedFormats=function(a){if(!this.reverseFormatMap.has(a))throw"reverseFormatMap doesn't have ".concat(a);return this.reverseFormatMap.get(a)},r.prototype.createZXingFormats=function(a){for(var i=[],c=0,m=a;c<m.length;c++){var u=m[c];this.formatMap.has(u)?i.push(this.formatMap.get(u)):this.logger.logError("".concat(u," is not supported by")+"ZXingHtml5QrcodeShim")}return i},r.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},r}(),o0=function(r,a,i,c){function m(u){return u instanceof i?u:new i(function(x){x(u)})}return new(i||(i=Promise))(function(u,x){function j(y){try{f(c.next(y))}catch(N){x(N)}}function b(y){try{f(c.throw(y))}catch(N){x(N)}}function f(y){y.done?u(y.value):m(y.value).then(j,b)}f((c=c.apply(r,a||[])).next())})},c0=function(r,a){var i={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},c,m,u,x;return x={next:j(0),throw:j(1),return:j(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function j(f){return function(y){return b([f,y])}}function b(f){if(c)throw new TypeError("Generator is already executing.");for(;x&&(x=0,f[0]&&(i=0)),i;)try{if(c=1,m&&(u=f[0]&2?m.return:f[0]?m.throw||((u=m.return)&&u.call(m),0):m.next)&&!(u=u.call(m,f[1])).done)return u;switch(m=0,u&&(f=[f[0]&2,u.value]),f[0]){case 0:case 1:u=f;break;case 4:return i.label++,{value:f[1],done:!1};case 5:i.label++,m=f[1],f=[0];continue;case 7:f=i.ops.pop(),i.trys.pop();continue;default:if(u=i.trys,!(u=u.length>0&&u[u.length-1])&&(f[0]===6||f[0]===2)){i=0;continue}if(f[0]===3&&(!u||f[1]>u[0]&&f[1]<u[3])){i.label=f[1];break}if(f[0]===6&&i.label<u[1]){i.label=u[1],u=f;break}if(u&&i.label<u[2]){i.label=u[2],i.ops.push(f);break}u[2]&&i.ops.pop(),i.trys.pop();continue}f=a.call(r,i)}catch(y){f=[6,y],m=0}finally{c=u=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}},co=function(){function r(a,i,c){if(this.formatMap=new Map([[At.QR_CODE,"qr_code"],[At.AZTEC,"aztec"],[At.CODABAR,"codabar"],[At.CODE_39,"code_39"],[At.CODE_93,"code_93"],[At.CODE_128,"code_128"],[At.DATA_MATRIX,"data_matrix"],[At.ITF,"itf"],[At.EAN_13,"ean_13"],[At.EAN_8,"ean_8"],[At.PDF_417,"pdf417"],[At.UPC_A,"upc_a"],[At.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!r.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=i,this.logger=c;var m=this.createBarcodeDetectorFormats(a);if(this.detector=new BarcodeDetector(m),!this.detector)throw"BarcodeDetector detector not supported"}return r.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var a=new BarcodeDetector({formats:["qr_code"]});return typeof a<"u"},r.prototype.decodeAsync=function(a){return o0(this,void 0,void 0,function(){var i,c;return c0(this,function(m){switch(m.label){case 0:return[4,this.detector.detect(a)];case 1:if(i=m.sent(),!i||i.length===0)throw"No barcode or QR code detected.";return c=this.selectLargestBarcode(i),[2,{text:c.rawValue,format:Cc.create(this.toHtml5QrcodeSupportedFormats(c.format)),debugData:this.createDebugData()}]}})})},r.prototype.selectLargestBarcode=function(a){for(var i=null,c=0,m=0,u=a;m<u.length;m++){var x=u[m],j=x.boundingBox.width*x.boundingBox.height;j>c&&(c=j,i=x)}if(!i)throw"No largest barcode found";return i},r.prototype.createBarcodeDetectorFormats=function(a){for(var i=[],c=0,m=a;c<m.length;c++){var u=m[c];this.formatMap.has(u)?i.push(this.formatMap.get(u)):this.logger.warn("".concat(u," is not supported by")+"BarcodeDetectorDelegate")}return{formats:i}},r.prototype.toHtml5QrcodeSupportedFormats=function(a){if(!this.reverseFormatMap.has(a))throw"reverseFormatMap doesn't have ".concat(a);return this.reverseFormatMap.get(a)},r.prototype.createReverseFormatMap=function(){var a=new Map;return this.formatMap.forEach(function(i,c,m){a.set(i,c)}),a},r.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},r}(),uo=function(r,a,i,c){function m(u){return u instanceof i?u:new i(function(x){x(u)})}return new(i||(i=Promise))(function(u,x){function j(y){try{f(c.next(y))}catch(N){x(N)}}function b(y){try{f(c.throw(y))}catch(N){x(N)}}function f(y){y.done?u(y.value):m(y.value).then(j,b)}f((c=c.apply(r,a||[])).next())})},mo=function(r,a){var i={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},c,m,u,x;return x={next:j(0),throw:j(1),return:j(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function j(f){return function(y){return b([f,y])}}function b(f){if(c)throw new TypeError("Generator is already executing.");for(;x&&(x=0,f[0]&&(i=0)),i;)try{if(c=1,m&&(u=f[0]&2?m.return:f[0]?m.throw||((u=m.return)&&u.call(m),0):m.next)&&!(u=u.call(m,f[1])).done)return u;switch(m=0,u&&(f=[f[0]&2,u.value]),f[0]){case 0:case 1:u=f;break;case 4:return i.label++,{value:f[1],done:!1};case 5:i.label++,m=f[1],f=[0];continue;case 7:f=i.ops.pop(),i.trys.pop();continue;default:if(u=i.trys,!(u=u.length>0&&u[u.length-1])&&(f[0]===6||f[0]===2)){i=0;continue}if(f[0]===3&&(!u||f[1]>u[0]&&f[1]<u[3])){i.label=f[1];break}if(f[0]===6&&i.label<u[1]){i.label=u[1],u=f;break}if(u&&i.label<u[2]){i.label=u[2],i.ops.push(f);break}u[2]&&i.ops.pop(),i.trys.pop();continue}f=a.call(r,i)}catch(y){f=[6,y],m=0}finally{c=u=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}},d0=function(){function r(a,i,c,m){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=c,i&&co.isSupported()?(this.primaryDecoder=new co(a,c,m),this.secondaryDecoder=new oo(a,c,m)):this.primaryDecoder=new oo(a,c,m)}return r.prototype.decodeAsync=function(a){return uo(this,void 0,void 0,function(){var i;return mo(this,function(c){switch(c.label){case 0:i=performance.now(),c.label=1;case 1:return c.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(a)];case 2:return[2,c.sent()];case 3:return this.possiblyLogPerformance(i),[7];case 4:return[2]}})})},r.prototype.decodeRobustlyAsync=function(a){return uo(this,void 0,void 0,function(){var i,c;return mo(this,function(m){switch(m.label){case 0:i=performance.now(),m.label=1;case 1:return m.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(a)];case 2:return[2,m.sent()];case 3:if(c=m.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(a)];throw c;case 4:return this.possiblyLogPerformance(i),[7];case 5:return[2]}})})},r.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},r.prototype.possiblyLogPerformance=function(a){if(this.verbose){var i=performance.now()-a;this.executionResults.push(i),this.executions++,this.possiblyFlushPerformanceReport()}},r.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var a=0,i=0,c=this.executionResults;i<c.length;i++){var m=c[i];a+=m}var u=a/this.executionResults.length;console.log("".concat(u," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},r}(),ml=function(){var r=function(a,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,m){c.__proto__=m}||function(c,m){for(var u in m)Object.prototype.hasOwnProperty.call(m,u)&&(c[u]=m[u])},r(a,i)};return function(a,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");r(a,i);function c(){this.constructor=a}a.prototype=i===null?Object.create(i):(c.prototype=i.prototype,new c)}}(),Kn=function(r,a,i,c){function m(u){return u instanceof i?u:new i(function(x){x(u)})}return new(i||(i=Promise))(function(u,x){function j(y){try{f(c.next(y))}catch(N){x(N)}}function b(y){try{f(c.throw(y))}catch(N){x(N)}}function f(y){y.done?u(y.value):m(y.value).then(j,b)}f((c=c.apply(r,a||[])).next())})},Zn=function(r,a){var i={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},c,m,u,x;return x={next:j(0),throw:j(1),return:j(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function j(f){return function(y){return b([f,y])}}function b(f){if(c)throw new TypeError("Generator is already executing.");for(;x&&(x=0,f[0]&&(i=0)),i;)try{if(c=1,m&&(u=f[0]&2?m.return:f[0]?m.throw||((u=m.return)&&u.call(m),0):m.next)&&!(u=u.call(m,f[1])).done)return u;switch(m=0,u&&(f=[f[0]&2,u.value]),f[0]){case 0:case 1:u=f;break;case 4:return i.label++,{value:f[1],done:!1};case 5:i.label++,m=f[1],f=[0];continue;case 7:f=i.ops.pop(),i.trys.pop();continue;default:if(u=i.trys,!(u=u.length>0&&u[u.length-1])&&(f[0]===6||f[0]===2)){i=0;continue}if(f[0]===3&&(!u||f[1]>u[0]&&f[1]<u[3])){i.label=f[1];break}if(f[0]===6&&i.label<u[1]){i.label=u[1],u=f;break}if(u&&i.label<u[2]){i.label=u[2],i.ops.push(f);break}u[2]&&i.ops.pop(),i.trys.pop();continue}f=a.call(r,i)}catch(y){f=[6,y],m=0}finally{c=u=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}},Ac=function(){function r(a,i){this.name=a,this.track=i}return r.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},r.prototype.apply=function(a){var i={};i[this.name]=a;var c={advanced:[i]};return this.track.applyConstraints(c)},r.prototype.value=function(){var a=this.track.getSettings();if(this.name in a){var i=a[this.name];return i}return null},r}(),u0=function(r){ml(a,r);function a(i,c){return r.call(this,i,c)||this}return a.prototype.min=function(){return this.getCapabilities().min},a.prototype.max=function(){return this.getCapabilities().max},a.prototype.step=function(){return this.getCapabilities().step},a.prototype.apply=function(i){var c={};c[this.name]=i;var m={advanced:[c]};return this.track.applyConstraints(m)},a.prototype.getCapabilities=function(){this.failIfNotSupported();var i=this.track.getCapabilities(),c=i[this.name];return{min:c.min,max:c.max,step:c.step}},a.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},a}(Ac),m0=function(r){ml(a,r);function a(i){return r.call(this,"zoom",i)||this}return a}(u0),h0=function(r){ml(a,r);function a(i){return r.call(this,"torch",i)||this}return a}(Ac),x0=function(){function r(a){this.track=a}return r.prototype.zoomFeature=function(){return new m0(this.track)},r.prototype.torchFeature=function(){return new h0(this.track)},r}(),g0=function(){function r(a,i,c){this.isClosed=!1,this.parentElement=a,this.mediaStream=i,this.callbacks=c,this.surface=this.createVideoElement(this.parentElement.clientWidth),a.append(this.surface)}return r.prototype.createVideoElement=function(a){var i=document.createElement("video");return i.style.width="".concat(a,"px"),i.style.display="block",i.muted=!0,i.setAttribute("muted","true"),i.playsInline=!0,i},r.prototype.setupSurface=function(){var a=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var i=function(){var c=a.surface.clientWidth,m=a.surface.clientHeight;a.callbacks.onRenderSurfaceReady(c,m),a.surface.removeEventListener("playing",i)};this.surface.addEventListener("playing",i),this.surface.srcObject=this.mediaStream,this.surface.play()},r.create=function(a,i,c,m){return Kn(this,void 0,void 0,function(){var u,x;return Zn(this,function(j){switch(j.label){case 0:return u=new r(a,i,m),c.aspectRatio?(x={aspectRatio:c.aspectRatio},[4,u.getFirstTrackOrFail().applyConstraints(x)]):[3,2];case 1:j.sent(),j.label=2;case 2:return u.setupSurface(),[2,u]}})})},r.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},r.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},r.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},r.prototype.resume=function(a){this.failIfClosed();var i=this,c=function(){setTimeout(a,200),i.surface.removeEventListener("playing",c)};this.surface.addEventListener("playing",c),this.surface.play()},r.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},r.prototype.getSurface=function(){return this.failIfClosed(),this.surface},r.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},r.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},r.prototype.applyVideoConstraints=function(a){return Kn(this,void 0,void 0,function(){return Zn(this,function(i){if("aspectRatio"in a)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(a)]})})},r.prototype.close=function(){if(this.isClosed)return Promise.resolve();var a=this;return new Promise(function(i,c){var m=a.mediaStream.getVideoTracks(),u=m.length,x=0;a.mediaStream.getVideoTracks().forEach(function(j){a.mediaStream.removeTrack(j),j.stop(),++x,x>=u&&(a.isClosed=!0,a.parentElement.removeChild(a.surface),i())})})},r.prototype.getCapabilities=function(){return new x0(this.getFirstTrackOrFail())},r}(),f0=function(){function r(a){this.mediaStream=a}return r.prototype.render=function(a,i,c){return Kn(this,void 0,void 0,function(){return Zn(this,function(m){return[2,g0.create(a,this.mediaStream,i,c)]})})},r.create=function(a){return Kn(this,void 0,void 0,function(){var i,c;return Zn(this,function(m){switch(m.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return i={audio:!1,video:a},[4,navigator.mediaDevices.getUserMedia(i)];case 1:return c=m.sent(),[2,new r(c)]}})})},r}(),ho=function(r,a,i,c){function m(u){return u instanceof i?u:new i(function(x){x(u)})}return new(i||(i=Promise))(function(u,x){function j(y){try{f(c.next(y))}catch(N){x(N)}}function b(y){try{f(c.throw(y))}catch(N){x(N)}}function f(y){y.done?u(y.value):m(y.value).then(j,b)}f((c=c.apply(r,a||[])).next())})},xo=function(r,a){var i={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},c,m,u,x;return x={next:j(0),throw:j(1),return:j(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function j(f){return function(y){return b([f,y])}}function b(f){if(c)throw new TypeError("Generator is already executing.");for(;x&&(x=0,f[0]&&(i=0)),i;)try{if(c=1,m&&(u=f[0]&2?m.return:f[0]?m.throw||((u=m.return)&&u.call(m),0):m.next)&&!(u=u.call(m,f[1])).done)return u;switch(m=0,u&&(f=[f[0]&2,u.value]),f[0]){case 0:case 1:u=f;break;case 4:return i.label++,{value:f[1],done:!1};case 5:i.label++,m=f[1],f=[0];continue;case 7:f=i.ops.pop(),i.trys.pop();continue;default:if(u=i.trys,!(u=u.length>0&&u[u.length-1])&&(f[0]===6||f[0]===2)){i=0;continue}if(f[0]===3&&(!u||f[1]>u[0]&&f[1]<u[3])){i.label=f[1];break}if(f[0]===6&&i.label<u[1]){i.label=u[1],u=f;break}if(u&&i.label<u[2]){i.label=u[2],i.ops.push(f);break}u[2]&&i.ops.pop(),i.trys.pop();continue}f=a.call(r,i)}catch(y){f=[6,y],m=0}finally{c=u=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}},p0=function(){function r(){}return r.failIfNotSupported=function(){return ho(this,void 0,void 0,function(){return xo(this,function(a){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new r]})})},r.prototype.create=function(a){return ho(this,void 0,void 0,function(){return xo(this,function(i){return[2,f0.create(a)]})})},r}(),b0=function(r,a,i,c){function m(u){return u instanceof i?u:new i(function(x){x(u)})}return new(i||(i=Promise))(function(u,x){function j(y){try{f(c.next(y))}catch(N){x(N)}}function b(y){try{f(c.throw(y))}catch(N){x(N)}}function f(y){y.done?u(y.value):m(y.value).then(j,b)}f((c=c.apply(r,a||[])).next())})},y0=function(r,a){var i={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},c,m,u,x;return x={next:j(0),throw:j(1),return:j(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function j(f){return function(y){return b([f,y])}}function b(f){if(c)throw new TypeError("Generator is already executing.");for(;x&&(x=0,f[0]&&(i=0)),i;)try{if(c=1,m&&(u=f[0]&2?m.return:f[0]?m.throw||((u=m.return)&&u.call(m),0):m.next)&&!(u=u.call(m,f[1])).done)return u;switch(m=0,u&&(f=[f[0]&2,u.value]),f[0]){case 0:case 1:u=f;break;case 4:return i.label++,{value:f[1],done:!1};case 5:i.label++,m=f[1],f=[0];continue;case 7:f=i.ops.pop(),i.trys.pop();continue;default:if(u=i.trys,!(u=u.length>0&&u[u.length-1])&&(f[0]===6||f[0]===2)){i=0;continue}if(f[0]===3&&(!u||f[1]>u[0]&&f[1]<u[3])){i.label=f[1];break}if(f[0]===6&&i.label<u[1]){i.label=u[1],u=f;break}if(u&&i.label<u[2]){i.label=u[2],i.ops.push(f);break}u[2]&&i.ops.pop(),i.trys.pop();continue}f=a.call(r,i)}catch(y){f=[6,y],m=0}finally{c=u=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}},w0=function(){function r(){}return r.retrieve=function(){if(navigator.mediaDevices)return r.getCamerasFromMediaDevices();var a=MediaStreamTrack;return MediaStreamTrack&&a.getSources?r.getCamerasFromMediaStreamTrack():r.rejectWithError()},r.rejectWithError=function(){var a=Ba.unableToQuerySupportedDevices();return r.isHttpsOrLocalhost()||(a=Ba.insecureContextCameraQueryError()),Promise.reject(a)},r.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var a=location.host.split(":")[0];return a==="127.0.0.1"||a==="localhost"},r.getCamerasFromMediaDevices=function(){return b0(this,void 0,void 0,function(){var a,i,c,m,u,x,j;return y0(this,function(b){switch(b.label){case 0:return a=function(f){for(var y=f.getVideoTracks(),N=0,I=y;N<I.length;N++){var R=I[N];R.enabled=!1,R.stop(),f.removeTrack(R)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return i=b.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(c=b.sent(),m=[],u=0,x=c;u<x.length;u++)j=x[u],j.kind==="videoinput"&&m.push({id:j.deviceId,label:j.label});return a(i),[2,m]}})})},r.getCamerasFromMediaStreamTrack=function(){return new Promise(function(a,i){var c=function(u){for(var x=[],j=0,b=u;j<b.length;j++){var f=b[j];f.kind==="video"&&x.push({id:f.id,label:f.label})}a(x)},m=MediaStreamTrack;m.getSources(c)})},r}(),Vs;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.NOT_STARTED=1]="NOT_STARTED",r[r.SCANNING=2]="SCANNING",r[r.PAUSED=3]="PAUSED"})(Vs||(Vs={}));var j0=function(){function r(){this.state=Vs.NOT_STARTED,this.onGoingTransactionNewState=Vs.UNKNOWN}return r.prototype.directTransition=function(a){this.failIfTransitionOngoing(),this.validateTransition(a),this.state=a},r.prototype.startTransition=function(a){return this.failIfTransitionOngoing(),this.validateTransition(a),this.onGoingTransactionNewState=a,this},r.prototype.execute=function(){if(this.onGoingTransactionNewState===Vs.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var a=this.onGoingTransactionNewState;this.onGoingTransactionNewState=Vs.UNKNOWN,this.directTransition(a)},r.prototype.cancel=function(){if(this.onGoingTransactionNewState===Vs.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=Vs.UNKNOWN},r.prototype.getState=function(){return this.state},r.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==Vs.UNKNOWN)throw"Cannot transition to a new state, already under transition"},r.prototype.validateTransition=function(a){switch(this.state){case Vs.UNKNOWN:throw"Transition from unknown is not allowed";case Vs.NOT_STARTED:this.failIfNewStateIs(a,[Vs.PAUSED]);break;case Vs.SCANNING:break;case Vs.PAUSED:break}},r.prototype.failIfNewStateIs=function(a,i){for(var c=0,m=i;c<m.length;c++){var u=m[c];if(a===u)throw"Cannot transition from ".concat(this.state," to ").concat(a)}},r}(),N0=function(){function r(a){this.stateManager=a}return r.prototype.startTransition=function(a){return this.stateManager.startTransition(a)},r.prototype.directTransition=function(a){this.stateManager.directTransition(a)},r.prototype.getState=function(){return this.stateManager.getState()},r.prototype.canScanFile=function(){return this.stateManager.getState()===Vs.NOT_STARTED},r.prototype.isScanning=function(){return this.stateManager.getState()!==Vs.NOT_STARTED},r.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===Vs.SCANNING},r.prototype.isPaused=function(){return this.stateManager.getState()===Vs.PAUSED},r}(),v0=function(){function r(){}return r.create=function(){return new N0(new j0)},r}(),C0=function(){var r=function(a,i){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,m){c.__proto__=m}||function(c,m){for(var u in m)Object.prototype.hasOwnProperty.call(m,u)&&(c[u]=m[u])},r(a,i)};return function(a,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");r(a,i);function c(){this.constructor=a}a.prototype=i===null?Object.create(i):(c.prototype=i.prototype,new c)}}(),_r=function(r){C0(a,r);function a(){return r!==null&&r.apply(this,arguments)||this}return a.DEFAULT_WIDTH=300,a.DEFAULT_WIDTH_OFFSET=2,a.FILE_SCAN_MIN_HEIGHT=300,a.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,a.MIN_QR_BOX_SIZE=50,a.SHADED_LEFT=1,a.SHADED_RIGHT=2,a.SHADED_TOP=3,a.SHADED_BOTTOM=4,a.SHADED_REGION_ELEMENT_ID="qr-shaded-region",a.VERBOSE=!1,a.BORDER_SHADER_DEFAULT_COLOR="#ffffff",a.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",a}(Pr),S0=function(){function r(a,i){this.logger=i,this.fps=_r.SCAN_DEFAULT_FPS,a?(a.fps&&(this.fps=a.fps),this.disableFlip=a.disableFlip===!0,this.qrbox=a.qrbox,this.aspectRatio=a.aspectRatio,this.videoConstraints=a.videoConstraints):this.disableFlip=_r.DEFAULT_DISABLE_FLIP}return r.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?Ec.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},r.prototype.isShadedBoxEnabled=function(){return!Wr(this.qrbox)},r.create=function(a,i){return new r(a,i)},r}(),go=function(){function r(a,i){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(a))throw"HTML Element with id=".concat(a," not found");this.elementId=a,this.verbose=!1;var c;typeof i=="boolean"?this.verbose=i===!0:i&&(c=i,this.verbose=c.verbose===!0,c.experimentalFeatures),this.logger=new _c(this.verbose),this.qrcode=new d0(this.getSupportedFormats(i),this.getUseBarCodeDetectorIfSupported(c),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=v0.create()}return r.prototype.start=function(a,i,c,m){var u=this;if(!a)throw"cameraIdOrConfig is required";if(!c||typeof c!="function")throw"qrCodeSuccessCallback is required and should be a function.";var x;m?x=m:x=this.verbose?this.logger.log:function(){};var j=S0.create(i,this.logger);this.clearElement();var b=!1;j.videoConstraints&&(j.isMediaStreamConstraintsValid()?b=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var f=b,y=document.getElementById(this.elementId);y.clientWidth?y.clientWidth:_r.DEFAULT_WIDTH,y.style.position="relative",this.shouldScan=!0,this.element=y;var N=this,I=this.stateManagerProxy.startTransition(Vs.SCANNING);return new Promise(function(R,k){var E=f?j.videoConstraints:N.createVideoConstraints(a);if(!E){I.cancel(),k("videoConstraints should be defined");return}var v={};(!f||j.aspectRatio)&&(v.aspectRatio=j.aspectRatio);var U={onRenderSurfaceReady:function(F,L){N.setupUi(F,L,j),N.isScanning=!0,N.foreverScan(j,c,x)}};p0.failIfNotSupported().then(function(F){F.create(E).then(function(L){return L.render(u.element,v,U).then(function(C){N.renderedCamera=C,I.execute(),R(null)}).catch(function(C){I.cancel(),k(C)})}).catch(function(L){I.cancel(),k(Ba.errorGettingUserMedia(L))})}).catch(function(F){I.cancel(),k(Ba.cameraStreamingNotSupported())})})},r.prototype.pause=function(a){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(Vs.PAUSED),this.showPausedState(),(Wr(a)||a!==!0)&&(a=!1),a&&this.renderedCamera&&this.renderedCamera.pause()},r.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var a=this,i=function(){a.stateManagerProxy.directTransition(Vs.SCANNING),a.hidePausedState()};if(!this.renderedCamera.isPaused()){i();return}this.renderedCamera.resume(function(){i()})},r.prototype.getState=function(){return this.stateManagerProxy.getState()},r.prototype.stop=function(){var a=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var i=this.stateManagerProxy.startTransition(Vs.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var c=function(){if(a.element){var u=document.getElementById(_r.SHADED_REGION_ELEMENT_ID);u&&a.element.removeChild(u)}},m=this;return this.renderedCamera.close().then(function(){return m.renderedCamera=null,m.element&&(m.element.removeChild(m.canvasElement),m.canvasElement=null),c(),m.qrRegion&&(m.qrRegion=null),m.context&&(m.context=null),i.execute(),m.hidePausedState(),m.isScanning=!1,Promise.resolve()})},r.prototype.scanFile=function(a,i){return this.scanFileV2(a,i).then(function(c){return c.decodedText})},r.prototype.scanFileV2=function(a,i){var c=this;if(!a||!(a instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(Wr(i)&&(i=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(m,u){c.possiblyCloseLastScanImageFile(),c.clearElement(),c.lastScanImageFile=URL.createObjectURL(a);var x=new Image;x.onload=function(){var j=x.width,b=x.height,f=document.getElementById(c.elementId),y=f.clientWidth?f.clientWidth:_r.DEFAULT_WIDTH,N=Math.max(f.clientHeight?f.clientHeight:b,_r.FILE_SCAN_MIN_HEIGHT),I=c.computeCanvasDrawConfig(j,b,y,N);if(i){var R=c.createCanvasElement(y,N,"qr-canvas-visible");R.style.display="inline-block",f.appendChild(R);var k=R.getContext("2d");if(!k)throw"Unable to get 2d context from canvas";k.canvas.width=y,k.canvas.height=N,k.drawImage(x,0,0,j,b,I.x,I.y,I.width,I.height)}var E=_r.FILE_SCAN_HIDDEN_CANVAS_PADDING,v=Math.max(x.width,I.width),U=Math.max(x.height,I.height),F=v+2*E,L=U+2*E,C=c.createCanvasElement(F,L);f.appendChild(C);var $=C.getContext("2d");if(!$)throw"Unable to get 2d context from canvas";$.canvas.width=F,$.canvas.height=L,$.drawImage(x,0,0,j,b,E,E,v,U);try{c.qrcode.decodeRobustlyAsync(C).then(function(Y){m(io.createFromQrcodeResult(Y))}).catch(u)}catch(Y){u("QR code parse error, error = ".concat(Y))}},x.onerror=u,x.onabort=u,x.onstalled=u,x.onsuspend=u,x.src=URL.createObjectURL(a)})},r.prototype.clear=function(){this.clearElement()},r.getCameras=function(){return w0.retrieve()},r.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},r.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},r.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},r.prototype.applyVideoConstraints=function(a){if(a){if(!Ec.isMediaStreamConstraintsValid(a,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(a)},r.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},r.prototype.getSupportedFormats=function(a){var i=[At.QR_CODE,At.AZTEC,At.CODABAR,At.CODE_39,At.CODE_93,At.CODE_128,At.DATA_MATRIX,At.MAXICODE,At.ITF,At.EAN_13,At.EAN_8,At.PDF_417,At.RSS_14,At.RSS_EXPANDED,At.UPC_A,At.UPC_E,At.UPC_EAN_EXTENSION];if(!a||typeof a=="boolean"||!a.formatsToSupport)return i;if(!Array.isArray(a.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(a.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var c=[],m=0,u=a.formatsToSupport;m<u.length;m++){var x=u[m];a0(x)?c.push(x):this.logger.warn("Invalid format: ".concat(x," passed in config, ignoring."))}if(c.length===0)throw"None of formatsToSupport match supported values.";return c},r.prototype.getUseBarCodeDetectorIfSupported=function(a){if(Wr(a))return!0;if(!Wr(a.useBarCodeDetectorIfSupported))return a.useBarCodeDetectorIfSupported!==!1;if(Wr(a.experimentalFeatures))return!0;var i=a.experimentalFeatures;return Wr(i.useBarCodeDetectorIfSupported)?!0:i.useBarCodeDetectorIfSupported!==!1},r.prototype.validateQrboxSize=function(a,i,c){var m=this,u=c.qrbox;this.validateQrboxConfig(u);var x=this.toQrdimensions(a,i,u),j=function(f){if(f<_r.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(_r.MIN_QR_BOX_SIZE,"px.")},b=function(f){return f>a&&(m.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),f=a),f};j(x.width),j(x.height),x.width=b(x.width)},r.prototype.validateQrboxConfig=function(a){if(typeof a!="number"&&typeof a!="function"&&(a.width===void 0||a.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},r.prototype.toQrdimensions=function(a,i,c){if(typeof c=="number")return{width:c,height:c};if(typeof c=="function")try{return c(a,i)}catch(m){throw new Error("qrbox config was passed as a function but it failed with unknown error"+m)}return c},r.prototype.setupUi=function(a,i,c){c.isShadedBoxEnabled()&&this.validateQrboxSize(a,i,c);var m=Wr(c.qrbox)?{width:a,height:i}:c.qrbox;this.validateQrboxConfig(m);var u=this.toQrdimensions(a,i,m);u.height>i&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var x=c.isShadedBoxEnabled()&&u.height<=i,j={x:0,y:0,width:a,height:i},b=x?this.getShadedRegionBounds(a,i,u):j,f=this.createCanvasElement(b.width,b.height),y={willReadFrequently:!0},N=f.getContext("2d",y);N.canvas.width=b.width,N.canvas.height=b.height,this.element.append(f),x&&this.possiblyInsertShadingElement(this.element,a,i,u),this.createScannerPausedUiElement(this.element),this.qrRegion=b,this.context=N,this.canvasElement=f},r.prototype.createScannerPausedUiElement=function(a){var i=document.createElement("div");i.innerText=Ba.scannerPaused(),i.style.display="none",i.style.position="absolute",i.style.top="0px",i.style.zIndex="1",i.style.background="rgba(9, 9, 9, 0.46)",i.style.color="#FFECEC",i.style.textAlign="center",i.style.width="100%",a.appendChild(i),this.scannerPausedUiElement=i},r.prototype.scanContext=function(a,i){var c=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(m){return a(m.text,io.createFromQrcodeResult(m)),c.possiblyUpdateShaders(!0),!0}).catch(function(m){c.possiblyUpdateShaders(!1);var u=Ba.codeParseError(m);return i(u,Sc.createFrom(u)),!1})},r.prototype.foreverScan=function(a,i,c){var m=this;if(this.shouldScan&&this.renderedCamera){var u=this.renderedCamera.getSurface(),x=u.videoWidth/u.clientWidth,j=u.videoHeight/u.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var b=this.qrRegion.width*x,f=this.qrRegion.height*j,y=this.qrRegion.x*x,N=this.qrRegion.y*j;this.context.drawImage(u,y,N,b,f,0,0,this.qrRegion.width,this.qrRegion.height);var I=function(){m.foreverScanTimeout=setTimeout(function(){m.foreverScan(a,i,c)},m.getTimeoutFps(a.fps))};this.scanContext(i,c).then(function(R){!R&&a.disableFlip!==!0?(m.context.translate(m.context.canvas.width,0),m.context.scale(-1,1),m.scanContext(i,c).finally(function(){I()})):I()}).catch(function(R){m.logger.logError("Error happend while scanning context",R),I()})}},r.prototype.createVideoConstraints=function(a){if(typeof a=="string")return{deviceId:{exact:a}};if(typeof a=="object"){var i="facingMode",c="deviceId",m={user:!0,environment:!0},u="exact",x=function(k){if(k in m)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(k,"'")},j=Object.keys(a);if(j.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(j.length," keys");var b=Object.keys(a)[0];if(b!==i&&b!==c)throw"Only '".concat(i,"' and '").concat(c,"' ")+" are supported for 'cameraIdOrConfig'";if(b===i){var f=a.facingMode;if(typeof f=="string"){if(x(f))return{facingMode:f}}else if(typeof f=="object")if(u in f){if(x(f["".concat(u)]))return{facingMode:{exact:f["".concat(u)]}}}else throw"'facingMode' should be string or object with"+" ".concat(u," as key.");else{var y=typeof f;throw"Invalid type of 'facingMode' = ".concat(y)}}else{var N=a.deviceId;if(typeof N=="string")return{deviceId:N};if(typeof N=="object"){if(u in N)return{deviceId:{exact:N["".concat(u)]}};throw"'deviceId' should be string or object with"+" ".concat(u," as key.")}else{var I=typeof N;throw"Invalid type of 'deviceId' = ".concat(I)}}}var R=typeof a;throw"Invalid type of 'cameraIdOrConfig' = ".concat(R)},r.prototype.computeCanvasDrawConfig=function(a,i,c,m){if(a<=c&&i<=m){var u=(c-a)/2,x=(m-i)/2;return{x:u,y:x,width:a,height:i}}else{var j=a,b=i;return a>c&&(i=c/a*i,a=c),i>m&&(a=m/i*a,i=m),this.logger.log("Image downsampled from "+"".concat(j,"X").concat(b)+" to ".concat(a,"X").concat(i,".")),this.computeCanvasDrawConfig(a,i,c,m)}},r.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var a=document.getElementById(this.elementId);a&&(a.innerHTML="")},r.prototype.possiblyUpdateShaders=function(a){this.qrMatch!==a&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(i){i.style.backgroundColor=a?_r.BORDER_SHADER_MATCH_COLOR:_r.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=a)},r.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},r.prototype.createCanvasElement=function(a,i,c){var m=a,u=i,x=document.createElement("canvas");return x.style.width="".concat(m,"px"),x.style.height="".concat(u,"px"),x.style.display="none",x.id=Wr(c)?"qr-canvas":c,x},r.prototype.getShadedRegionBounds=function(a,i,c){if(c.width>a||c.height>i)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(a-c.width)/2,y:(i-c.height)/2,width:c.width,height:c.height}},r.prototype.possiblyInsertShadingElement=function(a,i,c,m){if(!(i-m.width<1||c-m.height<1)){var u=document.createElement("div");u.style.position="absolute";var x=(i-m.width)/2,j=(c-m.height)/2;if(u.style.borderLeft="".concat(x,"px solid rgba(0, 0, 0, 0.48)"),u.style.borderRight="".concat(x,"px solid rgba(0, 0, 0, 0.48)"),u.style.borderTop="".concat(j,"px solid rgba(0, 0, 0, 0.48)"),u.style.borderBottom="".concat(j,"px solid rgba(0, 0, 0, 0.48)"),u.style.boxSizing="border-box",u.style.top="0px",u.style.bottom="0px",u.style.left="0px",u.style.right="0px",u.id="".concat(_r.SHADED_REGION_ELEMENT_ID),i-m.width<11||c-m.height<11)this.hasBorderShaders=!1;else{var b=5,f=40;this.insertShaderBorders(u,f,b,-b,null,0,!0),this.insertShaderBorders(u,f,b,-b,null,0,!1),this.insertShaderBorders(u,f,b,null,-b,0,!0),this.insertShaderBorders(u,f,b,null,-b,0,!1),this.insertShaderBorders(u,b,f+b,-b,null,-b,!0),this.insertShaderBorders(u,b,f+b,null,-b,-b,!0),this.insertShaderBorders(u,b,f+b,-b,null,-b,!1),this.insertShaderBorders(u,b,f+b,null,-b,-b,!1),this.hasBorderShaders=!0}a.append(u)}},r.prototype.insertShaderBorders=function(a,i,c,m,u,x,j){var b=document.createElement("div");b.style.position="absolute",b.style.backgroundColor=_r.BORDER_SHADER_DEFAULT_COLOR,b.style.width="".concat(i,"px"),b.style.height="".concat(c,"px"),m!==null&&(b.style.top="".concat(m,"px")),u!==null&&(b.style.bottom="".concat(u,"px")),j?b.style.left="".concat(x,"px"):b.style.right="".concat(x,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(b),a.appendChild(b)},r.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},r.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},r.prototype.getTimeoutFps=function(a){return 1e3/a},r}(),hl="data:image/svg+xml;base64,",_0=hl+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNzEuNjQzIDM3MS42NDMiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDM3MS42NDMgMzcxLjY0MyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZD0iTTEwNS4wODQgMzguMjcxaDE2My43Njh2MjBIMTA1LjA4NHoiLz48cGF0aCBkPSJNMzExLjU5NiAxOTAuMTg5Yy03LjQ0MS05LjM0Ny0xOC40MDMtMTYuMjA2LTMyLjc0My0yMC41MjJWMzBjMC0xNi41NDItMTMuNDU4LTMwLTMwLTMwSDEyNS4wODRjLTE2LjU0MiAwLTMwIDEzLjQ1OC0zMCAzMHYxMjAuMTQzaC04LjI5NmMtMTYuNTQyIDAtMzAgMTMuNDU4LTMwIDMwdjEuMzMzYTI5LjgwNCAyOS44MDQgMCAwIDAgNC42MDMgMTUuOTM5Yy03LjM0IDUuNDc0LTEyLjEwMyAxNC4yMjEtMTIuMTAzIDI0LjA2MXYxLjMzM2MwIDkuODQgNC43NjMgMTguNTg3IDEyLjEwMyAyNC4wNjJhMjkuODEgMjkuODEgMCAwIDAtNC42MDMgMTUuOTM4djEuMzMzYzAgMTYuNTQyIDEzLjQ1OCAzMCAzMCAzMGg4LjMyNGMuNDI3IDExLjYzMSA3LjUwMyAyMS41ODcgMTcuNTM0IDI2LjE3Ny45MzEgMTAuNTAzIDQuMDg0IDMwLjE4NyAxNC43NjggNDUuNTM3YTkuOTg4IDkuOTg4IDAgMCAwIDguMjE2IDQuMjg4IDkuOTU4IDkuOTU4IDAgMCAwIDUuNzA0LTEuNzkzYzQuNTMzLTMuMTU1IDUuNjUtOS4zODggMi40OTUtMTMuOTIxLTYuNzk4LTkuNzY3LTkuNjAyLTIyLjYwOC0xMC43Ni0zMS40aDgyLjY4NWMuMjcyLjQxNC41NDUuODE4LjgxNSAxLjIxIDMuMTQyIDQuNTQxIDkuMzcyIDUuNjc5IDEzLjkxMyAyLjUzNCA0LjU0Mi0zLjE0MiA1LjY3Ny05LjM3MSAyLjUzNS0xMy45MTMtMTEuOTE5LTE3LjIyOS04Ljc4Ny0zNS44ODQgOS41ODEtNTcuMDEyIDMuMDY3LTIuNjUyIDEyLjMwNy0xMS43MzIgMTEuMjE3LTI0LjAzMy0uODI4LTkuMzQzLTcuMTA5LTE3LjE5NC0xOC42NjktMjMuMzM3YTkuODU3IDkuODU3IDAgMCAwLTEuMDYxLS40ODZjLS40NjYtLjE4Mi0xMS40MDMtNC41NzktOS43NDEtMTUuNzA2IDEuMDA3LTYuNzM3IDE0Ljc2OC04LjI3MyAyMy43NjYtNy42NjYgMjMuMTU2IDEuNTY5IDM5LjY5OCA3LjgwMyA0Ny44MzYgMTguMDI2IDUuNzUyIDcuMjI1IDcuNjA3IDE2LjYyMyA1LjY3MyAyOC43MzMtLjQxMyAyLjU4NS0uODI0IDUuMjQxLTEuMjQ1IDcuOTU5LTUuNzU2IDM3LjE5NC0xMi45MTkgODMuNDgzLTQ5Ljg3IDExNC42NjEtNC4yMjEgMy41NjEtNC43NTYgOS44Ny0xLjE5NCAxNC4wOTJhOS45OCA5Ljk4IDAgMCAwIDcuNjQ4IDMuNTUxIDkuOTU1IDkuOTU1IDAgMCAwIDYuNDQ0LTIuMzU4YzQyLjY3Mi0zNi4wMDUgNTAuODAyLTg4LjUzMyA1Ni43MzctMTI2Ljg4OC40MTUtMi42ODQuODIxLTUuMzA5IDEuMjI5LTcuODYzIDIuODM0LTE3LjcyMS0uNDU1LTMyLjY0MS05Ljc3Mi00NC4zNDV6bS0yMzIuMzA4IDQyLjYyYy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM2MwLTUuNTE0IDQuNDg2LTEwIDEwLTEwaDE1djIxLjMzM2gtMTV6bS0yLjUtNTIuNjY2YzAtNS41MTQgNC40ODYtMTAgMTAtMTBoNy41djIxLjMzM2gtNy41Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM3ptMTcuNSA5My45OTloLTcuNWMtNS41MTQgMC0xMC00LjQ4Ni0xMC0xMHYtMS4zMzNjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGg3LjV2MjEuMzMzem0zMC43OTYgMjguODg3Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi04LjI3MWg5MS40NTdjLS44NTEgNi42NjgtLjQzNyAxMi43ODcuNzMxIDE4LjI3MWgtODIuMTg4em03OS40ODItMTEzLjY5OGMtMy4xMjQgMjAuOTA2IDEyLjQyNyAzMy4xODQgMjEuNjI1IDM3LjA0IDUuNDQxIDIuOTY4IDcuNTUxIDUuNjQ3IDcuNzAxIDcuMTg4LjIxIDIuMTUtMi41NTMgNS42ODQtNC40NzcgNy4yNTEtLjQ4Mi4zNzgtLjkyOS44LTEuMzM1IDEuMjYxLTYuOTg3IDcuOTM2LTExLjk4MiAxNS41Mi0xNS40MzIgMjIuNjg4aC05Ny41NjRWMzBjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGgxMjMuNzY5YzUuNTE0IDAgMTAgNC40ODYgMTAgMTB2MTM1LjU3OWMtMy4wMzItLjM4MS02LjE1LS42OTQtOS4zODktLjkxNC0yNS4xNTktMS42OTQtNDIuMzcgNy43NDgtNDQuODk4IDI0LjY2NnoiLz48cGF0aCBkPSJNMTc5LjEyOSA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXpNMTcyLjYyOSAxNDIuODZoLTEyLjU2VjEzMC44YTUgNSAwIDEgMC0xMCAwdjE3LjA2MWE1IDUgMCAwIDAgNSA1aDE3LjU2YTUgNSAwIDEgMCAwLTEwLjAwMXpNMjE2LjU2OCA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXptLTUgMjQuMDYxaC0xNC4wNlY5My4xNjdoMTQuMDZ2MTQuMDYxek0yMTEuNjY5IDEyNS45MzZIMTk3LjQxYTUgNSAwIDAgMC01IDV2MTQuMjU3YTUgNSAwIDAgMCA1IDVoMTQuMjU5YTUgNSAwIDAgMCA1LTV2LTE0LjI1N2E1IDUgMCAwIDAtNS01eiIvPjwvc3ZnPg==",E0=hl+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1OS4wMTggNTkuMDE4IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1OS4wMTggNTkuMDE4IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJtNTguNzQxIDU0LjgwOS01Ljk2OS02LjI0NGExMC43NCAxMC43NCAwIDAgMCAyLjgyLTcuMjVjMC01Ljk1My00Ljg0My0xMC43OTYtMTAuNzk2LTEwLjc5NlMzNCAzNS4zNjEgMzQgNDEuMzE0IDM4Ljg0MyA1Mi4xMSA0NC43OTYgNTIuMTFjMi40NDEgMCA0LjY4OC0uODI0IDYuNDk5LTIuMTk2bDYuMDAxIDYuMjc3YS45OTguOTk4IDAgMCAwIDEuNDE0LjAzMiAxIDEgMCAwIDAgLjAzMS0xLjQxNHpNMzYgNDEuMzE0YzAtNC44NSAzLjk0Ni04Ljc5NiA4Ljc5Ni04Ljc5NnM4Ljc5NiAzLjk0NiA4Ljc5NiA4Ljc5Ni0zLjk0NiA4Ljc5Ni04Ljc5NiA4Ljc5NlMzNiA0Ni4xNjQgMzYgNDEuMzE0ek0xMC40MzEgMTYuMDg4YzAgMy4wNyAyLjQ5OCA1LjU2OCA1LjU2OSA1LjU2OHM1LjU2OS0yLjQ5OCA1LjU2OS01LjU2OGMwLTMuMDcxLTIuNDk4LTUuNTY5LTUuNTY5LTUuNTY5cy01LjU2OSAyLjQ5OC01LjU2OSA1LjU2OXptOS4xMzggMGMwIDEuOTY4LTEuNjAyIDMuNTY4LTMuNTY5IDMuNTY4cy0zLjU2OS0xLjYwMS0zLjU2OS0zLjU2OCAxLjYwMi0zLjU2OSAzLjU2OS0zLjU2OSAzLjU2OSAxLjYwMSAzLjU2OSAzLjU2OXoiLz48cGF0aCBkPSJtMzAuODgyIDI4Ljk4NyA5LjE4LTEwLjA1NCAxMS4yNjIgMTAuMzIzYTEgMSAwIDAgMCAxLjM1MS0xLjQ3NWwtMTItMTFhMSAxIDAgMCAwLTEuNDE0LjA2M2wtOS43OTQgMTAuNzI3LTQuNzQzLTQuNzQzYTEuMDAzIDEuMDAzIDAgMCAwLTEuMzY4LS4wNDRMNi4zMzkgMzcuNzY4YTEgMSAwIDEgMCAxLjMyMiAxLjUwMWwxNi4zMTMtMTQuMzYyIDcuMzE5IDcuMzE4YS45OTkuOTk5IDAgMSAwIDEuNDE0LTEuNDE0bC0xLjgyNS0xLjgyNHoiLz48cGF0aCBkPSJNMzAgNDYuNTE4SDJ2LTQyaDU0djI4YTEgMSAwIDEgMCAyIDB2LTI5YTEgMSAwIDAgMC0xLTFIMWExIDEgMCAwIDAtMSAxdjQ0YTEgMSAwIDAgMCAxIDFoMjlhMSAxIDAgMSAwIDAtMnoiLz48L3N2Zz4=",fo=hl+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NjAgNDYwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NjAgNDYwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJNMjMwIDBDMTAyLjk3NSAwIDAgMTAyLjk3NSAwIDIzMHMxMDIuOTc1IDIzMCAyMzAgMjMwIDIzMC0xMDIuOTc0IDIzMC0yMzBTMzU3LjAyNSAwIDIzMCAwem0zOC4zMzMgMzc3LjM2YzAgOC42NzYtNy4wMzQgMTUuNzEtMTUuNzEgMTUuNzFoLTQzLjEwMWMtOC42NzYgMC0xNS43MS03LjAzNC0xNS43MS0xNS43MVYyMDIuNDc3YzAtOC42NzYgNy4wMzMtMTUuNzEgMTUuNzEtMTUuNzFoNDMuMTAxYzguNjc2IDAgMTUuNzEgNy4wMzMgMTUuNzEgMTUuNzFWMzc3LjM2ek0yMzAgMTU3Yy0yMS41MzkgMC0zOS0xNy40NjEtMzktMzlzMTcuNDYxLTM5IDM5LTM5IDM5IDE3LjQ2MSAzOSAzOS0xNy40NjEgMzktMzkgMzl6Ii8+PC9zdmc+",A0="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAQgAAAEIBarqQRAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAE1SURBVDiNfdI7S0NBEAXgLya1otFgpbYSbISAgpXYi6CmiH9KCAiChaVga6OiWPgfRDQ+0itaGVNosXtluWwcuMzePfM4M3sq8lbHBubwg1dc4m1E/J/N4ghDPOIsfk/4xiEao5KX0McFljN4C9d4QTPXuY99jP3DsIoDPGM6BY5i5yI5R7O4q+ImFkJY2DCh3cAH2klyB+9J1xUMMAG7eCh1a+Mr+k48b5diXrFVwwLuS+BJ9MfR7+G0FHOHhTHhnXNWS87VDF4pcnfQK4Ep7XScNLmPTZgURNKKYENYWDpzW1BhscS1WHS8CDgURFJQrWcoF3c13KKbgg1BYQfy8xZWEzTTw1QZbAoKu8FqJnktdu5hcVSHmchiILzzuaDQvjBzV2m8yohCE1jHfPx/xhU+y4G/D75ELlRJsSYAAAAASUVORK5CYII=",po=function(){function r(){}return r.createDefault=function(){return{hasPermission:!1,lastUsedCameraId:null}},r}(),k0=function(){function r(){this.data=po.createDefault();var a=localStorage.getItem(r.LOCAL_STORAGE_KEY);a?this.data=JSON.parse(a):this.reset()}return r.prototype.hasCameraPermissions=function(){return this.data.hasPermission},r.prototype.getLastUsedCameraId=function(){return this.data.lastUsedCameraId},r.prototype.setHasPermission=function(a){this.data.hasPermission=a,this.flush()},r.prototype.setLastUsedCameraId=function(a){this.data.lastUsedCameraId=a,this.flush()},r.prototype.resetLastUsedCameraId=function(){this.data.lastUsedCameraId=null,this.flush()},r.prototype.reset=function(){this.data=po.createDefault(),this.flush()},r.prototype.flush=function(){localStorage.setItem(r.LOCAL_STORAGE_KEY,JSON.stringify(this.data))},r.LOCAL_STORAGE_KEY="HTML5_QRCODE_DATA",r}(),D0=function(){function r(){this.infoDiv=document.createElement("div")}return r.prototype.renderInto=function(a){this.infoDiv.style.position="absolute",this.infoDiv.style.top="10px",this.infoDiv.style.right="10px",this.infoDiv.style.zIndex="2",this.infoDiv.style.display="none",this.infoDiv.style.padding="5pt",this.infoDiv.style.border="1px solid #171717",this.infoDiv.style.fontSize="10pt",this.infoDiv.style.background="rgb(0 0 0 / 69%)",this.infoDiv.style.borderRadius="5px",this.infoDiv.style.textAlign="center",this.infoDiv.style.fontWeight="400",this.infoDiv.style.color="white",this.infoDiv.innerText=lo.poweredBy();var i=document.createElement("a");i.innerText="ScanApp",i.href="https://scanapp.org",i.target="new",i.style.color="white",this.infoDiv.appendChild(i);var c=document.createElement("br"),m=document.createElement("br");this.infoDiv.appendChild(c),this.infoDiv.appendChild(m);var u=document.createElement("a");u.innerText=lo.reportIssues(),u.href="https://github.com/mebjas/html5-qrcode/issues",u.target="new",u.style.color="white",this.infoDiv.appendChild(u),a.appendChild(this.infoDiv)},r.prototype.show=function(){this.infoDiv.style.display="block"},r.prototype.hide=function(){this.infoDiv.style.display="none"},r}(),T0=function(){function r(a,i){this.isShowingInfoIcon=!0,this.onTapIn=a,this.onTapOut=i,this.infoIcon=document.createElement("img")}return r.prototype.renderInto=function(a){var i=this;this.infoIcon.alt="Info icon",this.infoIcon.src=fo,this.infoIcon.style.position="absolute",this.infoIcon.style.top="4px",this.infoIcon.style.right="4px",this.infoIcon.style.opacity="0.6",this.infoIcon.style.cursor="pointer",this.infoIcon.style.zIndex="2",this.infoIcon.style.width="16px",this.infoIcon.style.height="16px",this.infoIcon.onmouseover=function(c){return i.onHoverIn()},this.infoIcon.onmouseout=function(c){return i.onHoverOut()},this.infoIcon.onclick=function(c){return i.onClick()},a.appendChild(this.infoIcon)},r.prototype.onHoverIn=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="1")},r.prototype.onHoverOut=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="0.6")},r.prototype.onClick=function(){this.isShowingInfoIcon?(this.isShowingInfoIcon=!1,this.onTapIn(),this.infoIcon.src=A0,this.infoIcon.style.opacity="1"):(this.isShowingInfoIcon=!0,this.onTapOut(),this.infoIcon.src=fo,this.infoIcon.style.opacity="0.6")},r}(),I0=function(){function r(){var a=this;this.infoDiv=new D0,this.infoIcon=new T0(function(){a.infoDiv.show()},function(){a.infoDiv.hide()})}return r.prototype.renderInto=function(a){this.infoDiv.renderInto(a),this.infoIcon.renderInto(a)},r}(),M0=function(r,a,i,c){function m(u){return u instanceof i?u:new i(function(x){x(u)})}return new(i||(i=Promise))(function(u,x){function j(y){try{f(c.next(y))}catch(N){x(N)}}function b(y){try{f(c.throw(y))}catch(N){x(N)}}function f(y){y.done?u(y.value):m(y.value).then(j,b)}f((c=c.apply(r,a||[])).next())})},R0=function(r,a){var i={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},c,m,u,x;return x={next:j(0),throw:j(1),return:j(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function j(f){return function(y){return b([f,y])}}function b(f){if(c)throw new TypeError("Generator is already executing.");for(;x&&(x=0,f[0]&&(i=0)),i;)try{if(c=1,m&&(u=f[0]&2?m.return:f[0]?m.throw||((u=m.return)&&u.call(m),0):m.next)&&!(u=u.call(m,f[1])).done)return u;switch(m=0,u&&(f=[f[0]&2,u.value]),f[0]){case 0:case 1:u=f;break;case 4:return i.label++,{value:f[1],done:!1};case 5:i.label++,m=f[1],f=[0];continue;case 7:f=i.ops.pop(),i.trys.pop();continue;default:if(u=i.trys,!(u=u.length>0&&u[u.length-1])&&(f[0]===6||f[0]===2)){i=0;continue}if(f[0]===3&&(!u||f[1]>u[0]&&f[1]<u[3])){i.label=f[1];break}if(f[0]===6&&i.label<u[1]){i.label=u[1],u=f;break}if(u&&i.label<u[2]){i.label=u[2],i.ops.push(f);break}u[2]&&i.ops.pop(),i.trys.pop();continue}f=a.call(r,i)}catch(y){f=[6,y],m=0}finally{c=u=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}},bo=function(){function r(){}return r.hasPermissions=function(){return M0(this,void 0,void 0,function(){var a,i,c,m;return R0(this,function(u){switch(u.label){case 0:return[4,navigator.mediaDevices.enumerateDevices()];case 1:for(a=u.sent(),i=0,c=a;i<c.length;i++)if(m=c[i],m.kind==="videoinput"&&m.label)return[2,!0];return[2,!1]}})})},r}(),ca=function(){function r(a){this.supportedScanTypes=this.validateAndReturnScanTypes(a)}return r.prototype.getDefaultScanType=function(){return this.supportedScanTypes[0]},r.prototype.hasMoreThanOneScanType=function(){return this.supportedScanTypes.length>1},r.prototype.isCameraScanRequired=function(){for(var a=0,i=this.supportedScanTypes;a<i.length;a++){var c=i[a];if(r.isCameraScanType(c))return!0}return!1},r.isCameraScanType=function(a){return a===fa.SCAN_TYPE_CAMERA},r.isFileScanType=function(a){return a===fa.SCAN_TYPE_FILE},r.prototype.validateAndReturnScanTypes=function(a){if(!a||a.length===0)return Pr.DEFAULT_SUPPORTED_SCAN_TYPE;var i=Pr.DEFAULT_SUPPORTED_SCAN_TYPE.length;if(a.length>i)throw"Max ".concat(i," values expected for ")+"supportedScanTypes";for(var c=0,m=a;c<m.length;c++){var u=m[c];if(!Pr.DEFAULT_SUPPORTED_SCAN_TYPE.includes(u))throw"Unsupported scan type ".concat(u)}return a},r}(),kr=function(){function r(){}return r.ALL_ELEMENT_CLASS="html5-qrcode-element",r.CAMERA_PERMISSION_BUTTON_ID="html5-qrcode-button-camera-permission",r.CAMERA_START_BUTTON_ID="html5-qrcode-button-camera-start",r.CAMERA_STOP_BUTTON_ID="html5-qrcode-button-camera-stop",r.TORCH_BUTTON_ID="html5-qrcode-button-torch",r.CAMERA_SELECTION_SELECT_ID="html5-qrcode-select-camera",r.FILE_SELECTION_BUTTON_ID="html5-qrcode-button-file-selection",r.ZOOM_SLIDER_ID="html5-qrcode-input-range-zoom",r.SCAN_TYPE_CHANGE_ANCHOR_ID="html5-qrcode-anchor-scan-type-change",r.TORCH_BUTTON_CLASS_TORCH_ON="html5-qrcode-button-torch-on",r.TORCH_BUTTON_CLASS_TORCH_OFF="html5-qrcode-button-torch-off",r}(),ta=function(){function r(){}return r.createElement=function(a,i){var c=document.createElement(a);return c.id=i,c.classList.add(kr.ALL_ELEMENT_CLASS),a==="button"&&c.setAttribute("type","button"),c},r}(),kc=function(r,a,i,c){function m(u){return u instanceof i?u:new i(function(x){x(u)})}return new(i||(i=Promise))(function(u,x){function j(y){try{f(c.next(y))}catch(N){x(N)}}function b(y){try{f(c.throw(y))}catch(N){x(N)}}function f(y){y.done?u(y.value):m(y.value).then(j,b)}f((c=c.apply(r,a||[])).next())})},Dc=function(r,a){var i={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},c,m,u,x;return x={next:j(0),throw:j(1),return:j(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function j(f){return function(y){return b([f,y])}}function b(f){if(c)throw new TypeError("Generator is already executing.");for(;x&&(x=0,f[0]&&(i=0)),i;)try{if(c=1,m&&(u=f[0]&2?m.return:f[0]?m.throw||((u=m.return)&&u.call(m),0):m.next)&&!(u=u.call(m,f[1])).done)return u;switch(m=0,u&&(f=[f[0]&2,u.value]),f[0]){case 0:case 1:u=f;break;case 4:return i.label++,{value:f[1],done:!1};case 5:i.label++,m=f[1],f=[0];continue;case 7:f=i.ops.pop(),i.trys.pop();continue;default:if(u=i.trys,!(u=u.length>0&&u[u.length-1])&&(f[0]===6||f[0]===2)){i=0;continue}if(f[0]===3&&(!u||f[1]>u[0]&&f[1]<u[3])){i.label=f[1];break}if(f[0]===6&&i.label<u[1]){i.label=u[1],u=f;break}if(u&&i.label<u[2]){i.label=u[2],i.ops.push(f);break}u[2]&&i.ops.pop(),i.trys.pop();continue}f=a.call(r,i)}catch(y){f=[6,y],m=0}finally{c=u=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}},yo=function(){function r(a,i,c){this.isTorchOn=!1,this.torchCapability=a,this.buttonController=i,this.onTorchActionFailureCallback=c}return r.prototype.isTorchEnabled=function(){return this.isTorchOn},r.prototype.flipState=function(){return kc(this,void 0,void 0,function(){var a,i;return Dc(this,function(c){switch(c.label){case 0:this.buttonController.disable(),a=!this.isTorchOn,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.torchCapability.apply(a)];case 2:return c.sent(),this.updateUiBasedOnLatestSettings(this.torchCapability.value(),a),[3,4];case 3:return i=c.sent(),this.propagateFailure(a,i),this.buttonController.enable(),[3,4];case 4:return[2]}})})},r.prototype.updateUiBasedOnLatestSettings=function(a,i){a===i?(this.buttonController.setText(i?Cs.torchOffButton():Cs.torchOnButton()),this.isTorchOn=i):this.propagateFailure(i),this.buttonController.enable()},r.prototype.propagateFailure=function(a,i){var c=a?Cs.torchOnFailedMessage():Cs.torchOffFailedMessage();i&&(c+="; Error = "+i),this.onTorchActionFailureCallback(c)},r.prototype.reset=function(){this.isTorchOn=!1},r}(),L0=function(){function r(a,i){this.onTorchActionFailureCallback=i,this.torchButton=ta.createElement("button",kr.TORCH_BUTTON_ID),this.torchController=new yo(a,this,i)}return r.prototype.render=function(a,i){var c=this;this.torchButton.innerText=Cs.torchOnButton(),this.torchButton.style.display=i.display,this.torchButton.style.marginLeft=i.marginLeft;var m=this;this.torchButton.addEventListener("click",function(u){return kc(c,void 0,void 0,function(){return Dc(this,function(x){switch(x.label){case 0:return[4,m.torchController.flipState()];case 1:return x.sent(),m.torchController.isTorchEnabled()?(m.torchButton.classList.remove(kr.TORCH_BUTTON_CLASS_TORCH_OFF),m.torchButton.classList.add(kr.TORCH_BUTTON_CLASS_TORCH_ON)):(m.torchButton.classList.remove(kr.TORCH_BUTTON_CLASS_TORCH_ON),m.torchButton.classList.add(kr.TORCH_BUTTON_CLASS_TORCH_OFF)),[2]}})})}),a.appendChild(this.torchButton)},r.prototype.updateTorchCapability=function(a){this.torchController=new yo(a,this,this.onTorchActionFailureCallback)},r.prototype.getTorchButton=function(){return this.torchButton},r.prototype.hide=function(){this.torchButton.style.display="none"},r.prototype.show=function(){this.torchButton.style.display="inline-block"},r.prototype.disable=function(){this.torchButton.disabled=!0},r.prototype.enable=function(){this.torchButton.disabled=!1},r.prototype.setText=function(a){this.torchButton.innerText=a},r.prototype.reset=function(){this.torchButton.innerText=Cs.torchOnButton(),this.torchController.reset()},r.create=function(a,i,c,m){var u=new r(i,m);return u.render(a,c),u},r}(),O0=function(){function r(a,i,c){this.fileBasedScanRegion=this.createFileBasedScanRegion(),this.fileBasedScanRegion.style.display=i?"block":"none",a.appendChild(this.fileBasedScanRegion);var m=document.createElement("label");m.setAttribute("for",this.getFileScanInputId()),m.style.display="inline-block",this.fileBasedScanRegion.appendChild(m),this.fileSelectionButton=ta.createElement("button",kr.FILE_SELECTION_BUTTON_ID),this.setInitialValueToButton(),this.fileSelectionButton.addEventListener("click",function(j){m.click()}),m.append(this.fileSelectionButton),this.fileScanInput=ta.createElement("input",this.getFileScanInputId()),this.fileScanInput.type="file",this.fileScanInput.accept="image/*",this.fileScanInput.style.display="none",m.appendChild(this.fileScanInput);var u=this;this.fileScanInput.addEventListener("change",function(j){if(!(j==null||j.target==null)){var b=j.target;if(!(b.files&&b.files.length===0)){var f=b.files,y=f[0],N=y.name;u.setImageNameToButton(N),c(y)}}});var x=this.createDragAndDropMessage();this.fileBasedScanRegion.appendChild(x),this.fileBasedScanRegion.addEventListener("dragenter",function(j){u.fileBasedScanRegion.style.border=u.fileBasedScanRegionActiveBorder(),j.stopPropagation(),j.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragleave",function(j){u.fileBasedScanRegion.style.border=u.fileBasedScanRegionDefaultBorder(),j.stopPropagation(),j.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragover",function(j){u.fileBasedScanRegion.style.border=u.fileBasedScanRegionActiveBorder(),j.stopPropagation(),j.preventDefault()}),this.fileBasedScanRegion.addEventListener("drop",function(j){j.stopPropagation(),j.preventDefault(),u.fileBasedScanRegion.style.border=u.fileBasedScanRegionDefaultBorder();var b=j.dataTransfer;if(b){var f=b.files;if(!f||f.length===0)return;for(var y=!1,N=0;N<f.length;++N){var I=f.item(N);if(I){var R=/image.*/;if(I.type.match(R)){y=!0;var k=I.name;u.setImageNameToButton(k),c(I),x.innerText=Cs.dragAndDropMessage();break}}}y||(x.innerText=Cs.dragAndDropMessageOnlyImages())}})}return r.prototype.hide=function(){this.fileBasedScanRegion.style.display="none",this.fileScanInput.disabled=!0},r.prototype.show=function(){this.fileBasedScanRegion.style.display="block",this.fileScanInput.disabled=!1},r.prototype.isShowing=function(){return this.fileBasedScanRegion.style.display==="block"},r.prototype.resetValue=function(){this.fileScanInput.value="",this.setInitialValueToButton()},r.prototype.createFileBasedScanRegion=function(){var a=document.createElement("div");return a.style.textAlign="center",a.style.margin="auto",a.style.width="80%",a.style.maxWidth="600px",a.style.border=this.fileBasedScanRegionDefaultBorder(),a.style.padding="10px",a.style.marginBottom="10px",a},r.prototype.fileBasedScanRegionDefaultBorder=function(){return"6px dashed #ebebeb"},r.prototype.fileBasedScanRegionActiveBorder=function(){return"6px dashed rgb(153 151 151)"},r.prototype.createDragAndDropMessage=function(){var a=document.createElement("div");return a.innerText=Cs.dragAndDropMessage(),a.style.fontWeight="400",a},r.prototype.setImageNameToButton=function(a){var i=20;if(a.length>i){var c=a.substring(0,8),m=a.length,u=a.substring(m-8,m);a="".concat(c,"....").concat(u)}var x=Cs.fileSelectionChooseAnother()+" - "+a;this.fileSelectionButton.innerText=x},r.prototype.setInitialValueToButton=function(){var a=Cs.fileSelectionChooseImage()+" - "+Cs.fileSelectionNoImageSelected();this.fileSelectionButton.innerText=a},r.prototype.getFileScanInputId=function(){return"html5-qrcode-private-filescan-input"},r.create=function(a,i,c){var m=new r(a,i,c);return m},r}(),P0=function(){function r(a){this.selectElement=ta.createElement("select",kr.CAMERA_SELECTION_SELECT_ID),this.cameras=a,this.options=[]}return r.prototype.render=function(a){var i=document.createElement("span");i.style.marginRight="10px";var c=this.cameras.length;if(c===0)throw new Error("No cameras found");if(c===1)i.style.display="none";else{var m=Cs.selectCamera();i.innerText="".concat(m," (").concat(this.cameras.length,")  ")}for(var u=1,x=0,j=this.cameras;x<j.length;x++){var b=j[x],f=b.id,y=b.label==null?f:b.label;(!y||y==="")&&(y=[Cs.anonymousCameraPrefix(),u++].join(" "));var N=document.createElement("option");N.value=f,N.innerText=y,this.options.push(N),this.selectElement.appendChild(N)}i.appendChild(this.selectElement),a.appendChild(i)},r.prototype.disable=function(){this.selectElement.disabled=!0},r.prototype.isDisabled=function(){return this.selectElement.disabled===!0},r.prototype.enable=function(){this.selectElement.disabled=!1},r.prototype.getValue=function(){return this.selectElement.value},r.prototype.hasValue=function(a){for(var i=0,c=this.options;i<c.length;i++){var m=c[i];if(m.value===a)return!0}return!1},r.prototype.setValue=function(a){if(!this.hasValue(a))throw new Error("".concat(a," is not present in the camera list."));this.selectElement.value=a},r.prototype.hasSingleItem=function(){return this.cameras.length===1},r.prototype.numCameras=function(){return this.cameras.length},r.create=function(a,i){var c=new r(i);return c.render(a),c},r}(),F0=function(){function r(){this.onChangeCallback=null,this.zoomElementContainer=document.createElement("div"),this.rangeInput=ta.createElement("input",kr.ZOOM_SLIDER_ID),this.rangeInput.type="range",this.rangeText=document.createElement("span"),this.rangeInput.min="1",this.rangeInput.max="5",this.rangeInput.value="1",this.rangeInput.step="0.1"}return r.prototype.render=function(a,i){this.zoomElementContainer.style.display=i?"block":"none",this.zoomElementContainer.style.padding="5px 10px",this.zoomElementContainer.style.textAlign="center",a.appendChild(this.zoomElementContainer),this.rangeInput.style.display="inline-block",this.rangeInput.style.width="50%",this.rangeInput.style.height="5px",this.rangeInput.style.background="#d3d3d3",this.rangeInput.style.outline="none",this.rangeInput.style.opacity="0.7";var c=Cs.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(c),this.rangeText.style.marginRight="10px";var m=this;this.rangeInput.addEventListener("input",function(){return m.onValueChange()}),this.rangeInput.addEventListener("change",function(){return m.onValueChange()}),this.zoomElementContainer.appendChild(this.rangeInput),this.zoomElementContainer.appendChild(this.rangeText)},r.prototype.onValueChange=function(){var a=Cs.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(a),this.onChangeCallback&&this.onChangeCallback(parseFloat(this.rangeInput.value))},r.prototype.setValues=function(a,i,c,m){this.rangeInput.min=a.toString(),this.rangeInput.max=i.toString(),this.rangeInput.step=m.toString(),this.rangeInput.value=c.toString(),this.onValueChange()},r.prototype.show=function(){this.zoomElementContainer.style.display="block"},r.prototype.hide=function(){this.zoomElementContainer.style.display="none"},r.prototype.setOnCameraZoomValueChangeCallback=function(a){this.onChangeCallback=a},r.prototype.removeOnCameraZoomValueChangeCallback=function(){this.onChangeCallback=null},r.create=function(a,i){var c=new r;return c.render(a,i),c},r}(),Er;(function(r){r[r.STATUS_DEFAULT=0]="STATUS_DEFAULT",r[r.STATUS_SUCCESS=1]="STATUS_SUCCESS",r[r.STATUS_WARNING=2]="STATUS_WARNING",r[r.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(Er||(Er={}));function B0(r){return{fps:r.fps,qrbox:r.qrbox,aspectRatio:r.aspectRatio,disableFlip:r.disableFlip,videoConstraints:r.videoConstraints}}function z0(r,a){return{formatsToSupport:r.formatsToSupport,useBarCodeDetectorIfSupported:r.useBarCodeDetectorIfSupported,experimentalFeatures:r.experimentalFeatures,verbose:a}}var U0=function(){function r(a,i,c){if(this.lastMatchFound=null,this.cameraScanImage=null,this.fileScanImage=null,this.fileSelectionUi=null,this.elementId=a,this.config=this.createConfig(i),this.verbose=c===!0,!document.getElementById(a))throw"HTML Element with id=".concat(a," not found");this.scanTypeSelector=new ca(this.config.supportedScanTypes),this.currentScanType=this.scanTypeSelector.getDefaultScanType(),this.sectionSwapAllowed=!0,this.logger=new _c(this.verbose),this.persistedDataManager=new k0,i.rememberLastUsedCamera!==!0&&this.persistedDataManager.reset()}return r.prototype.render=function(a,i){var c=this;this.lastMatchFound=null,this.qrCodeSuccessCallback=function(u,x){if(a)a(u,x);else{if(c.lastMatchFound===u)return;c.lastMatchFound=u,c.setHeaderMessage(Cs.lastMatch(u),Er.STATUS_SUCCESS)}},this.qrCodeErrorCallback=function(u,x){i&&i(u,x)};var m=document.getElementById(this.elementId);if(!m)throw"HTML Element with id=".concat(this.elementId," not found");m.innerHTML="",this.createBasicLayout(m),this.html5Qrcode=new go(this.getScanRegionId(),z0(this.config,this.verbose))},r.prototype.pause=function(a){(Wr(a)||a!==!0)&&(a=!1),this.getHtml5QrcodeOrFail().pause(a)},r.prototype.resume=function(){this.getHtml5QrcodeOrFail().resume()},r.prototype.getState=function(){return this.getHtml5QrcodeOrFail().getState()},r.prototype.clear=function(){var a=this,i=function(){var c=document.getElementById(a.elementId);c&&(c.innerHTML="",a.resetBasicLayout(c))};return this.html5Qrcode?new Promise(function(c,m){if(!a.html5Qrcode){c();return}a.html5Qrcode.isScanning?a.html5Qrcode.stop().then(function(u){if(!a.html5Qrcode){c();return}a.html5Qrcode.clear(),i(),c()}).catch(function(u){a.verbose&&a.logger.logError("Unable to stop qrcode scanner",u),m(u)}):(a.html5Qrcode.clear(),i(),c())}):Promise.resolve()},r.prototype.getRunningTrackCapabilities=function(){return this.getHtml5QrcodeOrFail().getRunningTrackCapabilities()},r.prototype.getRunningTrackSettings=function(){return this.getHtml5QrcodeOrFail().getRunningTrackSettings()},r.prototype.applyVideoConstraints=function(a){return this.getHtml5QrcodeOrFail().applyVideoConstraints(a)},r.prototype.getHtml5QrcodeOrFail=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode},r.prototype.createConfig=function(a){return a?(a.fps||(a.fps=Pr.SCAN_DEFAULT_FPS),a.rememberLastUsedCamera!==!Pr.DEFAULT_REMEMBER_LAST_CAMERA_USED&&(a.rememberLastUsedCamera=Pr.DEFAULT_REMEMBER_LAST_CAMERA_USED),a.supportedScanTypes||(a.supportedScanTypes=Pr.DEFAULT_SUPPORTED_SCAN_TYPE),a):{fps:Pr.SCAN_DEFAULT_FPS,rememberLastUsedCamera:Pr.DEFAULT_REMEMBER_LAST_CAMERA_USED,supportedScanTypes:Pr.DEFAULT_SUPPORTED_SCAN_TYPE}},r.prototype.createBasicLayout=function(a){a.style.position="relative",a.style.padding="0px",a.style.border="1px solid silver",this.createHeader(a);var i=document.createElement("div"),c=this.getScanRegionId();i.id=c,i.style.width="100%",i.style.minHeight="100px",i.style.textAlign="center",a.appendChild(i),ca.isCameraScanType(this.currentScanType)?this.insertCameraScanImageToScanRegion():this.insertFileScanImageToScanRegion();var m=document.createElement("div"),u=this.getDashboardId();m.id=u,m.style.width="100%",a.appendChild(m),this.setupInitialDashboard(m)},r.prototype.resetBasicLayout=function(a){a.style.border="none"},r.prototype.setupInitialDashboard=function(a){this.createSection(a),this.createSectionControlPanel(),this.scanTypeSelector.hasMoreThanOneScanType()&&this.createSectionSwap()},r.prototype.createHeader=function(a){var i=document.createElement("div");i.style.textAlign="left",i.style.margin="0px",a.appendChild(i);var c=new I0;c.renderInto(i);var m=document.createElement("div");m.id=this.getHeaderMessageContainerId(),m.style.display="none",m.style.textAlign="center",m.style.fontSize="14px",m.style.padding="2px 10px",m.style.margin="4px",m.style.borderTop="1px solid #f6f6f6",i.appendChild(m)},r.prototype.createSection=function(a){var i=document.createElement("div");i.id=this.getDashboardSectionId(),i.style.width="100%",i.style.padding="10px 0px 10px 0px",i.style.textAlign="left",a.appendChild(i)},r.prototype.createCameraListUi=function(a,i,c){var m=this;m.showHideScanTypeSwapLink(!1),m.setHeaderMessage(Cs.cameraPermissionRequesting());var u=function(){c||m.createPermissionButton(a,i)};go.getCameras().then(function(x){m.persistedDataManager.setHasPermission(!0),m.showHideScanTypeSwapLink(!0),m.resetHeaderMessage(),x&&x.length>0?(a.removeChild(i),m.renderCameraSelection(x)):(m.setHeaderMessage(Cs.noCameraFound(),Er.STATUS_WARNING),u())}).catch(function(x){m.persistedDataManager.setHasPermission(!1),c?c.disabled=!1:u(),m.setHeaderMessage(x,Er.STATUS_WARNING),m.showHideScanTypeSwapLink(!0)})},r.prototype.createPermissionButton=function(a,i){var c=this,m=ta.createElement("button",this.getCameraPermissionButtonId());m.innerText=Cs.cameraPermissionTitle(),m.addEventListener("click",function(){m.disabled=!0,c.createCameraListUi(a,i,m)}),i.appendChild(m)},r.prototype.createPermissionsUi=function(a,i){var c=this;if(ca.isCameraScanType(this.currentScanType)&&this.persistedDataManager.hasCameraPermissions()){bo.hasPermissions().then(function(m){m?c.createCameraListUi(a,i):(c.persistedDataManager.setHasPermission(!1),c.createPermissionButton(a,i))}).catch(function(m){c.persistedDataManager.setHasPermission(!1),c.createPermissionButton(a,i)});return}this.createPermissionButton(a,i)},r.prototype.createSectionControlPanel=function(){var a=document.getElementById(this.getDashboardSectionId()),i=document.createElement("div");a.appendChild(i);var c=document.createElement("div");c.id=this.getDashboardSectionCameraScanRegionId(),c.style.display=ca.isCameraScanType(this.currentScanType)?"block":"none",i.appendChild(c);var m=document.createElement("div");m.style.textAlign="center",c.appendChild(m),this.scanTypeSelector.isCameraScanRequired()&&this.createPermissionsUi(c,m),this.renderFileScanUi(i)},r.prototype.renderFileScanUi=function(a){var i=ca.isFileScanType(this.currentScanType),c=this,m=function(u){if(!c.html5Qrcode)throw"html5Qrcode not defined";ca.isFileScanType(c.currentScanType)&&(c.setHeaderMessage(Cs.loadingImage()),c.html5Qrcode.scanFileV2(u,!0).then(function(x){c.resetHeaderMessage(),c.qrCodeSuccessCallback(x.decodedText,x)}).catch(function(x){c.setHeaderMessage(x,Er.STATUS_WARNING),c.qrCodeErrorCallback(x,Sc.createFrom(x))}))};this.fileSelectionUi=O0.create(a,i,m)},r.prototype.renderCameraSelection=function(a){var i=this,c=this,m=document.getElementById(this.getDashboardSectionCameraScanRegionId());m.style.textAlign="center";var u=F0.create(m,!1),x=function(E){var v=E.zoomFeature();if(v.isSupported()){u.setOnCameraZoomValueChangeCallback(function(F){v.apply(F)});var U=1;i.config.defaultZoomValueIfSupported&&(U=i.config.defaultZoomValueIfSupported),U=n0(U,v.min(),v.max()),u.setValues(v.min(),v.max(),U,v.step()),u.show()}},j=P0.create(m,a),b=document.createElement("span"),f=ta.createElement("button",kr.CAMERA_START_BUTTON_ID);f.innerText=Cs.scanButtonStartScanningText(),b.appendChild(f);var y=ta.createElement("button",kr.CAMERA_STOP_BUTTON_ID);y.innerText=Cs.scanButtonStopScanningText(),y.style.display="none",y.disabled=!0,b.appendChild(y);var N,I=function(E){if(!E.torchFeature().isSupported()){N&&N.hide();return}N?N.updateTorchCapability(E.torchFeature()):N=L0.create(b,E.torchFeature(),{display:"none",marginLeft:"5px"},function(v){c.setHeaderMessage(v,Er.STATUS_WARNING)}),N.show()};m.appendChild(b);var R=function(E){E||(f.style.display="none"),f.innerText=Cs.scanButtonStartScanningText(),f.style.opacity="1",f.disabled=!1,E&&(f.style.display="inline-block")};if(f.addEventListener("click",function(E){f.innerText=Cs.scanButtonScanningStarting(),j.disable(),f.disabled=!0,f.style.opacity="0.5",i.scanTypeSelector.hasMoreThanOneScanType()&&c.showHideScanTypeSwapLink(!1),c.resetHeaderMessage();var v=j.getValue();c.persistedDataManager.setLastUsedCameraId(v),c.html5Qrcode.start(v,B0(c.config),c.qrCodeSuccessCallback,c.qrCodeErrorCallback).then(function(U){y.disabled=!1,y.style.display="inline-block",R(!1);var F=c.html5Qrcode.getRunningTrackCameraCapabilities();i.config.showTorchButtonIfSupported===!0&&I(F),i.config.showZoomSliderIfSupported===!0&&x(F)}).catch(function(U){c.showHideScanTypeSwapLink(!0),j.enable(),R(!0),c.setHeaderMessage(U,Er.STATUS_WARNING)})}),j.hasSingleItem()&&f.click(),y.addEventListener("click",function(E){if(!c.html5Qrcode)throw"html5Qrcode not defined";y.disabled=!0,c.html5Qrcode.stop().then(function(v){i.scanTypeSelector.hasMoreThanOneScanType()&&c.showHideScanTypeSwapLink(!0),j.enable(),f.disabled=!1,y.style.display="none",f.style.display="inline-block",N&&(N.reset(),N.hide()),u.removeOnCameraZoomValueChangeCallback(),u.hide(),c.insertCameraScanImageToScanRegion()}).catch(function(v){y.disabled=!1,c.setHeaderMessage(v,Er.STATUS_WARNING)})}),c.persistedDataManager.getLastUsedCameraId()){var k=c.persistedDataManager.getLastUsedCameraId();j.hasValue(k)?(j.setValue(k),f.click()):c.persistedDataManager.resetLastUsedCameraId()}},r.prototype.createSectionSwap=function(){var a=this,i=Cs.textIfCameraScanSelected(),c=Cs.textIfFileScanSelected(),m=document.getElementById(this.getDashboardSectionId()),u=document.createElement("div");u.style.textAlign="center";var x=ta.createElement("span",this.getDashboardSectionSwapLinkId());x.style.textDecoration="underline",x.style.cursor="pointer",x.innerText=ca.isCameraScanType(this.currentScanType)?i:c,x.addEventListener("click",function(){if(!a.sectionSwapAllowed){a.verbose&&a.logger.logError("Section swap called when not allowed");return}a.resetHeaderMessage(),a.fileSelectionUi.resetValue(),a.sectionSwapAllowed=!1,ca.isCameraScanType(a.currentScanType)?(a.clearScanRegion(),a.getCameraScanRegion().style.display="none",a.fileSelectionUi.show(),x.innerText=c,a.currentScanType=fa.SCAN_TYPE_FILE,a.insertFileScanImageToScanRegion()):(a.clearScanRegion(),a.getCameraScanRegion().style.display="block",a.fileSelectionUi.hide(),x.innerText=i,a.currentScanType=fa.SCAN_TYPE_CAMERA,a.insertCameraScanImageToScanRegion(),a.startCameraScanIfPermissionExistsOnSwap()),a.sectionSwapAllowed=!0}),u.appendChild(x),m.appendChild(u)},r.prototype.startCameraScanIfPermissionExistsOnSwap=function(){var a=this,i=this;if(this.persistedDataManager.hasCameraPermissions()){bo.hasPermissions().then(function(c){if(c){var m=document.getElementById(i.getCameraPermissionButtonId());if(!m)throw a.logger.logError("Permission button not found, fail;"),"Permission button not found";m.click()}else i.persistedDataManager.setHasPermission(!1)}).catch(function(c){i.persistedDataManager.setHasPermission(!1)});return}},r.prototype.resetHeaderMessage=function(){var a=document.getElementById(this.getHeaderMessageContainerId());a.style.display="none"},r.prototype.setHeaderMessage=function(a,i){i||(i=Er.STATUS_DEFAULT);var c=this.getHeaderMessageDiv();switch(c.innerText=a,c.style.display="block",i){case Er.STATUS_SUCCESS:c.style.background="rgba(106, 175, 80, 0.26)",c.style.color="#477735";break;case Er.STATUS_WARNING:c.style.background="rgba(203, 36, 49, 0.14)",c.style.color="#cb2431";break;case Er.STATUS_DEFAULT:default:c.style.background="rgba(0, 0, 0, 0)",c.style.color="rgb(17, 17, 17)";break}},r.prototype.showHideScanTypeSwapLink=function(a){this.scanTypeSelector.hasMoreThanOneScanType()&&(a!==!0&&(a=!1),this.sectionSwapAllowed=a,this.getDashboardSectionSwapLink().style.display=a?"inline-block":"none")},r.prototype.insertCameraScanImageToScanRegion=function(){var a=this,i=document.getElementById(this.getScanRegionId());if(this.cameraScanImage){i.innerHTML="<br>",i.appendChild(this.cameraScanImage);return}this.cameraScanImage=new Image,this.cameraScanImage.onload=function(c){i.innerHTML="<br>",i.appendChild(a.cameraScanImage)},this.cameraScanImage.width=64,this.cameraScanImage.style.opacity="0.8",this.cameraScanImage.src=_0,this.cameraScanImage.alt=Cs.cameraScanAltText()},r.prototype.insertFileScanImageToScanRegion=function(){var a=this,i=document.getElementById(this.getScanRegionId());if(this.fileScanImage){i.innerHTML="<br>",i.appendChild(this.fileScanImage);return}this.fileScanImage=new Image,this.fileScanImage.onload=function(c){i.innerHTML="<br>",i.appendChild(a.fileScanImage)},this.fileScanImage.width=64,this.fileScanImage.style.opacity="0.8",this.fileScanImage.src=E0,this.fileScanImage.alt=Cs.fileScanAltText()},r.prototype.clearScanRegion=function(){var a=document.getElementById(this.getScanRegionId());a.innerHTML=""},r.prototype.getDashboardSectionId=function(){return"".concat(this.elementId,"__dashboard_section")},r.prototype.getDashboardSectionCameraScanRegionId=function(){return"".concat(this.elementId,"__dashboard_section_csr")},r.prototype.getDashboardSectionSwapLinkId=function(){return kr.SCAN_TYPE_CHANGE_ANCHOR_ID},r.prototype.getScanRegionId=function(){return"".concat(this.elementId,"__scan_region")},r.prototype.getDashboardId=function(){return"".concat(this.elementId,"__dashboard")},r.prototype.getHeaderMessageContainerId=function(){return"".concat(this.elementId,"__header_message")},r.prototype.getCameraPermissionButtonId=function(){return kr.CAMERA_PERMISSION_BUTTON_ID},r.prototype.getCameraScanRegion=function(){return document.getElementById(this.getDashboardSectionCameraScanRegionId())},r.prototype.getDashboardSectionSwapLink=function(){return document.getElementById(this.getDashboardSectionSwapLinkId())},r.prototype.getHeaderMessageDiv=function(){return document.getElementById(this.getHeaderMessageContainerId())},r}();const xl=({onClose:r,onScan:a})=>{const i=hs(),[c,m]=g.useState(""),[u,x]=g.useState(!1),[j,b]=g.useState(!1);return g.useEffect(()=>{const f=new U0("reader",{qrbox:{width:250,height:250},fps:5,aspectRatio:1,showTorchButtonIfSupported:!0,showZoomSliderIfSupported:!0,defaultZoomValueIfSupported:2},!1);return x(!0),f.render(y=>{if(y)if(a)a(y),b(!0),m(""),setTimeout(()=>{r()},500);else{const N=y;N!=null&&N.startsWith("DEV-")?(b(!0),m(""),setTimeout(()=>{i(`/devices/${N}`),r()},500)):(m("Invalid device QR code. Please scan a valid device barcode."),b(!1))}},y=>{y&&(m("Error accessing camera. Please check camera permissions."),x(!1),console.error(y))}),()=>{f.clear(),x(!1)}},[i,r,a]),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"relative w-full max-w-md sm:max-w-lg mx-auto bg-white rounded-lg shadow-xl overflow-hidden transform transition-all",children:[e.jsx("div",{className:"absolute top-3 right-3 z-10",children:e.jsx("button",{onClick:r,className:"p-2 rounded-full bg-black/50 text-white hover:bg-black/70 transition-colors","aria-label":"Close scanner",children:e.jsx(tr,{size:18,className:"sm:w-5 sm:h-5"})})}),e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 sm:mb-4",children:[e.jsx(vn,{size:20,className:"sm:w-5 sm:h-5 text-blue-600"}),e.jsx("h3",{className:"text-base sm:text-lg font-bold text-gray-900",children:"Scan Device QR Code"})]}),e.jsxs("div",{className:"relative aspect-square overflow-hidden rounded-lg mb-4",children:[e.jsx("div",{id:"reader",className:"w-full h-full"}),e.jsx("div",{className:"absolute inset-0 border-2 border-blue-500/50 pointer-events-none"}),u&&!j&&e.jsx("div",{className:"absolute top-2 left-2 bg-blue-500 text-white px-2 py-1 rounded-full text-xs font-medium",children:"Scanning..."}),j&&e.jsx("div",{className:"absolute top-2 left-2 bg-green-500 text-white px-2 py-1 rounded-full text-xs font-medium",children:"Found!"})]}),c&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsx(dr,{size:16,className:"text-red-600 flex-shrink-0"}),e.jsx("p",{className:"text-red-600 text-sm",children:c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 text-center",children:"Point your camera at a device QR code to scan"}),e.jsx(X,{onClick:r,variant:"secondary",className:"w-full text-sm",children:"Cancel Scan"})]})]})]})})},$0=async r=>{var a;try{const{data:{user:i}}=await G.auth.getUser();if(!i)throw new Error("User not authenticated");const{data:c,error:m}=await G.from("diagnostic_requests").insert({title:r.title,created_by:i.id,assigned_to:r.assigned_to,notes:r.notes}).select().single();if(m)throw m;const u=[];for(const j of r.devices){const b=j.quantity||1;if(b===1)u.push({diagnostic_request_id:c.id,device_name:j.device_name,serial_number:j.serial_number,model:j.model,notes:j.notes});else for(let f=0;f<b;f++){const y=((a=j.individual_serials)==null?void 0:a[f])||`${j.serial_number||"SN"}-${f+1}`;u.push({diagnostic_request_id:c.id,device_name:j.device_name,serial_number:y,model:j.model,notes:j.notes})}}const{error:x}=await G.from("diagnostic_devices").insert(u);if(x)throw x;return te.success("Diagnostic request created successfully"),c}catch(i){return console.error("Error creating diagnostic request:",i),te.error(i.message||"Failed to create diagnostic request"),null}},En=async r=>{try{let a=G.from("diagnostic_requests").select(`
        *,
        created_by_user:auth_users!diagnostic_requests_created_by_fkey(id, name, username),
        assigned_to_user:auth_users!diagnostic_requests_assigned_to_fkey(id, name, username),
        devices:diagnostic_devices(
          *,
          checks:diagnostic_checks(*)
        )
      `).order("created_at",{ascending:!1});r!=null&&r.status&&(a=a.eq("status",r.status)),r!=null&&r.assigned_to&&(a=a.eq("assigned_to",r.assigned_to)),r!=null&&r.created_by&&(a=a.eq("created_by",r.created_by)),r!=null&&r.date_from&&(a=a.gte("created_at",r.date_from)),r!=null&&r.date_to&&(a=a.lte("created_at",r.date_to));const{data:i,error:c}=await a;if(c)throw console.error("Supabase error:",c),c;return(i||[]).map(u=>{const x=u.devices||[],j=x.length,b=x.filter(N=>N.result_status==="passed").length,f=x.filter(N=>N.result_status==="failed").length,y=x.filter(N=>N.result_status==="pending").length;return{...u,device_count:j,passed_devices:b,failed_devices:f,pending_devices:y}})}catch(a){return console.error("Error fetching diagnostic requests:",a),te.error(a.message||"Failed to fetch diagnostic requests"),[]}},gl=async r=>{try{const{data:a,error:i}=await G.from("diagnostic_requests").select(`
        *,
        created_by_user:auth_users!diagnostic_requests_created_by_fkey(id, name, username),
        assigned_to_user:auth_users!diagnostic_requests_assigned_to_fkey(id, name, username),
        devices:diagnostic_devices(
          *,
          checks:diagnostic_checks(*)
        )
      `).eq("id",r).single();if(i)throw i;return a}catch(a){return console.error("Error fetching diagnostic request:",a),te.error(a.message||"Failed to fetch diagnostic request"),null}},wo=async(r,a)=>{try{const{error:i}=await G.from("diagnostic_requests").update(a).eq("id",r);if(i)throw i;return te.success("Diagnostic request updated successfully"),!0}catch(i){return console.error("Error updating diagnostic request:",i),te.error(i.message||"Failed to update diagnostic request"),!1}},Si=async(r,a)=>{try{const{error:i}=await G.from("diagnostic_devices").update(a).eq("id",r);if(i)throw i;return te.success("Device updated successfully"),!0}catch(i){return console.error("Error updating diagnostic device:",i),te.error(i.message||"Failed to update device"),!1}},q0=async(r,a)=>{try{const{data:i,error:c}=await G.from("diagnostic_checks").insert({diagnostic_device_id:r,test_item:a.test_item,result:a.result,remarks:a.remarks,image_url:a.image_url}).select().single();if(c)throw c;return te.success("Check result saved successfully"),i}catch(i){return console.error("Error creating diagnostic check:",i),te.error(i.message||"Failed to save check result"),null}},V0=async(r,a)=>{try{const{error:i}=await G.from("diagnostic_checks").update({test_item:a.test_item,result:a.result,remarks:a.remarks,image_url:a.image_url}).eq("id",r);if(i)throw i;return te.success("Check result updated successfully"),!0}catch(i){return console.error("Error updating diagnostic check:",i),te.error(i.message||"Failed to update check result"),!1}},qi=async r=>{try{const{data:a,error:i}=await G.from("diagnostic_checks").select("*").eq("diagnostic_device_id",r).order("created_at",{ascending:!0});if(i)throw i;return a||[]}catch(a){return console.error("Error fetching diagnostic checks:",a),te.error(a.message||"Failed to fetch diagnostic checks"),[]}},Tc=async()=>{try{const{data:r,error:a}=await G.from("diagnostic_templates").select("*").order("device_type",{ascending:!0});if(a)throw a;return r||[]}catch(r){return console.error("Error fetching diagnostic templates:",r),te.error(r.message||"Failed to fetch diagnostic templates"),[]}},Ic=async r=>{try{const{data:a,error:i}=await G.from("diagnostic_templates").select("*").eq("device_type",r).single();if(i)throw i;return a}catch(a){return console.error("Error fetching diagnostic template:",a),null}},G0=async r=>{try{const{data:a,error:i}=await G.from("diagnostic_templates").insert(r).select().single();if(i)throw i;return te.success("Diagnostic template created successfully"),a}catch(a){return console.error("Error creating diagnostic template:",a),te.error(a.message||"Failed to create diagnostic template"),null}},H0=async(r,a)=>{try{const{error:i}=await G.from("diagnostic_templates").update(a).eq("id",r);if(i)throw i;return te.success("Diagnostic template updated successfully"),!0}catch(i){return console.error("Error updating diagnostic template:",i),te.error(i.message||"Failed to update diagnostic template"),!1}},W0=async r=>{try{const{error:a}=await G.from("diagnostic_templates").delete().eq("id",r);if(a)throw a;return te.success("Diagnostic template deleted successfully"),!0}catch(a){return console.error("Error deleting diagnostic template:",a),te.error(a.message||"Failed to delete diagnostic template"),!1}},fl=async()=>{try{const{data:r,error:a}=await G.from("diagnostic_requests").select("status");if(a)throw a;const{data:i,error:c}=await G.from("diagnostic_devices").select("result_status");if(c)throw c;return{total_requests:(r==null?void 0:r.length)||0,pending_requests:(r==null?void 0:r.filter(u=>u.status==="pending").length)||0,in_progress_requests:(r==null?void 0:r.filter(u=>u.status==="in_progress").length)||0,completed_requests:(r==null?void 0:r.filter(u=>u.status==="completed").length)||0,total_devices:(i==null?void 0:i.length)||0,passed_devices:(i==null?void 0:i.filter(u=>u.result_status==="passed").length)||0,failed_devices:(i==null?void 0:i.filter(u=>u.result_status==="failed").length)||0,partially_failed_devices:(i==null?void 0:i.filter(u=>u.result_status==="partially_failed").length)||0,pending_devices:(i==null?void 0:i.filter(u=>u.result_status==="pending").length)||0}}catch(r){return console.error("Error fetching diagnostic stats:",r),{total_requests:0,pending_requests:0,in_progress_requests:0,completed_requests:0,total_devices:0,passed_devices:0,failed_devices:0,partially_failed_devices:0,pending_devices:0}}},Y0=async r=>{try{const{data:{user:a}}=await G.auth.getUser();if(!a)throw new Error("User not authenticated");let i="admin_reviewed";switch(r.next_action){case"repair":i="repair_required";break;case"replace":i="replacement_required";break;case"ignore":i="no_action_required";break;case"escalate":i="escalated";break}const{error:c}=await G.from("diagnostic_devices").update({admin_feedback:r.admin_feedback,next_action:r.next_action,feedback_submitted_at:new Date().toISOString(),feedback_submitted_by:a.id,result_status:i}).eq("id",r.device_id);if(c)throw c;return te.success("Admin feedback submitted successfully"),!0}catch(a){return console.error("Error submitting admin feedback:",a),te.error(a.message||"Failed to submit admin feedback"),!1}},X0=async()=>{try{const{data:r,error:a}=await G.from("auth_users").select("id, name, username").eq("role","technician").order("name",{ascending:!0});if(a)throw a;return r||[]}catch(r){return console.error("Error fetching technicians:",r),[]}},es=({isOpen:r,onClose:a,title:i,children:c,maxHeight:m,actions:u})=>r?e.jsx("div",{className:"modal-backdrop",style:{position:"fixed",inset:0,zIndex:50,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.4)",backdropFilter:"blur(2px)"},children:e.jsxs("div",{className:"modal-content",style:{background:"#fff",border:"1px solid #e5e7eb",boxShadow:"0 12px 48px 0 rgba(0,0,0,0.18)",width:"100%",maxWidth:780,maxHeight:m||"90vh",borderRadius:15,display:"flex",flexDirection:"column",overflow:"hidden",margin:"0 1rem",padding:1,position:"relative"},children:[i&&e.jsx("div",{className:"font-bold text-xl mb-4 text-gray-900",style:{paddingTop:32,paddingRight:32,paddingBottom:0,paddingLeft:32},children:i}),e.jsx("div",{style:{flex:1,overflowY:"auto",paddingTop:i?16:32,paddingRight:35,paddingBottom:35,paddingLeft:35},children:c}),u&&e.jsx("div",{style:{flexShrink:0,width:"100%",background:"#fff",boxShadow:"0 -2px 8px rgba(0,0,0,0.05)",borderTop:"1px solid #e5e7eb",zIndex:1,display:"flex",justifyContent:"flex-start",padding:15},children:u}),e.jsx("button",{onClick:a,className:"absolute top-3 right-5 text-2xl text-gray-500 hover:text-gray-800 bg-transparent border-none cursor-pointer",style:{lineHeight:1},children:"×"})]})}):null,K0=({isOpen:r,onClose:a})=>{const{currentUser:i}=Wt(),{userGoals:c,loading:m,updateGoal:u,createGoal:x,deleteGoal:j}=dl(),[b,f]=g.useState(null),[y,N]=g.useState("new_customers"),[I,R]=g.useState(5),[k,E]=g.useState(5),v={new_customers:"New Customers",devices_processed:"Devices Processed",checkins:"Customer Check-ins",repairs_completed:"Repairs Completed"},U={new_customers:_s,devices_processed:cn,checkins:nr,repairs_completed:Ss},F=(i==null?void 0:i.role)==="admin",L=(_,D)=>{F&&(f(_),E(D))},C=async()=>{if(!b||!F)return;await u(b,{goal_value:k})?(te.success("Goal updated successfully!"),f(null)):te.error("Failed to update goal")},$=async()=>{if(!F){te.error("Only administrators can create goals");return}await x({goal_type:y,goal_value:I})?(te.success("Goal created successfully!"),N("new_customers"),R(5)):te.error("Failed to create goal")},Y=async _=>{if(!F){te.error("Only administrators can delete goals");return}if(!confirm("Are you sure you want to delete this goal?"))return;await j(_)?te.success("Goal deleted successfully!"):te.error("Failed to delete goal")},Z=(i==null?void 0:i.role)==="customer-care"?["new_customers","checkins"]:(i==null?void 0:i.role)==="technician"?["devices_processed","repairs_completed"]:["new_customers","devices_processed"];return e.jsx(es,{isOpen:r,onClose:a,title:F?"Manage Daily Goals":"View Daily Goals",children:e.jsxs("div",{className:"space-y-6 max-h-[80vh] overflow-y-auto",children:[!F&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ti,{className:"h-5 w-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold text-blue-900",children:"Admin Only"})]}),e.jsx("p",{className:"text-sm text-blue-800",children:"Only administrators can create, edit, or delete goals. Contact your administrator to manage your goals."})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Cn,{className:"h-5 w-5 text-blue-500"}),F?"Your Current Goals":"Your Assigned Goals"]}),m?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Loading goals..."})]}):c.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx($a,{className:"h-12 w-12 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No goals set yet. Create your first goal below!"})]}):e.jsx("div",{className:"space-y-3",children:c.map(_=>{const D=U[_.goal_type];return e.jsx("div",{className:"p-4 bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(D,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:v[_.goal_type]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Daily target: ",_.goal_value]})]})]}),F&&e.jsx("div",{className:"flex items-center gap-2",children:b===_.id?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",value:k,onChange:T=>E(parseInt(T.target.value)||0),className:"w-20 px-3 py-1 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:"1",max:"100"}),e.jsx("button",{onClick:C,className:"px-3 py-1.5 text-xs bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors shadow-sm",children:e.jsx(yt,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>L(_.id,_.goal_value),className:"px-3 py-1.5 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors shadow-sm",children:e.jsx(Ts,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Y(_.id),className:"px-3 py-1.5 text-xs bg-red-500 hover:bg-red-600 text-white rounded transition-colors shadow-sm",children:e.jsx(tr,{className:"h-4 w-4"})})]})}),!F&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Read Only"})]})]})},_.id)})})]}),F&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ut,{className:"h-5 w-5 text-green-500"}),"Add New Goal"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Goal Type"}),e.jsx("select",{value:y,onChange:_=>N(_.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:Z.map(_=>e.jsx("option",{value:_,children:v[_]},_))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Daily Target"}),e.jsx("input",{type:"number",value:I,onChange:_=>R(parseInt(_.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:"1",max:"100",placeholder:"Enter daily target"})]}),e.jsxs("button",{onClick:$,className:"w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-sm font-medium",disabled:I<=0,children:[e.jsx(Ut,{className:"h-4 w-4 mr-2"}),"Create Goal"]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx($a,{className:"h-5 w-5 text-blue-600"}),F?"Tips":"Goal Tips"]}),e.jsx("ul",{className:"text-sm text-blue-800 space-y-2",children:F?e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-1",children:"•"}),e.jsx("span",{children:"Set realistic goals based on your role and experience"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-1",children:"•"}),e.jsx("span",{children:"You can have multiple goals of different types"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-1",children:"•"}),e.jsx("span",{children:"Goals help track your daily progress and motivation"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-1",children:"•"}),e.jsx("span",{children:"Adjust goals as you improve and grow"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-1",children:"•"}),e.jsx("span",{children:"View your assigned goals and daily targets"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-1",children:"•"}),e.jsx("span",{children:"Contact your administrator to modify goals"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-1",children:"•"}),e.jsx("span",{children:"Goals help track your daily progress and motivation"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-1",children:"•"}),e.jsx("span",{children:"Focus on achieving your assigned targets"})]})]})})]})]})})},Z0=({isOpen:r,onClose:a})=>{const{currentUser:i}=Wt(),[c,m]=g.useState([]),[u,x]=g.useState(null),[j,b]=g.useState([]),[f,y]=g.useState(!1),[N,I]=g.useState(""),[R,k]=g.useState(null),[E,v]=g.useState("new_customers"),[U,F]=g.useState(5),[L,C]=g.useState(5),$={new_customers:"New Customers",devices_processed:"Devices Processed",checkins:"Customer Check-ins",repairs_completed:"Repairs Completed"},Y={new_customers:_s,devices_processed:cn,checkins:nr,repairs_completed:Ss},A=(i==null?void 0:i.role)==="admin",Z=async()=>{try{const J=await Zm();m(J)}catch(J){console.error("Unexpected error loading users:",J),te.error("Failed to load users")}},_=async J=>{try{y(!0);const{data:V,error:ge}=await G.from("user_daily_goals").select("*").eq("user_id",J).eq("is_active",!0).order("goal_type");if(ge){console.error("Error loading user goals:",ge),te.error("Failed to load user goals");return}b(V||[])}catch(V){console.error("Unexpected error loading user goals:",V),te.error("Failed to load user goals")}finally{y(!1)}},D=J=>{x(J),_(J.id)},T=(J,V)=>{k(J),C(V)},z=async()=>{if(!R||!u)return;await yc(R,{goal_value:L})?(te.success("Goal updated successfully!"),k(null),_(u.id)):te.error("Failed to update goal")},se=async()=>{if(!u)return;await cl({user_id:u.id,goal_type:E,goal_value:U})?(te.success("Goal created successfully!"),v("new_customers"),F(5),_(u.id)):te.error("Failed to create goal")},q=async J=>{if(!confirm("Are you sure you want to delete this goal?"))return;await wc(J)?(te.success("Goal deleted successfully!"),u&&_(u.id)):te.error("Failed to delete goal")},H=c.filter(J=>J.username.toLowerCase().includes(N.toLowerCase())||J.role.toLowerCase().includes(N.toLowerCase())||J.email&&J.email.toLowerCase().includes(N.toLowerCase()));return g.useEffect(()=>{r&&Z()},[r]),A?e.jsx(es,{isOpen:r,onClose:a,title:"Admin Goals Management",children:e.jsxs("div",{className:"space-y-6 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ws,{className:"h-5 w-5 text-blue-500"}),"Select User"]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Cr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:N,onChange:J=>I(J.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2 bg-gray-50 rounded-lg p-2",children:H.map(J=>e.jsx("div",{className:`p-3 cursor-pointer transition-all duration-200 rounded-lg border ${(u==null?void 0:u.id)===J.id?"ring-2 ring-blue-500 bg-blue-50 border-blue-200":"bg-white border-gray-200 hover:border-blue-300 hover:bg-blue-50/50"}`,onClick:()=>D(J),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:J.username}),e.jsx("p",{className:"text-sm text-gray-500 capitalize",children:J.role}),J.email&&e.jsx("p",{className:"text-xs text-gray-400",children:J.email})]}),(u==null?void 0:u.id)===J.id&&e.jsx(yt,{className:"h-5 w-5 text-blue-500"})]})},J.id))})]}),u&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Cn,{className:"h-5 w-5 text-green-500"}),"Goals for ",u.username]}),f?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Loading goals..."})]}):j.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx($a,{className:"h-12 w-12 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No goals set for this user. Create goals below!"})]}):e.jsx("div",{className:"space-y-3",children:j.map(J=>{const V=Y[J.goal_type];return e.jsx("div",{className:"p-4 bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(V,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:$[J.goal_type]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Daily target: ",J.goal_value]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:R===J.id?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",value:L,onChange:ge=>C(parseInt(ge.target.value)||0),className:"w-20 px-3 py-1 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:"1",max:"100"}),e.jsx("button",{onClick:z,className:"px-3 py-1.5 text-xs bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors shadow-sm",children:e.jsx(yt,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>T(J.id,J.goal_value),className:"px-3 py-1.5 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors shadow-sm",children:e.jsx(Ts,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>q(J.id),className:"px-3 py-1.5 text-xs bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors shadow-sm",children:e.jsx(tr,{className:"h-4 w-4"})})]})})]})},J.id)})})]}),u&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ut,{className:"h-5 w-5 text-green-500"}),"Add New Goal for ",u.username]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Goal Type"}),e.jsx("select",{value:E,onChange:J=>v(J.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:Object.keys($).map(J=>e.jsx("option",{value:J,children:$[J]},J))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Daily Target"}),e.jsx("input",{type:"number",value:U,onChange:J=>F(parseInt(J.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:"1",max:"100",placeholder:"Enter daily target"})]}),e.jsxs("button",{onClick:se,className:"w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-sm font-medium",disabled:U<=0,children:[e.jsx(Ut,{className:"h-4 w-4 mr-2"}),"Create Goal"]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(Ti,{className:"h-5 w-5 text-blue-600"}),"Admin Tips"]}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-2",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-1",children:"•"}),e.jsx("span",{children:"Select a user to view and manage their goals"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-1",children:"•"}),e.jsx("span",{children:"You can assign different goal types based on user roles"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-1",children:"•"}),e.jsx("span",{children:"Goals help motivate staff and track performance"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-1",children:"•"}),e.jsx("span",{children:"Regular goal reviews help maintain team productivity"})]})]})]})]})}):e.jsx(es,{isOpen:r,onClose:a,title:"Admin Access Required",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ti,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"Only administrators can manage user goals."})]})})},Q0=({devices:r,loading:a,searchQuery:i,setSearchQuery:c,statusFilter:m,setStatusFilter:u})=>{const{currentUser:x}=Wt(),{getDevicesDueToday:j,getOverdueDevices:b}=na(),{getGoalProgress:f}=dl(),[y,N]=g.useState(!1),[I,R]=g.useState([]),[k,E]=g.useState(!0),[v,U]=g.useState([]),[F,L]=g.useState(!0),[C,$]=g.useState(!1),[Y,A]=g.useState(!1),[Z,_]=g.useState(!1),[D,T]=g.useState(!1),[z,se]=g.useState(!1),[q,H]=g.useState(5),[J,V]=g.useState(0);g.useEffect(()=>{async function Re(){if(!(!x||x.role!=="technician")){L(!0);try{const ut=await En({assigned_to:x.id});U(ut||[])}catch(ut){console.error("Error loading diagnostic requests:",ut),U([])}finally{L(!1)}}}Re()},[x]),g.useEffect(()=>{(x==null?void 0:x.role)==="technician"&&m==="assigned"&&u("all")},[x==null?void 0:x.role,m,u]),g.useEffect(()=>{(async()=>{if(x!=null&&x.id)try{const ut=await f("repairs_completed");H(ut.goal),V(ut.progress)}catch(ut){console.warn("Goals system not available yet:",ut),H(5),V(0)}})()},[x==null?void 0:x.id,f]);const ge=r.filter(Re=>Re.assignedTo===(x==null?void 0:x.id)&&Re.status!=="repair-complete"&&Re.status!=="done"),He=g.useMemo(()=>{let Re=ge;return i&&(Re=Re.filter(ut=>ut.id.toLowerCase().includes(i.toLowerCase())||ut.customerName.toLowerCase().includes(i.toLowerCase())||ut.brand.toLowerCase().includes(i.toLowerCase())||ut.model.toLowerCase().includes(i.toLowerCase())||ut.serialNumber&&ut.serialNumber.toLowerCase().includes(i.toLowerCase())||ut.phoneNumber&&ut.phoneNumber.toLowerCase().includes(i.toLowerCase())||ut.remarks&&ut.remarks.some(Ee=>Ee.content&&Ee.content.toLowerCase().includes(i.toLowerCase())))),m!=="all"&&(Re=Re.filter(ut=>ut.status===m)),Re},[ge,i,m]),B=j().filter(Re=>Re.assignedTo===(x==null?void 0:x.id)),fe=b().filter(Re=>Re.assignedTo===(x==null?void 0:x.id)),re=ge.filter(Re=>["diagnosis-started","in-repair","reassembled-testing"].includes(Re.status)),ye=ge.filter(Re=>Re.status==="reassembled-testing"),Q=ge.filter(Re=>Re.status==="awaiting-parts"),Le=Re=>ge.filter(ut=>ut.status===Re).length,Ue=[{label:"Overdue",count:fe.length,icon:e.jsx(Ht,{className:"h-5 w-5 sm:h-6 sm:w-6 text-red-500"}),color:"from-red-500/20 to-red-400/10",priority:"high"},{label:"Due Today",count:B.length,icon:e.jsx(ms,{className:"h-5 w-5 sm:h-6 sm:w-6 text-orange-500"}),color:"from-orange-500/20 to-orange-400/10",priority:"medium"},{label:"In Progress",count:re.length,icon:e.jsx(Ss,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-500"}),color:"from-blue-500/20 to-blue-400/10",priority:"medium"},{label:"Ready for Testing",count:ye.length,icon:e.jsx(yt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-cyan-500"}),color:"from-cyan-500/20 to-cyan-400/10",priority:"low"},{label:"Awaiting Parts",count:Q.length,icon:e.jsx(Yr,{className:"h-5 w-5 sm:h-6 sm:w-6 text-yellow-500"}),color:"from-yellow-500/20 to-yellow-400/10",priority:"low"}],Ct=[{label:"Diagnosis",count:Le("diagnosis-started"),icon:e.jsx(Un,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-500"}),status:"diagnosis-started",color:"from-blue-500/20 to-blue-400/10"},{label:"Awaiting Parts",count:Le("awaiting-parts"),icon:e.jsx(Yr,{className:"h-5 w-5 sm:h-6 sm:w-6 text-yellow-500"}),status:"awaiting-parts",color:"from-yellow-400/20 to-yellow-200/10"},{label:"In Repair",count:Le("in-repair"),icon:e.jsx(Ss,{className:"h-5 w-5 sm:h-6 sm:w-6 text-purple-500"}),status:"in-repair",color:"from-purple-500/20 to-purple-400/10"},{label:"Testing",count:Le("reassembled-testing"),icon:e.jsx(yt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-cyan-500"}),status:"reassembled-testing",color:"from-cyan-500/20 to-blue-200/10"}];return g.useEffect(()=>{fe.length>0?te.error(`You have ${fe.length} overdue device${fe.length>1?"s":""}! Please take action.`,{id:"technician-overdue-reminder",duration:6e3}):B.length>0&&te(`You have ${B.length} device${B.length>1?"s":""} due today.`,{id:"technician-due-today-reminder",duration:4e3})},[fe.length,B.length]),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsx("div",{className:"mb-4 flex flex-col gap-0 justify-between py-4 px-4 bg-white/90 rounded-xl transition-all duration-300 cursor-pointer",onClick:()=>se(!z),children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-10 h-10 rounded-full bg-yellow-100",children:e.jsx($a,{size:24,className:"text-yellow-500"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-extrabold text-gray-900",children:(x==null?void 0:x.points)??0}),e.jsx("span",{className:"text-lg font-bold text-gray-700",children:"Daily points"})]})]}),e.jsxs("div",{className:"flex gap-2 items-center text-base font-bold",children:[e.jsxs("span",{className:"flex items-center gap-1 text-blue-600 text-sm",children:[e.jsx(Ss,{size:16}),re.length]}),e.jsxs("span",{className:"flex items-center gap-1 text-green-600 text-sm",children:[e.jsx(yt,{size:16}),ye.length]}),z?e.jsx(mn,{size:20}):e.jsx(sa,{size:20})]})]})}),z&&e.jsx("div",{className:"mb-4 bg-white/90 rounded-xl p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center bg-white rounded-lg p-3 border border-blue-100",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 mb-1",children:e.jsx(Ss,{size:20,className:"text-blue-500"})}),e.jsx("span",{className:"text-xl font-extrabold text-gray-900 mb-1",children:re.length}),e.jsx("span",{className:"text-xs font-semibold text-gray-500",children:"In Progress"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center bg-white rounded-lg p-3 border border-green-100",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-green-100 mb-1",children:e.jsx(yt,{size:20,className:"text-green-500"})}),e.jsx("span",{className:"text-xl font-extrabold text-gray-900 mb-1",children:ye.length}),e.jsx("span",{className:"text-xs font-semibold text-gray-500",children:"Ready for Testing"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center bg-white rounded-lg p-3 border border-yellow-100",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-yellow-100 mb-1",children:e.jsx(Yr,{size:20,className:"text-yellow-500"})}),e.jsx("span",{className:"text-xl font-extrabold text-gray-900 mb-1",children:Q.length}),e.jsx("span",{className:"text-xs font-semibold text-gray-500",children:"Awaiting Parts"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center bg-white rounded-lg p-3 border border-emerald-100",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-emerald-100 mb-1",children:e.jsx(yt,{size:20,className:"text-emerald-500"})}),e.jsx("span",{className:"text-xl font-extrabold text-gray-900 mb-1",children:He.filter(Re=>Re.status==="repair-complete").length}),e.jsx("span",{className:"text-xs font-semibold text-gray-500",children:"Completed"})]})]})})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsxs("div",{className:`mb-4 flex flex-col gap-0 justify-between py-4 px-6 bg-white/90 rounded-xl transition-all duration-300 cursor-pointer ${Z?"shadow-2xl scale-[1.03]":""}`,onMouseEnter:()=>_(!0),onMouseLeave:()=>_(!1),onClick:()=>_(Re=>!Re),children:[e.jsxs("div",{className:"flex items-center justify-between gap-5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-yellow-100",children:e.jsx($a,{size:28,className:"text-yellow-500"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-extrabold text-gray-900",children:(x==null?void 0:x.points)??0}),e.jsx("span",{className:"text-2xl font-bold text-gray-700",children:"Daily points"})]})]}),e.jsxs("div",{className:"flex gap-4 items-center text-base font-bold",children:[e.jsxs("span",{className:"flex items-center gap-1 text-blue-600",children:[e.jsx(Ss,{size:20}),re.length]}),e.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(yt,{size:20}),ye.length]}),e.jsxs("span",{className:"flex items-center gap-1 text-yellow-600",children:[e.jsx(Yr,{size:20}),Q.length]}),e.jsxs("span",{className:"flex items-center gap-1 text-emerald-600",children:[e.jsx(yt,{size:20}),He.filter(Re=>Re.status==="repair-complete").length]})]})]}),e.jsx("div",{className:`overflow-hidden transition-all duration-300 ${Z?"max-h-[400px] mt-4 opacity-100":"max-h-0 opacity-0"}`,children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center bg-white rounded-xl p-6 border border-blue-100",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-blue-100 mb-2",children:e.jsx(Ss,{size:28,className:"text-blue-500"})}),e.jsx("span",{className:"text-3xl font-extrabold text-gray-900 mb-1",children:re.length}),e.jsx("span",{className:"text-xs font-semibold text-gray-500 mb-2",children:"In Progress"}),e.jsx("div",{className:"w-full h-1 bg-blue-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-1 bg-blue-500 rounded-full transition-all duration-1000 animate-progress",style:{width:`${Math.min(100,Math.round(re.length/q*100))}%`}})})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center bg-white rounded-xl p-6 border border-green-100",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-green-100 mb-2",children:e.jsx(yt,{size:28,className:"text-green-500"})}),e.jsx("span",{className:"text-3xl font-extrabold text-gray-900 mb-1",children:ye.length}),e.jsx("span",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Ready for Testing"}),e.jsx("div",{className:"w-full h-1 bg-green-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-1 bg-green-500 rounded-full transition-all duration-1000 animate-progress",style:{width:`${Math.min(100,Math.round(ye.length/q*100))}%`}})})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center bg-white rounded-xl p-6 border border-yellow-100",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-yellow-100 mb-2",children:e.jsx(Yr,{size:28,className:"text-yellow-500"})}),e.jsx("span",{className:"text-3xl font-extrabold text-gray-900 mb-1",children:Q.length}),e.jsx("span",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Awaiting Parts"}),e.jsx("div",{className:"w-full h-1 bg-yellow-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-1 bg-yellow-500 rounded-full transition-all duration-1000 animate-progress",style:{width:`${Math.min(100,Math.round(Q.length/q*100))}%`}})})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center bg-white rounded-xl p-6 border border-emerald-100",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-emerald-100 mb-2",children:e.jsx(yt,{size:28,className:"text-emerald-500"})}),e.jsx("span",{className:"text-3xl font-extrabold text-gray-900 mb-1",children:He.filter(Re=>Re.status==="repair-complete").length}),e.jsx("span",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Completed"}),e.jsx("div",{className:"w-full h-1 bg-emerald-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-1 bg-emerald-500 rounded-full transition-all duration-1000 animate-progress",style:{width:`${Math.min(100,Math.round(He.filter(Re=>Re.status==="repair-complete").length/q*100))}%`}})})]})]})})]})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-4 mb-6 sm:mb-8",children:Ue.map((Re,ut)=>e.jsx(he,{className:`bg-gradient-to-br ${Re.color} p-3 sm:p-4`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-sm sm:text-lg font-medium text-gray-600",children:Re.label}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:Re.count})]}),e.jsx("div",{className:"flex justify-center sm:justify-end",children:Re.icon})]})},ut))}),e.jsx("div",{className:"flex flex-wrap gap-2 sm:gap-3 mb-4 sm:mb-6",children:e.jsxs("button",{onClick:()=>N(!0),className:"inline-flex items-center gap-2 bg-purple-500/70 hover:bg-purple-600/70 text-white py-3 px-4 rounded-lg border border-purple-300/30 backdrop-blur-md transition-all duration-300 text-sm sm:text-base min-h-[44px]",children:[e.jsx(Hi,{size:18}),e.jsx("span",{children:"Scan Device"})]})}),e.jsx("div",{className:"mb-4",children:e.jsx(ga,{onSearch:c,placeholder:"Search devices...",className:"w-full",suggestions:Array.from(new Set([...r.map(Re=>Re.id),...r.map(Re=>Re.customerName),...r.map(Re=>Re.brand),...r.map(Re=>Re.model),...r.map(Re=>Re.serialNumber||""),...r.map(Re=>Re.phoneNumber||""),...r.flatMap(Re=>Re.remarks?Re.remarks.map(ut=>ut.content):[])].filter(Boolean)))})}),e.jsx("div",{className:"sm:hidden mb-4",children:e.jsxs("button",{onClick:()=>T(!D),className:"w-full flex items-center justify-between p-3 bg-white/80 backdrop-blur-sm rounded-lg border border-gray-200 text-sm font-medium",children:[e.jsxs("span",{children:["Filters (",m==="all"?"All":m,")"]}),D?e.jsx(mn,{size:20}):e.jsx(sa,{size:20})]})}),e.jsxs("div",{className:`${D?"block":"hidden"} sm:block flex flex-wrap gap-2 mb-4 sm:mb-6`,children:[e.jsxs("button",{onClick:()=>u("all"),className:`relative px-4 sm:px-6 py-3 sm:py-2 rounded-lg text-sm font-medium transition-all duration-300 backdrop-blur-sm border min-w-[80px] sm:min-w-[100px] min-h-[44px] ${m==="all"?"bg-blue-500/90 text-white border-blue-400/50 shadow-lg shadow-blue-500/25":"bg-white/60 text-gray-700 border-gray-200/50 hover:bg-white/80 hover:border-blue-300/50 hover:shadow-md"}`,children:["All",ge.length>0&&e.jsx("span",{className:`absolute -top-1 -right-1 w-5 h-5 rounded-full text-xs font-bold flex items-center justify-center ${m==="all"?"bg-white text-blue-500 shadow-sm":"bg-red-500 text-white shadow-sm"}`,children:ge.length})]}),Ct.map(Re=>e.jsxs("button",{onClick:()=>u(Re.status),className:`relative px-4 sm:px-6 py-3 sm:py-2 rounded-lg text-sm font-medium transition-all duration-300 backdrop-blur-sm border min-w-[80px] sm:min-w-[100px] min-h-[44px] ${m===Re.status?"bg-blue-500/90 text-white border-blue-400/50 shadow-lg shadow-blue-500/25":"bg-white/60 text-gray-700 border-gray-200/50 hover:bg-white/80 hover:border-blue-300/50 hover:shadow-md"}`,children:[Re.label,Re.count>0&&e.jsx("span",{className:`absolute -top-1 -right-1 w-5 h-5 rounded-full text-xs font-bold flex items-center justify-center ${m===Re.status?"bg-white text-blue-500 shadow-sm":"bg-red-500 text-white shadow-sm"}`,children:Re.count})]},Re.status))]}),i&&He.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow p-2 mb-4 max-h-48 sm:max-h-64 overflow-y-auto",children:[e.jsx("div",{className:"text-xs text-gray-500 px-2 pb-1",children:"Matching Devices"}),He.slice(0,6).map((Re,ut)=>e.jsxs("div",{className:"px-2 py-2 border-b last:border-0 flex flex-col",children:[e.jsxs("span",{className:"font-medium text-gray-900 text-sm",children:[On(Re.brand,i)," ",On(Re.model,i)]}),e.jsx("span",{className:"text-xs text-gray-600",children:On(Re.customerName,i)}),e.jsxs("span",{className:"text-xs text-gray-400",children:["ID: ",On(Re.id,i)]})]},Re.id+"-"+ut))]}),e.jsx("div",{className:"space-y-4",children:a?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Loading your assigned devices..."})]}):He.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ns,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No assigned devices found"}),e.jsx("p",{className:"text-sm text-gray-500",children:ge.length===0?"You don't have any devices assigned to you yet.":"Try adjusting your search or filters"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Your Assigned Devices (",He.length,")"]}),ge.length!==He.length&&e.jsxs("span",{className:"text-sm text-gray-500 hidden sm:inline",children:["Showing ",He.length," of ",ge.length," devices"]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-3 sm:gap-4",children:He.map((Re,ut)=>e.jsx(Xn,{device:Re},Re.id+"-"+ut))})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Nr,{className:"h-5 w-5 text-purple-500"}),e.jsx("span",{className:"hidden sm:inline",children:"Diagnostic Devices"}),e.jsx("span",{className:"sm:hidden",children:"Diagnostics"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",v.flatMap(Re=>Re.devices||[]).length,")"]})]}),e.jsxs(Zs,{to:"/diagnostics/assigned",className:"text-sm text-purple-600 hover:text-purple-700 font-medium",children:[e.jsx("span",{className:"hidden sm:inline",children:"View All →"}),e.jsx("span",{className:"sm:hidden",children:"View All"})]})]}),F?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-2 text-sm",children:"Loading diagnostic devices..."})]}):v.length===0?e.jsxs(he,{className:"p-4 sm:p-6 text-center",children:[e.jsx(Nr,{className:"h-8 w-8 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"No diagnostic devices assigned"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"You'll see diagnostic devices here when they're assigned to you"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:v.flatMap(Re=>{var ut;return((ut=Re.devices)==null?void 0:ut.map(Ee=>e.jsxs("div",{className:`
                  backdrop-blur-xl bg-white/70 rounded-xl 
                  border border-white/30 shadow-lg 
                  p-4 sm:p-6 transition-all duration-300 
                  hover:bg-white/80 hover:shadow-xl hover:border-white/40
                  hover:backdrop-blur-2xl hover:scale-[1.02]
                  cursor-pointer active:scale-[0.98]
                  group transform transition-all duration-300 ease-in-out hover:scale-[1.02] hover:shadow-xl cursor-pointer relative overflow-hidden
                `,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-50/30 via-transparent to-blue-50/30 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"absolute top-3 right-3 z-20",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-semibold border-2 shadow-lg backdrop-blur-sm ${Ee.result_status==="passed"?"text-green-700 bg-gradient-to-r from-green-50 to-emerald-50 border-green-200":Ee.result_status==="failed"?"text-red-700 bg-gradient-to-r from-red-50 to-pink-50 border-red-200":"text-yellow-700 bg-gradient-to-r from-yellow-50 to-orange-50 border-yellow-200"}`,children:[e.jsx(yt,{className:"h-5 w-5"}),e.jsx("span",{className:"capitalize",children:Ee.result_status||"pending"})]})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4 pt-8 pr-20",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-100 to-blue-100 flex items-center justify-center border-2 border-purple-200 shadow-sm",children:e.jsx(Nr,{className:"h-6 w-6 text-purple-600"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-900 truncate",title:Ee.device_name,children:Ee.device_name}),e.jsxs("p",{className:"text-sm text-gray-600 font-mono truncate",title:`S/N: ${Ee.serial_number||"N/A"}`,children:["S/N: ",Ee.serial_number||"N/A"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vr,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Progress"})]}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:Ee.result_status==="passed"?"8/8 tests completed":Ee.result_status==="failed"?"Tests failed":"Tests pending"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ease-out ${Ee.result_status==="passed"?"bg-gradient-to-r from-green-500 to-emerald-500":Ee.result_status==="failed"?"bg-gradient-to-r from-red-500 to-pink-500":"bg-gradient-to-r from-yellow-500 to-orange-500"}`,style:{width:Ee.result_status==="passed"||Ee.result_status==="failed"?"100%":"0%"}})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-purple-50/50 rounded-lg border border-purple-100",children:[e.jsx(ws,{className:"h-4 w-4 text-purple-600"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Created"}),e.jsx("p",{className:"text-sm font-semibold text-purple-700 truncate",children:new Date(Re.created_at||Date.now()).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-50/50 rounded-lg border border-blue-100",children:[e.jsx(nr,{className:"h-4 w-4 text-blue-600"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Assigned"}),e.jsx("p",{className:"text-sm font-semibold text-blue-700 truncate",children:Re.assigned_to||"Unassigned"})]})]})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ms,{className:"h-4 w-4 text-indigo-600"}),e.jsx("span",{className:"text-sm font-semibold text-indigo-800",children:"Request"})]}),e.jsx("p",{className:"text-sm text-indigo-700 font-medium truncate",children:Re.title})]}),e.jsx("div",{className:"flex gap-2 pt-4 border-t border-gray-200",children:e.jsxs(Zs,{to:`/diagnostics/device/${Re.id}/${Ee.id}`,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white rounded-lg font-medium shadow-sm transition-all duration-200 group-hover:shadow-md",children:[e.jsx(cs,{className:"h-4 w-4"}),"View"]})})]})]},Ee.id)))||[]})})]}),y&&e.jsx(xl,{onClose:()=>N(!1)}),e.jsx(K0,{isOpen:C,onClose:()=>$(!1)}),e.jsx(Z0,{isOpen:Y,onClose:()=>A(!1)})]})};function On(r,a){if(!r)return"";const i=r.toLowerCase().indexOf(a.toLowerCase());return i===-1?r:e.jsxs(e.Fragment,{children:[r.slice(0,i),e.jsx("span",{className:"bg-yellow-200 text-black font-bold",children:r.slice(i,i+a.length)}),r.slice(i+a.length)]})}const J0=({devices:r,loading:a,searchQuery:i,setSearchQuery:c,statusFilter:m,setStatusFilter:u})=>{var Qt;const{currentUser:x}=Wt(),{getDevicesDueToday:j,getOverdueDevices:b}=na(),{customers:f,addPoints:y}=Ur(),{userGoals:N,getGoalProgress:I}=dl(),R=hs(),[k,E]=g.useState(!1),[v,U]=g.useState(!1),[F,L]=g.useState(!1),[C,$]=g.useState(!1),[Y,A]=g.useState(!1),[Z,_]=g.useState(!1),[D,T]=g.useState(!1),[z,se]=g.useState(!1),[q,H]=g.useState(null),[J,V]=g.useState(!1),[ge,He]=g.useState("date"),[B,fe]=g.useState("desc"),re=new Date().toISOString().slice(0,10),ye=g.useMemo(()=>(f||[]).filter(Pe=>Pe.joinedDate.slice(0,10)===re),[f,re]),[Q,Le]=g.useState(5),[Ue,Ct]=g.useState(0);g.useEffect(()=>{(async()=>{if(x!=null&&x.id){const ot=await I("new_customers");Le(ot.goal),Ct(ot.progress)}})()},[x==null?void 0:x.id,I]),g.useEffect(()=>{const Pe=setInterval(()=>{console.log("Auto-refreshing dashboard data...")},3e4);return()=>clearInterval(Pe)},[]),g.useEffect(()=>{if(!(x!=null&&x.id))return;const Pe=G.channel("customer-care-dashboard-diagnostic-requests").on("postgres_changes",{event:"*",schema:"public",table:"diagnostic_requests",filter:`created_by=eq.${x.id}`},ot=>{var $t,gs,Jt,Es;if(console.log("🔔 Dashboard: Diagnostic request update received:",ot),ot.eventType==="UPDATE"&&(($t=ot.old)==null?void 0:$t.status)!==((gs=ot.new)==null?void 0:gs.status)){const as=Re((Jt=ot.new)==null?void 0:Jt.status);te.success(`Diagnostic request "${(Es=ot.new)==null?void 0:Es.title}" status updated to ${as}`,{icon:"🔧",duration:4e3})}}).subscribe();return()=>{Pe.unsubscribe()}},[x==null?void 0:x.id]);const Re=Pe=>{switch(Pe){case"pending":return"Pending";case"in_progress":return"In Progress";case"completed":return"Completed";case"submitted_for_review":return"Submitted for Review";case"repair_required":return"Repair Required";case"replacement_required":return"Replacement Required";case"no_action_required":return"No Action Required";case"escalated":return"Escalated";case"admin_reviewed":return"Admin Reviewed";default:return"Unknown"}},ut=g.useMemo(()=>r.filter(Pe=>Pe.createdAt&&Pe.createdAt.slice(0,10)===re),[r,re]),[Ee,Oe]=g.useState(!1),[Xe,Be]=g.useState(null),[Ce,Ze]=g.useState(5),[$e,K]=g.useState(!1),be=g.useMemo(()=>{const Pe={};return(f||[]).forEach(ot=>{const $t=(ot.notes||[]).filter(gs=>gs.content.toLowerCase().includes("checked in")&&gs.createdAt.slice(0,10)===re);$t.length>0&&(Pe[ot.id]=$t.length)}),Pe},[f,re]),ue=Pe=>Pe.sort((ot,$t)=>{let gs=0;switch(ge){case"date":const Jt=new Date(ot.createdAt||"").getTime(),Es=new Date($t.createdAt||"").getTime();gs=Jt-Es;break;case"customer":gs=(ot.customerName||"").localeCompare($t.customerName||"");break;case"brand":const as=`${ot.brand} ${ot.model}`.toLowerCase(),Us=`${$t.brand} ${$t.model}`.toLowerCase();gs=as.localeCompare(Us);break;case"status":gs=(ot.status||"").localeCompare($t.status||"");break}return B==="asc"?gs:-gs}),Ye=()=>U(!0),ae=()=>U(!1),ke=()=>L(!0),Ke=()=>L(!1),le=()=>$(!0),Ne=()=>$(!1),Te=()=>A(!0),Qe=()=>A(!1),vt=()=>_(!1),Rt=Pe=>{if(!Pe.expectedReturnDate)return"No due date";const ot=new Date,$t=new Date(Pe.expectedReturnDate),gs=ot.getTime()-$t.getTime();if(gs<=0)return"Not overdue";const Jt=Math.floor(gs/(1e3*60*60)),Es=Math.floor(Jt/24),as=Jt%24;return Es>0?`${Es}d ${as}h overdue`:`${Jt}h overdue`},ht=r.filter(Pe=>Pe.status==="repair-complete"),Se=r.filter(Pe=>Pe.status==="returned-to-customer-care"),ve=r.filter(Pe=>Pe.status==="done"),de=b().filter(Pe=>["repair-complete","returned-to-customer-care"].includes(Pe.status));console.log("Dashboard Data:",{totalDevices:r.length,readyForHandover:ht.length,returnedToCC:Se.length,done:ve.length,overdueHandovers:de.length,deviceStatuses:r.map(Pe=>({id:Pe.id,status:Pe.status,customerName:Pe.customerName}))});const me=g.useMemo(()=>{let Pe=r.filter(ot=>ot.status!=="done");return i&&(Pe=Pe.filter(ot=>ot.id.toLowerCase().includes(i.toLowerCase())||ot.customerName.toLowerCase().includes(i.toLowerCase())||ot.brand.toLowerCase().includes(i.toLowerCase())||ot.model.toLowerCase().includes(i.toLowerCase())||ot.serialNumber&&ot.serialNumber.toLowerCase().includes(i.toLowerCase())||ot.phoneNumber&&ot.phoneNumber.toLowerCase().includes(i.toLowerCase())||ot.remarks&&ot.remarks.some($t=>$t.content&&$t.content.toLowerCase().includes(i.toLowerCase())))),m!=="all"&&(Pe=Pe.filter(ot=>ot.status===m)),Pe},[r,i,m]),Ae=[{label:"Ready for Handover",count:ht.length,icon:e.jsx(yt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-emerald-500"}),color:"from-emerald-500/20 to-emerald-400/10",priority:"high"},{label:"Overdue Handovers",count:de.length,subtitle:de.length>0?`${de.reduce((Pe,ot)=>{const $t=new Date,gs=new Date(ot.expectedReturnDate||""),Jt=$t.getTime()-gs.getTime();return Pe+Math.max(0,Math.floor(Jt/(1e3*60*60)))},0)}h total`:"",icon:e.jsx(Ht,{className:"h-5 w-5 sm:h-6 sm:w-6 text-red-500"}),color:"from-red-500/20 to-red-400/10",priority:"high"},{label:"Returned to CC",count:Se.length,icon:e.jsx(nr,{className:"h-5 w-5 sm:h-6 sm:w-6 text-teal-500"}),color:"from-teal-500/20 to-cyan-400/10",priority:"medium"},{label:"Completed Today",count:ve.filter(Pe=>{const ot=new Date().toDateString();return new Date(Pe.updatedAt||"").toDateString()===ot}).length,icon:e.jsx(yt,{className:"h-5 w-5 sm:h-6 sm:w-6 text-gray-500"}),color:"from-gray-500/20 to-gray-400/10",priority:"low"}];g.useEffect(()=>{de.length>0?te.error(`You have ${de.length} overdue handover${de.length>1?"s":""}! Please contact customers.`,{id:"cc-overdue-reminder",duration:6e3}):ht.length>0&&te(`You have ${ht.length} device${ht.length>1?"s":""} ready for handover.`,{id:"cc-handover-reminder",duration:4e3})},[de.length,ht.length]);const it=((Qt=x==null?void 0:x.name)==null?void 0:Qt.split(" ")[0])||"there",St=new Date().getHours(),kt=St<12?"Good morning":St<18?"Good afternoon":"Good evening",et=["Every new customer is a new opportunity!","You’re just one step away from your goal!","Great service brings great rewards!","Keep up the amazing work!","Your effort makes a difference every day!"],xs=et[new Date().getDate()%et.length],Nt=Number(localStorage.getItem("customer_goal_streak")||0);g.useEffect(()=>{if(Ue>=100){const Pe=localStorage.getItem("customer_goal_streak_date"),ot=new Date().toISOString().slice(0,10);Pe!==ot&&(localStorage.setItem("customer_goal_streak",String(Nt+1)),localStorage.setItem("customer_goal_streak_date",ot))}},[Ue]),Ue>=100||(Ue>=80?`${Math.max(1,Q-ye.length)}`:ye.length);const ss=new Date().toISOString().slice(0,7),gt={};(f||[]).forEach(Pe=>{Pe.joinedDate&&Pe.joinedDate.slice(0,7)===ss&&(gt[Pe.id]=(gt[Pe.id]||0)+1)}),Object.entries(gt).sort((Pe,ot)=>ot[1]-Pe[1]).slice(0,5).map(([Pe,ot])=>{const $t=f.find(gs=>gs.id===Pe);return $t?{...$t,count:ot}:null}).filter(Boolean);const Is=(new Date().getMonth()+1).toString().padStart(2,"0"),ts=(f||[]).filter(Pe=>Pe.birthMonth===Is),bs=Date.now();return(f||[]).filter(Pe=>{const ot=new Date(Pe.lastVisit).getTime();return bs-ot>60*24*60*60*1e3}),g.useMemo(()=>{const Pe=r.flatMap(ot=>[ot.id,ot.customerName,ot.phoneNumber,ot.brand,ot.model,ot.serialNumber]).filter(Boolean);return Array.from(new Set(Pe)).filter(ot=>!!ot&&typeof ot=="string")},[r]),e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"mb-4 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-extrabold text-gray-900 flex items-center gap-2",children:[kt,", ",it,"!",Nt>1&&e.jsxs("span",{className:"ml-2 flex items-center gap-1 text-yellow-500 text-lg font-bold animate-glow",children:[e.jsx(hr,{size:20})," ",Nt," day streak!"]})]}),e.jsxs("button",{onClick:()=>{console.log("Manual refresh triggered"),window.location.reload()},className:"flex items-center gap-2 px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium transition-colors duration-200",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})]}),e.jsx("div",{className:"text-blue-700 font-semibold text-lg mb-1",children:xs})]}),e.jsxs("div",{className:`mb-4 flex flex-col gap-0 justify-between py-4 px-6 bg-white/90 rounded-xl transition-all duration-300 cursor-pointer ${D?"shadow-2xl scale-[1.03]":""}`,onMouseEnter:()=>T(!0),onMouseLeave:()=>T(!1),onClick:()=>T(Pe=>!Pe),children:[e.jsxs("div",{className:"flex items-center justify-between gap-5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-yellow-100",children:e.jsx($a,{size:28,className:"text-yellow-500"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-extrabold text-gray-900",children:(x==null?void 0:x.points)??0}),e.jsx("span",{className:"text-2xl font-bold text-gray-700",children:"Daily points"})]})]}),e.jsxs("div",{className:"flex gap-4 items-center text-base font-bold",children:[e.jsxs("span",{className:"flex items-center gap-1 text-yellow-600",children:[e.jsx(nr,{size:20}),Object.keys(be).length]}),e.jsxs("span",{className:"flex items-center gap-1 text-blue-600",children:[e.jsx(_s,{size:20}),ye.length]}),e.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(cn,{size:20}),ut.length]}),e.jsxs("span",{className:"flex items-center gap-1 text-pink-600",children:[e.jsx(qa,{size:20}),ts.length]})]})]}),e.jsx("div",{className:`overflow-hidden transition-all duration-300 ${D?"max-h-[400px] mt-4 opacity-100":"max-h-0 opacity-0"}`,children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center bg-white rounded-xl p-6 border border-yellow-100",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-yellow-100 mb-2",children:e.jsx(nr,{size:28,className:"text-yellow-500"})}),e.jsx("span",{className:"text-3xl font-extrabold text-gray-900 mb-1",children:Object.keys(be).length}),e.jsx("span",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Checked In"}),e.jsx("div",{className:"w-full h-1 bg-yellow-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-1 bg-yellow-400 rounded-full transition-all duration-1000 animate-progress",style:{width:`${Math.min(100,Math.round(Object.keys(be).length/5*100))}%`}})})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center bg-white rounded-xl p-6 border border-blue-100",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-blue-100 mb-2",children:e.jsx(_s,{size:28,className:"text-blue-500"})}),e.jsx("span",{className:"text-3xl font-extrabold text-gray-900 mb-1",children:ye.length}),e.jsx("span",{className:"text-xs font-semibold text-gray-500 mb-2",children:"New Customers"}),e.jsx("div",{className:"w-full h-1 bg-blue-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-1 bg-blue-500 rounded-full transition-all duration-1000 animate-progress",style:{width:`${Math.min(100,Math.round(ye.length/5*100))}%`}})})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center bg-white rounded-xl p-6 border border-green-100",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-green-100 mb-2",children:e.jsx(cn,{size:28,className:"text-green-500"})}),e.jsx("span",{className:"text-3xl font-extrabold text-gray-900 mb-1",children:ut.length}),e.jsx("span",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Devices Received"}),e.jsx("div",{className:"w-full h-1 bg-green-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-1 bg-green-500 rounded-full transition-all duration-1000 animate-progress",style:{width:`${Math.min(100,Math.round(ut.length/5*100))}%`}})})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center bg-white rounded-xl p-6 border border-pink-100",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-pink-100 mb-2",children:e.jsx(qa,{size:28,className:"text-pink-500"})}),e.jsx("span",{className:"text-3xl font-extrabold text-gray-900 mb-1",children:ts.length}),e.jsx("span",{className:"text-xs font-semibold text-gray-500 mb-2",children:"Birthdays"}),e.jsx("div",{className:"w-full h-1 bg-pink-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-1 bg-pink-500 rounded-full transition-all duration-1000 animate-progress",style:{width:`${Math.min(100,Math.round(ts.length/10*100))}%`}})})]})]})})]}),e.jsx("div",{className:"border-b border-gray-200 mb-4"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6 sm:mb-8",children:Ae.map((Pe,ot)=>e.jsx(he,{className:`bg-gradient-to-br ${Pe.color} cursor-pointer hover:scale-105 transition-transform duration-200 p-4 sm:p-6 col-span-1 h-full`,onClick:()=>{ot===0?Ye():ot===1?ke():ot===2?le():ot===3&&Te()},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-600 truncate",children:Pe.label}),e.jsx("p",{className:"text-2xl sm:text-4xl font-bold text-gray-900",children:Pe.count}),Pe.subtitle&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:Pe.subtitle})]}),e.jsx("div",{className:"flex-shrink-0 ml-2",children:Pe.icon})]})},ot))}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-2 sm:gap-3 mb-4 sm:mb-6",children:[e.jsxs(Zs,{to:"/devices/new",className:"inline-flex items-center justify-center gap-2 bg-blue-500/70 hover:bg-blue-600/70 text-white py-3 px-4 sm:py-2 sm:px-6 rounded-lg border border-blue-300/30 backdrop-blur-md transition-colors duration-150 text-sm flex-1 sm:flex-none min-w-[120px]",children:[e.jsx(Ii,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"New Device"}),e.jsx("span",{className:"sm:hidden",children:"New"})]}),e.jsxs("button",{onClick:()=>E(!0),className:"inline-flex items-center justify-center gap-2 bg-purple-500/70 hover:bg-purple-600/70 text-white py-3 px-4 sm:py-2 sm:px-6 rounded-lg border border-purple-300/30 backdrop-blur-md transition-colors duration-150 text-sm flex-1 sm:flex-none min-w-[120px]",children:[e.jsx(Hi,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Scan Device"}),e.jsx("span",{className:"sm:hidden",children:"Scan"})]}),e.jsxs(Zs,{to:"/customers",className:"inline-flex items-center justify-center gap-2 bg-green-500/70 hover:bg-green-600/70 text-white py-3 px-4 sm:py-2 sm:px-6 rounded-lg border border-green-300/30 backdrop-blur-md transition-colors duration-150 text-sm flex-1 sm:flex-none min-w-[120px]",children:[e.jsx(_s,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Manage Customers"}),e.jsx("span",{className:"sm:hidden",children:"Customers"})]}),e.jsxs(Zs,{to:"/sms",className:"inline-flex items-center justify-center gap-2 bg-orange-500/70 hover:bg-orange-600/70 text-white py-3 px-4 sm:py-2 sm:px-6 rounded-lg border border-orange-300/30 backdrop-blur-md transition-colors duration-150 text-sm flex-1 sm:flex-none min-w-[120px]",children:[e.jsx(js,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"SMS Center"}),e.jsx("span",{className:"sm:hidden",children:"SMS"})]})]}),(i||m!=="all")&&e.jsxs("div",{className:"flex gap-2 mb-2 flex-wrap",children:[i&&e.jsxs("span",{className:"inline-flex items-center bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:["Search: ",i,e.jsx("button",{type:"button",className:"ml-2 text-blue-500 hover:text-blue-700 focus:outline-none",onClick:()=>c(""),"aria-label":"Clear search query",children:"✕"})]}),m!=="all"&&e.jsxs("span",{className:"inline-flex items-center bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium",children:["Status: ",m,e.jsx("button",{type:"button",className:"ml-2 text-green-500 hover:text-green-700 focus:outline-none",onClick:()=>u("all"),"aria-label":"Clear status filter",children:"✕"})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-start sm:items-center",children:[e.jsx(ga,{onSearch:c,placeholder:"Search devices...",className:"flex-1",suggestions:[],searchKey:"customer_care_devices"}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:ge,onChange:Pe=>He(Pe.target.value),className:`
                  py-2 sm:py-3 pl-10 sm:pl-12 pr-10 
                  bg-white/20 backdrop-blur-md
                  border border-white/30 rounded-lg
                  text-gray-800 text-sm sm:text-base
                  focus:outline-none focus:ring-2 focus:ring-blue-500/50
                  transition-all duration-300
                  appearance-none
                `,children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"customer",children:"Sort by Customer"}),e.jsx("option",{value:"brand",children:"Sort by Device"}),e.jsx("option",{value:"status",children:"Sort by Status"})]}),e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500",children:e.jsx(Ad,{size:18,className:"sm:w-5 sm:h-5"})})]}),e.jsx("button",{onClick:()=>fe(B==="asc"?"desc":"asc"),className:`
                p-2 sm:p-3
                bg-white/20 backdrop-blur-md
                border border-white/30 rounded-lg
                text-gray-800 hover:bg-white/30
                focus:outline-none focus:ring-2 focus:ring-blue-500/50
                transition-all duration-300
              `,title:`Sort ${B==="asc"?"Descending":"Ascending"}`,children:B==="asc"?e.jsx(kd,{size:18,className:"sm:w-5 sm:h-5"}):e.jsx(Dd,{size:18,className:"sm:w-5 sm:h-5"})})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 sm:pb-0 justify-start w-fit mx-0",children:e.jsx("button",{onClick:()=>u("all"),className:`px-3 sm:px-4 py-2 rounded-lg border transition-colors whitespace-nowrap text-sm ${m==="all"?"bg-blue-500 text-white border-blue-500":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:"All"})})]}),e.jsx("div",{className:"space-y-4",children:a?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Loading devices..."})]}):me.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ns,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No devices found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Try adjusting your search or filters"})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:ue(Yn(me)).map(Pe=>e.jsx(Xn,{device:Pe},Pe.id))})}),ve.length>0&&e.jsxs("div",{className:"mt-8 border-t border-gray-200 pt-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500/20 to-green-400/10 rounded-xl flex items-center justify-center",children:e.jsx(yt,{className:"h-6 w-6 text-green-500"})}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-white",children:ve.length})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Completed Devices"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Successfully completed work"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:ue(Yn(ve)).slice(0,J?ve.length:6).map((Pe,ot)=>e.jsxs(he,{className:`transform transition-all duration-500 ease-in-out hover:translate-y-[-5px] hover:scale-105 ${(q==null?void 0:q.id)===Pe.id?"border-green-400 bg-green-50 shadow-lg shadow-green-500/20 scale-105 ring-2 ring-green-200":""}`,onClick:()=>{H(Pe),se(!0)},children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"flex items-center gap-2 w-full",children:e.jsxs("h3",{className:"font-bold text-base text-gray-900 truncate",children:[Pe.brand," ",Pe.model]})}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-2 rounded-full text-sm font-bold bg-green-100 text-green-700 border border-green-200",children:[e.jsx(zo,{size:16,className:"text-green-600 font-bold"}),"Done"]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(nr,{size:16,className:"text-blue-500"}),e.jsx("button",{onClick:$t=>{$t.stopPropagation(),R(`/customers/${Pe.customerId}`)},className:"text-base font-semibold truncate text-blue-600 hover:text-blue-800 hover:underline transition-colors",children:Pe.customerName})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-1 sm:py-2 rounded-lg bg-white/20 backdrop-blur-md shadow mt-1",children:[e.jsx(yt,{className:"text-purple-600 drop-shadow",size:16}),e.jsx("span",{className:"font-semibold text-sm sm:text-base text-purple-900",children:"Completed:"}),e.jsx("span",{className:"ml-1 font-semibold text-sm sm:text-base text-purple-700",children:new Date(Pe.updatedAt||"").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),Pe.phoneNumber&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(Qr,{size:14,className:"text-gray-500"}),e.jsx("span",{className:"text-xs truncate",children:Pe.phoneNumber})]})]})]},Pe.id))}),ve.length>6&&e.jsx("div",{className:"mt-6 text-center",children:e.jsx(he,{className:"inline-flex items-center gap-2 px-4 py-2",children:J?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Showing all ",ve.length," devices"]}),e.jsx("button",{onClick:()=>V(!1),className:"text-xs text-blue-600 hover:text-blue-800 font-medium transition-colors",children:"Show Less"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["+",ve.length-6," more completed devices"]}),e.jsx("button",{onClick:()=>V(!0),className:"text-xs text-green-600 hover:text-green-800 font-medium transition-colors",children:"View All"})]})})})]}),k&&e.jsx(xl,{onClose:()=>E(!1)}),v&&e.jsx(es,{isOpen:v,onClose:ae,title:"Ready for Handover",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Devices ready to be handed over to customers:"}),ht.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No devices ready for handover"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:ht.map(Pe=>e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg border relative",children:e.jsxs("div",{className:"flex justify-between items-start pt-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"font-medium text-gray-900 truncate",children:[Pe.brand," ",Pe.model]}),e.jsxs("p",{className:"text-sm text-gray-600 truncate",children:["Customer: ",e.jsx("span",{className:"capitalize",children:Pe.customerName})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",Pe.id]})]}),e.jsx("div",{className:"flex-shrink-0 ml-2",children:e.jsx(ma,{status:Pe.status})})]})},Pe.id))})]})}),F&&e.jsx(es,{isOpen:F,onClose:Ke,title:"Overdue Handovers",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Devices overdue for handover:"}),de.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No overdue handovers"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:de.map(Pe=>e.jsx("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200 relative",children:e.jsxs("div",{className:"flex justify-between items-start pt-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"font-medium text-gray-900 truncate",children:[Pe.brand," ",Pe.model]}),e.jsxs("p",{className:"text-sm text-gray-600 truncate",children:["Customer: ",e.jsx("span",{className:"capitalize",children:Pe.customerName})]}),e.jsx("p",{className:"text-xs text-red-600 font-semibold",children:Rt(Pe)})]}),e.jsx("div",{className:"flex-shrink-0 ml-2",children:e.jsx(ma,{status:Pe.status})})]})},Pe.id))})]})}),C&&e.jsx(es,{isOpen:C,onClose:Ne,title:"Returned to Customer Care",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Devices returned to customer care:"}),Se.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No devices returned to CC"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:Se.map(Pe=>e.jsx("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200 relative",children:e.jsxs("div",{className:"flex justify-between items-start pt-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"font-medium text-gray-900 truncate",children:[Pe.brand," ",Pe.model]}),e.jsxs("p",{className:"text-sm text-gray-600 truncate",children:["Customer: ",e.jsx("span",{className:"capitalize",children:Pe.customerName})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",Pe.id]})]}),e.jsx("div",{className:"flex-shrink-0 ml-2",children:e.jsx(ma,{status:Pe.status})})]})},Pe.id))})]})}),Y&&e.jsx(es,{isOpen:Y,onClose:Qe,title:"Completed Today",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Devices completed today:"}),ve.filter(Pe=>{const ot=new Date().toDateString();return new Date(Pe.updatedAt||"").toDateString()===ot}).length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No devices completed today"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:ve.filter(Pe=>{const ot=new Date().toDateString();return new Date(Pe.updatedAt||"").toDateString()===ot}).map(Pe=>e.jsx("div",{className:"p-3 bg-green-50 rounded-lg relative",children:e.jsxs("div",{className:"flex justify-between items-start pt-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"font-medium text-gray-900 truncate",children:[Pe.brand," ",Pe.model]}),e.jsxs("p",{className:"text-sm text-gray-600 truncate",children:["Customer: ",Pe.customerName]}),e.jsxs("p",{className:"text-xs text-green-600",children:["Completed: ",new Date(Pe.updatedAt||"").toLocaleDateString()]})]}),e.jsx("div",{className:"flex-shrink-0 ml-2",children:e.jsx(ma,{status:Pe.status})})]})},Pe.id))})]})}),Z&&e.jsx(es,{isOpen:Z,onClose:vt,title:"Total Customers",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"All registered customers:"}),!f||f.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No customers found"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:f.map(Pe=>e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg border",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:Pe.name}),e.jsxs("p",{className:"text-sm text-gray-600 truncate",children:["Phone: ",Pe.phone]})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex-shrink-0 ml-2",children:["Joined: ",new Date(Pe.joinedDate).toLocaleDateString()]})]})},Pe.id))})]})}),z&&q&&e.jsx(es,{isOpen:z,onClose:()=>se(!1),title:`${q.brand} ${q.model} - Details`,children:e.jsxs("div",{className:"space-y-6 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center",children:e.jsx(yt,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:[q.brand," ",q.model]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Serial: ",q.serialNumber]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Customer"}),e.jsx("p",{className:"text-base text-gray-900",children:q.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:q.phoneNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Issue"}),e.jsx("p",{className:"text-sm text-gray-900",children:q.issueDescription})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Created"}),e.jsx("p",{className:"text-sm text-gray-900",children:new Date(q.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Completed"}),e.jsx("p",{className:"text-sm text-green-600 font-semibold",children:new Date(q.updatedAt).toLocaleDateString()})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ms,{className:"h-5 w-5 text-blue-500"}),"Device Timeline"]}),e.jsx("div",{className:"space-y-3",children:q.transitions&&q.transitions.length>0?q.transitions.map((Pe,ot)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[Pe.fromStatus," → ",Pe.toStatus]}),e.jsx("p",{className:"text-xs text-gray-600",children:new Date(Pe.timestamp).toLocaleString()}),e.jsxs("p",{className:"text-xs text-gray-500",children:["By: ",Pe.performedBy]})]})]},Pe.id)):e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(ms,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"No timeline data available"})]})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(js,{className:"h-5 w-5 text-purple-500"}),"Remarks & Conversations"]}),e.jsx("div",{className:"space-y-3",children:q.remarks&&q.remarks.length>0?q.remarks.map((Pe,ot)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:Pe.content}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(Pe.createdAt).toLocaleString()})]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["By: ",Pe.createdBy]})]},Pe.id)):e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(js,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"No remarks or conversations available"})]})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(cn,{className:"h-5 w-5 text-orange-500"}),"Additional Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[q.repairCost&&e.jsxs("div",{className:"bg-orange-50 rounded-lg p-3 border border-orange-200",children:[e.jsx("p",{className:"text-sm font-medium text-orange-700 mb-1",children:"Repair Cost"}),e.jsx("p",{className:"text-lg font-bold text-orange-600",children:q.repairCost})]}),q.depositAmount&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200",children:[e.jsx("p",{className:"text-sm font-medium text-blue-700 mb-1",children:"Deposit"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:q.depositAmount})]}),q.estimatedHours&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 border border-green-200",children:[e.jsx("p",{className:"text-sm font-medium text-green-700 mb-1",children:"Estimated Hours"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[q.estimatedHours,"h"]})]}),q.expectedReturnDate&&e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 border border-purple-200",children:[e.jsx("p",{className:"text-sm font-medium text-purple-700 mb-1",children:"Expected Return"}),e.jsx("p",{className:"text-lg font-bold text-purple-600",children:new Date(q.expectedReturnDate).toLocaleDateString()})]})]})]})]})})]})},eh=()=>{const{currentUser:r}=Wt(),{devices:a,getDevicesDueToday:i,getOverdueDevices:c,getDevicesByTechnician:m}=na(),{customers:u}=Ur(),[x,j]=g.useState(!navigator.onLine),[b,f]=g.useState(!1),[y,N]=g.useState(""),[I,R]=g.useState(!1),[k,E]=g.useState("all"),[v,U]=g.useState(!1),[F,L]=g.useState(!1),[C,$]=g.useState([]),[Y,A]=g.useState(!0),[Z,_]=g.useState([]),[D,T]=g.useState(!1),[z,se]=g.useState(0),[q,H]=g.useState(!1),[J,V]=g.useState("all"),[ge,He]=g.useState("all"),[B,fe]=g.useState("all"),[re,ye]=g.useState("all"),[Q,Le]=g.useState("all"),[Ue,Ct]=g.useState("date"),[Re,ut]=g.useState("desc"),Ee=g.useCallback(()=>{f(!0),setTimeout(()=>f(!1),1e3)},[]);g.useEffect(()=>{const ae=()=>j(!1),ke=()=>j(!0);return window.addEventListener("online",ae),window.addEventListener("offline",ke),()=>{window.removeEventListener("online",ae),window.removeEventListener("offline",ke)}},[]);async function Oe(){try{A(!0);const ae=await En();$(ae)}catch(ae){console.error("Failed to load diagnostic requests:",ae)}finally{A(!1)}}g.useEffect(()=>{(r==null?void 0:r.role)==="admin"&&Oe()},[r==null?void 0:r.role]);const Xe=g.useCallback(()=>{const ae=[],ke=c();ke.length>0&&ae.push({id:"overdue-devices",type:"error",title:"Overdue Devices",message:`${ke.length} device(s) are overdue for completion`,timestamp:new Date,read:!1,action:()=>{E("overdue"),T(!1)}});const Ke=i();Ke.length>0&&ae.push({id:"due-today",type:"warning",title:"Devices Due Today",message:`${Ke.length} device(s) are due for completion today`,timestamp:new Date,read:!1,action:()=>{E("all"),T(!1)}});const le=a.filter(Ne=>{const Te=new Date(Ne.createdAt),Qe=new Date;return Qe.setDate(Qe.getDate()-1),Te>Qe});le.length>0&&ae.push({id:"new-devices",type:"info",title:"New Devices",message:`${le.length} new device(s) added in the last 24 hours`,timestamp:new Date,read:!1,action:()=>{E("all"),T(!1)}}),x&&ae.push({id:"offline-mode",type:"warning",title:"Offline Mode",message:"You are currently working offline. Changes will sync when connection is restored.",timestamp:new Date,read:!1}),_(ae),se(ae.filter(Ne=>!Ne.read).length)},[a,c,i,x,E]);g.useEffect(()=>{Xe()},[a,Xe]),g.useEffect(()=>{const ae=ke=>{ke.target.closest(".notifications-panel")||T(!1)};return D&&document.addEventListener("mousedown",ae),()=>{document.removeEventListener("mousedown",ae)}},[D]);const Be=g.useMemo(()=>{let ae=a;return(r==null?void 0:r.role)==="technician"&&r.id&&(ae=m(r.id)),k!=="all"&&k!=="done"&&(ae=ae.filter(ke=>ke.status!=="done")),y&&(ae=ae.filter(ke=>{var Ke,le,Ne,Te;return((Ke=ke.id)==null?void 0:Ke.toLowerCase().includes(y.toLowerCase()))||((le=ke.customerName)==null?void 0:le.toLowerCase().includes(y.toLowerCase()))||((Ne=ke.brand)==null?void 0:Ne.toLowerCase().includes(y.toLowerCase()))||((Te=ke.model)==null?void 0:Te.toLowerCase().includes(y.toLowerCase()))})),k!=="all"&&["assigned","diagnosis-started","awaiting-parts","in-repair","reassembled-testing","repair-complete","returned-to-customer-care","done","failed"].includes(k)&&(ae=ae.filter(Ke=>Ke.status===k)),ae},[a,r==null?void 0:r.role,r==null?void 0:r.id,y,k,m]),Ce=g.useMemo(()=>{let ae=Be;if(J!=="all"){const ke=new Date,Ke=new Date(ke.getFullYear(),ke.getMonth(),ke.getDate()),le=new Date(Ke.getTime()-7*24*60*60*1e3),Ne=new Date(Ke.getTime()-30*24*60*60*1e3);ae=ae.filter(Te=>{const Qe=new Date(Te.createdAt);switch(J){case"today":return Qe>=Ke;case"week":return Qe>=le;case"month":return Qe>=Ne;default:return!0}})}return ge!=="all"&&(ae=ae.filter(ke=>ke.assignedTo===ge)),B!=="all"&&(ae=ae.filter(ke=>{var Ke;return(Ke=ke.customerName)==null?void 0:Ke.toLowerCase().includes(B.toLowerCase())})),re!=="all"&&(ae=ae.filter(ke=>{var Ke;return(Ke=ke.brand)==null?void 0:Ke.toLowerCase().includes(re.toLowerCase())})),Q!=="all"&&(ae=ae.filter(ke=>Ze(ke.status)===Q)),ae.sort((ke,Ke)=>{let le,Ne;switch(Ue){case"date":le=new Date(ke.createdAt).getTime(),Ne=new Date(Ke.createdAt).getTime();break;case"status":le=ke.status,Ne=Ke.status;break;case"customer":le=ke.customerName||"",Ne=Ke.customerName||"";break;case"technician":le=ke.assignedTo||"",Ne=Ke.assignedTo||"";break;default:return 0}return Re==="asc"?le>Ne?1:-1:le<Ne?1:-1}),ae},[Be,J,ge,B,re,Q,Ue,Re]),Ze=ae=>{switch(ae){case"overdue":case"failed":return"high";case"in-repair":case"diagnosis-started":case"awaiting-parts":return"medium";default:return"low"}},$e=ae=>{let ke=(r==null?void 0:r.role)==="technician"?Be:a;return k!=="all"&&k!=="done"&&(ke=ke.filter(Ke=>Ke.status!=="done")),ke.filter(Ke=>Ke.status===ae).length},K=[{label:"Assigned",count:$e("assigned"),icon:e.jsx(nr,{className:"h-6 w-6 text-amber-500"}),status:"assigned",color:"from-amber-500/20 to-orange-400/10",show:!0},{label:"Diagnosis",count:$e("diagnosis-started"),icon:e.jsx(Un,{className:"h-6 w-6 text-blue-500"}),status:"diagnosis-started",color:"from-blue-500/20 to-blue-400/10",show:!0},{label:"Awaiting Parts",count:$e("awaiting-parts"),icon:e.jsx(Yr,{className:"h-6 w-6 text-yellow-500"}),status:"awaiting-parts",color:"from-yellow-400/20 to-yellow-200/10",show:!0},{label:"In Repair",count:$e("in-repair"),icon:e.jsx(Ss,{className:"h-6 w-6 text-purple-500"}),status:"in-repair",color:"from-purple-500/20 to-purple-400/10",show:!0},{label:"Back to CC",count:$e("returned-to-customer-care"),icon:e.jsx(nr,{className:"h-6 w-6 text-teal-500"}),status:"returned-to-customer-care",color:"from-teal-500/20 to-cyan-400/10",show:!0},{label:"Done",count:$e("done"),icon:e.jsx(yt,{className:"h-6 w-6 text-gray-500"}),status:"done",color:"from-gray-500/20 to-gray-400/10",show:!0},{label:"Failed",count:$e("failed"),icon:e.jsx(Fs,{className:"h-6 w-6 text-red-500"}),status:"failed",color:"from-red-500/20 to-pink-400/10",show:!0}].filter(ae=>ae.show),be=i(),ue=c(),Ye=Ce.filter(ae=>ae.status!=="done");if(g.useEffect(()=>{ue.length>0?te.error(`You have ${ue.length} overdue device${ue.length>1?"s":""}! Please take action.`,{id:"overdue-reminder"}):be.length>0&&te(`You have ${be.length} device${be.length>1?"s":""} due today.`,{id:"due-today-reminder"})},[]),r){if(r.role==="technician")return e.jsx("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:e.jsx(Q0,{devices:a,loading:!1,searchQuery:y,setSearchQuery:N,statusFilter:k,setStatusFilter:E})});if(r.role==="customer-care")return e.jsx("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:e.jsx(J0,{devices:a,loading:!1,searchQuery:y,setSearchQuery:N,statusFilter:k,setStatusFilter:E})})}return e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Device Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage and track all device repairs"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[x&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(Td,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{className:"text-sm text-yellow-700",children:"Offline Mode"})]}),F&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(Ar,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-blue-700",children:"Cached Data"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>T(!D),className:"relative flex items-center gap-2 px-4 py-2 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-lg hover:border-gray-300 transition-all duration-200",children:[e.jsx(Mr,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"text-gray-700",children:"Notifications"}),z>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center",children:z})]}),D&&e.jsxs("div",{className:"notifications-panel absolute right-0 mt-2 w-80 bg-white/95 backdrop-blur-md border border-gray-200 rounded-lg shadow-xl z-50 max-h-96 overflow-y-auto",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("h3",{className:"font-semibold text-gray-900",children:"Notifications"})}),e.jsx("div",{className:"p-2",children:Z.length===0?e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(Mr,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm",children:"No notifications"})]}):Z.map(ae=>e.jsx("div",{className:`p-3 rounded-lg mb-2 cursor-pointer transition-colors duration-200 ${ae.read?"bg-gray-50":"bg-blue-50"}`,onClick:()=>{ae.action&&ae.action(),_(ke=>ke.map(Ke=>Ke.id===ae.id?{...Ke,read:!0}:Ke))},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`mt-1 p-1 rounded-full ${ae.type==="error"?"bg-red-100":ae.type==="warning"?"bg-yellow-100":ae.type==="info"?"bg-blue-100":"bg-green-100"}`,children:ae.type==="error"?e.jsx(Ht,{className:"h-3 w-3 text-red-600"}):ae.type==="warning"?e.jsx(Ht,{className:"h-3 w-3 text-yellow-600"}):ae.type==="info"?e.jsx(Bs,{className:"h-3 w-3 text-blue-600"}):e.jsx(yt,{className:"h-3 w-3 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900",children:ae.title}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:ae.message}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:new Date(ae.timestamp).toLocaleTimeString()})]}),!ae.read&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})]})},ae.id))})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:Ee,disabled:b,className:"flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors duration-200 disabled:opacity-50",children:[e.jsx(us,{className:`h-4 w-4 ${b?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),e.jsxs(Zs,{to:"/devices/new",className:"flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors duration-200",children:[e.jsx(Ii,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Add Device"})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Kr,{className:"h-5 w-5 text-blue-600"}),"Quick Actions"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[Ye.length," active devices"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3",children:[e.jsxs("button",{onClick:()=>{const ae=Ye.filter(ke=>ke.status==="intake");ae.length>0?te.success(`Ready to assign ${ae.length} devices`):te.error("No devices ready for assignment")},className:"flex flex-col items-center gap-2 p-3 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors duration-200",children:[e.jsx(nr,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-700",children:"Bulk Assign"})]}),e.jsxs("button",{onClick:()=>{const ae=Ye.filter(ke=>["assigned","diagnosis-started","awaiting-parts"].includes(ke.status));ae.length>0?te.success(`Ready to update ${ae.length} devices`):te.error("No devices ready for status update")},className:"flex flex-col items-center gap-2 p-3 bg-green-50 hover:bg-green-100 rounded-lg transition-colors duration-200",children:[e.jsx(Fr,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-700",children:"Bulk Update"})]}),e.jsxs("button",{onClick:()=>{const ae=Ye.map(Te=>({id:Te.id,customer:Te.customerName,device:Te.deviceName,status:Te.status,technician:Te.technician,createdAt:new Date(Te.createdAt).toLocaleDateString()})),ke=[Object.keys(ae[0]).join(","),...ae.map(Te=>Object.values(Te).join(","))].join(`
`),Ke=new Blob([ke],{type:"text/csv"}),le=window.URL.createObjectURL(Ke),Ne=document.createElement("a");Ne.href=le,Ne.download=`devices-${new Date().toISOString().split("T")[0]}.csv`,Ne.click(),te.success("Data exported successfully")},className:"flex flex-col items-center gap-2 p-3 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors duration-200",children:[e.jsx(Br,{className:"h-5 w-5 text-purple-600"}),e.jsx("span",{className:"text-xs font-medium text-purple-700",children:"Export CSV"})]}),e.jsxs(Zs,{to:"/devices/new",className:"flex flex-col items-center gap-2 p-3 bg-orange-50 hover:bg-orange-100 rounded-lg transition-colors duration-200",children:[e.jsx(Ut,{className:"h-5 w-5 text-orange-600"}),e.jsx("span",{className:"text-xs font-medium text-orange-700",children:"Add Device"})]}),e.jsxs(Zs,{to:"/customers",className:"flex flex-col items-center gap-2 p-3 bg-teal-50 hover:bg-teal-100 rounded-lg transition-colors duration-200",children:[e.jsx(_s,{className:"h-5 w-5 text-teal-600"}),e.jsx("span",{className:"text-xs font-medium text-teal-700",children:"Customers"})]}),e.jsxs("button",{onClick:()=>{const ae={total:Ye.length,overdue:c().length,dueToday:i().length,completed:a.filter(ke=>ke.status==="done").length};te.success(`Stats: ${ae.total} active, ${ae.overdue} overdue, ${ae.completed} completed`)},className:"flex flex-col items-center gap-2 p-3 bg-indigo-50 hover:bg-indigo-100 rounded-lg transition-colors duration-200",children:[e.jsx(zr,{className:"h-5 w-5 text-indigo-600"}),e.jsx("span",{className:"text-xs font-medium text-indigo-700",children:"Quick Stats"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 xl:grid-cols-9 gap-4 mb-6",children:K.map(ae=>e.jsxs("button",{onClick:()=>E(ae.status),className:`p-4 rounded-xl border transition-all duration-200 hover:scale-105 ${k===ae.status?"border-blue-300 bg-blue-50 shadow-lg":"border-gray-200 bg-white/80 backdrop-blur-sm hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[ae.icon,e.jsx("span",{className:"text-lg font-bold text-gray-900",children:ae.count})]}),e.jsx("p",{className:"text-sm font-medium text-gray-700 text-left",children:ae.label})]},ae.status))}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(ga,{value:y,onChange:N,placeholder:"Search devices, customers, or technicians...",className:"w-full"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>H(!q),className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors duration-200",children:[e.jsx(Rr,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Filters"}),q&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})]}),(J!=="all"||ge!=="all"||B!=="all"||re!=="all"||Q!=="all")&&e.jsx("button",{onClick:()=>{V("all"),He("all"),fe("all"),ye("all"),Le("all")},className:"px-3 py-2 text-sm text-gray-500 hover:text-gray-700 transition-colors duration-200",children:"Clear All"})]})]}),q&&e.jsx("div",{className:"mt-4 p-4 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-lg shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Range"}),e.jsxs("select",{value:J,onChange:ae=>V(ae.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Technician"}),e.jsxs("select",{value:ge,onChange:ae=>He(ae.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Technicians"}),Array.from(new Set(a.map(ae=>ae.technician).filter(Boolean))).map(ae=>e.jsx("option",{value:ae,children:ae},ae))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer"}),e.jsxs("select",{value:B,onChange:ae=>fe(ae.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Customers"}),Array.from(new Set(a.map(ae=>ae.customerName).filter(Boolean))).map(ae=>e.jsx("option",{value:ae,children:ae},ae))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Brand"}),e.jsxs("select",{value:re,onChange:ae=>ye(ae.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Brands"}),Array.from(new Set(a.map(ae=>ae.brand).filter(Boolean))).map(ae=>e.jsx("option",{value:ae,children:ae},ae))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),e.jsxs("select",{value:Q,onChange:ae=>Le(ae.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sort By"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("select",{value:Ue,onChange:ae=>Ct(ae.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"status",children:"Status"}),e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"technician",children:"Technician"})]}),e.jsx("button",{onClick:()=>ut(Re==="asc"?"desc":"asc"),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 transition-colors duration-200",children:Re==="asc"?"↑":"↓"})]})]})]})})]}),Ye.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("h2",{className:"text-lg sm:text-xl font-bold text-gray-700 mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(hn,{className:"h-5 w-5 text-gray-600"})}),"Active Devices (",Ye.length,")"]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6",children:Yn(Ye).map(ae=>e.jsx(Xn,{device:ae},ae.id))})]}):e.jsxs(he,{className:"flex flex-col items-center justify-center p-8 sm:p-12 text-center",children:[e.jsx(ns,{className:"h-12 w-12 sm:h-16 sm:w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-xl sm:text-2xl font-medium text-gray-900 mb-3",children:"No devices found"}),e.jsx("p",{className:"text-gray-600 text-sm sm:text-base max-w-md",children:y?"No devices match your search criteria":k!=="all"?`No devices with status "${k.replace(/-/g," ")}"`:"No devices available in your queue"})]}),(()=>{const ae=a.filter(le=>le.status==="done"),[ke,Ke]=g.useState(!1);return ae.length>0?e.jsxs("div",{className:"mt-8 sm:mt-12 border-t border-gray-200 pt-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500/20 to-green-400/10 rounded-xl flex items-center justify-center",children:e.jsx(yt,{className:"h-6 w-6 text-green-500"})}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-white",children:ae.length})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Completed Devices"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Successfully completed work"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6",children:Yn(ae).slice(0,ke?ae.length:4).map(le=>e.jsx(Xn,{device:le},le.id))}),ae.length>4&&e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>Ke(!ke),className:"inline-flex items-center gap-2 px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors duration-200 hover:shadow-md",children:ke?e.jsx(e.Fragment,{children:e.jsx("span",{children:"Show Less"})}):e.jsx(e.Fragment,{children:e.jsxs("span",{children:["View More (",ae.length-4," more)"]})})})})]}):null})(),(r==null?void 0:r.role)==="customer-care"&&e.jsxs("div",{className:"mt-8 sm:mt-12 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h2",{className:"text-lg sm:text-xl font-bold text-blue-700 mb-2 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Nr,{className:"h-5 w-5 text-blue-600"})}),"Device Diagnostics"]})}),e.jsx(he,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Nr,{className:"h-8 w-8 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Need Device Diagnostics?"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Submit your devices for professional diagnostic testing. Our technicians will thoroughly test your equipment and provide detailed reports."}),e.jsxs(Zs,{to:"/diagnostics/new",className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors duration-200 hover:shadow-md",children:[e.jsx(Ii,{className:"h-5 w-5"}),"Request Device Diagnostics"]})]})})]}),(r==null?void 0:r.role)==="admin"&&e.jsxs("div",{className:"mt-8 sm:mt-12 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-bold text-purple-700 mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Nr,{className:"h-5 w-5 text-purple-600"})}),"Diagnostics Dashboard"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Zs,{to:"/diagnostics/new",className:"flex items-center gap-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-colors duration-200",children:[e.jsx(Ut,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"New Diagnostic"})]}),e.jsx(Zs,{to:"/diagnostics/reports",className:"text-sm text-purple-600 hover:text-purple-700 font-medium hover:underline transition-colors duration-200",children:"View All →"})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:(()=>{const ae=C.flatMap(Ne=>{var Te;return((Te=Ne.devices)==null?void 0:Te.filter(Qe=>Qe.result_status!=="passed"&&Qe.result_status!=="failed"&&Qe.result_status!=="partially_failed"))||[]}),ke=C.flatMap(Ne=>{var Te;return((Te=Ne.devices)==null?void 0:Te.filter(Qe=>Qe.result_status==="passed"||Qe.result_status==="failed"||Qe.result_status==="partially_failed"))||[]}),Ke=C.flatMap(Ne=>{var Te;return((Te=Ne.devices)==null?void 0:Te.filter(Qe=>!Qe.result_status||Qe.result_status==="pending"))||[]}),le=C.flatMap(Ne=>{var Te;return((Te=Ne.devices)==null?void 0:Te.filter(Qe=>Qe.result_status==="in_progress"||Qe.result_status==="testing"))||[]});return[{label:"Active Diagnostics",count:ae.length,icon:e.jsx(Nr,{className:"h-6 w-6 text-purple-500"}),color:"from-purple-500/20 to-purple-400/10",description:"Currently being tested"},{label:"Pending",count:Ke.length,icon:e.jsx(ms,{className:"h-6 w-6 text-yellow-500"}),color:"from-yellow-400/20 to-yellow-200/10",description:"Waiting to start"},{label:"In Progress",count:le.length,icon:e.jsx(Fr,{className:"h-6 w-6 text-blue-500"}),color:"from-blue-500/20 to-blue-400/10",description:"Currently testing"},{label:"Completed",count:ke.length,icon:e.jsx(yt,{className:"h-6 w-6 text-green-500"}),color:"from-green-500/20 to-green-400/10",description:"Tests finished"}].map((Ne,Te)=>e.jsx(he,{className:"p-4 cursor-pointer hover:scale-105 transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-gradient-to-br ${Ne.color}`,children:Ne.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:Ne.label}),e.jsx("p",{className:"text-sm text-gray-600",children:Ne.description})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:Ne.count})})]})},Te))})()}),Y?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-3 text-sm",children:"Loading diagnostic devices..."})]}):C.length===0?e.jsxs(he,{className:"p-8 sm:p-12 text-center",children:[e.jsx(Nr,{className:"h-12 w-12 sm:h-16 sm:w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Diagnostic Devices"}),e.jsx("p",{className:"text-gray-600 text-sm sm:text-base mb-6",children:"Start by creating diagnostic requests to see devices here"}),e.jsxs(Zs,{to:"/diagnostics/new",className:"inline-flex items-center gap-2 px-6 py-3 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-colors duration-200 hover:shadow-md",children:[e.jsx(Ut,{className:"h-5 w-5"}),"Create Diagnostic Request"]})]}):e.jsxs("div",{className:"space-y-6",children:[(()=>{const ae=C.flatMap(ke=>{var Ke;return((Ke=ke.devices)==null?void 0:Ke.filter(le=>le.result_status!=="passed"&&le.result_status!=="failed"&&le.result_status!=="partially_failed").map(le=>({...le,request:ke})))||[]});return ae.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),"Active Diagnostic Devices (",ae.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6",children:ae.map(ke=>{var Ke;return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl border border-gray-200 p-4 hover:shadow-lg hover:scale-105 transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Nr,{className:"h-4 w-4 text-purple-600"})}),e.jsx("span",{className:"font-medium text-gray-900 text-sm truncate",children:ke.device_name})]}),e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${ke.result_status==="passed"?"text-green-600 bg-green-50 border border-green-200":ke.result_status==="failed"?"text-red-600 bg-red-50 border border-red-200":ke.result_status==="in_progress"?"text-blue-600 bg-blue-50 border border-blue-200":ke.result_status==="testing"?"text-orange-600 bg-orange-50 border border-orange-200":"text-yellow-600 bg-yellow-50 border border-yellow-200"}`,children:ke.result_status||"pending"})]}),e.jsxs("div",{className:"text-xs text-gray-600 mb-4 space-y-1",children:[e.jsxs("div",{className:"truncate",children:["Request: ",ke.request.title]}),e.jsxs("div",{children:["Model: ",ke.model||"N/A"]}),e.jsxs("div",{children:["Assigned: ",((Ke=ke.request.assigned_to_user)==null?void 0:Ke.name)||"Unassigned"]}),e.jsxs("div",{children:["Created: ",new Date(ke.request.created_at).toLocaleDateString()]})]}),e.jsx(Zs,{to:`/diagnostics/device/${ke.request.id}/${ke.id}`,className:"block w-full text-center px-3 py-2 bg-purple-500 hover:bg-purple-600 text-white text-sm rounded-lg font-medium transition-colors duration-200 hover:shadow-md",children:"View Details"})]},ke.id)})})]}):null})(),(()=>{const ae=C.flatMap(ke=>{var Ke;return((Ke=ke.devices)==null?void 0:Ke.filter(le=>le.result_status==="passed"||le.result_status==="failed"||le.result_status==="partially_failed").map(le=>({...le,request:ke})))||[]});return ae.length>0?e.jsxs("div",{className:"mt-8",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Completed Diagnostics (",ae.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6",children:ae.slice(0,4).map(ke=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl border border-gray-200 p-4 hover:shadow-lg hover:scale-105 transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(yt,{className:"h-4 w-4 text-green-600"})}),e.jsx("span",{className:"font-medium text-gray-900 text-sm truncate",children:ke.device_name})]}),e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${ke.result_status==="passed"?"text-green-600 bg-green-50 border border-green-200":ke.result_status==="failed"?"text-red-600 bg-red-50 border border-red-200":"text-yellow-600 bg-yellow-50 border border-yellow-200"}`,children:ke.result_status})]}),e.jsxs("div",{className:"text-xs text-gray-600 mb-4 space-y-1",children:[e.jsxs("div",{className:"truncate",children:["Request: ",ke.request.title]}),e.jsxs("div",{children:["Model: ",ke.model||"N/A"]}),e.jsxs("div",{children:["Completed: ",new Date(ke.updated_at||ke.created_at).toLocaleDateString()]})]}),e.jsx(Zs,{to:`/diagnostics/device/${ke.request.id}/${ke.id}`,className:"block w-full text-center px-3 py-2 bg-green-500 hover:bg-green-600 text-white text-sm rounded-lg font-medium transition-colors duration-200 hover:shadow-md",children:"View Results"})]},ke.id))}),ae.length>4&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs(Zs,{to:"/diagnostics/reports",className:"inline-flex items-center gap-2 px-4 py-2 text-purple-600 hover:text-purple-700 font-medium hover:underline transition-colors duration-200",children:["View All Completed (",ae.length-4," more)"]})})]}):null})()]})]})]})},th="clean-app-db",wn="pending-actions";async function pl(){return cc(th,1,{upgrade(r){r.objectStoreNames.contains(wn)||r.createObjectStore(wn,{keyPath:"id",autoIncrement:!0})}})}async function jn(r){await(await pl()).add(wn,{...r,timestamp:Date.now()})}async function sh(){return(await pl()).getAll(wn)}async function rh(){const a=(await pl()).transaction(wn,"readwrite");await a.store.clear(),await a.done}function Mc({key:r,formData:a,setFormData:i,clearOnSubmit:c=!1,submitted:m=!1}){const u=g.useRef(!0);return g.useEffect(()=>{const j=localStorage.getItem(r);if(j)try{const b=JSON.parse(j);i(b)}catch{}},[r]),g.useEffect(()=>{if(u.current){u.current=!1;return}localStorage.setItem(r,JSON.stringify(a))},[a,r]),g.useEffect(()=>{c&&m&&localStorage.removeItem(r)},[c,m,r]),{clearDraft:()=>localStorage.removeItem(r)}}const Pn={name:"",phone:"",whatsapp:"",gender:"",city:"",birthMonth:"",birthDay:"",referralSource:"",notes:"",referralSourceCustom:""},Rc="referral_source_clicks";function ah(){try{return JSON.parse(localStorage.getItem(Rc)||"{}")}catch{return{}}}function nh(r){localStorage.setItem(Rc,JSON.stringify(r))}const Lc=({onSubmit:r,onCancel:a,isLoading:i=!1,initialValues:c={},showBackAction:m=!1,onBack:u,renderActionsInModal:x=!1,children:j})=>{const[b,f]=g.useState({...Pn,...c}),[y,N]=g.useState({}),[I,R]=g.useState(!0),[k,E]=g.useState([]),[v,U]=g.useState(!1),[F,L]=g.useState(!1),[C,$]=g.useState(!1),[Y,A]=g.useState(!1),[Z,_]=g.useState(!1),[D,T]=g.useState(!1),[z,se]=g.useState(!1),[q,H]=g.useState(!1),[J,V]=g.useState(!1),[ge,He]=g.useState(ah()),{clearDraft:B}=Mc({key:"customer_form_draft",formData:b,setFormData:f,clearOnSubmit:!0,submitted:z});g.useEffect(()=>{f({...Pn,...c})},[JSON.stringify(c)]);const fe=()=>{f({...Pn}),B()},re=["Dar es Salaam","Arusha","Mwanza","Dodoma","Mbeya","Tanga","Morogoro","Iringa","Tabora","Kigoma","Mara","Kagera","Shinyanga","Singida","Rukwa","Ruvuma","Lindi","Mtwara","Pwani","Manyara","Geita","Simiyu","Katavi","Njombe","Songwe"],ye=["January","February","March","April","May","June","July","August","September","October","November","December"],Q=Array.from({length:31},(K,be)=>(be+1).toString()),Le=[{label:"Friend",icon:"🤝",color:"green"},{label:"Walk-in",icon:"🚶",color:"orange"},{label:"Facebook",icon:e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor",style:{display:"inline",verticalAlign:"middle"},children:e.jsx("path",{d:"M22.675 0h-21.35C.595 0 0 .592 0 1.326v21.348C0 23.408.595 24 1.325 24h11.495v-9.294H9.692v-3.622h3.128V8.413c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.797.143v3.24l-1.918.001c-1.504 0-1.797.715-1.797 1.763v2.313h3.587l-.467 3.622h-3.12V24h6.116C23.406 24 24 23.408 24 22.674V1.326C24 .592 23.406 0 22.675 0"})}),color:"blue"},{label:"Instagram",icon:e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor",style:{display:"inline",verticalAlign:"middle"},children:e.jsx("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 1.366.062 2.633.334 3.608 1.308.974.974 1.246 2.241 1.308 3.608.058 1.266.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.062 1.366-.334 2.633-1.308 3.608-.974.974-2.241 1.246-3.608 1.308-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.366-.062-2.633-.334-3.608-1.308-.974-.974-1.246-2.241-1.308-3.608C2.175 15.647 2.163 15.267 2.163 12s.012-3.584.07-4.85c.062-1.366.334-2.633 1.308-3.608.974-.974 2.241-1.246 3.608-1.308C8.416 2.175 8.796 2.163 12 2.163zm0-2.163C8.741 0 8.332.013 7.052.072 5.771.131 4.659.363 3.678 1.344c-.98.98-1.213 2.092-1.272 3.373C2.013 5.668 2 6.077 2 9.333v5.334c0 3.256.013 3.665.072 4.946.059 1.281.292 2.393 1.272 3.373.98.98 2.092 1.213 3.373 1.272C8.332 23.987 8.741 24 12 24s3.668-.013 4.948-.072c1.281-.059 2.393-.292 3.373-1.272.98-.98 1.213-2.092 1.272-3.373.059-1.281.072-1.69.072-4.946V9.333c0-3.256-.013-3.665-.072-4.946-.059-1.281-.292-2.393-1.272-3.373-.98-.98-2.092-1.213-3.373-1.272C15.668.013 15.259 0 12 0zm0 5.838a6.162 6.162 0 1 0 0 12.324 6.162 6.162 0 0 0 0-12.324zm0 10.162a3.999 3.999 0 1 1 0-7.998 3.999 3.999 0 0 1 0 7.998zm6.406-11.845a1.44 1.44 0 1 0 0 2.88 1.44 1.44 0 0 0 0-2.88z"})}),color:"pink"},{label:"Tiktok",icon:"🎵",color:"gray"},{label:"Website",icon:"🌐",color:"teal"},{label:"Business Card",icon:"💳",color:"yellow"},{label:"Newspaper",icon:"📰",color:"gray"},{label:"Google Search",icon:"🔍",color:"red"},{label:"Billboard",icon:"🏢",color:"indigo"},{label:"Event",icon:"🎫",color:"violet"},{label:"Other",icon:"❓",color:"slate"}],Ue={green:{selected:"bg-green-600 text-white font-semibold shadow-lg ring-2 ring-green-300",unselected:"bg-green-100 text-green-700"},orange:{selected:"bg-orange-600 text-white font-semibold shadow-lg ring-2 ring-orange-300",unselected:"bg-orange-100 text-orange-700"},blue:{selected:"bg-blue-600 text-white font-semibold shadow-lg ring-2 ring-blue-300",unselected:"bg-blue-100 text-blue-700"},pink:{selected:"bg-pink-600 text-white font-semibold shadow-lg ring-2 ring-pink-300",unselected:"bg-pink-100 text-pink-700"},gray:{selected:"bg-gray-600 text-white font-semibold shadow-lg ring-2 ring-gray-300",unselected:"bg-gray-100 text-gray-700"},teal:{selected:"bg-teal-600 text-white font-semibold shadow-lg ring-2 ring-teal-300",unselected:"bg-teal-100 text-teal-700"},yellow:{selected:"bg-yellow-500 text-white font-semibold shadow-lg ring-2 ring-yellow-200",unselected:"bg-yellow-100 text-yellow-700"},red:{selected:"bg-red-600 text-white font-semibold shadow-lg ring-2 ring-red-300",unselected:"bg-red-100 text-red-700"},indigo:{selected:"bg-indigo-600 text-white font-semibold shadow-lg ring-2 ring-indigo-300",unselected:"bg-indigo-100 text-indigo-700"},violet:{selected:"bg-violet-600 text-white font-semibold shadow-lg ring-2 ring-violet-300",unselected:"bg-violet-100 text-violet-700"},slate:{selected:"bg-slate-600 text-white font-semibold shadow-lg ring-2 ring-slate-300",unselected:"bg-slate-100 text-slate-700"}},Ct=c==null?void 0:c.id;g.useEffect(()=>{const K=be=>{const ue=be.target;F&&!ue.closest('[data-dropdown="region"]')&&L(!1),C&&!ue.closest('[data-dropdown="month"]')&&$(!1),Y&&!ue.closest('[data-dropdown="day"]')&&A(!1),Z&&!ue.closest('[data-dropdown="referral"]')&&_(!1)};return document.addEventListener("mousedown",K),()=>document.removeEventListener("mousedown",K)},[F,C,Y,Z]);const Re=async K=>{if(!(!K||K.length<10)){T(!0);try{const{data:be,error:ue}=await G.from("customers").select("id, name, phone, email").eq("phone",K);if(ue){console.error("Error checking phone:",ue);return}const Ye=be?Ct?be.filter(ae=>ae.id!==Ct):be:[];Ye.length>0?(E(Ye),U(!0),N(ae=>({...ae,phone:Ct?"Another customer with this phone number already exists.":"A customer with this phone number already exists."}))):(E([]),U(!1),N(ae=>{const ke={...ae};return delete ke.phone,ke}))}catch(be){console.error("Error checking duplicate phone:",be)}finally{T(!1)}}};g.useEffect(()=>{const K=setTimeout(()=>{b.phone&&b.phone.length>=10&&Re(b.phone)},500);return()=>clearTimeout(K)},[b.phone]);const ut=K=>{const{name:be,value:ue}=K.target;let Ye=ue;be==="name"&&(Ye=ue.charAt(0).toUpperCase()+ue.slice(1).toLowerCase()),f(ae=>({...ae,[be]:Ye})),be==="phone"&&I&&f(ae=>({...ae,whatsapp:Ye})),y[be]&&N(ae=>({...ae,[be]:""}))},Ee=async K=>{K.preventDefault(),N({});const be={};if(b.name.trim()||(be.name="Name is required"),b.phone.trim()?b.phone.length<10&&(be.phone="Phone number must be at least 10 digits"):be.phone="Phone number is required",v&&k.length>0&&(be.phone="A customer with this phone number already exists. Please use a different phone number."),b.gender||(be.gender="Gender is required"),Object.keys(be).length>0){N(be);return}if(navigator.onLine)try{await r(b),se(!0)}catch{}else await jn({type:"submitData",payload:b}),V(!0),f({...Pn}),setTimeout(()=>V(!1),3e3)},Oe=!!Ct,Xe=[m&&u?{icon:e.jsx(zs,{}),label:"Back",onClick:u,color:"primary"}:null,{icon:e.jsx(tr,{}),label:"Cancel",onClick:a,color:"danger"},{icon:e.jsx(us,{}),label:"Reset",onClick:fe,color:"secondary"},{icon:i?e.jsx(us,{className:"animate-spin"}):e.jsx(zo,{}),label:i?Oe?"Updating...":"Adding...":Oe?"Update Customer":"Add Customer",onClick:()=>{},color:"success",disabled:i}].filter(Boolean),Be=[...Le].sort((K,be)=>{const ue=ge[K.label]||0;return(ge[be.label]||0)-ue});function Ce(K){f(ue=>({...ue,referralSource:K}));const be={...ge,[K]:(ge[K]||0)+1};nh(be),He(be)}const Ze=()=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"name",value:b.name||"",onChange:ut,className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter customer name",required:!0,autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Ws,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]}),y.name&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:y.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Phone Number *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"tel",name:"phone",value:b.phone||"",onChange:ut,className:`w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none ${y.phone?"border-red-500 focus:border-red-500":"border-gray-300 focus:border-blue-500"}`,placeholder:"Enter phone number",required:!0,autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Qr,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18}),D&&e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"})})]}),y.phone&&e.jsxs("div",{className:"mt-1 text-sm text-red-600 flex items-center gap-2",children:[e.jsx(Ht,{size:16,className:"text-red-500"}),y.phone]}),v&&k.length>0&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ht,{size:16,className:"text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Existing customer found:"})]}),k.map((K,be)=>e.jsxs("div",{className:"text-sm text-yellow-700",children:["• ",K.name," (",K.phone,") ",K.email&&`- ${K.email}`]},K.id))]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-gray-700 font-medium",children:"WhatsApp"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"hasWhatsapp",checked:I,onChange:K=>{R(K.target.checked),K.target.checked?b.phone&&f(be=>({...be,whatsapp:b.phone})):f(be=>({...be,whatsapp:""}))},className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),e.jsx("label",{htmlFor:"hasWhatsapp",className:"text-sm text-gray-600",children:"Has WhatsApp"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"whatsapp",value:b.whatsapp||"",onChange:ut,disabled:!I,className:`w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none ${I?"border-gray-300 focus:border-blue-500":"border-gray-200 bg-gray-50 text-gray-500"}`,placeholder:I?"Enter WhatsApp number":"WhatsApp disabled",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Qr,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]}),y.whatsapp&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:y.whatsapp})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Region"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"city",value:b.city||"",onChange:ut,onFocus:()=>L(!0),onBlur:()=>setTimeout(()=>L(!1),200),className:"w-full min-h-[48px] py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Type or select region",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(ei,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18}),e.jsx(sa,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500",size:18}),F&&e.jsxs("div",{"data-dropdown":"region",className:"absolute top-full left-0 right-0 mt-1 bg-white/95 backdrop-blur-md border-2 border-gray-300 rounded-lg shadow-xl z-[9999] max-h-60 overflow-y-auto",children:[re.filter(K=>K.toLowerCase().includes(b.city.toLowerCase())||b.city==="").map((K,be)=>e.jsx("div",{className:"px-4 py-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>{f(ue=>({...ue,city:K})),L(!1)},children:K},K)),re.filter(K=>K.toLowerCase().includes(b.city.toLowerCase())||b.city==="").length===0&&e.jsx("div",{className:"px-4 py-3 text-gray-500",children:"No matching regions found"})]})]})]}),e.jsxs("div",{className:"md:col-span-1 flex flex-col justify-end",children:[e.jsxs("label",{className:"block text-gray-700 mb-2 font-medium",children:["Gender ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"flex gap-3",children:[{value:"male",label:"Male",icon:"👨"},{value:"female",label:"Female",icon:"👩"}].map(K=>{const be=b.gender===K.value;return e.jsxs("button",{type:"button",onClick:()=>f(ue=>({...ue,gender:K.value})),className:`flex-1 flex items-center justify-center gap-2 py-3 px-4 rounded-lg border-2 text-sm font-medium transition-all duration-200 cursor-pointer relative
                  ${be?K.value==="male"?"bg-blue-600 text-white border-blue-600 shadow-lg":"bg-pink-600 text-white border-pink-600 shadow-lg":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 hover:border-gray-400 hover:shadow-md"}
                  focus:outline-none focus:ring-2 focus:ring-blue-300 focus:ring-opacity-50
                  h-[52px]`,style:{userSelect:"none"},children:[e.jsx("span",{className:"text-lg",children:K.icon}),e.jsx("span",{className:"font-medium",children:K.label})]},K.value)})}),y.gender&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:y.gender})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Birthday"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"birthMonth",value:b.birthMonth||"",onChange:ut,onFocus:()=>$(!0),onBlur:()=>setTimeout(()=>$(!1),200),className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Type or select month",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 text-lg",children:"🎂"}),e.jsx(sa,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500",size:18}),C&&e.jsxs("div",{"data-dropdown":"month",className:"absolute top-full left-0 right-0 mt-1 bg-white/95 backdrop-blur-md border-2 border-gray-300 rounded-lg shadow-xl z-[9999] max-h-60 overflow-y-auto",children:[ye.filter(K=>K.toLowerCase().includes(b.birthMonth.toLowerCase())||b.birthMonth==="").map(K=>e.jsx("div",{className:"px-4 py-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>{f(be=>({...be,birthMonth:K})),$(!1)},children:K},K)),ye.filter(K=>K.toLowerCase().includes(b.birthMonth.toLowerCase())||b.birthMonth==="").length===0&&e.jsx("div",{className:"px-4 py-3 text-gray-500",children:"No matching months found"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"birthDay",value:b.birthDay||"",onChange:ut,onFocus:()=>A(!0),onBlur:()=>setTimeout(()=>A(!1),200),className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Type or select day",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 text-lg",children:"🎉"}),e.jsx(sa,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500",size:18}),Y&&e.jsxs("div",{"data-dropdown":"day",className:"absolute top-full left-0 right-0 mt-1 bg-white/95 backdrop-blur-md border-2 border-gray-300 rounded-lg shadow-xl z-[9999] max-h-60 overflow-y-auto",children:[Q.filter(K=>K.includes(b.birthDay)||b.birthDay==="").map(K=>e.jsx("div",{className:"px-4 py-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>{f(be=>({...be,birthDay:K})),A(!1)},children:K},K)),Q.filter(K=>K.includes(b.birthDay)||b.birthDay==="").length===0&&e.jsx("div",{className:"px-4 py-3 text-gray-500",children:"No matching days found"})]})]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Referral Source"}),e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:Be.map(K=>{const be=b.referralSource===K.label,ue=Ue[K.color][be?"selected":"unselected"];return e.jsxs("button",{type:"button",onClick:()=>Ce(K.label),className:`w-full flex items-center justify-start gap-2 px-4 py-3 rounded-lg text-sm transition-all duration-200 ease-in-out ${ue} focus:outline-none`,style:{userSelect:"none"},children:[e.jsx("span",{className:"text-2xl whitespace-nowrap",children:K.icon}),e.jsx("span",{className:"whitespace-nowrap",children:K.label})]},K.label)})})}),b.referralSource==="Other"&&e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"text",name:"referralSource",value:b.referralSourceCustom||"",onChange:K=>f(be=>({...be,referralSourceCustom:K.target.value})),className:"w-full min-h-[48px] py-3 px-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Please specify referral source",autoComplete:"off",autoCorrect:"off",spellCheck:!1})})]}),e.jsx("div",{className:"md:col-span-2 flex justify-end",children:q?e.jsx("button",{type:"button",onClick:()=>H(!1),className:"text-gray-500 hover:underline text-sm mt-2",children:"Hide Notes"}):e.jsx("button",{type:"button",onClick:()=>H(!0),className:"text-blue-600 hover:underline text-sm mt-2",children:"+ Add Notes"})}),q&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Notes"}),e.jsx("textarea",{name:"notes",value:b.notes||"",onChange:ut,rows:2,className:"w-full min-h-[48px] py-3 px-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none resize-none",placeholder:"Additional notes",autoComplete:"off",autoCorrect:"off",spellCheck:!1})]})]}),$e=e.jsxs("div",{style:{position:"relative"},children:[J&&e.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg text-center text-base font-semibold animate-fade-in",children:"Customer saved offline! Will sync when you are back online."}),e.jsx("form",{id:"customer-form",onSubmit:Ee,className:"space-y-6 pb-28",children:Ze()}),e.jsx("div",{className:"w-full",style:{position:"sticky",left:0,right:0,bottom:0,background:"rgba(255,255,255,0.97)",boxShadow:"0 -2px 8px rgba(0,0,0,0.05)",padding:16,display:"flex",justifyContent:"flex-end",borderBottomLeftRadius:24,borderBottomRightRadius:24,zIndex:20},children:Xe.map((K,be)=>e.jsxs("button",{type:be===Xe.length-1?"submit":"button",onClick:be===Xe.length-1?ue=>{ue.preventDefault();const Ye=document.getElementById("customer-form");Ye&&Ye.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}))}:K.onClick,disabled:K.disabled,className:`inline-flex items-center gap-2 px-6 py-3 rounded-lg font-semibold text-base transition-all duration-200 shadow-sm ml-2
              ${K.color==="danger"?"bg-rose-500 text-white hover:bg-rose-600 hover:shadow-md":K.color==="success"?"bg-emerald-500 text-white hover:bg-emerald-600 hover:shadow-md":K.color==="primary"?"bg-blue-500 text-white hover:bg-blue-600 hover:shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200 hover:shadow-md"}
              ${K.disabled?"opacity-50 cursor-not-allowed":"hover:scale-105 active:scale-95"}
              focus:outline-none focus:ring-2 focus:ring-blue-300 focus:ring-opacity-50`,children:[K.icon," ",K.label]},K.label+be))})]});if(x&&typeof j=="function"){const K=e.jsx("div",{className:"flex gap-3 w-full justify-end",children:Xe.map((be,ue)=>{const{icon:Ye,label:ae,onClick:ke,color:Ke,disabled:le}=be;return e.jsxs("button",{type:ue===Xe.length-1?"submit":"button",onClick:ue===Xe.length-1?Ne=>{Ne.preventDefault();const Te=document.getElementById("customer-form");Te&&Te.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}))}:ke,disabled:le,className:`flex-1 inline-flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-semibold text-base transition-all duration-200 shadow-sm ml-2
                ${Ke==="danger"?"bg-rose-500 text-white hover:bg-rose-600 hover:shadow-md":Ke==="success"?"bg-emerald-500 text-white hover:bg-emerald-600 hover:shadow-md":Ke==="primary"?"bg-blue-500 text-white hover:bg-blue-600 hover:shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200 hover:shadow-md"}
                ${le?"opacity-50 cursor-not-allowed":"hover:scale-105 active:scale-95"}
                focus:outline-none focus:ring-2 focus:ring-blue-300 focus:ring-opacity-50
              `,children:[Ye," ",ae]},ae)})});return j(K,e.jsx("form",{id:"customer-form",onSubmit:Ee,className:"space-y-6",children:Ze()}))}return $e},bl=({isOpen:r,onClose:a,onCustomerCreated:i})=>{const{addCustomer:c}=Ur(),[m,u]=g.useState(!1),x=Sn,j=ol,b=async f=>{try{u(!0);const y={name:f.name,phone:x(f.phone),email:"",gender:f.gender,city:f.city,whatsapp:j(f.whatsapp||""),referralSource:f.referralSource,birthMonth:f.birthMonth,birthDay:f.birthDay,initialNotes:f.notes,notes:[],loyaltyLevel:"bronze",colorTag:f.customerTag,referrals:[],totalSpent:0,points:0,lastVisit:new Date().toISOString(),isActive:!0,devices:[]},N=await c(y);N?(va.playSuccessSound(),te.success("Customer created successfully!"),i&&i(N),a()):te.error("Failed to create customer. Please try again.")}catch(y){console.error("AddCustomerModal: Unexpected error:",y),te.error("Failed to create customer. Please try again.")}finally{u(!1)}};return e.jsx(Lc,{onSubmit:b,onCancel:a,isLoading:m,renderActionsInModal:!0,children:(f,y)=>e.jsx(es,{isOpen:r,onClose:a,title:"Add New Customer",actions:f,maxWidth:"lg",children:y})})},ih=["iPhone 6 (A1549, A1586)","iPhone 6 Plus (A1522, A1524)","iPhone 6s (A1633, A1688)","iPhone 6s Plus (A1634, A1687)","iPhone SE (1st generation) (A1662, A1723)","iPhone 7 (A1660, A1778)","iPhone 7 Plus (A1661, A1784)","iPhone 8 (A1863, A1905)","iPhone 8 Plus (A1864, A1897)","iPhone X (A1865, A1901)","iPhone XR (A1984, A2105)","iPhone XS (A1920, A2097)","iPhone XS Max (A1921, A2101)","iPhone 11 (A2111, A2223)","iPhone 11 Pro (A2160, A2215)","iPhone 11 Pro Max (A2161, A2220)","iPhone SE (2nd generation) (A2275, A2296)","iPhone SE (3rd generation) (A2595, A2783)","iPhone 12 (A2172, A2402)","iPhone 12 mini (A2176, A2399)","iPhone 12 Pro (A2341, A2406)","iPhone 12 Pro Max (A2342, A2410)","iPhone 13 (A2482, A2631)","iPhone 13 mini (A2481, A2626)","iPhone 13 Pro (A2483, A2636)","iPhone 13 Pro Max (A2484, A2641)","iPhone 14 (A2649, A2881)","iPhone 14 Plus (A2632, A2885)","iPhone 14 Pro (A2650, A2890)","iPhone 14 Pro Max (A2651, A2894)","iPhone 15 (A3090, A2846)","iPhone 15 Plus (A3094, A2840)","iPhone 15 Pro (A3102, A2848)","iPhone 15 Pro Max (A3106, A2836)","iPhone 16 (TBD)","iPhone 16 Plus (TBD)","iPhone 16 Pro (TBD)","iPhone 16 Pro Max (TBD)","Samsung Galaxy S20","Samsung Galaxy S20+","Samsung Galaxy S20 Ultra","Samsung Galaxy S21","Samsung Galaxy S21+","Samsung Galaxy S21 Ultra","Samsung Galaxy S22","Samsung Galaxy S22+","Samsung Galaxy S22 Ultra","Samsung Galaxy S23","Samsung Galaxy S23+","Samsung Galaxy S23 Ultra","Samsung Galaxy S24","Samsung Galaxy S24+","Samsung Galaxy S24 Ultra","Samsung Galaxy S25 (TBD)","Samsung Galaxy S25+ (TBD)","Samsung Galaxy S25 Ultra (TBD)","Samsung Galaxy Note 20","Samsung Galaxy Note 20 Ultra","Samsung Galaxy Note 10","Samsung Galaxy Note 10+","Samsung Galaxy Note 10+ 5G","Samsung Galaxy Note 9","Samsung Galaxy Note 8","Samsung Galaxy Note 7 (Discontinued)","Samsung Galaxy Note 5","Samsung Galaxy Z Flip","Samsung Galaxy Z Flip 3","Samsung Galaxy Z Flip 4","Samsung Galaxy Z Flip 5","Samsung Galaxy Z Flip 6 (TBD)","Samsung Galaxy Z Fold","Samsung Galaxy Z Fold 2","Samsung Galaxy Z Fold 3","Samsung Galaxy Z Fold 4","Samsung Galaxy Z Fold 5","Samsung Galaxy Z Fold 6 (TBD)","Google Pixel (2016)","Google Pixel XL (2016)","Google Pixel 2","Google Pixel 2 XL","Google Pixel 3","Google Pixel 3 XL","Google Pixel 3a","Google Pixel 3a XL","Google Pixel 4","Google Pixel 4 XL","Google Pixel 4a","Google Pixel 4a (5G)","Google Pixel 5","Google Pixel 5a (5G)","Google Pixel 6","Google Pixel 6 Pro","Google Pixel 6a","Google Pixel 7","Google Pixel 7 Pro","Google Pixel 7a","Google Pixel 8","Google Pixel 8 Pro","Google Pixel 8a","Google Pixel 9 (TBD)","Google Pixel 9 Pro (TBD)","Google Pixel Fold","Google Pixel Fold 2 (TBD)","Surface Pro (1st Gen) (1514)","Surface Pro 2 (1601)","Surface Pro 3 (1631)","Surface Pro 4 (1724)","Surface Pro (2017, 5th Gen) (1796)","Surface Pro 6 (1807)","Surface Pro 7 (1866)","Surface Pro 7+ (1960)","Surface Pro 8 (1983)","Surface Pro 9 (Intel, 2022) (2038)","Surface Pro 9 (5G, ARM, 2022) (2027)","Surface Pro 10 (Intel, 2024) (TBD)","Surface Pro 10 (5G, ARM, 2024) (TBD)","Surface Laptop (1st Gen, 2017) (1769)","Surface Laptop 2 (2018) (1769)","Surface Laptop 3 (13.5-inch, 2019) (1867)","Surface Laptop 3 (15-inch, 2019) (1873)","Surface Laptop 4 (13.5-inch, 2021) (1950)","Surface Laptop 4 (15-inch, 2021) (1953)","Surface Laptop 5 (13.5-inch, 2022) (1962)","Surface Laptop 5 (15-inch, 2022) (1963)","Surface Laptop 6 (Intel, 2024) (TBD)","Surface Laptop Go (2020) (1943)","Surface Laptop Go 2 (2022) (2013)","Surface Laptop Go 3 (2023) (TBD)","Surface Laptop Studio (2021) (1964)","Surface Laptop Studio 2 (2023) (TBD)","Surface Book (1st Gen, 2015) (1703)","Surface Book with Performance Base (2016) (1705)","Surface Book 2 (13.5-inch, 2017) (1832)","Surface Book 2 (15-inch, 2017) (1793)","Surface Book 3 (13.5-inch, 2020) (1900)","Surface Book 3 (15-inch, 2020) (1901)","Surface Go (2018) (1824)","Surface Go 2 (2020) (1901)","Surface Go 3 (2021) (1926)","Surface Go 4 (2023) (TBD)","Surface Duo (2020) (1930)","Surface Duo 2 (2021) (1995)","HP Pavilion 14 (14-dv2074nr)","HP Pavilion 15 (15-eg2025nr)","HP Pavilion x360 14 (14-ek0013dx)","HP Pavilion x360 15 (15-er0105wm)","HP Pavilion Gaming 15 (15-ec2075wm)","HP Pavilion Aero 13 (13-be0047nr)","HP ENVY 13 (13-ba1010nr)","HP ENVY x360 13 (13-bf0013dx)","HP ENVY x360 15 (15-ed2005wm)","HP ENVY x360 16 (16-h1000ca)","HP Spectre x360 13.5 (14-ef2013dx)","HP Spectre x360 14 (14-ea0023dx)","HP Spectre x360 15 (15-eb1003ca)","HP Spectre Fold (16-aa0002na)","HP EliteBook 830 G8 (4B2M4UT#ABA)","HP EliteBook 840 G8 (3C9Q1UT#ABA)","HP EliteBook x360 1040 G7 (2Z3Y3UT#ABA)","HP EliteBook 865 G9 (5Y3M9UT#ABA)","HP ProBook 430 G8 (33L09EA)","HP ProBook 440 G9 (6A1L4EA)","HP ProBook 450 G9 (6A1P4EA)","HP ProBook 455 G9 (6A3G4EA)","HP ZBook Firefly 14 G9 (6B1K1EA)","HP ZBook Firefly 16 G9 (6B1K7EA)","HP ZBook Studio G9 (6B2M6EA)","HP ZBook Fury 15 G8 (4R8L6EA)","HP ZBook Power G9 (6B2L1EA)","HP OMEN 15 (15-en0013dx)","HP OMEN 16 (16-b0005dx)","HP OMEN 17 (17-ck1020nr)","HP OMEN Transcend 16 (16-u0004nr)","HP Victus 15 (15-fa0031dx)","HP Victus 16 (16-e1000ne)","MacBook Air (11-inch, Mid 2012)","MacBook Air (13-inch, Mid 2012)","MacBook Pro (13-inch, Mid 2012)","MacBook Pro (15-inch, Mid 2012)","MacBook Pro with Retina display (15-inch, Mid 2012)","MacBook Pro with Retina display (13-inch, Late 2012)","MacBook Air (11-inch, Mid 2013)","MacBook Air (13-inch, Mid 2013)","MacBook Pro (13-inch, Late 2013)","MacBook Pro (15-inch, Late 2013)","MacBook Air (11-inch, Early 2014)","MacBook Air (13-inch, Early 2014)","MacBook Pro (13-inch, Mid 2014)","MacBook Pro (15-inch, Mid 2014)","MacBook Air (11-inch, Early 2015)","MacBook Air (13-inch, Early 2015)","MacBook Pro (13-inch, Early 2015)","MacBook Pro (15-inch, Mid 2015)","MacBook (Retina, 12-inch, Early 2015)","MacBook (Retina, 12-inch, Early 2016)","MacBook (Retina, 12-inch, 2017)","MacBook Air (13-inch, 2017)","MacBook Pro (13-inch, 2016)","MacBook Pro (15-inch, 2016)","MacBook Pro (13-inch, 2017)","MacBook Pro (15-inch, 2017)","MacBook Pro (13-inch, 2018)","MacBook Pro (15-inch, 2018)","MacBook Pro (13-inch, 2019)","MacBook Pro (15-inch, 2019)","MacBook Pro (16-inch, 2019)","MacBook Air (Retina, 13-inch, 2018)","MacBook Air (Retina, 13-inch, 2019)","MacBook Air (Retina, 13-inch, 2020)","MacBook Pro (13-inch, 2020)","MacBook Pro (M1, 13-inch, 2020) (A2338)","MacBook Air (M1, 2020) (A2337)","MacBook Pro (14-inch, 2021) (A2442)","MacBook Pro (16-inch, 2021) (A2485)","MacBook Air (M2, 2022) (A2681)","MacBook Pro (M2, 13-inch, 2022) (A2338)","MacBook Pro (M2 Pro, 14-inch, 2023) (A2779)","MacBook Pro (M2 Max, 16-inch, 2023) (A2780)","MacBook Air (M2, 15-inch, 2023) (A2941)","MacBook Air (M3, 13-inch, 2024) (A3113)","MacBook Air (M3, 15-inch, 2024) (A3114)","MacBook Pro (M3 Pro, 14-inch, 2024) (A2992)","MacBook Pro (M3 Max, 16-inch, 2024) (A2991)","MacBook Pro (13-inch, Late 2012, Retina)","iPad (4th generation, 2012)","iPad (5th generation, 2017)","iPad (6th generation, 2018)","iPad (7th generation, 2019)","iPad (8th generation, 2020)","iPad (9th generation, 2021)","iPad (10th generation, 2022)","iPad Air (1st generation, 2013)","iPad Air 2 (2014)","iPad Air (3rd generation, 2019)","iPad Air (4th generation, 2020)","iPad Air (5th generation, 2022)","iPad Air (11-inch, M2, 2024)","iPad Air (13-inch, M2, 2024)","iPad mini 2 (2013)","iPad mini 3 (2014)","iPad mini 4 (2015)","iPad mini (5th generation, 2019)","iPad mini (6th generation, 2021)","iPad Pro (12.9-inch, 1st generation, 2015)","iPad Pro (9.7-inch, 2016)","iPad Pro (10.5-inch, 2017)","iPad Pro (12.9-inch, 2nd generation, 2017)","iPad Pro (11-inch, 1st generation, 2018)","iPad Pro (12.9-inch, 3rd generation, 2018)","iPad Pro (11-inch, 2nd generation, 2020)","iPad Pro (12.9-inch, 4th generation, 2020)","iPad Pro (11-inch, 3rd generation, 2021)","iPad Pro (12.9-inch, 5th generation, 2021)","iPad Pro (11-inch, 4th generation, 2022)","iPad Pro (12.9-inch, 6th generation, 2022)","iPad Pro (11-inch, M4, 2024)","iPad Pro (13-inch, M4, 2024)"],jo=(r,a)=>a.every(i=>r.split(/[^a-z0-9]+/).some(c=>c.startsWith(i))),Oc=({value:r,onChange:a,placeholder:i="Enter model or model number",required:c=!1,className:m="",modelLogos:u,brand:x})=>{const[j,b]=g.useState(!1),f=g.useRef(null),y=g.useRef(null);g.useEffect(()=>{function I(R){f.current&&!f.current.contains(R.target)&&y.current&&!y.current.contains(R.target)&&b(!1)}return j&&document.addEventListener("mousedown",I),()=>{document.removeEventListener("mousedown",I)}},[j]);let N=ih;if(x){const I=x.toLowerCase();N=N.filter(R=>I==="apple"?R.toLowerCase().startsWith("iphone")||R.toLowerCase().startsWith("ipad")||R.toLowerCase().startsWith("macbook"):I==="samsung"?R.toLowerCase().startsWith("samsung"):I==="google"?R.toLowerCase().startsWith("google"):I==="microsoft"?R.toLowerCase().startsWith("surface"):I==="hp"?R.toLowerCase().startsWith("hp"):R.toLowerCase().includes(I))}return N=N.filter(I=>{if(!r)return!0;const R=r.toLowerCase().split(/\s+/).filter(Boolean),k=I.toLowerCase();return R.every(E=>k.includes(E))}).sort((I,R)=>{if(!r)return 0;const k=r.toLowerCase().split(/\s+/).filter(Boolean),E=I.toLowerCase(),v=R.toLowerCase(),U=jo(E,k),F=jo(v,k);return U&&!F?-1:!U&&F?1:0}),e.jsxs("div",{className:`relative ${m}`,children:[e.jsx("input",{type:"text",value:r,onChange:I=>{a(I.target.value),b(!0)},onFocus:()=>b(!0),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg pl-12 bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",placeholder:i,required:c,autoComplete:"off",autoCorrect:"off",spellCheck:!1,ref:f}),e.jsx(hn,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:20}),j&&e.jsx("div",{ref:y,className:"absolute z-[9999] w-full mt-1 bg-white/95 backdrop-blur-md border border-gray-300 rounded-md shadow-xl max-h-60 overflow-y-auto",children:N.map((I,R)=>e.jsxs("button",{type:"button",className:"w-full px-4 py-2 text-left hover:bg-gray-100 focus:bg-gray-100 focus:outline-none flex items-center gap-2",onClick:()=>{a(I),b(!1)},children:[u&&u[I]?e.jsx("img",{src:u[I],alt:I,className:"w-6 h-6 object-contain"}):e.jsx(hn,{size:18,className:"text-blue-500 flex-shrink-0"}),e.jsx("span",{children:I})]},`${I}-${R}`))})]})},No={Apple:100,Samsung:95,Google:90,Microsoft:85,Lenovo:80,HP:75,Dell:70,Huawei:65,Xiaomi:60,OnePlus:55,Sony:50,LG:45,Motorola:40,Nokia:35,Tecno:30,Infinix:25,Itel:20,HTC:15,Asus:10,Acer:5,Canon:3,Epson:2,Brother:1},yl=r=>r.sort((a,i)=>{const c=No[a.name]||0;return(No[i.name]||0)-c}),Pc=async()=>{try{const{data:r,error:a}=await G.from("brands").select("id, name, logo_url, description, category, is_active, created_by, created_at, updated_at").order("name");if(a)throw a;return r||[]}catch(r){throw console.error("Error fetching brands:",r),r}},wl=async()=>{try{const{data:r,error:a}=await G.from("brands").select("id, name, logo_url, description, category, is_active, created_by, created_at, updated_at").eq("is_active",!0).order("name");if(a)throw a;return yl(r||[])}catch(r){throw console.error("Error fetching active brands:",r),r}},lh=async r=>{try{const{data:a,error:i}=await G.from("brands").select("id, name, logo_url, description, category, is_active, created_by, created_at, updated_at").contains("category",[r]).eq("is_active",!0).order("name");if(i)throw i;return a||[]}catch(a){throw console.error("Error fetching brands by category:",a),a}},Fc=async r=>{try{const a=r.categories&&r.categories.length>0?r.categories:r.category?[r.category]:["other"],i={name:r.name,logo_url:r.logo_url,description:r.description,category:a},{data:c,error:m}=await G.from("brands").insert([i]).select("id, name, logo_url, description, category, is_active, created_by, created_at, updated_at").single();if(m)throw m;return c}catch(a){throw console.error("Error creating brand:",a),a}},Bc=async(r,a)=>{try{const i=a.categories&&a.categories.length>0?a.categories:a.category?[a.category]:["other"],c={name:a.name,logo_url:a.logo_url,description:a.description,category:i},{data:m,error:u}=await G.from("brands").update(c).eq("id",r).select("id, name, logo_url, description, category, is_active, created_by, created_at, updated_at").single();if(u)throw u;return m}catch(i){throw console.error("Error updating brand:",i),i}},zc=async r=>{try{const{error:a}=await G.from("brands").update({is_active:!1}).eq("id",r);if(a)throw a}catch(a){throw console.error("Error deleting brand:",a),a}},Uc=async r=>{try{const{error:a}=await G.from("brands").update({is_active:!0}).eq("id",r);if(a)throw a}catch(a){throw console.error("Error restoring brand:",a),a}},$c=async r=>{try{const{data:a,error:i}=await G.from("brands").select("id, name, logo_url, description, category, is_active, created_by, created_at, updated_at").ilike("name",`%${r}%`).eq("is_active",!0).order("name");if(i)throw i;return yl(a||[])}catch(a){throw console.error("Error searching brands:",a),a}},oh=Object.freeze(Object.defineProperty({__proto__:null,createBrand:Fc,deleteBrand:zc,getActiveBrands:wl,getBrands:Pc,getBrandsByCategory:lh,restoreBrand:Uc,searchBrands:$c,sortBrandsByPopularity:yl,updateBrand:Bc},Symbol.toStringTag,{value:"Module"})),_i="/logos/placeholder.svg",qc=({value:r,onChange:a,brands:i,placeholder:c,required:m,className:u="",category:x})=>{const[j,b]=g.useState([]),[f,y]=g.useState(!1),[N,I]=g.useState(!1),R=g.useRef(null),k=g.useRef(null),E=async()=>{try{I(!0);let U=[];if(x){const{getBrandsByCategory:L}=await Bo(async()=>{const{getBrandsByCategory:C}=await Promise.resolve().then(()=>oh);return{getBrandsByCategory:C}},void 0);U=await L(x)}else U=await wl();const F=U.map(L=>({name:L.name,logo:L.logo_url||_i}));b(F)}catch(U){console.error("Error fetching brands:",U),b([{name:"Apple",logo:"/logos/apple.svg"},{name:"Samsung",logo:"/logos/samsung.svg"},{name:"Google",logo:"/logos/google.svg"},{name:"Microsoft",logo:"/logos/microsoft.svg"},{name:"Lenovo",logo:"/logos/lenovo.svg"},{name:"HP",logo:"/logos/hp.svg"},{name:"Dell",logo:"/logos/dell.svg"},{name:"Huawei",logo:"/logos/huawei.svg"},{name:"Xiaomi",logo:"/logos/xiaomi.svg"},{name:"OnePlus",logo:"/logos/oneplus.svg"},{name:"Sony",logo:"/logos/sony.svg"},{name:"LG",logo:"/logos/lg.svg"},{name:"Motorola",logo:"/logos/motorola.svg"},{name:"Nokia",logo:"/logos/nokia.svg"},{name:"Tecno",logo:"/logos/tecno.svg"},{name:"Infinix",logo:"/logos/infinix.svg"},{name:"Itel",logo:"/logos/itel.svg"},{name:"HTC",logo:"/logos/htc.svg"},{name:"Asus",logo:"/logos/asus.svg"},{name:"Acer",logo:"/logos/acer.svg"},{name:"Canon",logo:"/logos/canon.svg"},{name:"Epson",logo:"/logos/epson.svg"},{name:"Brother",logo:"/logos/brother.svg"}])}finally{I(!1)}};g.useEffect(()=>{i?b(i):E()},[i,x]),g.useEffect(()=>{function U(F){R.current&&!R.current.contains(F.target)&&k.current&&!k.current.contains(F.target)&&y(!1)}return f&&document.addEventListener("mousedown",U),()=>{document.removeEventListener("mousedown",U)}},[f]);const v=j.filter(U=>r?U.name.toLowerCase().includes(r.toLowerCase()):!0);return e.jsxs("div",{className:`relative ${u}`,children:[e.jsx("input",{type:"text",value:r,onChange:U=>{a(U.target.value),y(!0)},onFocus:()=>y(!0),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg pl-12 bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",placeholder:c,required:m,autoComplete:"off",autoCorrect:"off",spellCheck:!1,ref:R}),e.jsx(Id,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:20}),f&&e.jsx("div",{ref:k,className:"absolute z-[9999] w-full mt-2 bg-white/95 backdrop-blur-md border-2 border-gray-300 rounded-lg shadow-xl max-h-80 overflow-y-auto grid grid-cols-3 gap-3 p-4",children:N?e.jsx("div",{className:"col-span-3 flex items-center justify-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})}):v.length>0?v.map(U=>e.jsxs("button",{type:"button",className:"flex flex-col items-center gap-2 p-3 hover:bg-gray-100 rounded-lg transition-all duration-200 hover:scale-105",onClick:()=>{a(U.name),y(!1)},children:[e.jsx("img",{src:U.logo||_i,alt:U.name,className:"w-12 h-12 object-contain",loading:"lazy",onError:F=>{F.currentTarget.src=_i}}),e.jsx("span",{className:"text-sm font-medium",children:U.name})]},U.name)):e.jsx("div",{className:"col-span-3 text-center py-4 text-gray-500 text-sm",children:"No brands found"})})]})},vo=[{id:"screen_cracked",label:"Screen Cracked",icon:e.jsx(ns,{size:16,className:"text-red-500"}),category:"Physical"},{id:"no_power",label:"No Power",icon:e.jsx(ti,{size:16,className:"text-red-500"}),category:"Power"},{id:"charging_issue",label:"Charging Issue",icon:e.jsx(Rd,{size:16,className:"text-orange-500"}),category:"Power"},{id:"water_damage",label:"Water Damage",icon:e.jsx(Ld,{size:16,className:"text-blue-500"}),category:"Physical"},{id:"camera_issue",label:"Camera Issue",icon:e.jsx(vn,{size:16,className:"text-purple-500"}),category:"Hardware"},{id:"speaker_issue",label:"Speaker Issue",icon:e.jsx(si,{size:16,className:"text-yellow-500"}),category:"Audio"},{id:"wifi_issue",label:"WiFi Issue",icon:e.jsx(Uo,{size:16,className:"text-green-500"}),category:"Connectivity"},{id:"bluetooth_issue",label:"Bluetooth Issue",icon:e.jsx(Od,{size:16,className:"text-blue-500"}),category:"Connectivity"},{id:"touch_issue",label:"Touch Not Working",icon:e.jsx(ns,{size:16,className:"text-red-500"}),category:"Display"},{id:"microphone_issue",label:"Microphone Issue",icon:e.jsx(Wi,{size:16,className:"text-gray-500"}),category:"Audio"},{id:"button_issue",label:"Buttons Not Working",icon:e.jsx(Yi,{size:16,className:"text-gray-500"}),category:"Hardware"},{id:"performance_issue",label:"Performance Issue",icon:e.jsx(ri,{size:16,className:"text-orange-500"}),category:"Software"},{id:"storage_issue",label:"Storage Issue",icon:e.jsx(Xi,{size:16,className:"text-blue-500"}),category:"Hardware"},{id:"back_cover_damaged",label:"Back Cover Damaged",icon:e.jsx(Nn,{size:16,className:"text-red-500"}),category:"Physical"},{id:"frame_bent",label:"Frame Bent",icon:e.jsx(ns,{size:16,className:"text-red-500"}),category:"Physical"},{id:"other",label:"Other Issue",icon:e.jsx(Bs,{size:16,className:"text-gray-500"}),category:"Other"}],ch=({isOpen:r,onClose:a,selectedConditions:i,onConditionsChange:c,otherText:m,onOtherTextChange:u})=>{const[x,j]=g.useState(""),[b,f]=g.useState(!1),y=F=>{F==="other"?i.includes("other")?(c(i.filter(L=>L!=="other")),f(!1)):(c([...i,"other"]),f(!0)):i.includes(F)?c(i.filter(L=>L!==F)):c([...i,F])},N=()=>{i.length===0?c(["no_issues"]):(c([]),f(!1),u(""))},I=()=>{c([]),f(!1),u(""),j("")},R=()=>{a()},k=i.includes("no_issues"),E=i.includes("other"),v=vo.filter(F=>F.label.toLowerCase().includes(x.toLowerCase())||F.category.toLowerCase().includes(x.toLowerCase())),U=()=>i.filter(L=>L!=="no_issues").length+(E&&m.trim()?1:0);return e.jsx(es,{isOpen:r,onClose:a,title:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Ht,{size:24,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Device Issues"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Quick select all issues found"})]})]}),maxWidth:"800px",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-4",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:N,className:"w-5 h-5 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Md,{size:20,className:"text-green-600"}),e.jsx("span",{className:"font-semibold text-green-800",children:"No Issues Found"})]}),e.jsx("span",{className:"text-sm text-green-700 ml-2",children:"(Device is in perfect condition)"})]})}),!k&&e.jsxs("div",{className:"relative",children:[e.jsx(Cr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search issues...",value:x,onChange:F=>j(F.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),U()>0&&!k&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(yt,{size:16}),"Selected Issues (",U(),")"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.filter(F=>F!=="no_issues").map(F=>{const L=vo.find(C=>C.id===F);return e.jsxs("span",{className:"px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-semibold flex items-center gap-1 hover:bg-blue-200 transition-colors",children:[L==null?void 0:L.icon,(L==null?void 0:L.label)||F,e.jsx("button",{onClick:()=>y(F),className:"ml-1 hover:text-blue-600",title:"Remove this issue",children:e.jsx(tr,{size:12})})]},F)}),E&&m.trim()&&e.jsxs("span",{className:"px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-semibold flex items-center gap-1",children:[e.jsx(Bs,{size:12}),"Other: ",m.trim().substring(0,20),"..."]})]})]}),!k&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:v.map(F=>e.jsxs("button",{onClick:()=>y(F.id),className:`p-3 rounded-lg border-2 transition-all duration-200 flex items-center gap-2 text-left ${i.includes(F.id)?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 bg-white hover:border-gray-300 hover:shadow-sm"}`,children:[e.jsx("div",{className:"flex-shrink-0",children:F.icon}),e.jsx("span",{className:"text-sm font-medium text-gray-700 truncate",children:F.label}),i.includes(F.id)&&e.jsx(yt,{size:14,className:"text-blue-500 ml-auto flex-shrink-0"})]},F.id))}),x&&v.length===0&&!k&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Cr,{size:48,className:"text-gray-300 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:['No issues found matching "',x,'"']}),e.jsx("button",{onClick:()=>j(""),className:"mt-2 text-blue-600 hover:text-blue-700 underline",children:"Clear search"})]}),b&&!k&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(Bs,{size:16,className:"text-gray-500"}),"Describe Other Issue"]}),e.jsx("textarea",{value:m,onChange:F=>u(F.target.value),placeholder:"Describe the issue in detail...",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",rows:3})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:I,className:"px-3 py-2 text-sm bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors flex items-center gap-2",children:[e.jsx(Fs,{size:16}),"Clear All"]})}),e.jsx("div",{className:"text-sm text-gray-600",children:k?e.jsx("span",{className:"text-green-600 font-medium",children:"✓ No issues reported"}):`${U()} issue(s) selected`}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(X,{variant:"secondary",onClick:a,children:"Cancel"}),e.jsx(X,{variant:"primary",onClick:R,children:"Save Issues"})]})]})]})})};var dh=Object.defineProperty,Qn=Object.getOwnPropertySymbols,Vc=Object.prototype.hasOwnProperty,Gc=Object.prototype.propertyIsEnumerable,Co=(r,a,i)=>a in r?dh(r,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[a]=i,uh=(r,a)=>{for(var i in a||(a={}))Vc.call(a,i)&&Co(r,i,a[i]);if(Qn)for(var i of Qn(a))Gc.call(a,i)&&Co(r,i,a[i]);return r},mh=(r,a)=>{var i={};for(var c in r)Vc.call(r,c)&&a.indexOf(c)<0&&(i[c]=r[c]);if(r!=null&&Qn)for(var c of Qn(r))a.indexOf(c)<0&&Gc.call(r,c)&&(i[c]=r[c]);return i};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var _a;(r=>{const a=class{constructor(b,f,y,N){if(this.version=b,this.errorCorrectionLevel=f,this.modules=[],this.isFunction=[],b<a.MIN_VERSION||b>a.MAX_VERSION)throw new RangeError("Version value out of range");if(N<-1||N>7)throw new RangeError("Mask value out of range");this.size=b*4+17;let I=[];for(let k=0;k<this.size;k++)I.push(!1);for(let k=0;k<this.size;k++)this.modules.push(I.slice()),this.isFunction.push(I.slice());this.drawFunctionPatterns();const R=this.addEccAndInterleave(y);if(this.drawCodewords(R),N==-1){let k=1e9;for(let E=0;E<8;E++){this.applyMask(E),this.drawFormatBits(E);const v=this.getPenaltyScore();v<k&&(N=E,k=v),this.applyMask(E)}}u(0<=N&&N<=7),this.mask=N,this.applyMask(N),this.drawFormatBits(N),this.isFunction=[]}static encodeText(b,f){const y=r.QrSegment.makeSegments(b);return a.encodeSegments(y,f)}static encodeBinary(b,f){const y=r.QrSegment.makeBytes(b);return a.encodeSegments([y],f)}static encodeSegments(b,f,y=1,N=40,I=-1,R=!0){if(!(a.MIN_VERSION<=y&&y<=N&&N<=a.MAX_VERSION)||I<-1||I>7)throw new RangeError("Invalid value");let k,E;for(k=y;;k++){const L=a.getNumDataCodewords(k,f)*8,C=j.getTotalBits(b,k);if(C<=L){E=C;break}if(k>=N)throw new RangeError("Data too long")}for(const L of[a.Ecc.MEDIUM,a.Ecc.QUARTILE,a.Ecc.HIGH])R&&E<=a.getNumDataCodewords(k,L)*8&&(f=L);let v=[];for(const L of b){c(L.mode.modeBits,4,v),c(L.numChars,L.mode.numCharCountBits(k),v);for(const C of L.getData())v.push(C)}u(v.length==E);const U=a.getNumDataCodewords(k,f)*8;u(v.length<=U),c(0,Math.min(4,U-v.length),v),c(0,(8-v.length%8)%8,v),u(v.length%8==0);for(let L=236;v.length<U;L^=253)c(L,8,v);let F=[];for(;F.length*8<v.length;)F.push(0);return v.forEach((L,C)=>F[C>>>3]|=L<<7-(C&7)),new a(k,f,F,I)}getModule(b,f){return 0<=b&&b<this.size&&0<=f&&f<this.size&&this.modules[f][b]}getModules(){return this.modules}drawFunctionPatterns(){for(let y=0;y<this.size;y++)this.setFunctionModule(6,y,y%2==0),this.setFunctionModule(y,6,y%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const b=this.getAlignmentPatternPositions(),f=b.length;for(let y=0;y<f;y++)for(let N=0;N<f;N++)y==0&&N==0||y==0&&N==f-1||y==f-1&&N==0||this.drawAlignmentPattern(b[y],b[N]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(b){const f=this.errorCorrectionLevel.formatBits<<3|b;let y=f;for(let I=0;I<10;I++)y=y<<1^(y>>>9)*1335;const N=(f<<10|y)^21522;u(N>>>15==0);for(let I=0;I<=5;I++)this.setFunctionModule(8,I,m(N,I));this.setFunctionModule(8,7,m(N,6)),this.setFunctionModule(8,8,m(N,7)),this.setFunctionModule(7,8,m(N,8));for(let I=9;I<15;I++)this.setFunctionModule(14-I,8,m(N,I));for(let I=0;I<8;I++)this.setFunctionModule(this.size-1-I,8,m(N,I));for(let I=8;I<15;I++)this.setFunctionModule(8,this.size-15+I,m(N,I));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let b=this.version;for(let y=0;y<12;y++)b=b<<1^(b>>>11)*7973;const f=this.version<<12|b;u(f>>>18==0);for(let y=0;y<18;y++){const N=m(f,y),I=this.size-11+y%3,R=Math.floor(y/3);this.setFunctionModule(I,R,N),this.setFunctionModule(R,I,N)}}drawFinderPattern(b,f){for(let y=-4;y<=4;y++)for(let N=-4;N<=4;N++){const I=Math.max(Math.abs(N),Math.abs(y)),R=b+N,k=f+y;0<=R&&R<this.size&&0<=k&&k<this.size&&this.setFunctionModule(R,k,I!=2&&I!=4)}}drawAlignmentPattern(b,f){for(let y=-2;y<=2;y++)for(let N=-2;N<=2;N++)this.setFunctionModule(b+N,f+y,Math.max(Math.abs(N),Math.abs(y))!=1)}setFunctionModule(b,f,y){this.modules[f][b]=y,this.isFunction[f][b]=!0}addEccAndInterleave(b){const f=this.version,y=this.errorCorrectionLevel;if(b.length!=a.getNumDataCodewords(f,y))throw new RangeError("Invalid argument");const N=a.NUM_ERROR_CORRECTION_BLOCKS[y.ordinal][f],I=a.ECC_CODEWORDS_PER_BLOCK[y.ordinal][f],R=Math.floor(a.getNumRawDataModules(f)/8),k=N-R%N,E=Math.floor(R/N);let v=[];const U=a.reedSolomonComputeDivisor(I);for(let L=0,C=0;L<N;L++){let $=b.slice(C,C+E-I+(L<k?0:1));C+=$.length;const Y=a.reedSolomonComputeRemainder($,U);L<k&&$.push(0),v.push($.concat(Y))}let F=[];for(let L=0;L<v[0].length;L++)v.forEach((C,$)=>{(L!=E-I||$>=k)&&F.push(C[L])});return u(F.length==R),F}drawCodewords(b){if(b.length!=Math.floor(a.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let f=0;for(let y=this.size-1;y>=1;y-=2){y==6&&(y=5);for(let N=0;N<this.size;N++)for(let I=0;I<2;I++){const R=y-I,E=(y+1&2)==0?this.size-1-N:N;!this.isFunction[E][R]&&f<b.length*8&&(this.modules[E][R]=m(b[f>>>3],7-(f&7)),f++)}}u(f==b.length*8)}applyMask(b){if(b<0||b>7)throw new RangeError("Mask value out of range");for(let f=0;f<this.size;f++)for(let y=0;y<this.size;y++){let N;switch(b){case 0:N=(y+f)%2==0;break;case 1:N=f%2==0;break;case 2:N=y%3==0;break;case 3:N=(y+f)%3==0;break;case 4:N=(Math.floor(y/3)+Math.floor(f/2))%2==0;break;case 5:N=y*f%2+y*f%3==0;break;case 6:N=(y*f%2+y*f%3)%2==0;break;case 7:N=((y+f)%2+y*f%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[f][y]&&N&&(this.modules[f][y]=!this.modules[f][y])}}getPenaltyScore(){let b=0;for(let I=0;I<this.size;I++){let R=!1,k=0,E=[0,0,0,0,0,0,0];for(let v=0;v<this.size;v++)this.modules[I][v]==R?(k++,k==5?b+=a.PENALTY_N1:k>5&&b++):(this.finderPenaltyAddHistory(k,E),R||(b+=this.finderPenaltyCountPatterns(E)*a.PENALTY_N3),R=this.modules[I][v],k=1);b+=this.finderPenaltyTerminateAndCount(R,k,E)*a.PENALTY_N3}for(let I=0;I<this.size;I++){let R=!1,k=0,E=[0,0,0,0,0,0,0];for(let v=0;v<this.size;v++)this.modules[v][I]==R?(k++,k==5?b+=a.PENALTY_N1:k>5&&b++):(this.finderPenaltyAddHistory(k,E),R||(b+=this.finderPenaltyCountPatterns(E)*a.PENALTY_N3),R=this.modules[v][I],k=1);b+=this.finderPenaltyTerminateAndCount(R,k,E)*a.PENALTY_N3}for(let I=0;I<this.size-1;I++)for(let R=0;R<this.size-1;R++){const k=this.modules[I][R];k==this.modules[I][R+1]&&k==this.modules[I+1][R]&&k==this.modules[I+1][R+1]&&(b+=a.PENALTY_N2)}let f=0;for(const I of this.modules)f=I.reduce((R,k)=>R+(k?1:0),f);const y=this.size*this.size,N=Math.ceil(Math.abs(f*20-y*10)/y)-1;return u(0<=N&&N<=9),b+=N*a.PENALTY_N4,u(0<=b&&b<=2568888),b}getAlignmentPatternPositions(){if(this.version==1)return[];{const b=Math.floor(this.version/7)+2,f=this.version==32?26:Math.ceil((this.version*4+4)/(b*2-2))*2;let y=[6];for(let N=this.size-7;y.length<b;N-=f)y.splice(1,0,N);return y}}static getNumRawDataModules(b){if(b<a.MIN_VERSION||b>a.MAX_VERSION)throw new RangeError("Version number out of range");let f=(16*b+128)*b+64;if(b>=2){const y=Math.floor(b/7)+2;f-=(25*y-10)*y-55,b>=7&&(f-=36)}return u(208<=f&&f<=29648),f}static getNumDataCodewords(b,f){return Math.floor(a.getNumRawDataModules(b)/8)-a.ECC_CODEWORDS_PER_BLOCK[f.ordinal][b]*a.NUM_ERROR_CORRECTION_BLOCKS[f.ordinal][b]}static reedSolomonComputeDivisor(b){if(b<1||b>255)throw new RangeError("Degree out of range");let f=[];for(let N=0;N<b-1;N++)f.push(0);f.push(1);let y=1;for(let N=0;N<b;N++){for(let I=0;I<f.length;I++)f[I]=a.reedSolomonMultiply(f[I],y),I+1<f.length&&(f[I]^=f[I+1]);y=a.reedSolomonMultiply(y,2)}return f}static reedSolomonComputeRemainder(b,f){let y=f.map(N=>0);for(const N of b){const I=N^y.shift();y.push(0),f.forEach((R,k)=>y[k]^=a.reedSolomonMultiply(R,I))}return y}static reedSolomonMultiply(b,f){if(b>>>8||f>>>8)throw new RangeError("Byte out of range");let y=0;for(let N=7;N>=0;N--)y=y<<1^(y>>>7)*285,y^=(f>>>N&1)*b;return u(y>>>8==0),y}finderPenaltyCountPatterns(b){const f=b[1];u(f<=this.size*3);const y=f>0&&b[2]==f&&b[3]==f*3&&b[4]==f&&b[5]==f;return(y&&b[0]>=f*4&&b[6]>=f?1:0)+(y&&b[6]>=f*4&&b[0]>=f?1:0)}finderPenaltyTerminateAndCount(b,f,y){return b&&(this.finderPenaltyAddHistory(f,y),f=0),f+=this.size,this.finderPenaltyAddHistory(f,y),this.finderPenaltyCountPatterns(y)}finderPenaltyAddHistory(b,f){f[0]==0&&(b+=this.size),f.pop(),f.unshift(b)}};let i=a;i.MIN_VERSION=1,i.MAX_VERSION=40,i.PENALTY_N1=3,i.PENALTY_N2=3,i.PENALTY_N3=40,i.PENALTY_N4=10,i.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],i.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],r.QrCode=i;function c(b,f,y){if(f<0||f>31||b>>>f)throw new RangeError("Value out of range");for(let N=f-1;N>=0;N--)y.push(b>>>N&1)}function m(b,f){return(b>>>f&1)!=0}function u(b){if(!b)throw new Error("Assertion error")}const x=class{constructor(b,f,y){if(this.mode=b,this.numChars=f,this.bitData=y,f<0)throw new RangeError("Invalid argument");this.bitData=y.slice()}static makeBytes(b){let f=[];for(const y of b)c(y,8,f);return new x(x.Mode.BYTE,b.length,f)}static makeNumeric(b){if(!x.isNumeric(b))throw new RangeError("String contains non-numeric characters");let f=[];for(let y=0;y<b.length;){const N=Math.min(b.length-y,3);c(parseInt(b.substr(y,N),10),N*3+1,f),y+=N}return new x(x.Mode.NUMERIC,b.length,f)}static makeAlphanumeric(b){if(!x.isAlphanumeric(b))throw new RangeError("String contains unencodable characters in alphanumeric mode");let f=[],y;for(y=0;y+2<=b.length;y+=2){let N=x.ALPHANUMERIC_CHARSET.indexOf(b.charAt(y))*45;N+=x.ALPHANUMERIC_CHARSET.indexOf(b.charAt(y+1)),c(N,11,f)}return y<b.length&&c(x.ALPHANUMERIC_CHARSET.indexOf(b.charAt(y)),6,f),new x(x.Mode.ALPHANUMERIC,b.length,f)}static makeSegments(b){return b==""?[]:x.isNumeric(b)?[x.makeNumeric(b)]:x.isAlphanumeric(b)?[x.makeAlphanumeric(b)]:[x.makeBytes(x.toUtf8ByteArray(b))]}static makeEci(b){let f=[];if(b<0)throw new RangeError("ECI assignment value out of range");if(b<128)c(b,8,f);else if(b<16384)c(2,2,f),c(b,14,f);else if(b<1e6)c(6,3,f),c(b,21,f);else throw new RangeError("ECI assignment value out of range");return new x(x.Mode.ECI,0,f)}static isNumeric(b){return x.NUMERIC_REGEX.test(b)}static isAlphanumeric(b){return x.ALPHANUMERIC_REGEX.test(b)}getData(){return this.bitData.slice()}static getTotalBits(b,f){let y=0;for(const N of b){const I=N.mode.numCharCountBits(f);if(N.numChars>=1<<I)return 1/0;y+=4+I+N.bitData.length}return y}static toUtf8ByteArray(b){b=encodeURI(b);let f=[];for(let y=0;y<b.length;y++)b.charAt(y)!="%"?f.push(b.charCodeAt(y)):(f.push(parseInt(b.substr(y+1,2),16)),y+=2);return f}};let j=x;j.NUMERIC_REGEX=/^[0-9]*$/,j.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,j.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",r.QrSegment=j})(_a||(_a={}));(r=>{(a=>{const i=class{constructor(m,u){this.ordinal=m,this.formatBits=u}};let c=i;c.LOW=new i(0,1),c.MEDIUM=new i(1,0),c.QUARTILE=new i(2,3),c.HIGH=new i(3,2),a.Ecc=c})(r.QrCode||(r.QrCode={}))})(_a||(_a={}));(r=>{(a=>{const i=class{constructor(m,u){this.modeBits=m,this.numBitsCharCount=u}numCharCountBits(m){return this.numBitsCharCount[Math.floor((m+7)/17)]}};let c=i;c.NUMERIC=new i(1,[10,12,14]),c.ALPHANUMERIC=new i(2,[9,11,13]),c.BYTE=new i(4,[8,16,16]),c.KANJI=new i(8,[8,10,12]),c.ECI=new i(7,[0,0,0]),a.Mode=c})(r.QrSegment||(r.QrSegment={}))})(_a||(_a={}));var on=_a;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var hh={L:on.QrCode.Ecc.LOW,M:on.QrCode.Ecc.MEDIUM,Q:on.QrCode.Ecc.QUARTILE,H:on.QrCode.Ecc.HIGH},xh=128,gh="L",fh="#FFFFFF",ph="#000000",bh=!1,Hc=4,yh=.1;function wh(r,a=0){const i=[];return r.forEach(function(c,m){let u=null;c.forEach(function(x,j){if(!x&&u!==null){i.push(`M${u+a} ${m+a}h${j-u}v1H${u+a}z`),u=null;return}if(j===c.length-1){if(!x)return;u===null?i.push(`M${j+a},${m+a} h1v1H${j+a}z`):i.push(`M${u+a},${m+a} h${j+1-u}v1H${u+a}z`);return}x&&u===null&&(u=j)})}),i.join("")}function jh(r,a){return r.slice().map((i,c)=>c<a.y||c>=a.y+a.h?i:i.map((m,u)=>u<a.x||u>=a.x+a.w?m:!1))}function Nh(r,a,i,c){if(c==null)return null;const m=i?Hc:0,u=r.length+m*2,x=Math.floor(a*yh),j=u/a,b=(c.width||x)*j,f=(c.height||x)*j,y=c.x==null?r.length/2-b/2:c.x*j,N=c.y==null?r.length/2-f/2:c.y*j;let I=null;if(c.excavate){let R=Math.floor(y),k=Math.floor(N),E=Math.ceil(b+y-R),v=Math.ceil(f+N-k);I={x:R,y:k,w:E,h:v}}return{x:y,y:N,h:f,w:b,excavation:I}}(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})();function vh(r){const a=r,{value:i,size:c=xh,level:m=gh,bgColor:u=fh,fgColor:x=ph,includeMargin:j=bh,imageSettings:b}=a,f=mh(a,["value","size","level","bgColor","fgColor","includeMargin","imageSettings"]);let y=on.QrCode.encodeText(i,hh[m]).getModules();const N=j?Hc:0,I=y.length+N*2,R=Nh(y,c,j,b);let k=null;b!=null&&R!=null&&(R.excavation!=null&&(y=jh(y,R.excavation)),k=Dr.createElement("image",{xlinkHref:b.src,height:R.h,width:R.w,x:R.x+N,y:R.y+N,preserveAspectRatio:"none"}));const E=wh(y,N);return Dr.createElement("svg",uh({height:c,width:c,viewBox:`0 0 ${I} ${I}`},f),Dr.createElement("path",{fill:u,d:`M0,0 h${I}v${I}H0z`,shapeRendering:"crispEdges"}),Dr.createElement("path",{fill:x,d:E,shapeRendering:"crispEdges"}),k)}const Ch=({isOpen:r,onClose:a,device:i})=>{const c=g.useRef(null),m=()=>{var x;if(c.current){const j=window.open("","_blank");j&&(j.document.write(`
          <!DOCTYPE html>
          <html>
            <head>
              <title>Device QR Code - ${i.brand} ${i.model}</title>
              <style>
                body {
                  font-family: Arial, sans-serif;
                  margin: 0;
                  padding: 20px;
                  background: white;
                }
                .print-container {
                  max-width: 400px;
                  margin: 0 auto;
                  border: 2px solid #333;
                  border-radius: 8px;
                  padding: 20px;
                  background: white;
                }
                .header {
                  text-align: center;
                  border-bottom: 2px solid #333;
                  padding-bottom: 15px;
                  margin-bottom: 20px;
                }
                .company-name {
                  font-size: 24px;
                  font-weight: bold;
                  color: #2563eb;
                  margin-bottom: 5px;
                }
                .tagline {
                  font-size: 14px;
                  color: #666;
                }
                .qr-section {
                  text-align: center;
                  margin: 20px 0;
                }
                .qr-code {
                  border: 1px solid #ddd;
                  padding: 10px;
                  display: inline-block;
                  background: white;
                }
                .device-info {
                  margin: 20px 0;
                }
                .info-row {
                  display: flex;
                  justify-content: space-between;
                  margin: 8px 0;
                  font-size: 14px;
                }
                .label {
                  font-weight: bold;
                  color: #333;
                }
                .value {
                  color: #666;
                }
                .conditions-section {
                  margin: 20px 0;
                  border-top: 1px solid #ddd;
                  padding-top: 15px;
                }
                .conditions-title {
                  font-weight: bold;
                  margin-bottom: 10px;
                  color: #333;
                }
                .condition-item {
                  background: #f3f4f6;
                  padding: 4px 8px;
                  margin: 2px;
                  border-radius: 4px;
                  font-size: 12px;
                  display: inline-block;
                }
                .footer {
                  text-align: center;
                  margin-top: 20px;
                  padding-top: 15px;
                  border-top: 1px solid #ddd;
                  font-size: 12px;
                  color: #666;
                }
                .status-badge {
                  display: inline-block;
                  padding: 4px 12px;
                  border-radius: 20px;
                  font-size: 12px;
                  font-weight: bold;
                  text-transform: uppercase;
                }
                .status-assigned {
                  background: #dbeafe;
                  color: #1d4ed8;
                }
                .status-diagnosis {
                  background: #fef3c7;
                  color: #d97706;
                }
                .status-repair {
                  background: #fce7f3;
                  color: #be185d;
                }
                .status-complete {
                  background: #d1fae5;
                  color: #059669;
                }
                @media print {
                  body { margin: 0; }
                  .print-container { border: none; }
                }
              </style>
            </head>
            <body>
              <div class="print-container">
                <div class="header">
                  <div class="company-name">CLEAN REPAIRS</div>
                  <div class="tagline">Professional Device Repair Services</div>
                </div>
                
                <div class="qr-section">
                  <div class="qr-code">
                    ${((x=document.querySelector(".qr-code svg"))==null?void 0:x.outerHTML)||""}
                  </div>
                  <div style="margin-top: 10px; font-size: 12px; color: #666;">
                    Scan to track device status
                  </div>
                </div>
                
                <div class="device-info">
                  <div class="info-row">
                    <span class="label">Device ID:</span>
                    <span class="value">${i.id}</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Brand/Model:</span>
                    <span class="value">${i.brand} ${i.model}</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Serial/IMEI:</span>
                    <span class="value">${i.serialNumber}</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Customer:</span>
                    <span class="value">${i.customerName}</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Phone:</span>
                    <span class="value">${i.phoneNumber}</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Expected Return:</span>
                    <span class="value">${new Date(i.expectedReturnDate).toLocaleDateString()}</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Status:</span>
                    <span class="value">
                      <span class="status-badge status-${i.status}">${i.status}</span>
                    </span>
                  </div>
                </div>
                
                ${i.conditions.length>0?`
                <div class="conditions-section">
                  <div class="conditions-title">Reported Issues:</div>
                  ${i.conditions.map(b=>`
                    <span class="condition-item">${b}</span>
                  `).join("")}
                  ${i.otherText?`<span class="condition-item">${i.otherText}</span>`:""}
                </div>
                `:""}
                
                <div class="footer">
                  <div>Thank you for choosing Clean Repairs</div>
                  <div>Contact: +255 XXX XXX XXX</div>
                  <div>Email: info@cleanrepairs.com</div>
                </div>
              </div>
            </body>
          </html>
        `),j.document.close(),j.focus(),j.print(),j.close())}},u=x=>{switch(x){case"assigned":return"text-blue-600 bg-blue-100";case"diagnosis-started":return"text-yellow-600 bg-yellow-100";case"in-repair":return"text-purple-600 bg-purple-100";case"repair-complete":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}};return e.jsx(es,{isOpen:r,onClose:a,title:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ns,{size:24,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Print Device QR Code"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Print QR code with device information"})]})]}),maxWidth:"500px",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block p-4 bg-white border border-gray-200 rounded-lg",children:e.jsx(vh,{value:`${window.location.origin}/devices/${i.id}`,size:200,level:"M",className:"qr-code"})}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Scan to track device status"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Device ID:"}),e.jsx("span",{className:"text-gray-900 font-mono",children:i.id})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Brand/Model:"}),e.jsxs("span",{className:"text-gray-900",children:[i.brand," ",i.model]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Customer:"}),e.jsx("span",{className:"text-gray-900",children:i.customerName})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Status:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${u(i.status)}`,children:i.status})]})]}),i.conditions.length>0&&e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(Ht,{size:16,className:"text-yellow-600"}),"Reported Issues"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.conditions.map((x,j)=>e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:x},j)),i.otherText&&e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:i.otherText})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(X,{variant:"secondary",onClick:a,children:"Cancel"}),e.jsx(X,{variant:"primary",onClick:m,children:"Print QR Code"})]})]})})},Pa={brand:"",model:"",serialNumber:"",issueDescription:"",repairCost:"",depositAmount:"",diagnosisRequired:!1,expectedReturnDate:new Date().toISOString().split("T")[0],unlockCode:"",deviceNotes:"",deviceCost:"",assignedTo:""},Sh=()=>{var gr;const[r,a]=g.useState(Pa),[i,c]=g.useState(!1),[m,u]=g.useState([]),[x,j]=g.useState(!1),[b,f]=g.useState(!1),y=hs(),[N,I]=g.useState(null),[R,k]=g.useState(!1),{customers:E}=Ur(),[v,U]=g.useState(""),[F,L]=g.useState(!1),[C,$]=g.useState([]),Y=g.useRef(null),[A,Z]=g.useState([]),[_,D]=g.useState(!1),[T,z]=g.useState(!1),[se,q]=g.useState(!0),[H,J]=g.useState(""),[V,ge]=g.useState(!1),[He,B]=g.useState(!1),[fe,re]=g.useState(!1),[ye,Q]=g.useState(!1),[Le,Ue]=g.useState(null),[Ct,Re]=g.useState(!1),[ut,Ee]=g.useState({screenCracked:!1,backCoverDamaged:!1,waterDamage:!1,noPower:!1,buttonsNotWorking:!1,other:!1,otherText:""}),[Oe,Xe]=g.useState(!1),[Be,Ce]=g.useState(""),[Ze,$e]=g.useState(!1),[K,be]=g.useState({name:"",phone:"",email:"",city:"",gender:"",loyaltyLevel:"bronze",colorTag:"normal"}),[ue,Ye]=g.useState(!1),[ae,ke]=g.useState(!1),[Ke,le]=g.useState(null),[Ne,Te]=g.useState(!1),[Qe,vt]=g.useState({}),{addDevice:Rt}=na(),{currentUser:ht}=Wt(),[Se,ve]=g.useState([]),[de,me]=g.useState(!1),Ae=g.useRef(null),it=g.useRef(null),[St,kt]=g.useState(!1),et=g.useRef(null);g.useEffect(()=>{ht&&ht.role==="technician"&&y("/dashboard")},[ht,y]);const[xs,Nt]=g.useState("same_day"),ss=[{label:"Same Day",value:"same_day",days:0},{label:"2 Days",value:"2_days",days:2},{label:"3 Days",value:"3_days",days:3},{label:"1 Week",value:"1_week",days:7},{label:"Custom",value:"custom",days:null}],[gt,Is]=g.useState(!1);g.useEffect(()=>{function Ie(ze){const ft=document.querySelector('[data-dropdown="completion"]');ft&&!ft.contains(ze.target)&&Is(!1)}return gt&&document.addEventListener("mousedown",Ie),()=>{document.removeEventListener("mousedown",Ie)}},[gt]);const ts={same_day:e.jsx(ms,{size:20,className:"text-blue-500"}),"2_days":e.jsx(ws,{size:20,className:"text-green-500"}),"3_days":e.jsx(ws,{size:20,className:"text-yellow-500"}),"1_week":e.jsx(ws,{size:20,className:"text-purple-500"}),custom:e.jsx(ws,{size:20,className:"text-gray-400"})},bs=Ie=>{if(Nt(Ie),Is(!1),Ie!=="custom"){const ze=ss.find(ft=>ft.value===Ie);if(ze&&ze.days!==null){const ft=new Date,oe=ze.value==="same_day"?new Date(ft.getFullYear(),ft.getMonth(),ft.getDate()+1):new Date(ft.getFullYear(),ft.getMonth(),ft.getDate()+(ze.days||0));a(De=>({...De,expectedReturnDate:oe.toISOString().split("T")[0]}))}}};g.useEffect(()=>{(async()=>{const{data:ze,error:ft}=await G.from("auth_users").select("id, name, email").eq("role","technician");!ft&&ze&&ve(ze)})()},[]),g.useEffect(()=>{if(!v.trim()){$([]);return}const Ie=setTimeout(()=>{const ze=E.filter(ft=>ft.name.toLowerCase().includes(v.toLowerCase())||ft.phone&&ft.phone.includes(v));$(ze)},200);return()=>clearTimeout(Ie)},[v,E]),g.useEffect(()=>{const Ie=ze=>{Y.current&&!Y.current.contains(ze.target)&&L(!1)};return document.addEventListener("mousedown",Ie),()=>document.removeEventListener("mousedown",Ie)},[]),g.useEffect(()=>{function Ie(ze){Ae.current&&!Ae.current.contains(ze.target)&&it.current&&!it.current.contains(ze.target)&&j(!1)}return x&&document.addEventListener("mousedown",Ie),()=>{document.removeEventListener("mousedown",Ie)}},[x]);const Qt=Ie=>{const{name:ze,value:ft,type:oe}=Ie.target;let De=oe==="checkbox"&&"checked"in Ie.target?Ie.target.checked:ft;if(ze==="repairCost"||ze==="depositAmount"){const Fe=ft.replace(/,/g,"");if(Fe===""||/^\d+(\.\d{0,2})?$/.test(Fe))De=Fe;else return}a(Fe=>({...Fe,[ze]:De}))},$t=(Ie=>Ie.trim().split(/\s+/).filter(Boolean).length)(r.issueDescription)>=5,[gs,Jt]=g.useState(!1),Es=async()=>{if(!K.name.trim()||!K.phone.trim()){te.error("Name and phone number are required");return}Ye(!0);try{const{data:Ie,error:ze}=await G.from("customers").insert([{name:K.name.trim(),phone:K.phone.trim(),email:K.email.trim()||null,city:K.city.trim()||null,gender:K.gender||null,loyaltyLevel:K.loyaltyLevel,colorTag:K.colorTag,points:0,totalSpent:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]).select().single();if(ze)throw ze;Ie&&(te.success("Customer created successfully!"),I(Ie),$e(!1),be({name:"",phone:"",email:"",city:"",gender:"",loyaltyLevel:"bronze",colorTag:"normal"}),a(Pa),lt([]),wt(""))}catch(Ie){te.error(`Error creating customer: ${Ie.message}`)}finally{Ye(!1)}},as=Ie=>{const ze=Ie.replace(/\D/g,"");if(!Ie.trim())return{isValid:!1,error:"IMEI or Serial Number is required"};const ft=Ie.replace(/\s/g,"").length,oe=ze.length,De=ft-oe;if(De>oe&&ft>=8)return{isValid:!0};if(ft>=8&&oe>=2&&De>=2)return{isValid:!0};if(oe<12&&De===0)return{isValid:!1,error:"IMEI or Serial Number must be at least 12 digits"};if(oe>20)return{isValid:!1,error:"IMEI or Serial Number is too long"};const Fe=Ie.toLowerCase(),Bt=["iphone","galaxy","pixel","oneplus","huawei","xiaomi","samsung","apple","note","plus","pro","max","ultra","mini","lite","neo","fe","a series","s series","m series","c series","g series","x series"];for(const _e of Bt)if(Fe.includes(_e))return{isValid:!1,error:"Please enter the actual IMEI or Serial Number, not the model name"};const vs=[/\b(iphone|galaxy|pixel|oneplus|huawei|xiaomi)\s+\d+/i,/\b(s|a|m|c|g|x)\s*\d+/i,/\b(pro|max|ultra|mini|lite|neo|fe)\b/i];for(const _e of vs)if(_e.test(Ie))return{isValid:!1,error:"Please enter the actual IMEI or Serial Number, not the model name"};return Ie.split(" ").length>2?{isValid:!1,error:"Please enter the actual IMEI or Serial Number, not a description"}:oe>=12&&oe/ft>=.8?{isValid:!0}:ft<8?{isValid:!1,error:"IMEI or Serial Number is too short"}:ft>=8&&oe>0&&De>0?{isValid:!0}:["n/a","na","unknown","not available","none","n/a","tbd","pending"].includes(Fe)?{isValid:!1,error:"Please enter the actual IMEI or Serial Number from the device"}:/(\d)\1{5,}/.test(ze)?{isValid:!1,error:"IMEI or Serial Number appears to be invalid (repeated digits)"}:{isValid:!0}},Us=()=>{let Ie={},ze=!0;return r.brand.trim()||(Ie.brand=!0,ze=!1),r.model.trim()||(Ie.model=!0,ze=!1),as(H).isValid||(Ie.imeiOrSerial=!0,ze=!1),(!r.issueDescription.trim()||!$t)&&(Ie.issueDescription=!0,ze=!1),r.assignedTo||(Ie.assignedTo=!0,ze=!1),Object.values(ut).some(De=>De)||pt.length>0||!!rt.trim()||(Ie.conditionAssessment=!0,ze=!1),vt(Ie),ze},[ys,xe]=g.useState(!1),[pt,lt]=g.useState([]),[rt,wt]=g.useState(""),[Ot,Gt]=g.useState(!1),[we,Ge]=g.useState(null),[tt,dt]=g.useState("form"),jt="custom_model_logos";function bt(){const Ie=localStorage.getItem(jt);return Ie?JSON.parse(Ie):{}}const[Xt,ds]=g.useState(bt());g.useEffect(()=>{const Ie=()=>ds(bt());return window.addEventListener("storage",Ie),()=>window.removeEventListener("storage",Ie)},[]);const fs=N?`device_intake_form_draft_${N.id}`:"device_intake_form_draft_no_customer",{clearDraft:We}=Mc({key:fs,formData:r,setFormData:a,clearOnSubmit:!0,submitted:de&&!i});g.useEffect(()=>{N?(lt([]),wt("")):(a(Pa),lt([]),wt(""),We())},[N==null?void 0:N.id]);const[M,ce]=g.useState(!1),[Je,_t]=g.useState(null);g.useEffect(()=>{if(Object.values(r).some(Ie=>Ie!=="")){ce(!0);const Ie=setTimeout(()=>{ce(!1),_t(new Date)},2e3);return()=>clearTimeout(Ie)}},[r]);const at=(()=>{const Ie=[N?1:0,r.brand?1:0,r.model?1:0,H?1:0,r.assignedTo?1:0,r.issueDescription?1:0,pt.length>0||rt.trim()?1:0];return Math.round(Ie.reduce((ze,ft)=>ze+ft,0)/Ie.length*100)})(),[Et,sr]=g.useState(!1);return e.jsx("div",{className:"p-4 sm:p-6 h-full overflow-y-auto pt-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"bg-white/50 backdrop-blur-md rounded-xl p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Device Intake Form"}),e.jsx("div",{className:"text-sm text-gray-600",children:N?"Customer Selected":"Customer Required"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:`flex items-center space-x-2 ${N?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${N?"bg-green-500 text-white":"bg-gray-200 text-gray-500"}`,children:N?e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx(Ws,{size:16})}),e.jsx("span",{className:"text-sm font-medium",children:"Customer"})]}),e.jsx("div",{className:"flex-1 h-1 bg-gray-200 rounded",children:e.jsx("div",{className:`h-1 rounded transition-all duration-300 ${N?"bg-green-500":"bg-gray-200"}`,style:{width:N?"100%":"0%"}})}),e.jsxs("div",{className:`flex items-center space-x-2 ${r.brand&&r.model&&H?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${r.brand&&r.model&&H?"bg-green-500 text-white":"bg-gray-200 text-gray-500"}`,children:r.brand&&r.model&&H?e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx(ns,{size:16})}),e.jsx("span",{className:"text-sm font-medium",children:"Device"})]}),e.jsx("div",{className:"flex-1 h-1 bg-gray-200 rounded",children:e.jsx("div",{className:`h-1 rounded transition-all duration-300 ${r.brand&&r.model&&H?"bg-green-500":"bg-gray-200"}`,style:{width:r.brand&&r.model&&H?"100%":"0%"}})}),e.jsxs("div",{className:`flex items-center space-x-2 ${r.assignedTo?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${r.assignedTo?"bg-green-500 text-white":"bg-gray-200 text-gray-500"}`,children:r.assignedTo?e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx(Ss,{size:16})}),e.jsx("span",{className:"text-sm font-medium",children:"Technician"})]})]}),e.jsx("div",{className:"mt-3 text-xs text-gray-500",children:N&&r.brand&&r.model&&H&&r.assignedTo?e.jsx("span",{className:"text-green-600 font-medium",children:"✓ Ready to submit"}):e.jsx("span",{children:"Complete all sections to submit"})}),M&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-blue-600",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Saving draft..."})]}),Je&&!M&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("svg",{width:"12",height:"12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsxs("span",{children:["Last saved: ",Je.toLocaleTimeString()]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-1",children:[e.jsx("span",{children:"Form completion"}),e.jsxs("span",{children:[at,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1",children:e.jsx("div",{className:"bg-blue-500 h-1 rounded-full transition-all duration-300",style:{width:`${at}%`}})})]})]}),at>=80&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-blue-900",children:"Quick Actions"}),e.jsxs("span",{className:"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded-full",children:[at,"% Complete"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>xe(!0),className:"flex items-center gap-2 p-3 bg-white rounded-lg border border-blue-200 hover:bg-blue-50 transition-colors",children:[e.jsx(Ht,{size:16,className:"text-orange-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Add Device Issues"})]}),e.jsxs("button",{type:"button",onClick:()=>{if(N){const Ie=`Hi ${N.name}, we've received your device for repair. We'll keep you updated on the progress.`;window.open(`https://wa.me/${N.phone.replace(/\D/g,"")}?text=${encodeURIComponent(Ie)}`,"_blank")}},disabled:!N,className:"flex items-center gap-2 p-3 bg-white rounded-lg border border-blue-200 hover:bg-blue-50 transition-colors disabled:opacity-50",children:[e.jsx(Xr,{size:16,className:"text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Send WhatsApp"})]}),e.jsxs("button",{type:"button",onClick:()=>{Ge({id:`preview-${Date.now()}`,brand:r.brand,model:r.model,serialNumber:H,unlockCode:r.unlockCode,customerName:N==null?void 0:N.name,phoneNumber:N==null?void 0:N.phone,expectedReturnDate:r.expectedReturnDate,status:"assigned",issueDescription:r.issueDescription,conditions:pt,otherText:rt}),Gt(!0)},disabled:!r.brand||!r.model||!H,className:"flex items-center gap-2 p-3 bg-white rounded-lg border border-blue-200 hover:bg-blue-50 transition-colors disabled:opacity-50",children:[e.jsx(ns,{size:16,className:"text-purple-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Print QR Code"})]})]})]}),!we&&e.jsx(he,{className:"mb-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ws,{size:20,className:"text-blue-600"}),"Customer Information"]}),N?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center text-white font-semibold",children:N.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:N.name}),e.jsx("p",{className:"text-sm text-gray-600",children:N.phone})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>sr(!Et),className:"text-gray-500 hover:text-gray-700 p-1",title:Et?"Expand":"Minimize",children:Et?e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}):e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),e.jsx("button",{type:"button",onClick:()=>{I(null),a(Pa),lt([]),wt(""),We()},className:"text-gray-500 hover:text-gray-700 text-sm",children:"Change"})]})]}),!Et&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pt-3 border-t border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hr,{size:14,className:"text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Loyalty"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 capitalize",children:N.loyaltyLevel||"Bronze"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Points"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:N.points||0})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{size:14,className:"text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Total Spent"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:N.totalSpent?`Tsh ${N.totalSpent.toLocaleString()}`:"Tsh 0"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ws,{size:14,className:"text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Last Visit"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:N.lastVisit?new Date(N.lastVisit).toLocaleDateString():"Never"})]})]}),N.city&&e.jsxs("div",{className:"flex items-center gap-2 md:col-span-2",children:[e.jsx(ei,{size:14,className:"text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Location"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:N.city})]})]}),N.colorTag&&N.colorTag!=="regular"&&e.jsxs("div",{className:"flex items-center gap-2 md:col-span-2",children:[e.jsx(Js,{size:14,className:"text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Tag"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 capitalize",children:N.colorTag})]})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-gray-700 mb-3 font-semibold",children:"Search Customer"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:v,onChange:Ie=>{U(Ie.target.value),L(!0)},onFocus:()=>L(!0),className:"w-full py-3 pl-10 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Type name or phone...",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Ws,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:18}),F&&e.jsx("div",{className:"w-full bg-white/95 backdrop-blur-md border border-gray-300 rounded-lg shadow-xl mb-4",children:C.length>0?e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[C.length," customer(s) found"]}),e.jsxs("button",{type:"button",onClick:()=>$e(!Ze),className:"text-blue-600 hover:text-blue-700 font-medium text-sm flex items-center gap-1",children:[e.jsx(Ca,{size:14}),Ze?"Cancel":"Create New Customer"]})]}),Ze&&e.jsxs("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Create New Customer"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),e.jsx("input",{type:"text",value:K.name,onChange:Ie=>be(ze=>({...ze,name:Ie.target.value})),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter customer name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone *"}),e.jsx("input",{type:"tel",value:K.phone,onChange:Ie=>be(ze=>({...ze,phone:Ie.target.value})),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:K.email,onChange:Ie=>be(ze=>({...ze,email:Ie.target.value})),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter email (optional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("input",{type:"text",value:K.city,onChange:Ie=>be(ze=>({...ze,city:Ie.target.value})),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter city (optional)"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:Es,disabled:ue||!K.name.trim()||!K.phone.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:ue?"Creating...":"Create Customer"}),e.jsx("button",{type:"button",onClick:()=>$e(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300",children:"Cancel"})]})]}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200/50",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:" "}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Customer"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Contact"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-700",children:"Points"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",children:"Loyalty"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",children:"Tag"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:C.map(Ie=>e.jsxs("tr",{className:"border-b border-gray-200/30 hover:bg-white/30 transition-colors cursor-pointer",onClick:()=>{I(Ie),q(!0),U(""),L(!1)},children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold",children:Ie.name.charAt(0)})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:Ie.name}),e.jsx("p",{className:"text-sm text-gray-600",children:Ie.city})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Qr,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-gray-900",children:Ie.phone})]}),Ie.email&&e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(da,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:Ie.email})]})]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsx("span",{className:"text-gray-900 font-semibold",children:Ie.points})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-sm border ${Ie.loyaltyLevel==="platinum"?"bg-purple-500/20 text-purple-700 border-purple-300/30":Ie.loyaltyLevel==="gold"?"bg-amber-500/20 text-amber-700 border-amber-300/30":Ie.loyaltyLevel==="silver"?"bg-gray-400/20 text-gray-700 border-gray-300/30":"bg-orange-500/20 text-orange-700 border-orange-300/30"}`,children:[e.jsx(hr,{size:14}),e.jsx("span",{className:"capitalize",children:Ie.loyaltyLevel})]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-sm border ${Ie.colorTag==="vip"?"bg-emerald-500/20 text-emerald-700 border-emerald-300/30":Ie.colorTag==="complainer"?"bg-rose-500/20 text-rose-700 border-rose-300/30":Ie.colorTag==="purchased"?"bg-blue-500/20 text-blue-700 border-blue-300/30":Ie.colorTag==="new"?"bg-purple-500/20 text-purple-700 border-purple-300/30":"bg-gray-500/20 text-gray-700 border-gray-300/30"}`,children:Ie.colorTag})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:ze=>{ze.stopPropagation()},className:"p-1 text-gray-500 hover:text-blue-600 transition-colors",title:"View Details",children:e.jsx(cs,{size:16})}),e.jsx("button",{type:"button",onClick:ze=>{ze.stopPropagation()},className:"p-1 text-gray-500 hover:text-green-600 transition-colors",title:"Edit Customer",children:e.jsx(Ts,{size:16})}),e.jsx("button",{type:"button",onClick:ze=>{ze.stopPropagation()},className:"p-1 text-gray-500 hover:text-purple-600 transition-colors",title:"Send Message",children:e.jsx(Xr,{size:16})})]})})]},Ie.id))})]})]}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx(_s,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No customers found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Try adjusting your search or create a new customer"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Create New Customer"}),e.jsx("button",{type:"button",onClick:()=>$e(!Ze),className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:Ze?"Cancel":"Add Customer"})]}),Ze&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),e.jsx("input",{type:"text",value:K.name,onChange:Ie=>be(ze=>({...ze,name:Ie.target.value})),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter customer name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone *"}),e.jsx("input",{type:"tel",value:K.phone,onChange:Ie=>be(ze=>({...ze,phone:Ie.target.value})),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter phone number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:K.email,onChange:Ie=>be(ze=>({...ze,email:Ie.target.value})),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter email (optional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("input",{type:"text",value:K.city,onChange:Ie=>be(ze=>({...ze,city:Ie.target.value})),className:"w-full py-2 px-3 bg-white border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter city (optional)"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:Es,disabled:ue||!K.name.trim()||!K.phone.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:ue?"Creating...":"Create Customer"}),e.jsx("button",{type:"button",onClick:()=>$e(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300",children:"Cancel"})]})]})]})]})})]}),e.jsx("button",{type:"button",onClick:()=>{Re(!0)},className:"w-12 h-12 flex items-center justify-center rounded-xl bg-white/30 backdrop-blur border border-gray-200 shadow-md hover:bg-white/50 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400","aria-label":"Add new customer",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"text-blue-500",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v12m6-6H6"})})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ns,{size:20,className:"text-blue-600"}),"Device Information"]}),e.jsxs("form",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:`block mb-2 font-medium ${Qe.brand?"text-red-600":"text-gray-700"}`,children:["Brand *",!r.brand&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Required)"})]}),e.jsx(qc,{value:r.brand,onChange:Ie=>a(ze=>({...ze,brand:Ie})),placeholder:"Enter brand",required:!0,className:`w-full ${r.brand?"":"ring-2 ring-yellow-200"}`})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block mb-2 font-medium ${Qe.model?"text-red-600":"text-gray-700"}`,children:["Model *",!r.model&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Required)"})]}),e.jsx(Oc,{value:r.model,onChange:Ie=>a(ze=>({...ze,model:Ie})),placeholder:"Enter model or model number",required:!0,className:`w-full ${r.model?"":"ring-2 ring-yellow-200"}`,modelLogos:Xt,brand:r.brand})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block mb-2 font-medium ${Qe.imeiOrSerial?"text-red-600":"text-gray-700"}`,children:["IMEI or Serial Number *",!H&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Required)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",className:`w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none ${Qe.imeiOrSerial?"border-red-500 focus:border-red-600":H?"border-gray-300 focus:border-blue-500":"border-yellow-300 focus:border-yellow-500"}`,placeholder:"Enter IMEI or Serial Number (min 12 digits)",value:H||"",onChange:Ie=>{const ze=Ie.target.value.toUpperCase();J(ze),ze.length>0&&(as(ze).isValid?vt(oe=>({...oe,imeiOrSerial:!1})):vt(oe=>({...oe,imeiOrSerial:!0})))},onBlur:()=>{as(H).isValid?vt(ze=>({...ze,imeiOrSerial:!1})):vt(ze=>({...ze,imeiOrSerial:!0}))},autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Ga,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]}),Qe.imeiOrSerial&&H&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:as(H).error||"Please enter a valid IMEI or Serial Number"}),Qe.imeiOrSerial&&H&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["💡 Tip: Enter the actual IMEI or Serial Number from the device, not the model name",e.jsx("br",{}),"📱 Examples: 123456789012345 (IMEI) or G9566RL4YC (Serial)"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block mb-2 font-medium text-gray-700",children:"Estimated Completion"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",className:"w-full py-3 pl-4 pr-10 bg-white border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none flex items-center",onClick:()=>Is(Ie=>!Ie),tabIndex:0,children:[e.jsxs("span",{className:"flex items-center gap-2 w-full justify-start",children:[ts[xs],e.jsx("span",{className:"text-gray-800 whitespace-nowrap",children:(gr=ss.find(Ie=>Ie.value===xs))==null?void 0:gr.label})]}),e.jsx(sa,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500",size:20})]}),gt&&e.jsx("div",{"data-dropdown":"completion",className:"absolute z-50 left-0 right-0 mt-2 bg-white rounded-xl shadow-lg border border-gray-200 p-4 grid grid-cols-2 gap-3",children:ss.map(Ie=>e.jsxs("button",{type:"button",className:`flex items-center gap-3 px-4 py-4 rounded-lg transition hover:bg-blue-50 w-full text-left text-base ${xs===Ie.value?"bg-blue-100":""}`,onClick:()=>bs(Ie.value),children:[ts[Ie.value],e.jsx("span",{children:Ie.label})]},Ie.value))})]}),xs==="custom"&&e.jsxs("div",{className:"relative mt-2",children:[e.jsx(ws,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18}),e.jsx("input",{type:"date",name:"expectedReturnDate",value:r.expectedReturnDate,onChange:Qt,className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",required:!0,autoComplete:"off",autoCorrect:"off",spellCheck:!1})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Unlock Code / Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"unlockCode",value:r.unlockCode,onChange:Qt,className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter unlock code or password (optional)",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Yi,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Estimated Repair Cost"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",name:"repairCost",value:r.repairCost,onChange:Qt,className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter estimated cost",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Ns,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block mb-2 font-medium ${Qe.assignedTo?"text-red-600":"text-gray-700"}`,children:"Assign Technician *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:Se.map(Ie=>{const ze=(Ie.name||Ie.email||"").split(" ").map(oe=>oe[0]).join("").slice(0,2).toUpperCase(),ft=r.assignedTo===Ie.id;return e.jsxs("button",{type:"button",onClick:()=>a(oe=>({...oe,assignedTo:Ie.id})),className:`relative flex flex-col items-center justify-center p-5 border rounded-xl shadow-md transition-all duration-200 focus:outline-none
                              ${ft?"bg-gradient-to-br from-blue-100 to-blue-200 border-blue-500 ring-2 ring-blue-400 scale-105":"bg-white border-gray-200 hover:shadow-lg hover:scale-105"}
                            `,children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold mb-2 transition-all duration-200
                              ${ft?"bg-blue-500 text-white shadow":"bg-gray-200 text-gray-700"}`,children:ze}),e.jsx("span",{className:"font-semibold text-base mb-1 text-gray-900 text-center",children:Ie.name||Ie.email}),ft&&e.jsx("span",{className:"absolute top-2 right-2 bg-blue-500 text-white rounded-full p-1 shadow",children:e.jsx("svg",{width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5 13l4 4L19 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]},Ie.id)})}),Qe.assignedTo&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:"Please select a technician"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative flex items-center",style:{minHeight:"2.5rem"},children:[e.jsx("label",{className:"text-gray-700 font-medium cursor-pointer flex-1 z-10 relative px-4 bg-transparent",onClick:()=>Te(!Ne),children:"Request Deposit"}),e.jsx("button",{type:"button",onClick:()=>Te(!Ne),className:`absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${Ne?"bg-blue-600":"bg-gray-200"}`,style:{zIndex:0},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${Ne?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"relative flex items-center",style:{minHeight:"2.5rem"},children:[e.jsx("label",{className:"text-gray-700 font-medium cursor-pointer flex-1 z-10 relative px-4 bg-transparent",onClick:()=>a(Ie=>({...Ie,diagnosisRequired:!Ie.diagnosisRequired})),children:"Diagnosis Required"}),e.jsx("button",{type:"button",onClick:()=>a(Ie=>({...Ie,diagnosisRequired:!Ie.diagnosisRequired})),className:`absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${r.diagnosisRequired?"bg-blue-600":"bg-gray-200"}`,style:{zIndex:0},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${r.diagnosisRequired?"translate-x-6":"translate-x-1"}`})})]})]}),Ne&&!r.diagnosisRequired&&e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",name:"depositAmount",value:r.depositAmount,onChange:Qt,className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Enter deposit amount",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Ns,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block mb-2 font-medium ${Qe.issueDescription?"text-red-600":"text-gray-700"}`,children:"Issue Description *"}),e.jsx("textarea",{name:"issueDescription",value:r.issueDescription,onChange:Ie=>{Qt(Ie),Jt(!0)},onBlur:()=>Jt(!0),className:`w-full py-3 pl-4 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none resize-none ${Qe.issueDescription?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500"}`,placeholder:"Describe the issue in detail (at least 5 words)",rows:3,required:!0,autoComplete:"off",autoCorrect:"off",spellCheck:!1}),gs&&!$t&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:"Please enter at least 5 words in the Issue Description."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Device Condition Assessment"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",className:`px-4 py-2 rounded-lg border text-sm font-medium transition-all flex items-center gap-2 ${pt.length>0||rt.trim()?"bg-blue-500 text-white border-blue-500":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-blue-50"}`,onClick:()=>xe(!0),children:[e.jsx(Ht,{size:16}),pt.length>0||rt.trim()?`${pt.length+(rt.trim()?1:0)} issue(s) selected`:"Select Issues"]}),pt.map((Ie,ze)=>e.jsx("span",{className:"px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-semibold flex items-center gap-1",children:Ie},Ie+ze)),rt&&e.jsx("span",{className:"px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-semibold flex items-center gap-1",children:rt})]}),Qe.conditionAssessment&&e.jsx("div",{className:"text-red-500 text-xs mt-2",children:"Please select at least one condition in the assessment."})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition",onClick:()=>y(-1),disabled:i||de,children:"Cancel"}),e.jsx("button",{type:"button",className:`px-6 py-3 rounded-lg font-semibold transition-all duration-200 ${at===100?"bg-green-600 text-white hover:bg-green-700 shadow-lg":at>=70?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-400 text-gray-600 cursor-not-allowed"}`,onClick:async()=>{if(Us()){me(!0),c(!0);const Ie={brand:r.brand,model:r.model,serialNumber:H,unlockCode:r.unlockCode,customerId:N==null?void 0:N.id,customerName:(N==null?void 0:N.name)||"",phoneNumber:(N==null?void 0:N.phone)||"",expectedReturnDate:r.expectedReturnDate,status:"assigned",issueDescription:r.issueDescription,conditions:pt,otherText:rt,depositAmount:Ne&&!r.diagnosisRequired?r.depositAmount:void 0,repairCost:r.repairCost,assignedTo:r.assignedTo,createdBy:ht==null?void 0:ht.id,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};if(!navigator.onLine){await jn({type:"addDevice",payload:Ie}),kt(!0),a(Pa),me(!1),c(!1),setTimeout(()=>kt(!1),3e3);return}Rt(Ie).then(async ze=>{ze?(te.success("Device intake created successfully!"),ar.sendMessage("255746605561@c.us",`New device created: ${ze.model||""} ${ze.serialNumber||""}`,"text"),me(!1),c(!1),y(`/device/${ze.id}`)):(te.error("Failed to create device intake."),me(!1),c(!1))}).catch(ze=>{te.error(`Error: ${ze.message}`),me(!1),c(!1)})}},disabled:i||de||at<100,children:i||de?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Submitting..."]}):at===100?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Submit Device Intake"]}):at>=70?e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:["Almost Ready (",at,"%)"]})}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:["Complete Form (",at,"%)"]})})})]})]})]})]})}),ys&&e.jsxs(es,{isOpen:ys,onClose:()=>xe(!1),title:"Device Condition Assessment",children:[e.jsx(ch,{isOpen:ys,onClose:()=>xe(!1),selectedConditions:pt,onConditionsChange:lt,otherText:rt,onOtherTextChange:wt}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition",onClick:()=>xe(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition",onClick:()=>{lt(pt.filter(Ie=>Ie!=="other")),wt(""),xe(!1)},children:"Clear All"}),e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition",onClick:()=>{lt(pt.filter(Ie=>Ie!=="other")),wt(""),xe(!1)},children:"Done"})]})]}),Ot&&we&&e.jsxs(es,{isOpen:Ot,onClose:()=>Gt(!1),title:"Print QR Code",children:[e.jsx("div",{ref:et,className:"print-area",children:e.jsx(Ch,{isOpen:Ot,onClose:()=>Gt(!1),device:we})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4 no-print",children:[e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition",onClick:()=>{if(et.current){const Ie=et.current.innerHTML,ze=window.open("","","height=600,width=400");ze&&(ze.document.write("<html><head><title>Print QR Code</title>"),ze.document.write("<style>@media print { body { margin: 0; } }</style>"),ze.document.write("</head><body >"),ze.document.write(Ie),ze.document.write("</body></html>"),ze.document.close(),ze.focus(),setTimeout(()=>{ze.print(),ze.close()},300))}},children:"Print"}),e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition",onClick:()=>Gt(!1),children:"Close"})]})]}),Ct&&e.jsx(bl,{isOpen:Ct,onClose:()=>Re(!1),onCustomerCreated:Ie=>{I(Ie),Re(!1),U(""),L(!1),a(Pa),lt([]),wt("")}}),Oe&&e.jsxs(es,{isOpen:Oe,onClose:()=>Xe(!1),title:"Add Note",children:[e.jsx("textarea",{className:"w-full py-3 pl-4 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none resize-none",placeholder:"Add a note (optional)",value:Be,onChange:Ie=>Ce(Ie.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition",onClick:()=>Xe(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition",onClick:()=>{Xe(!1),Ce("")},children:"Save Note"})]})]}),St&&e.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg text-center text-base font-semibold animate-fade-in",children:"Device saved offline! Will sync when you are back online."})]})})},_h=()=>{const r=hs(),[a,i]=g.useState(!0),c=u=>{r(`/customers/${u.id}`)},m=()=>{i(!1),r("/customers")};return e.jsxs("div",{className:"p-4 sm:p-6 max-w-3xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(Zs,{to:"/customers",className:"mr-4 text-gray-700 hover:text-gray-900",children:e.jsx(zs,{size:20})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"New Customer"})]}),e.jsx(bl,{isOpen:a,onClose:m,onCustomerCreated:c})]})},Eh=()=>null,Ah=({device:r,currentUser:a,onUpdateStatus:i,onAddRemark:c,onAddRating:m,outstanding:u})=>{const[x,j]=g.useState(""),[b,f]=g.useState(null),[y,N]=g.useState(null),[I,R]=g.useState(!1),[k,E]=g.useState(!1),[v,U]=g.useState(""),[F,L]=g.useState(!1),[C,$]=g.useState(""),[Y,A]=g.useState("cash"),[Z,_]=g.useState(!1),[D,T]=g.useState(null),[z,se]=g.useState(!1),[q,H]=g.useState(null),[J,V]=g.useState(!1),[ge,He]=g.useState(!1),[B,fe]=g.useState(""),[re,ye]=g.useState(!1),[Q,Le]=g.useState(null),Ue=le=>{Le(le),ye(!0),fe("")},Ct=async()=>{if(!B.trim()){te.error("Please add a remark for this action.");return}He(!0);try{await c(B),await i(Q,""),ye(!1),Le(null),fe(""),te.success("Status updated successfully.")}catch{te.error("Failed to update status.")}finally{He(!1)}};g.useEffect(()=>{let le;async function Ne(){if(!(r!=null&&r.id))return;const{data:Te,error:Qe}=await G.from("customer_payments").select("id, status, device_id").eq("device_id",r.id).eq("status","completed");!Qe&&Te&&Te.length>0?V(!0):V(!1)}return Ne(),le=setInterval(Ne,5e3),()=>clearInterval(le)},[r==null?void 0:r.id]);const Re=()=>{const{status:le,assignedTo:Ne}=r,{role:Te,id:Qe}=a,vt=Ne===Qe;switch(le){case"assigned":return Te==="technician"&&vt?[{status:"diagnosis-started",label:"Start Diagnosis",icon:e.jsx(Un,{size:18})}]:Te==="admin"||Te==="customer-care"?[{status:"diagnosis-started",label:"Start Diagnosis",icon:e.jsx(Un,{size:18})}]:[];case"diagnosis-started":return Te==="technician"&&vt?[{status:"awaiting-parts",label:"Awaiting Parts",icon:e.jsx(Yr,{size:18})},{status:"in-repair",label:"Start Repair",icon:e.jsx(Ss,{size:18})}]:Te==="admin"||Te==="customer-care"?[{status:"awaiting-parts",label:"Awaiting Parts",icon:e.jsx(Yr,{size:18})},{status:"in-repair",label:"Start Repair",icon:e.jsx(Ss,{size:18})}]:[];case"awaiting-parts":return Te==="technician"&&vt?[{status:"in-repair",label:"Parts Arrived",icon:e.jsx(Ss,{size:18})}]:Te==="admin"||Te==="customer-care"?[{status:"in-repair",label:"Parts Arrived",icon:e.jsx(Ss,{size:18})}]:[];case"in-repair":return Te==="technician"&&vt?[{status:"reassembled-testing",label:"Testing",icon:e.jsx(yt,{size:18})}]:Te==="admin"||Te==="customer-care"?[{status:"reassembled-testing",label:"Testing",icon:e.jsx(yt,{size:18})}]:[];case"reassembled-testing":return Te==="technician"&&vt?[{status:"repair-complete",label:"Repair Complete",icon:e.jsx(yt,{size:18})}]:Te==="admin"||Te==="customer-care"?[{status:"repair-complete",label:"Repair Complete",icon:e.jsx(yt,{size:18})}]:[];case"repair-complete":return Te==="admin"||Te==="customer-care"?[{status:"returned-to-customer-care",label:"Receive",icon:e.jsx(nr,{size:18})}]:Te==="technician"&&vt?[{status:"returned-to-customer-care",label:"Send to Customer Care",icon:e.jsx(nr,{size:18})}]:[];case"returned-to-customer-care":return Te==="admin"||Te==="customer-care"?[{status:"done",label:"Return to Customer",icon:e.jsx(nr,{size:18})}]:[];case"done":return[];case"failed":return Te==="technician"&&vt?[{status:"returned-to-customer-care",label:"Send to Customer Care",icon:e.jsx(nr,{size:18})}]:Te==="admin"||Te==="customer-care"?[{status:"done",label:"Return to Customer",icon:e.jsx(nr,{size:18})}]:[];default:return[]}},ut=async()=>{x.trim()&&(await c(x),j(""))},Ee=le=>{if(le==="awaiting-parts"){Xe(!0);return}f(le),i(le,"")},[Oe,Xe]=g.useState(!1),[Be,Ce]=g.useState(""),[Ze,$e]=g.useState(!1),K=async()=>{if(!Be.trim())return;$e(!0);const le=`Awaiting Part: ${Be.trim()}
Device: ${r.brand} ${r.model}`;await c(le),Xe(!1),Ce(""),$e(!1),f("awaiting-parts"),i("awaiting-parts","")},be=async()=>{_(!0),T(null);let le;try{if(!r.customerId||!r.id)throw new Error("Missing customer or device");if(!C||isNaN(Number(C))||Number(C)<=0){T("Enter a valid amount"),_(!1);return}le={id:crypto.randomUUID(),customer_id:r.customerId,amount:Number(C),method:Y,device_id:r.id,payment_date:new Date().toISOString(),payment_type:"payment",status:"completed",created_by:a.id,created_at:new Date().toISOString()};const{error:Ne,data:Te}=await G.from("customer_payments").insert(le);if(Ne)throw Ne;L(!1),$(""),A("cash"),H(le),se(!0),V(!0)}catch(Ne){T(Ne.message||"Failed to record payment")}finally{_(!1)}},ue=Re(),Ye=r.status==="failed",ae=le=>le==="done",ke=a.role==="customer-care",Ke=typeof u=="number"?u<=0:!0;return e.jsxs("div",{className:"space-y-6",children:[Ye&&ue.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-red-700 mb-2 flex items-center gap-2",children:[e.jsx(Fs,{size:20,className:"text-red-500"})," Device Marked as FAILED"]}),e.jsx("div",{className:"text-sm text-red-700 mb-2",children:"This device could not be repaired. Please add a remark and proceed with the next action."}),e.jsx("div",{className:"flex flex-col gap-3",children:ue.map(le=>e.jsx(X,{onClick:()=>Ue(le.status),size:"lg",icon:le.icon,className:"justify-start w-full h-[50px]",variant:le.status==="done"?"success":"primary",disabled:ge,children:le.label},le.status))}),re&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4 transform transition-all",children:[e.jsx("h3",{className:"text-lg font-bold mb-2 text-gray-900",children:"Confirm Action"}),e.jsx("div",{className:"mb-2 text-gray-700",children:"Are you sure you want to proceed with this action? Please provide a remark for the record."}),e.jsx("textarea",{value:B,onChange:le=>fe(le.target.value),placeholder:"Add a remark (required)",className:"w-full py-3 px-4 bg-gray-100 border border-gray-300 rounded-lg mb-4",rows:3,autoFocus:!0}),e.jsxs("div",{className:"flex gap-3 justify-end mt-2",children:[e.jsx(X,{type:"button",variant:"secondary",onClick:()=>ye(!1),disabled:ge,children:"Cancel"}),e.jsx(X,{type:"button",variant:Q==="done"?"success":"primary",disabled:ge||!B.trim(),onClick:Ct,children:ge?"Processing...":"Confirm"})]})]})}),r.remarks&&r.remarks.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"font-semibold text-xs text-gray-700 mb-1",children:"Recent Remarks:"}),e.jsx("ul",{className:"text-xs text-gray-600 space-y-1",children:r.remarks.slice(-3).reverse().map((le,Ne)=>e.jsxs("li",{className:"border-l-2 border-red-300 pl-2",children:[le.content," ",e.jsxs("span",{className:"text-gray-400",children:["(",new Date(le.createdAt).toLocaleString(),")"]})]},le.id||Ne))})]})]}),!Ye&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Status Update"}),ue.length>0?e.jsxs("div",{className:"flex flex-col gap-4",children:[ue.map((le,Ne)=>e.jsxs(Dr.Fragment,{children:[e.jsx("div",{className:"relative group",children:ae(le.status)?Ke?e.jsx(X,{onClick:()=>Ee(le.status),size:"lg",icon:le.icon,className:`justify-start w-full h-[70px] ${ue.length===1?"text-xl":"text-base"}`,variant:"success",children:le.label}):e.jsx("span",{className:"block w-full text-center text-gray-500 bg-gray-100 py-4 rounded-lg",children:"Payment required before release."}):e.jsx(X,{onClick:()=>Ee(le.status),size:"lg",icon:le.icon,className:`justify-start w-full h-[70px] ${ue.length===1?"text-xl":"text-base"}`,variant:"primary",children:le.label})}),le.status==="done"&&r.status==="returned-to-customer-care"&&!J&&(ke||a.role==="admin"?e.jsxs("div",{className:"flex flex-col gap-2 my-2",children:[e.jsx(X,{variant:"primary",icon:e.jsx(mr,{size:18}),onClick:()=>L(!0),className:"w-full",disabled:F,children:"Record Payment"}),F&&e.jsxs("div",{className:"p-4 mt-2 rounded-lg border border-blue-200 bg-blue-50",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:C,onChange:Te=>$(Te.target.value),className:"w-full rounded-lg border border-white/30 bg-white/30 p-3 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-400/30 transition-all duration-300",placeholder:"Enter amount"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Method"}),e.jsxs("select",{value:Y,onChange:Te=>A(Te.target.value),className:"w-full rounded-lg border border-white/30 bg-white/30 p-3 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-400/30 transition-all duration-300",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"transfer",children:"Transfer"})]})]}),D&&e.jsx("div",{className:"text-red-500 text-sm mb-2",children:D}),e.jsxs("div",{className:"flex gap-3 justify-end mt-2",children:[e.jsx(X,{variant:"secondary",onClick:()=>{L(!1),$(""),T(null)},children:"Cancel"}),e.jsx(X,{variant:"primary",onClick:be,disabled:Z,children:Z?"Recording...":"Record Payment"})]})]})]}):null)]},le.status)),e.jsx(es,{isOpen:z,onClose:()=>{se(!1)},title:e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Payment Receipt"}),children:q&&e.jsxs("div",{className:"p-2",id:"payment-receipt-content",children:[e.jsx("div",{className:"mb-2 text-green-900 font-semibold",children:"Payment Successful!"}),e.jsxs("div",{className:"mb-2",children:["Amount: ",e.jsx("span",{className:"font-bold",children:Vt(q.amount)})]}),e.jsxs("div",{className:"mb-2",children:["Method: ",e.jsx("span",{className:"font-bold",children:q.method})]}),e.jsxs("div",{className:"mb-2",children:["Date: ",e.jsx("span",{className:"font-bold",children:new Date(q.payment_date).toLocaleString()})]}),e.jsxs("div",{className:"mb-2",children:["Device: ",e.jsxs("span",{className:"font-bold",children:[r.brand," ",r.model]})]}),e.jsxs("div",{className:"mb-2",children:["Customer ID: ",e.jsx("span",{className:"font-bold",children:r.customerId})]}),e.jsxs("div",{className:"mb-2",children:["Recorded by: ",e.jsx("span",{className:"font-bold",children:a.name})]}),e.jsxs("div",{className:"flex gap-3 justify-end mt-4",children:[e.jsx(X,{variant:"secondary",onClick:()=>{se(!1)},children:"Close"}),e.jsx(X,{variant:"primary",onClick:()=>{var Te;const le=(Te=document.getElementById("payment-receipt-content"))==null?void 0:Te.innerHTML,Ne=window.open("","","height=600,width=400");Ne&&le&&(Ne.document.write("<html><head><title>Payment Receipt</title></head><body>"+le+"</body></html>"),Ne.document.close(),Ne.focus(),Ne.print(),Ne.close())},children:"Print Receipt"})]})]})}),(r.status==="in-repair"||r.status==="assigned")&&a.role==="technician"&&r.assignedTo===a.id&&e.jsxs("div",{className:"relative group",children:[e.jsx(X,{onClick:()=>{N(null),U(""),E(!0)},size:"lg",className:"justify-start w-full h-[50px] bg-gradient-to-r from-red-500/90 to-pink-500/90 text-white font-semibold mt-2 hover:from-red-600/90 hover:to-pink-600/90 transition-all duration-200",variant:"danger",disabled:I,children:"⚠️ Failed to Repair"}),y&&e.jsx("div",{className:`mt-2 text-sm ${y.startsWith("Device")?"text-green-600":"text-red-600"}`,children:y}),k&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4 transform transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-full",children:e.jsx(Ht,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Mark Device as Failed"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Please provide a reason for the repair failure"})]})]}),e.jsx("textarea",{value:v,onChange:le=>U(le.target.value),placeholder:"Please provide a detailed reason why the repair failed...",className:"w-full py-3 px-4 bg-gray-100 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-red-500 focus:border-red-500",rows:4}),e.jsxs("div",{className:"flex gap-3 justify-end mt-2",children:[e.jsx(X,{type:"button",variant:"secondary",onClick:()=>E(!1),disabled:I,children:"Cancel"}),e.jsx(X,{type:"button",variant:"danger",disabled:I||!v.trim(),onClick:async()=>{R(!0),N(null);try{await c(`FAILED TO REPAIR: ${v}`),await i("failed",""),N("Device marked as failed to repair successfully."),E(!1),te.success("Device marked as failed to repair")}catch(le){console.error("Error marking device as failed:",le),N("Error: "+String(le)),te.error("Failed to mark device as failed")}finally{R(!1)}},children:I?"Processing...":"Mark as Failed"})]})]})})]})]}):e.jsx("p",{className:"text-gray-600 italic",children:"No status updates available for your role."})]})}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-200/50",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Add Remark"}),e.jsx("textarea",{value:x,onChange:le=>j(le.target.value),onKeyDown:le=>{le.key==="Enter"&&!le.shiftKey&&(le.preventDefault(),ut())},placeholder:"Add a remark about this device...",className:"w-full py-3 px-4 bg-white/30 backdrop-blur-md border border-white/30 rounded-lg",rows:3}),e.jsx("div",{className:"flex justify-end",children:e.jsx(X,{onClick:ut,disabled:!x.trim(),variant:"secondary",children:"Add Remark"})})]}),F&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-200/50",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Record Payment"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:C,onChange:le=>$(le.target.value),className:"w-full rounded-lg border border-white/30 bg-white/30 p-3 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-400/30 transition-all duration-300",placeholder:"Enter amount"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Method"}),e.jsxs("select",{value:Y,onChange:le=>A(le.target.value),className:"w-full rounded-lg border border-white/30 bg-white/30 p-3 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-400/30 transition-all duration-300",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"transfer",children:"Transfer"})]})]}),D&&e.jsx("div",{className:"text-red-500 text-sm mb-2",children:D}),e.jsxs("div",{className:"flex gap-3 justify-end mt-2",children:[e.jsx(X,{variant:"secondary",onClick:()=>{L(!1),$(""),T(null)},children:"Cancel"}),e.jsx(X,{variant:"primary",onClick:be,disabled:Z,children:Z?"Recording...":"Record Payment"})]})]}),Oe&&e.jsx(es,{isOpen:Oe,onClose:()=>{Xe(!1),Ce("")},title:"Awaiting Parts",maxWidth:"400px",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"Enter the part you are waiting for:"}),e.jsx("input",{type:"text",value:Be,onChange:le=>Ce(le.target.value),className:"w-full rounded-lg border border-gray-300 p-3 text-gray-800 focus:outline-none focus:ring-2 focus:ring-amber-400/30",placeholder:"e.g. Charging Port, LCD, Battery",autoFocus:!0,onKeyDown:le=>{le.key==="Enter"&&Be.trim()&&(le.preventDefault(),K())},disabled:Ze}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(X,{variant:"secondary",onClick:()=>{Xe(!1),Ce("")},disabled:Ze,children:"Cancel"}),e.jsx(X,{variant:"primary",onClick:K,disabled:!Be.trim()||Ze,children:Ze?"Sending...":"Send & Update Status"})]})]})})]})},Wc=g.forwardRef(({device:r},a)=>{const i=c=>{const m={year:"numeric",month:"short",day:"numeric"};return new Date(c).toLocaleDateString(void 0,m)};return e.jsx("div",{ref:a,className:"p-8 bg-white text-black",style:{display:"none"},children:e.jsxs("div",{className:"border-2 border-black p-6 max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"REPAIR SHOP"}),e.jsx("p",{className:"text-sm",children:"Customer Receipt"})]}),e.jsxs("div",{className:"border-t-2 border-b-2 border-black py-4 my-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-bold",children:"Device ID:"}),e.jsx("span",{className:"text-xl",children:r.id})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-bold",children:"Customer:"}),e.jsx("span",{children:r.customerName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-bold",children:"Expected Return:"}),e.jsx("span",{children:i(r.expectedReturnDate)})]})]}),e.jsxs("div",{className:"text-center text-sm",children:[e.jsx("p",{className:"mb-1",children:"Please present this receipt when collecting your device."}),e.jsx("p",{children:"Contact: (555) 123-4567"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-dashed border-black text-xs",children:[e.jsxs("p",{children:["Device: ",r.brand," ",r.model]}),e.jsxs("p",{children:["Received: ",i(r.createdAt)]})]})]})})});Wc.displayName="PrintableSlip";const kh=({deviceId:r,currentTechId:a,currentUser:i})=>{const[c,m]=g.useState(a||""),[u,x]=g.useState(""),[j,b]=g.useState([]),{assignToTechnician:f,updateDeviceStatus:y}=na();Dr.useEffect(()=>{(async()=>{const{data:E,error:v}=await G.from("auth_users").select("id, name, email").eq("role","technician");!v&&E&&b(E)})()},[]);const N=async()=>{c&&(navigator.onLine?await f(r,c,""):(await jn({type:"assignTechnician",payload:{deviceId:r,selectedTechId:c}}),alert("You are offline. Technician assignment will be synced when you are back online.")))},I=async()=>{if(window.confirm("Are you sure you want to mark this device as failed to repair? This action cannot be undone."))try{navigator.onLine?(u.trim()?await G.from("device_remarks").insert({id:`remark-${Date.now()}`,device_id:r,content:`FAILED TO REPAIR: ${u}`,created_by:i.id,created_at:new Date().toISOString()}):await G.from("device_remarks").insert({id:`remark-${Date.now()}`,device_id:r,content:"FAILED TO REPAIR: Device marked as failed to repair by technician",created_by:i.id,created_at:new Date().toISOString()}),await y(r,"failed",""),alert("Device has been marked as failed to repair successfully."),window.location.reload()):(await jn({type:"markDeviceFailed",payload:{deviceId:r,remark:u}}),alert("You are offline. Device failure status will be synced when you are back online."))}catch(k){console.error("Error marking device as failed:",k),alert("Error marking device as failed. Please try again.")}},R=!!a;return e.jsxs("div",{className:"space-y-6",children:[R?e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",className:"text-blue-600",children:e.jsx("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"font-medium",children:"Device is already assigned to a technician"})]})}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Select Technician"}),e.jsxs("select",{value:c,onChange:k=>m(k.target.value),className:"w-full h-[45px] px-4 bg-white/30 backdrop-blur-md border border-white/30 rounded-lg text-base",children:[e.jsx("option",{value:"",children:"Select a technician..."}),j.map(k=>e.jsxs("option",{value:k.id,children:[k.name," (",k.email,")"]},k.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Add Remark (Optional)"}),e.jsx("textarea",{value:u,onChange:k=>x(k.target.value),className:"w-full h-[100px] px-4 py-3 bg-white/30 backdrop-blur-md border border-white/30 rounded-lg resize-none",placeholder:"Add any additional notes..."}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx("button",{onClick:()=>{x(""),alert("Remark added!")},disabled:!u.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold disabled:opacity-50",type:"button",children:"Add Remark"})})]}),!a&&e.jsxs("button",{onClick:N,disabled:!c,className:`w-full h-[70px] rounded-lg flex items-center justify-center gap-4 text-xl font-semibold
            transition-all duration-300 shadow-xl border transform hover:scale-[1.02] active:scale-[0.98] hover:shadow-2xl
            ${c?"bg-gradient-to-r from-blue-500/90 to-indigo-500/90 hover:from-blue-600/90 hover:to-indigo-600/90 text-white border-blue-400/40":"bg-gradient-to-r from-gray-500/60 to-gray-600/60 text-gray-300 border-gray-400/30"} backdrop-blur-md`,children:[e.jsx(Pd,{size:28,strokeWidth:2.5}),"Assign"]}),i.role==="technician"&&a===i.id&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-800 mb-2",children:[e.jsx(Ht,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium text-sm",children:"Emergency Action"})]}),e.jsx("p",{className:"text-sm text-red-700 mb-3",children:"Use this button only if the device cannot be repaired due to technical issues, missing parts, or other critical problems."}),e.jsx("button",{onClick:I,className:"w-full h-[50px] rounded-lg bg-gradient-to-r from-red-500/90 to-pink-500/90 text-white font-semibold hover:from-red-600/90 hover:to-pink-600/90 transition-all duration-200 flex items-center justify-center gap-2",type:"button",children:"⚠️ Failed to Repair"})]})})]})},Dh=({device:r,isOpen:a,onClose:i,onStatusUpdate:c})=>{const[m,u]=g.useState([]),[x,j]=g.useState(0),[b,f]=g.useState({}),[y,N]=g.useState(!1),[I,R]=g.useState(!1),[k,E]=g.useState(""),v=D=>{const T=[{id:"power-test",title:"Power Test",description:"Check if device powers on and boots properly",category:"hardware",icon:e.jsx(ti,{className:"h-5 w-5"}),required:!0,status:"pending"},{id:"display-test",title:"Display Test",description:"Check screen for dead pixels, brightness, and touch response",category:"hardware",icon:e.jsx(xr,{className:"h-5 w-5"}),required:!0,status:"pending"},{id:"camera-test",title:"Camera Test",description:"Test front and back cameras for functionality and quality",category:"hardware",icon:e.jsx(vn,{className:"h-5 w-5"}),required:!0,status:"pending"},{id:"audio-test",title:"Audio Test",description:"Test speakers, microphone, and headphone jack",category:"hardware",icon:e.jsx(si,{className:"h-5 w-5"}),required:!0,status:"pending"},{id:"storage-test",title:"Storage Test",description:"Check internal storage and SD card functionality",category:"hardware",icon:e.jsx(Xi,{className:"h-5 w-5"}),required:!0,status:"pending"},{id:"performance-test",title:"Performance Test",description:"Test CPU, RAM, and overall system performance",category:"performance",icon:e.jsx(ri,{className:"h-5 w-5"}),required:!0,status:"pending"},{id:"wifi-test",title:"WiFi Test",description:"Test WiFi connectivity and signal strength",category:"connectivity",icon:e.jsx(Uo,{className:"h-5 w-5"}),required:!0,status:"pending"},{id:"software-test",title:"Software Test",description:"Check operating system and installed applications",category:"software",icon:e.jsx(un,{className:"h-5 w-5"}),required:!0,status:"pending"}];return D.toLowerCase().includes("laptop")&&T.push({id:"keyboard-test",title:"Keyboard Test",description:"Test all keys and keyboard backlight",category:"hardware",icon:e.jsx(fi,{className:"h-5 w-5"}),required:!0,status:"pending"},{id:"touchpad-test",title:"Touchpad Test",description:"Test touchpad sensitivity and gestures",category:"hardware",icon:e.jsx(fi,{className:"h-5 w-5"}),required:!0,status:"pending"}),(D.toLowerCase().includes("phone")||D.toLowerCase().includes("mobile"))&&T.push({id:"touch-test",title:"Touch Screen Test",description:"Test touch screen responsiveness and accuracy",category:"hardware",icon:e.jsx(xr,{className:"h-5 w-5"}),required:!0,status:"pending"},{id:"sim-test",title:"SIM Card Test",description:"Test SIM card detection and cellular connectivity",category:"connectivity",icon:e.jsx(fi,{className:"h-5 w-5"}),required:!0,status:"pending"}),T};g.useEffect(()=>{if(a&&r){if(r.diagnostic_checklist&&r.diagnostic_checklist.items)u(r.diagnostic_checklist.items),f(r.diagnostic_checklist.notes||{}),E(r.diagnostic_checklist.adminNotes||"");else{const D=v(r.model);u(D),f({}),E("")}j(0)}},[a,r]);const U=(D,T)=>{u(se=>se.map(q=>q.id===D?{...q,status:T}:q));const z=m.findIndex(se=>se.id===D);z<m.length-1&&j(z+1)},F=(D,T)=>{f(z=>({...z,[D]:T}))},L=()=>{const D=m.length,T=m.filter(q=>q.status==="pass").length,z=m.filter(q=>q.status==="fail").length,se=m.filter(q=>q.status==="pending").length;return{total:D,passed:T,failed:z,pending:se}},C=()=>{const{failed:D,pending:T}=L();return T>0?"in-progress":D>0?"issues-found":"all-passed"},$=async()=>{N(!0);try{const D=L(),T=C(),{error:z}=await G.from("devices").update({diagnostic_checklist:{items:m,notes:b,adminNotes:k,summary:D,overallStatus:T,last_updated:new Date().toISOString()}}).eq("id",r.id);if(z)throw z;let se=r.status;T==="all-passed"?se="diagnosis-complete":T==="issues-found"?se="diagnosis-issues":se="diagnosis-started",se!==r.status&&c(se),te.success("Diagnostic results saved successfully"),i()}catch(D){console.error("Error saving diagnostic:",D),te.error("Failed to save diagnostic results")}finally{N(!1)}},Y=async()=>{N(!0);try{const D=L(),T=C(),{error:z}=await G.from("devices").update({diagnostic_checklist:{items:m,notes:b,adminNotes:k,summary:D,overallStatus:T,submittedToAdmin:!0,submittedAt:new Date().toISOString(),last_updated:new Date().toISOString()},status:"awaiting-admin-review"}).eq("id",r.id);if(z)throw z;const{error:se}=await G.from("admin_notifications").insert({device_id:r.id,type:"diagnostic_report",title:`Diagnostic Report: ${r.brand} ${r.model}`,message:`Diagnostic completed with ${D.failed} issues found. Requires admin review.`,status:"unread",created_at:new Date().toISOString()});se&&console.warn("Failed to create admin notification:",se),c("awaiting-admin-review"),te.success("Diagnostic report submitted to admin"),i()}catch(D){console.error("Error submitting to admin:",D),te.error("Failed to submit to admin")}finally{N(!1)}},A=D=>{switch(D){case"pass":return"text-green-600 bg-green-50 border-green-200";case"fail":return"text-red-600 bg-red-50 border-red-200";case"pending":return"text-gray-600 bg-gray-50 border-gray-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},Z=D=>{switch(D){case"hardware":return"text-blue-600 bg-blue-50 border-blue-200";case"software":return"text-purple-600 bg-purple-50 border-purple-200";case"connectivity":return"text-cyan-600 bg-cyan-50 border-cyan-200";case"performance":return"text-orange-600 bg-orange-50 border-orange-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}};if(!a)return null;const _=L();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Device Diagnostic Checklist"}),e.jsxs("p",{className:"text-blue-100",children:[r.brand," ",r.model," - ",r.id]}),e.jsxs("p",{className:"text-blue-200 text-sm",children:["Current Status: ",r.status.replace("-"," ").replace(/\b\w/g,D=>D.toUpperCase())]})]}),e.jsx("button",{onClick:i,className:"text-white hover:text-blue-100 transition-colors",children:"✕"})]})}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yt,{className:"h-5 w-5 text-green-600"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Passed: ",_.passed]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fs,{className:"h-5 w-5 text-red-600"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Failed: ",_.failed]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ht,{className:"h-5 w-5 text-yellow-600"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Pending: ",_.pending]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[Math.round((_.passed+_.failed)/_.total*100),"% Complete"]})]})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:m.map((D,T)=>e.jsx("div",{className:`border rounded-lg p-4 transition-all duration-200 ${D.status==="pass"?"bg-green-50 border-green-200":D.status==="fail"?"bg-red-50 border-red-200":T===x?"bg-blue-50 border-blue-200 shadow-md":"bg-white border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:D.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium border ${Z(D.category)}`,children:D.category.charAt(0).toUpperCase()+D.category.slice(1)}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium border ${A(D.status)}`,children:[D.status==="pass"&&e.jsx(yt,{className:"h-3 w-3"}),D.status==="fail"&&e.jsx(Fs,{className:"h-3 w-3"}),D.status==="pending"&&e.jsx(Ht,{className:"h-3 w-3"}),D.status.charAt(0).toUpperCase()+D.status.slice(1)]}),D.required&&e.jsx("span",{className:"text-xs text-red-600 font-medium",children:"Required"})]}),e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:D.title}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:D.description}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsxs("button",{onClick:()=>U(D.id,"pass"),className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${D.status==="pass"?"bg-green-500 text-white":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:[e.jsx(yt,{className:"h-4 w-4 inline mr-1"}),"Working"]}),e.jsxs("button",{onClick:()=>U(D.id,"fail"),className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${D.status==="fail"?"bg-red-500 text-white":"bg-red-100 text-red-700 hover:bg-red-200"}`,children:[e.jsx(Fs,{className:"h-4 w-4 inline mr-1"}),"Fail"]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("textarea",{placeholder:"Add notes for this test...",value:b[D.id]||"",onChange:z=>F(D.id,z.target.value),className:"w-full p-2 border border-gray-300 rounded-md text-sm resize-none",rows:2})})]})]})},D.id))})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Admin Notes"}),e.jsx("textarea",{placeholder:"Add notes for admin review...",value:k,onChange:D=>E(D.target.value),className:"w-full p-3 border border-gray-300 rounded-lg resize-none",rows:3})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[_.passed+_.failed," of ",_.total," tests completed"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:$,disabled:y,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all duration-200 disabled:opacity-50",children:y?"Saving...":"Save Results"}),e.jsxs("button",{onClick:Y,disabled:y||_.pending>0,className:"px-6 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all duration-200 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(Tr,{className:"h-4 w-4"}),"Submit to Admin"]})]})]})]})})};async function Th(r){const{data:a,error:i}=await G.from("device_attachments").select("*").eq("device_id",r).order("uploaded_at",{ascending:!1});if(i)throw i;return a}async function So(r,a){const i=a.split("/"),c=i.slice(i.indexOf("device-attachments")+1).join("/");await G.storage.from("device-attachments").remove([c]),await G.from("device_attachments").delete().eq("id",r)}async function _o({userId:r,action:a,entityType:i,entityId:c,details:m}){await G.from("audit_logs").insert({user_id:r,action:a,entity_type:i,entity_id:c,details:m?JSON.stringify(m):null,user_role:"admin",timestamp:new Date().toISOString()})}function za(r){const a=new Date(r),c=Math.floor((new Date().getTime()-a.getTime())/1e3);if(c<0||c<60)return"just now";const m=Math.floor(c/60);if(m<60)return`${m} minute${m===1?"":"s"} ago`;const u=Math.floor(m/60);if(u<24)return`${u} hour${u===1?"":"s"} ago`;const x=Math.floor(u/24);if(x<7)return`${x} day${x===1?"":"s"} ago`;const j=Math.floor(x/7);if(j<4)return`${j} week${j===1?"":"s"} ago`;const b=Math.floor(x/30);if(b<12)return`${b} month${b===1?"":"s"} ago`;const f=Math.floor(x/365);return`${f} year${f===1?"":"s"} ago`}const Ih=()=>{const{id:r}=ka(),{currentUser:a}=Wt();if(!r||!a)return e.jsx("div",{className:"p-8 text-center text-red-500 font-bold",children:"Missing device ID or user session. Please try again."});const{getDeviceById:i,updateDeviceStatus:c,addRemark:m,addRating:u,devices:x}=na(),{getCustomerById:j}=Ur(),b=hs(),f=g.useRef(null),[y,N]=g.useState(!1),[I,R]=g.useState(""),[k,E]=g.useState(!1),[v,U]=g.useState(null),[F,L]=g.useState([]),[C,$]=g.useState(!1),[Y,A]=g.useState(null),[Z,_]=g.useState(null),[D,T]=g.useState(null),[z,se]=g.useState(!1),[q,H]=g.useState(!1),[J,V]=g.useState(!1),[ge,He]=g.useState(!0);g.useEffect(()=>{He(!0);const oe=setTimeout(()=>He(!1),500);return()=>clearTimeout(oe)},[r,a]);const B=i(r),fe={id:(B==null?void 0:B.id)||"",customerId:(B==null?void 0:B.customerId)||"",customerName:(B==null?void 0:B.customerName)||"",phoneNumber:(B==null?void 0:B.phoneNumber)||"",brand:(B==null?void 0:B.brand)||"",model:(B==null?void 0:B.model)||"",serialNumber:(B==null?void 0:B.serialNumber)||"",createdAt:(B==null?void 0:B.createdAt)||"",updatedAt:(B==null?void 0:B.updatedAt)||"",expectedReturnDate:(B==null?void 0:B.expectedReturnDate)||"",estimatedHours:(B==null?void 0:B.estimatedHours)||0,status:(B==null?void 0:B.status)||"assigned",assignedTo:(B==null?void 0:B.assignedTo)||"",issueDescription:(B==null?void 0:B.issueDescription)||"",transitions:(B==null?void 0:B.transitions)||[],remarks:(B==null?void 0:B.remarks)||[],warrantyStart:(B==null?void 0:B.warrantyStart)||"",warrantyEnd:(B==null?void 0:B.warrantyEnd)||"",warrantyStatus:(B==null?void 0:B.warrantyStatus)||"None",unlockCode:(B==null?void 0:B.unlockCode)||"",repairCost:(B==null?void 0:B.repairCost)||"",depositAmount:(B==null?void 0:B.depositAmount)||"",diagnosisRequired:(B==null?void 0:B.diagnosisRequired)||!1,deviceNotes:(B==null?void 0:B.deviceNotes)||"",deviceCost:(B==null?void 0:B.deviceCost)||"",deviceCondition:(B==null?void 0:B.deviceCondition)||{},deviceImages:(B==null?void 0:B.deviceImages)||[],accessoriesConfirmed:(B==null?void 0:B.accessoriesConfirmed)||!1,problemConfirmed:(B==null?void 0:B.problemConfirmed)||!1,privacyConfirmed:(B==null?void 0:B.privacyConfirmed)||!1},re=j(fe.customerId),ye=oe=>{var Fe;const De=(Fe=oe.file_name.split(".").pop())==null?void 0:Fe.toLowerCase();return oe.file_url.match(/\.(jpg|jpeg|png|gif|bmp|webp)$/i)?e.jsx("img",{src:oe.file_url,alt:oe.file_name,className:"w-10 h-10 object-cover rounded shadow"}):De==="pdf"?e.jsx(pr,{className:"w-8 h-8 text-red-600"}):e.jsx(zd,{className:"w-8 h-8 text-gray-500"})};g.useEffect(()=>{$(!0),A(null),Th(String(r)).then(L).catch(oe=>A("Failed to load attachments")).finally(()=>$(!1))},[r]);const Q=oe=>{T(oe),se(!0)},Le=async()=>{if(D){$(!0),A(null);try{await So(D.id,D.file_url),L(oe=>oe.filter(De=>De.id!==D.id)),se(!1),a&&await _o({userId:a.id,action:"delete",entityType:"attachment",entityId:D.id,details:{fileName:D.file_name,deviceId:r}}),T(null)}catch{A("Failed to delete attachment")}finally{$(!1)}}},Ue=async()=>{if(Nt.length!==0){$(!0),A(null);try{const oe=F.filter(De=>Nt.includes(De.id)&&De.type!=="invoice");for(const De of oe)await So(De.id,De.file_url),a&&await _o({userId:a.id,action:"delete",entityType:"attachment",entityId:De.id,details:{fileName:De.file_name,deviceId:r}});L(De=>De.filter(Fe=>!Nt.includes(Fe.id))),ss([]),Is(!1),te.success(`Successfully deleted ${oe.length} attachment(s)`)}catch{A("Failed to delete some attachments"),te.error("Failed to delete some attachments")}finally{$(!1)}}},Ct=oe=>{ss(De=>De.includes(oe)?De.filter(Fe=>Fe!==oe):[...De,oe])},Re={status:fe.warrantyStatus||"None",startDate:fe.warrantyStart,endDate:fe.warrantyEnd,durationMonths:fe.warrantyStart&&fe.warrantyEnd?Math.round((new Date(fe.warrantyEnd).getTime()-new Date(fe.warrantyStart).getTime())/(1e3*60*60*24*30)):0},ut=x.filter(oe=>oe.serialNumber===fe.serialNumber&&oe.id!==fe.id),Ee=ul().payments.filter(oe=>oe.device_id===fe.id),Oe=Ee.filter(oe=>oe.status==="completed").reduce((oe,De)=>oe+(De.amount||0),0),Xe=F.filter(oe=>oe.type==="invoice");let Be=0;Xe.forEach(oe=>{const De=oe.file_name.match(/amount[-_](\d+)/i);De&&(Be+=parseFloat(De[1]))});const Ce=Be>0?Math.max(Be-Oe,0):null,Ze=()=>Re.status&&Re.status!=="None"&&(Re.startDate||Re.endDate||Re.durationMonths>0),$e=()=>ut.length>0,K=()=>F.filter(oe=>oe.type==="invoice").length>0,be=()=>F.filter(oe=>oe.type!=="invoice").length>0,ue=a.role==="technician",Ye=ue&&(B==null?void 0:B.assignedTo)===a.id;g.useEffect(()=>{ue&&!Ye&&b("/dashboard")},[ue,Ye,b]);const ae=(oe,De)=>c(r,oe,De),ke=oe=>{c(r,oe,"checklist-update")},Ke=async oe=>{await m(r,oe),await Dt()},le=()=>{setTimeout(()=>{if(f.current){const oe=window.open("","_blank");oe&&(oe.document.write(`
            <html>
              <head>
                <title>Repair Shop Receipt</title>
                <style>
                  body { font-family: Arial, sans-serif; }
                  .container { padding: 20px; }
                  .receipt { 
                    border: 2px solid #000; 
                    padding: 20px; 
                    max-width: 400px; 
                    margin: 0 auto; 
                  }
                  .header { 
                    text-align: center; 
                    margin-bottom: 20px; 
                  }
                  .divider { 
                    border-top: 2px solid #000; 
                    border-bottom: 2px solid #000; 
                    padding: 15px 0; 
                    margin: 15px 0; 
                  }
                  .row { 
                    display: flex; 
                    justify-content: space-between; 
                    margin-bottom: 10px; 
                  }
                  .footer { 
                    text-align: center; 
                    font-size: 12px; 
                  }
                  .dotted-divider { 
                    border-top: 1px dashed #000; 
                    margin-top: 15px; 
                    padding-top: 15px; 
                  }
                  .small-text { 
                    font-size: 10px; 
                  }
                </style>
              </head>
              <body>
                <div class="container">
                  <div class="receipt">
                    <div class="header">
                      <h2>REPAIR SHOP</h2>
                      <p>Customer Receipt</p>
                    </div>
                    
                    <div class="divider">
                      <div class="row">
                        <span><strong>Device:</strong></span>
                        <span style="font-size: 18px;">${Te(B||{model:""})}</span>
                      </div>
                      
                      <div class="row">
                        <span><strong>Customer:</strong></span>
                        <span>${(B==null?void 0:B.customerName)||"N/A"}</span>
                      </div>
                      
                      <div class="row">
                        <span><strong>Expected Return:</strong></span>
                        <span>${new Date((B==null?void 0:B.expectedReturnDate)||new Date().toISOString()).toLocaleDateString()}</span>
                      </div>
                    </div>
                    
                    <div class="footer">
                      <p>Please present this receipt when collecting your device.</p>
                      <p>Contact: (555) 123-4567</p>
                    </div>
                    
                    <div class="dotted-divider small-text">
                      <p>Device: ${(B==null?void 0:B.brand)||"N/A"} ${(B==null?void 0:B.model)||"N/A"}</p>
                      <p>Received: ${new Date((B==null?void 0:B.createdAt)||new Date().toISOString()).toLocaleDateString()}</p>
                    </div>
                  </div>
                </div>
              </body>
            </html>
          `),oe.document.close(),oe.focus(),oe.print())}},100)},Ne=(oe,De=!1)=>{const Fe={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"},Bt=new Date(oe),vs=Bt.toLocaleDateString(void 0,Fe);return De?`${vs} ${Bt.toLocaleTimeString()}`:vs},Te=oe=>`${oe.model}`;g.useEffect(()=>{if(Re.endDate){const oe=new Date,De=new Date(Re.endDate),Fe=Math.ceil((De.getTime()-oe.getTime())/(1e3*60*60*24));Fe>0&&Fe<=30&&te(`Warranty for this device expires in ${Fe} day${Fe===1?"":"s"}!`,{icon:"⚠️",id:`warranty-expiry-${fe.id}`})}},[Re.endDate,fe.id]);const[Qe,vt]=g.useState(!1),[Rt,ht]=g.useState(""),[Se,ve]=g.useState("cash"),[de,me]=g.useState(!1),[Ae,it]=g.useState(null),[St,kt]=g.useState(!1),[et,xs]=g.useState(null),[Nt,ss]=g.useState([]),[gt,Is]=g.useState(!1),ts=async()=>{me(!0),it(null);try{if(!re||!fe)throw new Error("Missing customer or device");if(!Rt||isNaN(Number(Rt))||Number(Rt)<=0){it("Enter a valid amount"),me(!1);return}const oe={id:crypto.randomUUID(),customer_id:re.id,amount:Number(Rt),method:Se,device_id:fe.id,payment_date:new Date().toISOString(),payment_type:"payment",status:"completed",created_by:a.id,created_at:new Date().toISOString()},{error:De}=await G.from("customer_payments").insert(oe);if(De)throw De;vt(!1),ht(""),ve("cash"),xs(oe),kt(!0),te.success("Payment recorded!")}catch(oe){it(oe.message||"Failed to record payment")}finally{me(!1)}},[bs,Qt]=g.useState(new Date);g.useEffect(()=>{const oe=setInterval(()=>Qt(new Date),1e3);return()=>clearInterval(oe)},[]);const[Pe,ot]=g.useState(!0);g.useEffect(()=>{const oe=setInterval(()=>ot(De=>!De),500);return()=>clearInterval(oe)},[]);const $t=oe=>{const Fe=new Date(oe).getTime()-bs.getTime();let Bt="#22c55e";Fe<=0?Bt="#ef4444":Fe<24*60*60*1e3&&(Bt="#f59e42");const vs=Math.floor(Fe/(1e3*60*60*24)),Kt=Math.floor(Fe/(1e3*60*60)%24),Mt=Math.floor(Fe/(1e3*60)%60),_e=Math.floor(Fe/1e3%60);if(Fe<=0)return e.jsx("span",{style:{fontFamily:"monospace",fontSize:"0.95em",color:Bt,fontWeight:600},children:"Overdue"});let ee=[];vs>0&&ee.push(`${vs}d`),(Kt>0||vs>0)&&ee.push(`${Kt}h`),Mt>0&&vs===0&&ee.push(`${Mt}m`),vs===0&&Kt===0&&ee.push(`${_e}s`),ee=ee.slice(0,2);const Lt=e.jsx("span",{style:{opacity:Pe?1:.2,transition:"opacity 0.3s",fontWeight:"bold",color:Bt},children:"."});return e.jsx("span",{style:{fontFamily:"monospace",fontSize:"0.95em",letterSpacing:"0.5px",color:Bt,fontWeight:600},children:ee.map(($s,ir)=>e.jsxs(Dr.Fragment,{children:[$s,ir<ee.length-1&&Lt]},ir))})};function gs(oe,De){const Fe=oe.find(Bt=>Bt.toStatus===De);return Fe?new Date(Fe.timestamp).getTime():void 0}B!=null&&B.transitions&&gs(B.transitions,"in-repair"),B!=null&&B.transitions&&gs(B.transitions,"repair-complete"),B!=null&&B.transitions&&gs(B.transitions,"done");const[Jt,Es]=g.useState([]),[as,Us]=g.useState([]),[ys,xe]=g.useState([]),[pt,lt]=g.useState(!0),[rt,wt]=g.useState(null),[Ot,Gt]=g.useState(!1),[we,Ge]=g.useState(null),[tt,dt]=g.useState(!1);g.useEffect(()=>{let oe=!0;async function De(){lt(!0);try{const Fe=await Wn.getEntityAuditLogs("device",fe.id),{data:Bt,error:vs}=await G.from("points_transactions").select("*").eq("device_id",fe.id),{data:Kt,error:Mt}=await G.from("sms_logs").select("*").eq("device_id",fe.id);oe&&(Es(Fe||[]),Us(Bt||[]),xe(Kt||[]))}catch{oe&&(Es([]),Us([]),xe([]))}finally{oe&&lt(!1)}}return fe.id&&De(),()=>{oe=!1}},[fe.id]);const[jt,bt]=g.useState([]),[Xt,ds]=g.useState([]),[fs,We]=g.useState([]),[M,ce]=g.useState([]),[Je,_t]=g.useState([]),Dt=async()=>{if(!fe.id)return;const{data:oe}=await G.from("customer_payments").select(`
        *,
        customers(name)
      `).eq("device_id",fe.id),De=(oe||[]).map(Mt=>{var _e;return{...Mt,customer_name:((_e=Mt.customers)==null?void 0:_e.name)||void 0}});bt(De);const{data:Fe}=await G.from("device_transitions").select("*").eq("device_id",fe.id);ds(Fe||[]);const{data:Bt}=await G.from("device_remarks").select("*").eq("device_id",fe.id);We(Bt||[]);const{data:vs}=await G.from("device_ratings").select("*").eq("device_id",fe.id);ce(vs||[]);const{data:Kt}=await G.from("device_attachments").select("*").eq("device_id",fe.id);_t(Kt||[])},at=async()=>{if(fe.id){Gt(!0),dt(!0);try{const{data:oe,error:De}=await G.from("device_checklists").select("*").eq("device_id",fe.id).maybeSingle();De?(console.error("Error fetching device checklist:",De),wt(null)):wt(oe);const{data:Fe,error:Bt}=await G.from("devices").select("*").eq("id",fe.id).single();Bt?(console.error("Error fetching device data:",Bt),Ge(null)):Ge(Fe)}catch(oe){console.error("Error fetching device details:",oe),wt(null),Ge(null)}finally{Gt(!1),dt(!1)}}};g.useEffect(()=>{Dt(),at()},[fe.id]);function Et(){var De;const oe=[];for(const Fe of Xt){const Bt=Xt.find(Mt=>Mt.to_status===Fe.from_status);let vs=null,Kt="";if(Bt&&Bt.created_at&&Fe.created_at){vs=new Date(Fe.created_at).getTime()-new Date(Bt.created_at).getTime();const Mt=Math.floor(vs/6e4),_e=Math.floor(Mt/60),ee=Mt%60;Kt=_e>0?`${_e}h ${ee}m`:`${ee}m`}oe.push({type:"status",typeLabel:"Status Change",timestamp:Fe.created_at,user:Fe.performed_by,description:`Changed to ${(De=Fe.to_status)==null?void 0:De.replace(/-/g," ")}`,icon:e.jsx(ms,{className:"h-4 w-4 text-blue-600"}),toStatus:Fe.to_status,fromStatus:Fe.from_status,durationMs:vs,durationLabel:Kt})}for(const Fe of fs){const Bt=a&&Fe.created_by===a.id;oe.push({type:"remark",typeLabel:Bt?"Sent Remark":"Incoming Remark",isSent:Bt,timestamp:Fe.created_at,user:Fe.created_by,description:Fe.content,icon:e.jsx(js,{className:Bt?"h-4 w-4 text-green-600":"h-4 w-4 text-purple-600"})})}for(const Fe of jt)oe.push({type:"payment",typeLabel:"Payment",timestamp:Fe.payment_date,user:Fe.created_by,description:`${Fe.payment_type==="payment"?"Payment":Fe.payment_type==="deposit"?"Deposit":"Refund"}: ${Vt(Fe.amount)} (${Fe.method}) [${Fe.status}]`,icon:e.jsx(mr,{className:"h-4 w-4 text-green-600"})});for(const Fe of Je)oe.push({type:"attachment",typeLabel:"Attachment",timestamp:Fe.uploaded_at,user:Fe.uploaded_by,description:`Attachment uploaded: ${Fe.file_name}`,icon:e.jsx(Lr,{className:"h-4 w-4 text-gray-600"})});for(const Fe of M)oe.push({type:"rating",typeLabel:"Rating",timestamp:Fe.created_at,user:Fe.technician_id,description:`Device rated ${Fe.score} star${Fe.score>1?"s":""}${Fe.comment?`: ${Fe.comment}`:""}`,icon:e.jsx(hr,{className:"h-4 w-4 text-yellow-500"})});for(const Fe of Jt)oe.push({type:"audit",typeLabel:"Audit",timestamp:Fe.timestamp,user:Fe.user_id,description:`[Audit] ${Fe.action.replace(/_/g," ")}${Fe.details&&Fe.details.fileName?`: ${Fe.details.fileName}`:""}`,icon:e.jsx(fr,{className:"h-4 w-4 text-rose-600"})});for(const Fe of as)oe.push({type:"points",typeLabel:"Points",timestamp:Fe.created_at,user:Fe.created_by,description:`Points ${Fe.points_change>0?"earned":"spent"}: ${Fe.points_change} (${Fe.transaction_type}) - ${Fe.reason}`,icon:e.jsx(Va,{className:"h-4 w-4 text-pink-600"})});for(const Fe of ys)oe.push({type:"sms",typeLabel:"SMS",timestamp:Fe.sent_at||Fe.created_at,user:Fe.sent_by||Fe.created_by||Fe.provider||"",description:`SMS: ${Fe.message||Fe.message_content||""} [${Fe.status}]`,icon:e.jsx(js,{className:"h-4 w-4 text-blue-400"})});return oe.sort((Fe,Bt)=>new Date(Bt.timestamp).getTime()-new Date(Fe.timestamp).getTime())}const[sr,gr]=g.useState({});g.useEffect(()=>{async function oe(){const De=new Set;fe.assignedTo&&De.add(fe.assignedTo),Xt.forEach(Mt=>Mt.performed_by&&De.add(Mt.performed_by)),fs.forEach(Mt=>Mt.created_by&&De.add(Mt.created_by)),jt.forEach(Mt=>Mt.created_by&&De.add(Mt.created_by)),Je.forEach(Mt=>Mt.uploaded_by&&De.add(Mt.uploaded_by)),M.forEach(Mt=>Mt.technician_id&&De.add(Mt.technician_id)),Jt.forEach(Mt=>Mt.user_id&&De.add(Mt.user_id)),as.forEach(Mt=>Mt.created_by&&De.add(Mt.created_by)),ys.forEach(Mt=>(Mt.sent_by||Mt.created_by)&&De.add(Mt.sent_by||Mt.created_by));const Fe=Array.from(De).filter(Boolean);if(Fe.length===0)return;const Bt=Fe.filter(Mt=>!(Mt in sr));if(Bt.length===0)return;const{data:vs,error:Kt}=await G.from("auth_users").select("id, username").in("id",Bt);if(!Kt&&vs){const Mt={};vs.forEach(_e=>{Mt[_e.id]=_e.username}),gr(_e=>({..._e,...Mt}))}}oe()},[fe,fe.assignedTo,jt,Xt,fs,M,Je,Jt,as,ys]);const Ie=oe=>oe?sr[oe]?sr[oe]:oe==="system"?"System":oe.slice(0,8)+"...":"Unknown",[ze,ft]=g.useState(null);return g.useEffect(()=>{async function oe(){if(!fe.customerId)return;const{data:De,error:Fe}=await G.from("customers").select("*").eq("id",fe.customerId).single();!Fe&&De&&ft(De)}oe()},[fe.customerId]),e.jsxs("div",{className:"p-2 sm:p-4 max-w-6xl mx-auto w-full",children:[fe.status==="failed"&&e.jsxs("div",{className:"mb-4 sm:mb-6 p-3 sm:p-4 rounded-lg bg-gradient-to-r from-red-600/90 to-pink-500/90 text-white text-lg sm:text-xl font-bold flex flex-col gap-2 shadow-lg",children:[e.jsxs("span",{children:["⚠️ This device was marked as ",e.jsx("span",{className:"underline",children:"FAILED TO REPAIR"})]}),(a.role==="admin"||a.role==="customer-care")&&fe.remarks.length>0&&e.jsxs("div",{className:"text-sm sm:text-base font-normal bg-white/20 rounded p-2 mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Failure Reason:"})," ",fe.remarks[fe.remarks.length-1].content]})]}),a.role==="admin"&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-semibold text-yellow-800 mb-2",children:"Debug Info (Admin Only)"}),e.jsxs("div",{className:"text-xs text-yellow-700 space-y-1",children:[e.jsxs("div",{children:["Current User: ",a.name," (",a.role,")"]}),e.jsxs("div",{children:["Device Status: ",fe.status]}),e.jsxs("div",{children:["Device Assigned To: ",fe.assignedTo||"None"]}),e.jsxs("div",{children:["Is Current User Assigned: ",fe.assignedTo===a.id?"Yes":"No"]}),e.jsxs("div",{children:["Can Show Failed Button: ",(fe.status==="in-repair"||fe.status==="assigned")&&a.role==="technician"&&fe.assignedTo===a.id?"Yes":"No"]})]})]}),e.jsxs("div",{className:"flex items-center mb-3 sm:mb-4 sm:mb-6",children:[e.jsx(Zs,{to:"/dashboard",className:"mr-3 sm:mr-4 text-gray-700 hover:text-gray-900",children:e.jsx(zs,{size:18,className:"sm:w-5 sm:h-5"})}),e.jsx("h1",{className:"text-lg sm:text-xl sm:text-2xl font-bold text-gray-900",children:"Device Details"})]}),e.jsx(Eh,{device:fe}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-2 sm:gap-3 sm:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-2 sm:space-y-3 sm:space-y-6",children:[e.jsx(he,{children:e.jsx("div",{className:"flex justify-between items-start mb-4 sm:mb-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-3 sm:mb-4",children:[e.jsx("h1",{className:"text-xl sm:text-2xl sm:text-3xl font-bold text-gray-900",children:Te(fe)}),e.jsx(ma,{status:fe.status})]}),e.jsxs("div",{className:"space-y-1 sm:space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 sm:p-2 rounded-lg bg-blue-500/10",children:e.jsx(ns,{size:16,className:"sm:w-[18px] sm:h-[18px] text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-blue-600/70",children:"Brand & Model"}),e.jsxs("p",{className:"text-sm sm:text-base text-gray-900 font-medium truncate",children:[fe.brand," ",fe.model]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 sm:p-2 rounded-lg bg-purple-500/10",children:e.jsx(Fd,{size:16,className:"sm:w-[18px] sm:h-[18px] text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-purple-600/70",children:"Serial Number"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-900 font-mono truncate",children:fe.serialNumber||"Not provided"})]})]}),(we==null?void 0:we.imei)&&we.imei!==fe.serialNumber&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 sm:p-2 rounded-lg bg-cyan-500/10",children:e.jsx(Ga,{size:16,className:"sm:w-[18px] sm:h-[18px] text-cyan-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-cyan-600/70",children:"IMEI Number"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-900 font-mono truncate",children:we.imei})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 sm:p-2 rounded-lg bg-emerald-500/10",children:e.jsx(ws,{size:16,className:"sm:w-[18px] sm:h-[18px] text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-emerald-600/70",children:"Date Received"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-900 font-mono",children:Ne(fe.createdAt||new Date().toISOString())})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 mb-1",children:[e.jsx("div",{className:"p-1.5 sm:p-2 rounded-lg bg-amber-500/10",children:e.jsx(ws,{size:16,className:"sm:w-[18px] sm:h-[18px] text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-amber-600/70",children:"Est. Completion"}),fe.expectedReturnDate?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm sm:text-base text-gray-900 font-mono font-semibold",children:$t(fe.expectedReturnDate)}),e.jsx("p",{className:"text-xs text-gray-500",children:Ne(fe.expectedReturnDate,!0)})]}):e.jsx("p",{className:"italic text-gray-400 text-sm",children:"N/A"})]})]}),e.jsx("div",{className:"mt-2 mb-1",children:e.jsxs("div",{className:"flex items-start gap-2 p-2 rounded-lg bg-rose-50 border border-rose-100 shadow-sm",children:[e.jsx(Ht,{size:16,className:"sm:w-[18px] sm:h-[18px] text-rose-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-xs font-semibold text-rose-700 mr-1",children:"Device Issue:"}),e.jsx("span",{className:"text-xs text-gray-900 font-medium break-words leading-relaxed",children:fe.issueDescription||e.jsx("span",{className:"italic text-gray-400",children:"No issue description provided."})})]})]})})]})]})})}),e.jsx(he,{children:fe.status==="failed"?e.jsx("div",{className:"text-center text-base sm:text-lg text-red-700 font-semibold p-4 sm:p-6",children:"No further actions are allowed for devices marked as failed to repair."}):a.role==="admin"&&fe.status==="assigned"?e.jsx(kh,{deviceId:fe.id,currentTechId:fe.assignedTo,currentUser:a}):e.jsx(Ah,{device:fe,currentUser:a,onUpdateStatus:ae,onAddRemark:Ke,onAddRating:fe.assignedTo?(oe,De)=>u(fe.id,fe.assignedTo,oe,De):void 0,outstanding:typeof Ce=="number"?Ce:void 0})}),e.jsxs(he,{className:"bg-gradient-to-br from-indigo-500/10 to-indigo-400/5",children:[e.jsx("h3",{className:"text-lg sm:text-xl sm:text-2xl font-bold text-indigo-900 mb-3 sm:mb-4",children:"Device Intake Details"}),tt?e.jsxs("div",{className:"flex items-center justify-center py-6 sm:py-8",children:[e.jsx(rn,{className:"animate-spin h-5 w-5 sm:h-6 sm:w-6 text-indigo-600"}),e.jsx("span",{className:"ml-2 text-indigo-700 text-sm sm:text-base",children:"Loading device details..."})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[(we==null?void 0:we.unlock_code)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 sm:p-2 rounded-lg bg-indigo-500/10",children:e.jsx(Yi,{size:16,className:"sm:w-[18px] sm:h-[18px] text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-indigo-600/70",children:"Unlock Code"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-900 font-mono truncate",children:we.unlock_code})]})]}),(we==null?void 0:we.repair_cost)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 sm:p-2 rounded-lg bg-green-500/10",children:e.jsx(Ns,{size:16,className:"sm:w-[18px] sm:h-[18px] text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-green-600/70",children:"Est. Repair Cost"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-900 font-semibold",children:Vt(parseFloat(we.repair_cost))})]})]}),(we==null?void 0:we.deposit_amount)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 sm:p-2 rounded-lg bg-amber-500/10",children:e.jsx(mr,{size:16,className:"sm:w-[18px] sm:h-[18px] text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-amber-600/70",children:"Deposit Amount"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-900 font-semibold",children:Vt(parseFloat(we.deposit_amount))})]})]}),(we==null?void 0:we.device_cost)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 sm:p-2 rounded-lg bg-emerald-500/10",children:e.jsx(Ns,{size:16,className:"sm:w-[18px] sm:h-[18px] text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-emerald-600/70",children:"Device Cost"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-900 font-semibold",children:Vt(parseFloat(we.device_cost))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 sm:p-2 rounded-lg bg-purple-500/10",children:e.jsx(Ss,{size:16,className:"sm:w-[18px] sm:h-[18px] text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-purple-600/70",children:"Diagnosis Required"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-900 font-semibold",children:we!=null&&we.diagnosis_required?"Yes":"No"})]})]})]}),!tt&&(we==null?void 0:we.device_notes)&&e.jsxs("div",{className:"mt-3 sm:mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pr,{size:16,className:"sm:w-[18px] sm:h-[18px] text-gray-600"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Device Notes"})]}),e.jsx("div",{className:"p-2 sm:p-3 bg-white/50 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-800 text-sm",children:we.device_notes})})]}),!tt&&e.jsxs("div",{className:"mt-3 sm:mt-4 grid grid-cols-1 md:grid-cols-3 gap-2 sm:gap-3",children:[e.jsx("div",{className:`p-2 sm:p-3 rounded-lg border ${we!=null&&we.accessories_confirmed?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yt,{size:14,className:"sm:w-4 sm:h-4 ${dbDevice?.accessories_confirmed ? 'text-green-600' : 'text-gray-400'}"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium",children:"Accessories Confirmed"})]})}),e.jsx("div",{className:`p-2 sm:p-3 rounded-lg border ${we!=null&&we.problem_confirmed?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yt,{size:14,className:"sm:w-4 sm:h-4 ${dbDevice?.problem_confirmed ? 'text-green-600' : 'text-gray-400'}"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium",children:"Problem Confirmed"})]})}),e.jsx("div",{className:`p-2 sm:p-3 rounded-lg border ${we!=null&&we.privacy_confirmed?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yt,{size:14,className:"sm:w-4 sm:h-4 ${dbDevice?.privacy_confirmed ? 'text-green-600' : 'text-gray-400'}"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium",children:"Privacy Confirmed"})]})})]})]}),(we==null?void 0:we.device_condition)&&Object.keys(we.device_condition).length>0&&e.jsxs(he,{className:"bg-gradient-to-br from-orange-500/10 to-orange-400/5",children:[e.jsx("h3",{className:"text-lg sm:text-xl sm:text-2xl font-bold text-orange-900 mb-3 sm:mb-4",children:"Device Condition Assessment"}),tt?e.jsxs("div",{className:"flex items-center justify-center py-6 sm:py-8",children:[e.jsx(rn,{className:"animate-spin h-5 w-5 sm:h-6 sm:w-6 text-orange-600"}),e.jsx("span",{className:"ml-2 text-orange-700 text-sm sm:text-base",children:"Loading condition assessment..."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 sm:gap-3",children:Object.entries(we.device_condition).map(([oe,De])=>e.jsx("div",{className:`p-2 sm:p-3 rounded-lg border ${De?"bg-orange-50 border-orange-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[De?e.jsx(Ht,{size:14,className:"sm:w-4 sm:h-4 text-orange-600"}):e.jsx(yt,{size:14,className:"sm:w-4 sm:h-4 text-gray-400"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium capitalize",children:oe.replace(/([A-Z])/g," $1").replace(/^./,Fe=>Fe.toUpperCase())})]})},oe))})]}),rt&&e.jsxs(he,{className:"bg-gradient-to-br from-teal-500/10 to-teal-400/5",children:[e.jsx("h3",{className:"text-lg sm:text-xl sm:text-2xl font-bold text-teal-900 mb-3 sm:mb-4",children:"Device Checklist"}),Ot?e.jsxs("div",{className:"flex items-center justify-center py-6 sm:py-8",children:[e.jsx(rn,{className:"animate-spin h-5 w-5 sm:h-6 sm:w-6 text-teal-600"}),e.jsx("span",{className:"ml-2 text-teal-700 text-sm sm:text-base",children:"Loading checklist..."})]}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 sm:mb-4 p-2 sm:p-3 bg-teal-50 border border-teal-200 rounded-lg",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 sm:gap-0",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-teal-800",children:"Checklist Type:"}),e.jsx("span",{className:"ml-2 text-teal-700 capitalize text-xs sm:text-sm",children:rt.checklist_type||"General"})]}),rt.completed_by&&e.jsxs("div",{className:"text-xs text-teal-600",children:["Completed by: ",Ie(rt.completed_by)]}),rt.completed_at&&e.jsx("div",{className:"text-xs text-teal-600",children:Ne(rt.completed_at)})]})}),rt.items&&Array.isArray(rt.items)&&rt.items.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-3",children:rt.items.map((oe,De)=>e.jsxs("div",{className:`p-2 sm:p-3 rounded-lg border ${oe.checked?"bg-teal-50 border-teal-200":"bg-gray-50 border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[oe.checked?e.jsx(yt,{size:14,className:"sm:w-4 sm:h-4 text-teal-600"}):e.jsx(Fs,{size:14,className:"sm:w-4 sm:h-4 text-gray-400"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium capitalize",children:oe.name||`Item ${De+1}`})]}),oe.notes&&e.jsx("div",{className:"mt-1 text-xs text-gray-600",children:oe.notes})]},De))}):e.jsx("div",{className:"text-center py-4 text-gray-500 text-sm",children:"No checklist items found"})]})]}),(we==null?void 0:we.device_images)&&we.device_images.length>0&&e.jsxs(he,{className:"bg-gradient-to-br from-pink-500/10 to-pink-400/5",children:[e.jsx("h3",{className:"text-lg sm:text-xl sm:text-2xl font-bold text-pink-900 mb-3 sm:mb-4",children:"Device Images"}),tt?e.jsxs("div",{className:"flex items-center justify-center py-6 sm:py-8",children:[e.jsx(rn,{className:"animate-spin h-5 w-5 sm:h-6 sm:w-6 text-pink-600"}),e.jsx("span",{className:"ml-2 text-pink-700 text-sm sm:text-base",children:"Loading device images..."})]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4",children:we.device_images.map((oe,De)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:oe,alt:`Device image ${De+1}`,className:"w-full h-24 sm:h-32 object-cover rounded-lg border border-gray-200 hover:border-pink-300 transition-colors"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all rounded-lg flex items-center justify-center",children:e.jsx("button",{onClick:()=>window.open(oe,"_blank"),className:"opacity-0 group-hover:opacity-100 bg-white bg-opacity-90 p-1.5 sm:p-2 rounded-full transition-all",children:e.jsx(Bd,{size:14,className:"sm:w-4 sm:h-4 text-gray-700"})})})]},De))})]}),Ze()&&e.jsxs(he,{className:"bg-gradient-to-br from-green-500/10 to-green-400/5",children:[e.jsx("h3",{className:"text-lg sm:text-xl sm:text-2xl font-bold text-green-900 mb-2",children:"Warranty Information"}),e.jsxs("div",{className:"flex flex-col gap-1 sm:gap-2 text-green-900 text-sm sm:text-base",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Status:"})," ",Re.status]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Start Date:"})," ",Ne(Re.startDate)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"End Date:"})," ",Ne(Re.endDate)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Duration:"})," ",Re.durationMonths," months"]})]})]}),$e()&&e.jsxs(he,{className:"bg-gradient-to-br from-blue-500/10 to-blue-400/5",children:[e.jsx("h3",{className:"text-lg sm:text-xl sm:text-2xl font-bold text-blue-900 mb-2",children:"Device Repair History"}),e.jsx("ul",{className:"divide-y divide-blue-200 overflow-x-auto",children:ut.map(oe=>e.jsxs("li",{className:"py-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold text-sm sm:text-base",children:[oe.brand," ",oe.model]})," — ",e.jsx("span",{className:"text-xs sm:text-sm",children:oe.issueDescription||"No issue description"})]}),e.jsx("div",{className:"text-xs sm:text-sm text-blue-700",children:Ne(oe.createdAt)})]}),e.jsxs("div",{className:"text-xs text-blue-600",children:["Status: ",oe.status]})]},oe.id))})]}),K()&&e.jsxs(he,{className:"bg-gradient-to-br from-amber-500/10 to-amber-400/5",children:[e.jsx("h3",{className:"text-lg sm:text-xl sm:text-2xl font-bold text-amber-900 mb-2",children:"Invoices"}),e.jsx("ul",{className:"divide-y divide-amber-200 overflow-x-auto",children:F.filter(oe=>oe.type==="invoice").map(oe=>e.jsxs("li",{className:"py-2 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[ye(oe),e.jsx("a",{href:oe.file_url,target:"_blank",rel:"noopener noreferrer",className:"text-amber-700 underline break-all text-sm",children:oe.file_name})]}),e.jsx(X,{className:"ml-4",variant:"danger",size:"sm",icon:e.jsx(Fs,{size:14,className:"sm:w-4 sm:h-4"}),onClick:()=>Q(oe),disabled:C,children:"Remove"})]},oe.id))})]}),be()&&(a.role==="admin"||a.role==="customer-care"||a.role==="technician")&&e.jsxs(he,{className:"bg-gradient-to-br from-red-500/10 to-red-400/5 border border-red-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-1.5 sm:p-2 rounded-full bg-red-500/20",children:e.jsx(Fs,{size:18,className:"sm:w-5 sm:h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-red-900",children:"Delete Attachments"}),e.jsx("p",{className:"text-xs sm:text-sm text-red-700",children:"Manage and remove device attachments"})]})]}),Nt.length>0&&e.jsxs(X,{variant:"danger",size:"sm",icon:e.jsx(Fs,{size:14,className:"sm:w-4 sm:h-4"}),onClick:()=>Is(!0),disabled:C,children:["Delete Selected (",Nt.length,")"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs sm:text-sm text-red-800",children:[e.jsx("span",{className:"font-semibold",children:"Total Attachments:"})," ",F.filter(oe=>oe.type!=="invoice").length,Nt.length>0&&e.jsxs("span",{className:"text-red-600 font-medium",children:[Nt.length," selected"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:F.filter(oe=>oe.type!=="invoice").map(oe=>e.jsxs("div",{className:`flex items-center justify-between p-2 sm:p-3 rounded-lg border transition-all duration-200 ${Nt.includes(oe.id)?"bg-red-100/50 border-red-300":"bg-white/30 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("input",{type:"checkbox",checked:Nt.includes(oe.id),onChange:()=>Ct(oe.id),className:"rounded border-red-300 text-red-600 focus:ring-red-500",disabled:C}),ye(oe),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-red-900 truncate",children:oe.file_name}),e.jsx("p",{className:"text-xs text-red-600",children:Nt.includes(oe.id)?"Selected for deletion":"Click to select"})]})]}),e.jsx(X,{variant:"danger",size:"sm",icon:e.jsx(Fs,{size:12,className:"sm:w-3.5 sm:h-3.5"}),onClick:()=>Q(oe),disabled:C,className:"ml-2",children:"Delete"})]},oe.id))}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-red-600",children:[e.jsx(Ht,{size:12,className:"sm:w-3.5 sm:h-3.5"}),e.jsx("span",{children:"Deleting attachments cannot be undone. Please confirm before proceeding."})]})]})]}),e.jsx(es,{isOpen:z,onClose:()=>{se(!1),T(null)},title:"Delete Attachment?",actions:e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(X,{variant:"secondary",onClick:()=>{se(!1),T(null)},children:"Cancel"}),e.jsx(X,{variant:"danger",onClick:Le,disabled:C,children:C?"Deleting...":"Delete"})]}),maxWidth:"350px",children:e.jsxs("div",{className:"text-gray-800",children:["Are you sure you want to delete ",e.jsx("span",{className:"font-semibold",children:D==null?void 0:D.file_name}),"?"]})}),e.jsx(es,{isOpen:gt,onClose:()=>{Is(!1)},title:"Bulk Delete Attachments?",actions:e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(X,{variant:"secondary",onClick:()=>{Is(!1)},children:"Cancel"}),e.jsx(X,{variant:"danger",onClick:Ue,disabled:C,children:C?"Deleting...":`Delete ${Nt.length} Attachment(s)`})]}),maxWidth:"400px",children:e.jsxs("div",{className:"text-gray-800",children:[e.jsxs("p",{className:"mb-3",children:["Are you sure you want to delete ",e.jsxs("span",{className:"font-semibold text-red-600",children:[Nt.length," attachment(s)"]}),"?"]}),e.jsxs("div",{className:"bg-red-50 p-3 rounded-lg border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700 mb-2",children:[e.jsx(Ht,{size:16}),e.jsx("span",{className:"font-semibold",children:"Warning:"})]}),e.jsxs("ul",{className:"text-sm text-red-600 space-y-1",children:[e.jsx("li",{children:"• This action cannot be undone"}),e.jsx("li",{children:"• Files will be permanently removed from storage"}),e.jsx("li",{children:"• Audit logs will be created for each deletion"})]})]}),e.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Selected files:"}),e.jsx("div",{className:"mt-1 max-h-20 overflow-y-auto",children:F.filter(oe=>Nt.includes(oe.id)).map(oe=>e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:["• ",oe.file_name]},oe.id))})]})]})}),e.jsx(es,{isOpen:Qe,onClose:()=>{vt(!1),ht(""),it(null)},title:e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Record Payment"}),children:e.jsx("div",{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:Rt,onChange:oe=>ht(oe.target.value),className:"w-full rounded-lg border border-gray-300 bg-white p-4 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-all duration-300 text-lg",placeholder:"Enter amount",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Method"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["cash","card","transfer"].map(oe=>e.jsx("button",{type:"button",onClick:()=>ve(oe),className:`p-3 rounded-lg border-2 transition-all duration-200 text-sm font-medium ${Se===oe?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:border-gray-400"}`,children:oe.charAt(0).toUpperCase()+oe.slice(1)},oe))})]}),Ae&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsx("div",{className:"text-red-600 text-sm font-medium",children:Ae})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsx(X,{variant:"secondary",onClick:()=>{vt(!1),ht(""),it(null)},className:"flex-1",children:"Cancel"}),e.jsx(X,{variant:"primary",onClick:ts,disabled:de,className:"flex-1",children:de?"Recording...":"Record Payment"})]})]})})}),e.jsx(es,{isOpen:St,onClose:()=>{kt(!1),window.location.reload()},title:e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Payment Receipt"}),children:et&&e.jsx("div",{className:"p-4 sm:p-6",id:"payment-receipt-content",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(yt,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold text-green-900 mb-2",children:"Payment Successful!"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Amount:"}),e.jsx("span",{className:"font-bold text-lg text-green-700",children:Vt(et.amount)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Method:"}),e.jsx("span",{className:"font-medium capitalize",children:et.method})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-medium",children:new Date(et.payment_date).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Device:"}),e.jsxs("span",{className:"font-medium",children:[fe.brand," ",fe.model]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Customer:"}),e.jsx("span",{className:"font-medium",children:re?re.name:fe.customerName})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Recorded by:"}),e.jsx("span",{className:"font-medium",children:a.name})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsx(X,{variant:"secondary",onClick:()=>{kt(!1),window.location.reload()},className:"flex-1",children:"Close"}),e.jsx(X,{variant:"primary",onClick:()=>{var Fe;const oe=(Fe=document.getElementById("payment-receipt-content"))==null?void 0:Fe.innerHTML,De=window.open("","","height=600,width=400");De&&oe&&(De.document.write("<html><head><title>Payment Receipt</title></head><body>"+oe+"</body></html>"),De.document.close(),De.focus(),De.print(),De.close())},className:"flex-1",children:"Print Receipt"})]})]})})}),e.jsxs(he,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Activity Timeline"}),(a.role==="admin"||a.role==="customer-care")&&e.jsx(X,{onClick:le,variant:"secondary",icon:e.jsx(ra,{size:16}),size:"sm",children:"Print Receipt"})]}),e.jsx("div",{className:"space-y-4",children:pt?e.jsxs("div",{className:"text-blue-700 flex items-center gap-2",children:[e.jsx(rn,{className:"animate-spin",size:18})," Loading timeline..."]}):Et().length===0?e.jsx("p",{className:"text-gray-500 italic",children:"No activity recorded yet"}):Et().map((oe,De)=>e.jsxs("div",{className:`relative pb-4 ${oe.type==="remark"?oe.isSent?"flex justify-end":"flex justify-start":""}`,children:[oe.type!=="remark"||!oe.isSent?e.jsxs(e.Fragment,{children:[De<Et().length-1&&e.jsx("div",{className:"absolute left-3 top-3 bottom-0 w-0.5 bg-gray-300"}),e.jsx("div",{className:"absolute left-0 top-1 h-6 w-6 rounded-full bg-white flex items-center justify-center border border-gray-300 shadow",children:oe.icon})]}):null,e.jsxs("div",{className:`rounded-lg p-3 backdrop-blur-sm border max-w-lg
                          ${oe.type==="remark"?oe.isSent?"ml-auto mr-0 shadow-green-200 border-green-200 bg-green-50":"mr-auto ml-0 shadow-purple-200 border-purple-200 bg-purple-50":""}
                          ${oe.type==="payment"?"bg-green-50 border-green-200 shadow-green-100":""}
                          ${oe.type==="status"?"bg-blue-50 border-blue-200 shadow-blue-100":""}
                          ${oe.type==="rating"?"bg-yellow-50 border-yellow-200 shadow-yellow-100":""}
                          ${oe.type==="points"?"bg-pink-50 border-pink-200 shadow-pink-100":""}
                          ${oe.type==="attachment"?"bg-gray-50 border-gray-200 shadow-gray-100":""}
                          ${oe.type==="audit"?"bg-rose-50 border-rose-200 shadow-rose-100":""}
                          ${oe.type==="sms"?"bg-blue-50 border-blue-200 shadow-blue-100":""}
                        `,style:oe.type==="remark"?{minWidth:"180px"}:{},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-xs font-bold uppercase tracking-wide ${oe.type==="remark"?oe.isSent?"text-green-700":"text-purple-700":"text-gray-700"}`,children:oe.typeLabel}),e.jsx("span",{className:"text-xs text-gray-400",children:Ne(oe.timestamp)})]}),oe.type==="status"?e.jsxs("div",{className:"flex items-center justify-between gap-2 p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ma,{status:oe.fromStatus,className:"opacity-50 scale-90"}),e.jsx(Bn,{className:"text-blue-400",size:18}),e.jsx(ma,{status:oe.toStatus,className:"scale-110 shadow"})]}),oe.durationLabel&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-500 font-mono",children:[e.jsx(ms,{className:"text-blue-400",size:14}),oe.durationLabel]})]}):e.jsx("p",{className:`font-medium text-gray-800 ${oe.type==="remark"?oe.isSent?"text-green-900":"text-purple-900":""}`,children:oe.description})]})]},De))})]})]}),e.jsxs("div",{className:"space-y-2 sm:space-y-3 sm:space-y-6",children:[e.jsxs(he,{children:[e.jsxs("h3",{className:"text-base sm:text-lg font-bold text-gray-900 mb-3 sm:mb-4 flex items-center gap-2",children:[e.jsx(Fr,{size:16,className:"sm:w-[18px] sm:h-[18px]"}),"Device Actions"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3",children:[e.jsx(X,{variant:"secondary",size:"sm",icon:e.jsx(Hi,{size:14,className:"sm:w-4 sm:h-4"}),onClick:()=>{var De;const oe=window.open("","_blank");oe&&(oe.document.write(`
                      <html>
                        <head>
                          <title>Device QR Code</title>
                          <style>
                            body {
                              display: flex;
                              justify-content: center;
                              align-items: center;
                              min-height: 100vh;
                              margin: 0;
                              font-family: monospace;
                            }
                            .container {
                              text-align: center;
                              padding: 20px;
                              border: 2px solid #000;
                              border-radius: 8px;
                            }
                            .qr-code {
                              margin-bottom: 15px;
                              padding: 10px;
                              background: white;
                              border-radius: 4px;
                            }
                            .device-info {
                              font-size: 12px;
                              margin-top: 10px;
                            }
                          </style>
                        </head>
                        <body>
                          <div class="container">
                            <div class="qr-code">
                              ${((De=document.querySelector(".barcode-svg"))==null?void 0:De.outerHTML)||""}
                            </div>
                            <div class="device-info">
                              <strong>${fe.brand} ${fe.model}</strong><br>
                              ID: ${fe.id}<br>
                              Serial: ${fe.serialNumber||"N/A"}
                            </div>
                          </div>
                        </body>
                      </html>
                    `),oe.document.close(),oe.focus(),oe.print())},className:"w-full text-xs sm:text-sm",children:"Print QR Code"}),(a.role==="admin"||a.role==="customer-care")&&e.jsx(X,{variant:"secondary",size:"sm",icon:e.jsx(ra,{size:14,className:"sm:w-4 sm:h-4"}),onClick:le,className:"w-full text-xs sm:text-sm",children:"Print Receipt"}),a.role==="customer-care"&&e.jsx(X,{variant:"secondary",size:"sm",icon:e.jsx(js,{size:14,className:"sm:w-4 sm:h-4"}),onClick:()=>N(!0),className:"w-full text-xs sm:text-sm",children:"Send SMS"}),a.role==="technician"&&e.jsx(X,{variant:"secondary",size:"sm",icon:e.jsx(Nr,{size:14,className:"sm:w-4 sm:h-4"}),onClick:()=>H(!0),className:"w-full text-xs sm:text-sm",children:"Diagnostic"}),a.role==="technician"&&e.jsx(X,{variant:"secondary",size:"sm",icon:e.jsx(Ss,{size:14,className:"sm:w-4 sm:h-4"}),onClick:()=>V(!0),className:"w-full text-xs sm:text-sm",children:"Repair"}),ut.length>0&&e.jsxs(X,{variant:"secondary",size:"sm",icon:e.jsx(Ki,{size:14,className:"sm:w-4 sm:h-4"}),onClick:()=>{te.success(`${ut.length} previous repairs found`)},className:"w-full text-xs sm:text-sm",children:["View History (",ut.length,")"]})]})]}),fe.assignedTo&&e.jsxs(he,{className:"bg-gradient-to-br from-blue-500/10 to-blue-400/5",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold text-blue-900 mb-3 sm:mb-4",children:"Assigned Technician"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold text-base sm:text-lg",children:Ie(fe.assignedTo).slice(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-blue-900 text-sm sm:text-base",children:Ie(fe.assignedTo)}),e.jsx("p",{className:"text-xs sm:text-sm text-blue-700",children:"Technician"})]})]})]}),(a.role==="admin"||a.role==="customer-care")&&e.jsxs(he,{children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold text-gray-900 mb-3 sm:mb-4",children:"Customer Information"}),e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ws,{size:16,className:"sm:w-[18px] sm:h-[18px] text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-900 cursor-pointer hover:text-blue-600 transition-colors text-sm sm:text-base truncate",onClick:()=>b(`/customers/${fe.customerId}`),children:(ze==null?void 0:ze.name)||(re==null?void 0:re.name)||fe.customerName||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"Phone Number"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx("p",{className:"text-gray-800 text-sm sm:text-base",children:(ze==null?void 0:ze.phone)||(re==null?void 0:re.phone)||fe.phoneNumber||"N/A"})}),e.jsxs("div",{className:"flex gap-2 mt-2 sm:mt-3",children:[e.jsx(X,{variant:"secondary",size:"sm",icon:e.jsx(Qr,{size:14,className:"sm:w-4 sm:h-4"}),onClick:()=>{const oe=((ze==null?void 0:ze.phone)||(re==null?void 0:re.phone)||fe.phoneNumber||"").replace(/\D/g,"");oe&&window.open(`tel:${oe}`)},className:"text-xs sm:text-sm",children:"Call"}),a.role==="customer-care"&&e.jsx(X,{variant:"secondary",size:"sm",icon:e.jsx(js,{size:14,className:"sm:w-4 sm:h-4"}),onClick:()=>N(!0),className:"text-xs sm:text-sm",children:"Text"}),e.jsx(X,{variant:"secondary",size:"sm",icon:e.jsx(Tr,{size:14,className:"sm:w-4 sm:h-4"}),onClick:()=>{const oe=((ze==null?void 0:ze.phone)||(re==null?void 0:re.phone)||fe.phoneNumber||"").replace(/\D/g,"");oe&&window.open(`https://wa.me/${oe}`)},className:"text-xs sm:text-sm",children:"WhatsApp"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"City"}),e.jsx("p",{className:"text-gray-800 text-sm sm:text-base",children:(ze==null?void 0:ze.city)||(re==null?void 0:re.city)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"Loyalty Level"}),e.jsx("p",{className:"text-gray-800 text-sm sm:text-base",children:(ze==null?void 0:ze.loyaltyLevel)||(re==null?void 0:re.loyaltyLevel)||"N/A"})]})]})]}),(a.role==="admin"||a.role==="customer-care")&&e.jsxs(he,{className:"bg-gradient-to-br from-green-500/10 to-green-400/5",children:[e.jsx("h3",{className:"text-lg sm:text-xl sm:text-2xl font-bold text-green-900 mb-4",children:"Payments"}),Ee.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(mr,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("div",{className:"text-gray-700 text-sm sm:text-base",children:"No payments recorded for this device."})]}):e.jsx("div",{className:"space-y-3 mb-4",children:Ee.map(oe=>e.jsxs("div",{className:"bg-white rounded-lg border border-green-200 p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(mr,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"font-semibold text-green-700 text-lg",children:Vt(oe.amount)})]}),e.jsx("span",{className:"text-xs text-gray-500 capitalize",children:oe.method})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Type:"}),e.jsx("p",{className:"font-medium capitalize",children:oe.payment_type==="payment"?"Payment":oe.payment_type==="deposit"?"Deposit":"Refund"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Status:"}),e.jsx("p",{className:"font-medium capitalize",children:oe.status})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[oe.payment_date?za(oe.payment_date):"",oe.created_by&&e.jsxs("span",{className:"ml-2 text-blue-700",children:["by ",oe.created_by]})]})]},oe.id))}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 sm:p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-green-900 font-semibold",children:"Total Paid:"}),e.jsx("span",{className:"text-green-700 font-bold text-lg",children:Vt(Oe)})]}),Be>0&&Ce!==null&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-amber-900 font-semibold",children:"Outstanding:"}),e.jsx("span",{className:"text-amber-700 font-bold",children:Vt(Ce)})]})]}),a.role==="customer-care"||a.role==="admin"?e.jsx(X,{variant:"primary",icon:e.jsx(mr,{size:16,className:"sm:w-[18px] sm:h-[18px]"}),className:"mt-4 w-full sm:w-auto text-sm",onClick:()=>vt(!0),children:"Record Payment"}):e.jsxs("div",{className:"mt-4",children:[e.jsx(X,{variant:"primary",icon:e.jsx(mr,{size:16,className:"sm:w-[18px] sm:h-[18px]"}),className:"opacity-50 cursor-not-allowed w-full sm:w-auto text-sm",disabled:!0,children:"Record Payment"}),e.jsx("div",{className:"text-xs text-gray-500 mt-2 text-center sm:text-left",children:"Only customer care can record payments."})]})]})]})]}),e.jsx(Wc,{ref:f,device:fe}),a.role==="customer-care"&&e.jsx(es,{isOpen:y,onClose:()=>{N(!1),R(""),U(null)},title:"Send SMS",maxWidth:"400px",children:e.jsxs("form",{onSubmit:async oe=>{oe.preventDefault(),E(!0),U(null);const De=((ze==null?void 0:ze.phone)||(re==null?void 0:re.phone)||fe.phoneNumber||"").replace(/\D/g,""),Fe=await Ps.sendSMS(De,I,(ze==null?void 0:ze.id)||(re==null?void 0:re.id)||fe.customerId);if(E(!1),Fe.success){const Bt=await Pm({deviceId:fe.id,customerId:(ze==null?void 0:ze.id)||(re==null?void 0:re.id)||fe.customerId,sentBy:a.id,message:I});U(Bt?"SMS sent!":"SMS sent, but failed to log the message."),R("")}else U(`Failed: ${Fe.error}`)},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"To"}),e.jsx("div",{className:"py-2 px-4 bg-gray-100 rounded",children:(ze==null?void 0:ze.phone)||(re==null?void 0:re.phone)||fe.phoneNumber||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Message"}),e.jsx("textarea",{value:I,onChange:oe=>R(oe.target.value),rows:3,className:"w-full py-2 px-4 bg-white/30 backdrop-blur-md border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"Type your message here",required:!0})]}),v&&e.jsx("div",{className:`text-sm ${v.startsWith("Failed")?"text-red-600":"text-green-600"}`,children:v}),e.jsxs("div",{className:"flex gap-3 justify-end mt-4",children:[e.jsx(X,{type:"button",variant:"secondary",onClick:()=>{N(!1),R(""),U(null)},children:"Cancel"}),e.jsx(X,{type:"submit",variant:"primary",disabled:k,children:k?"Sending...":"Send SMS"})]})]})}),e.jsx(Dh,{device:fe,isOpen:q,onClose:()=>H(!1),onStatusUpdate:ke}),e.jsx(vc,{device:fe,isOpen:J,onClose:()=>V(!1),onStatusUpdate:ke})]})},Mh=({searchQuery:r,onSearchChange:a,loyaltyFilter:i,onLoyaltyFilterChange:c,statusFilter:m,onStatusFilterChange:u,tagFilter:x,onTagFilterChange:j,referralFilter:b,onReferralFilterChange:f,birthdayFilter:y,onBirthdayFilterChange:N,whatsappFilter:I,onWhatsappFilterChange:R,showInactive:k,onShowInactiveChange:E,sortBy:v,onSortByChange:U,customers:F})=>{const[L,C]=g.useState(!1),$=r||i.length>0||m.length>0||x.length>0||b.length>0||y||I||k,Y=()=>{a(""),c([]),u([]),j([]),f([]),N(!1),R(!1),E(!1)},A=Array.from(new Set(F.map(_=>_.colorTag).filter(Boolean))),Z=Array.from(new Set(F.map(_=>_.referralSource).filter(Boolean)));return e.jsxs(he,{className:"mb-4 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Rr,{size:20,className:"text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Customer Filters"}),$&&e.jsx("span",{className:"bg-blue-500 text-white text-xs px-2 py-1 rounded-full",children:"Active"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[$&&e.jsx(X,{variant:"secondary",size:"sm",icon:e.jsx(tr,{size:16}),onClick:Y,children:"Clear All"}),e.jsxs(X,{variant:"secondary",size:"sm",onClick:()=>C(!L),children:[L?"Hide":"Show"," Filters"]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Cr,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:r,onChange:_=>a(_.target.value),placeholder:"Search by name, phone, email, or city...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),L&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(hr,{size:16,className:"inline mr-1"}),"Loyalty Level"]}),e.jsxs("select",{multiple:!0,value:i,onChange:_=>{const D=Array.from(_.target.selectedOptions,T=>T.value);c(D)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"bronze",children:"Bronze"}),e.jsx("option",{value:"silver",children:"Silver"}),e.jsx("option",{value:"gold",children:"Gold"}),e.jsx("option",{value:"platinum",children:"Platinum"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(nr,{size:16,className:"inline mr-1"}),"Status"]}),e.jsxs("select",{multiple:!0,value:m,onChange:_=>{const D=Array.from(_.target.selectedOptions,T=>T.value);u(D)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Js,{size:16,className:"inline mr-1"}),"Tags"]}),e.jsx("select",{multiple:!0,value:x,onChange:_=>{const D=Array.from(_.target.selectedOptions,T=>T.value);j(D)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:A.map(_=>e.jsx("option",{value:_,children:_.charAt(0).toUpperCase()+_.slice(1)},_))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Js,{size:16,className:"inline mr-1"}),"Referral Source"]}),e.jsx("select",{multiple:!0,value:b,onChange:_=>{const D=Array.from(_.target.selectedOptions,T=>T.value);f(D)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:Z.map(_=>e.jsx("option",{value:_,children:_},_))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Calendar,{size:16,className:"inline mr-1"}),"Birthday"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:_=>N(_.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Has birthday info"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(MessageSquare,{size:16,className:"inline mr-1"}),"WhatsApp"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:I,onChange:_=>R(_.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Has WhatsApp"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Show Inactive Only"}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:_=>E(_.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Show customers inactive for 90+ days"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ud,{size:16,className:"inline mr-1"}),"Sort By"]}),e.jsxs("select",{value:v,onChange:_=>U(_.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"recent",children:"Most Recent"}),e.jsx("option",{value:"spent",children:"Total Spent"}),e.jsx("option",{value:"points",children:"Points"})]})]})]})]})},Rh=({open:r,onClose:a,customers:i,onSend:c,sending:m=!1})=>{const[u,x]=g.useState("all"),[j,b]=g.useState("all"),[f,y]=g.useState("all"),[N,I]=g.useState(""),R=g.useMemo(()=>i.filter(E=>{let v=!0;return u!=="all"&&(v=v&&E.loyaltyLevel===u),j!=="all"&&(v=v&&(j==="active"?E.isActive:!E.isActive)),f!=="all"&&(v=v&&E.colorTag===f),v}),[i,u,j,f]),k=()=>{N.trim()&&(c(R,N),I(""),a())};return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",children:e.jsxs(he,{className:"w-full max-w-lg p-6 relative",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700",onClick:a,children:"×"}),e.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-900",children:"Send Bulk SMS"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Loyalty"}),e.jsxs("select",{className:"w-full rounded-lg border-gray-300",value:u,onChange:E=>x(E.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"platinum",children:"Platinum"}),e.jsx("option",{value:"gold",children:"Gold"}),e.jsx("option",{value:"silver",children:"Silver"}),e.jsx("option",{value:"bronze",children:"Bronze"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{className:"w-full rounded-lg border-gray-300",value:j,onChange:E=>b(E.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tag"}),e.jsxs("select",{className:"w-full rounded-lg border-gray-300",value:f,onChange:E=>y(E.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"vip",children:"VIP"}),e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"complainer",children:"Complainer"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message"}),e.jsx("textarea",{className:"w-full rounded-lg border-gray-300 min-h-[80px]",value:N,onChange:E=>I(E.target.value),placeholder:"Type your SMS message here...",maxLength:320})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Recipients: ",e.jsx("b",{children:R.length})]}),e.jsxs("span",{className:"text-xs text-gray-400",children:[N.length,"/320"]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(X,{variant:"secondary",onClick:a,disabled:m,children:"Cancel"}),e.jsx(X,{onClick:k,disabled:m||!N.trim()||R.length===0,children:m?"Sending...":"Send SMS"})]})]})}):null},Lh=({isOpen:r,onClose:a,onImportComplete:i})=>{const{currentUser:c}=Wt(),[m,u]=g.useState(null),[x,j]=g.useState([]),[b,f]=g.useState([]),[y,N]=g.useState(!1),[I,R]=g.useState(!1),[k,E]=g.useState("upload"),[v,U]=g.useState(0),[F,L]=g.useState([]),[C,$]=g.useState([]),[Y,A]=g.useState(!1),[Z,_]=g.useState([]),[D,T]=g.useState(!1),[z,se]=g.useState(new Set),q=g.useRef(null),H=Ee=>{if(!Ee)return"";const Oe=Ee.replace(/[\s\-\(\)]/g,"");return Oe.startsWith("+255")||Oe.startsWith("255")?Oe:Oe.startsWith("0")?"+255"+Oe.substring(1):(Oe.length===9&&/^\d+$/.test(Oe),"255"+Oe)},J=Ee=>{if(!Ee)return"";const Oe=Ee.replace(/[\s\-\(\)]/g,"");return Oe.startsWith("+255")||Oe.startsWith("255")?Oe:Oe.startsWith("0")?"+255"+Oe.substring(1):(Oe.length===9&&/^\d+$/.test(Oe),"255"+Oe)},V=Ee=>{if(!Ee)return"";const Oe=Ee.trim();return Oe===Oe.toUpperCase()&&Oe.length>1?Oe.toLowerCase().replace(/\b\w/g,Xe=>Xe.toUpperCase()):Oe===Oe.toUpperCase()?Oe.toLowerCase().replace(/\b\w/g,Xe=>Xe.toUpperCase()):Oe},ge=Ee=>{const Oe=Ee.trim().toLowerCase();return Oe==="male"||Oe==="m"?"male":Oe==="female"||Oe==="f"?"female":"other"},He=Ee=>{if(!Ee)return"";const Oe=Ee.trim(),Xe={instagram:"Instagram",mtandaoni:"Social Media",physically:"Walk-in",recommendation:"Friend","social media":"Social Media",facebook:"Facebook",google:"Google",friend:"Friend",family:"Family",colleague:"Colleague",advertisement:"Advertisement",website:"Website","walk-in":"Walk-in",referral:"Referral",other:"Other"},Be=Oe.toLowerCase();return Xe[Be]?Xe[Be]:Oe===Oe.toUpperCase()&&Oe.length>1?Oe.toLowerCase().replace(/\b\w/g,Ce=>Ce.toUpperCase()):Oe},B=Ee=>{if(!Ee)return"";const Oe=Ee.trim(),Xe={dsm:"Dar es Salaam",dar:"Dar es Salaam","dar es":"Dar es Salaam","dar es salaam":"Dar es Salaam",mara:"Mara",moro:"Morogoro",arusha:"Arusha",mwanza:"Mwanza",dodoma:"Dodoma",tanga:"Tanga",mbeya:"Mbeya",morogoro:"Morogoro",tabora:"Tabora",singida:"Singida",kigoma:"Kigoma",shinyanga:"Shinyanga",kagera:"Kagera",manyara:"Manyara",njombe:"Njombe",katavi:"Katavi",geita:"Geita",simiyu:"Simiyu",songwe:"Songwe"},Be=Oe.toLowerCase();return Xe[Be]?Xe[Be]:Oe},fe=Ee=>{if(!Ee)return{month:"",day:""};const Oe=Ee.trim().toLowerCase(),Xe=/^(\d{1,2})-([a-z]{3,})$/,Be=Oe.match(Xe);if(Be){const $e=Be[1],K=Be[2],ue={jan:"January",feb:"February",mar:"March",apr:"April",may:"May",jun:"June",jul:"July",aug:"August",sep:"September",oct:"October",nov:"November",dec:"December"}[K];if(ue)return{month:ue,day:$e}}const Ce=/^([a-z]{3,})-(\d{1,2})$/,Ze=Oe.match(Ce);if(Ze){const $e=Ze[1],K=Ze[2],ue={jan:"January",feb:"February",mar:"March",apr:"April",may:"May",jun:"June",jul:"July",aug:"August",sep:"September",oct:"October",nov:"November",dec:"December"}[$e];if(ue)return{month:ue,day:K}}return{month:"",day:""}};g.useEffect(()=>{const Ee=Oe=>{const Xe=document.getElementById("column-expand-dropdown"),Be=Oe.target;Xe&&!Xe.contains(Be)&&!Be.closest("[data-dropdown-button]")&&Xe.classList.add("hidden")};return document.addEventListener("mousedown",Ee),()=>document.removeEventListener("mousedown",Ee)},[]);const re=(Ee,Oe)=>{var Be,Ce;const Xe=[];if((Be=Ee.name)!=null&&Be.trim()||Xe.push(`Row ${Oe}: Name is required`),(Ce=Ee.phone)!=null&&Ce.trim()?/^[\+]?[0-9\s\-\(\)]{8,}$/.test(Ee.phone)||Xe.push(`Row ${Oe}: Invalid phone number format`):Xe.push(`Row ${Oe}: Phone number is required`),Ee.gender&&!["male","female","other"].includes(Ee.gender)&&Xe.push(`Row ${Oe}: Gender must be male, female, or other`),Ee.loyaltyLevel&&!["bronze","silver","gold","platinum"].includes(Ee.loyaltyLevel)&&Xe.push(`Row ${Oe}: Invalid loyalty level`),Ee.birthMonth&&!Ee.birthDay&&Xe.push(`Row ${Oe}: Birth day is required if birth month is provided`),Ee.birthDay&&!Ee.birthMonth&&Xe.push(`Row ${Oe}: Birth month is required if birth day is provided`),Ee.birthDay){const Ze=parseInt(Ee.birthDay);(isNaN(Ze)||Ze<1||Ze>31)&&Xe.push(`Row ${Oe}: Birth day must be a number between 1-31`)}return Xe},ye=(Ee,Oe)=>re(Ee,Oe+2),Q=(Ee,Oe,Xe)=>ye(Ee,Oe).some(Ce=>Ce.toLowerCase().includes(Xe.toLowerCase())||Xe==="name"&&Ce.includes("Name is required")||Xe==="phone"&&(Ce.includes("Phone number is required")||Ce.includes("Invalid phone number format"))),Le=Ee=>{var Xe;const Oe=(Xe=Ee.target.files)==null?void 0:Xe[0];if(Oe){if(Oe.size>5*1024*1024){te.error("File size must be less than 5MB");return}u(Oe),Ue(Oe)}},Ue=async Ee=>{var Oe;try{N(!0),$([]);const Be=(await Ee.text()).split(`
`).filter(K=>K.trim());if(Be.length<2){te.error("File must contain at least a header row and one data row");return}const Ce=((Oe=Be[0])==null?void 0:Oe.split(",").map(K=>K.trim().toLowerCase()))||[],Ze=[],$e=[];for(let K=1;K<Be.length;K++){const be=Be[K].trim();if(!be)continue;const ue=be.split(",").map(Ne=>Ne.trim().replace(/^"|"$/g,"")),Ye=ue[Ce.indexOf("phone")]||ue[Ce.indexOf("phone number")]||ue[Ce.indexOf("mobile")]||ue[Ce.indexOf("mobile phone")]||ue[Ce.indexOf("primary phone")]||ue[Ce.indexOf("phone 1 - value")]||"",ae=ue[Ce.indexOf("whatsapp")]||ue[Ce.indexOf("whatsapp number")]||"",ke={name:V(ue[Ce.indexOf("name")]||ue[Ce.indexOf("full name")]||ue[Ce.indexOf("customer name")]||ue[Ce.indexOf("first name")]||""),email:"",phone:H(Ye),gender:ge(ue[Ce.indexOf("gender")]||"other"),city:B(ue[Ce.indexOf("city")]||ue[Ce.indexOf("location")]||ue[Ce.indexOf("home city")]||ue[Ce.indexOf("business city")]||""),whatsapp:J(ae),notes:ue[Ce.indexOf("notes")]||ue[Ce.indexOf("comments")]||"",loyaltyLevel:ue[Ce.indexOf("loyalty")]||ue[Ce.indexOf("loyalty level")]||"bronze",colorTag:ue[Ce.indexOf("color tag")]||ue[Ce.indexOf("tag")]||"new",birthMonth:ue[Ce.indexOf("birth month")]||ue[Ce.indexOf("month")]||"",birthDay:ue[Ce.indexOf("birth day")]||ue[Ce.indexOf("day")]||"",referralSource:He(ue[Ce.indexOf("referral source")]||ue[Ce.indexOf("referral")]||ue[Ce.indexOf("referred by")]||ue[Ce.indexOf("referral resource")]||""),referralSourceCustom:ue[Ce.indexOf("referral source custom")]||ue[Ce.indexOf("custom referral")]||""},Ke=ue[Ce.indexOf("birthday")]||ue[Ce.indexOf("birth day")]||ue[Ce.indexOf("birth")]||ue[Ce.indexOf("birth date")]||"";if(Ke){const Ne=fe(Ke);Ne.month&&Ne.day&&(ke.birthMonth=Ne.month,ke.birthDay=Ne.day)}if(ke.birthMonth&&ke.birthMonth.includes("-")){const Ne=fe(ke.birthMonth);Ne.month&&Ne.day&&(ke.birthMonth=Ne.month,ke.birthDay=Ne.day)}const le=re(ke,K+1);$e.push(...le),ke.name&&ke.phone&&Ze.push(ke)}$($e),j(Ze),_([...Ze]),f(Ze.slice(0,5)),E("preview"),$e.length>0?te.error(`Found ${$e.length} validation errors. Please review before importing.`):te.success(`Successfully processed ${Ze.length} customers`)}catch(Xe){console.error("Error processing file:",Xe),te.error("Error processing file. Please ensure it's a valid CSV/Excel file.")}finally{N(!1)}},Ct=async()=>{if((c==null?void 0:c.role)!=="admin"){te.error("Only administrators can import customers");return}const Ee=Y?Z:x;if(Ee.length===0){te.error("No data to import. Please add at least one customer.");return}C.length>0&&te.error(`Found ${C.length} validation errors. Invalid rows will be skipped.`);try{R(!0),U(0),L([]);const Xe=[],Be=[];for(let K=0;K<Ee.length;K++){const be=Ee[K],ue=re(be,K+2);if(ue.length>0){Be.push({success:!1,error:`Validation errors: ${ue.join(", ")}`,rowNumber:K+2});continue}try{const Ye=await ll({id:crypto.randomUUID(),name:be.name,email:be.email,phone:H(be.phone),gender:be.gender,city:be.city,whatsapp:J(be.whatsapp||""),initialNotes:be.notes,loyaltyLevel:be.loyaltyLevel||"bronze",colorTag:be.colorTag||"new",birthMonth:be.birthMonth,birthDay:be.birthDay,referralSource:be.referralSource,joinedDate:new Date().toISOString(),totalSpent:0,points:0,lastVisit:new Date().toISOString(),isActive:!0,notes:[],referrals:[]});Ye?(Xe.push(Ye),Be.push({success:!0,customer:Ye,rowNumber:K+2})):Be.push({success:!1,error:"Failed to create customer",rowNumber:K+2})}catch(Ye){console.error(`Error creating customer ${be.name}:`,Ye),Be.push({success:!1,error:Ye instanceof Error?Ye.message:"Unknown error",rowNumber:K+2})}U((K+1)/Ee.length*100),L(Be)}const Ce=Be.filter(K=>K.success).length,Ze=Be.filter(K=>{var be;return!K.success&&((be=K.error)==null?void 0:be.includes("Validation errors"))}).length,$e=Be.filter(K=>{var be;return!K.success&&!((be=K.error)!=null&&be.includes("Validation errors"))}).length;Ce>0&&(te.success(`Successfully imported ${Ce} customers!`),i(Xe)),Ze>0&&te.success(`Skipped ${Ze} rows with validation errors.`),$e>0&&te.error(`${$e} customers failed to import. Check the results below.`),E("import")}catch(Xe){console.error("Import error:",Xe),te.error("Error importing customers. Please try again.")}finally{R(!1)}},Re=()=>{u(null),j([]),_([]),f([]),E("upload"),N(!1),R(!1),A(!1),T(!1),se(new Set),U(0),L([]),$([]),q.current&&(q.current.value=""),a()},ut=()=>{const Oe=`name,email,phone,gender,city,whatsapp,birth month,birth day,referral source,notes,loyalty level,color tag
John Doe,john@example.com,748757641,male,DSM,748757641,January,15,MTANDAONI,New customer,bronze,new
Jane Smith,jane@example.com,717377078,female,MARA,717377078,March,22,RECOMMENDATION,VIP customer,silver,vip
Mike Johnson,mike@example.com,676947420,male,MORO,676947420,December,5,PHYSICALLY,Regular customer,gold,new
Alice Brown,alice@example.com,655123456,female,DSM,655123456,June,10,INSTAGRAM,Social media customer,platinum,purchased`,Xe=new Blob([Oe],{type:"text/csv;charset=utf-8;"}),Be=window.URL.createObjectURL(Xe),Ce=document.createElement("a");Ce.href=Be,Ce.download="customer_import_template.csv",Ce.click(),window.URL.revokeObjectURL(Be),te.success("Template downloaded! To add dropdowns in Excel: Select column → Data → Data Validation → List → Enter values separated by commas")};return!r||(c==null?void 0:c.role)!=="admin"?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs(he,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(Nn,{className:"w-5 h-5 text-green-500"}),"Import Customers from Excel (Admin Only)"]}),e.jsx("button",{onClick:Re,className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(tr,{className:"w-5 h-5"})})]}),k==="upload"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(Lr,{className:"w-12 h-12 mx-auto text-blue-500 mb-2"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Upload Customer Data"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Import customers from Excel/CSV file. Download the template below for the correct format."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>{var Ee;return(Ee=q.current)==null?void 0:Ee.click()},disabled:y,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium transition-colors",children:[e.jsx(Lr,{className:"w-4 h-4 mr-2 inline"}),y?"Processing...":"Choose File"]}),e.jsxs("button",{onClick:()=>{E("preview"),A(!0),_([{name:"",email:"",phone:"",gender:"other",city:"",whatsapp:"",birthMonth:"",birthDay:"",referralSource:"",notes:"",loyaltyLevel:"bronze",colorTag:"new"}])},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[e.jsx(Ca,{className:"w-4 h-4 mr-2 inline"}),"Manual Entry"]}),e.jsxs("button",{onClick:ut,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[e.jsx(Br,{className:"w-4 h-4 mr-2 inline"}),"Download Template"]}),e.jsx("div",{className:"flex items-center justify-center text-sm text-gray-500",children:"or"})]}),e.jsx("input",{ref:q,type:"file",accept:".csv,.xlsx,.xls",onChange:Le,className:"hidden"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-green-800 mb-2 flex items-center gap-2",children:[e.jsx(Bs,{className:"w-4 h-4"}),"Dropdown Values for Excel:"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-green-700",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Gender:"})," male, female, other"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Loyalty Level:"})," bronze, silver, gold, platinum"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Color Tag:"})," new, vip, complainer, purchased"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Referral Source:"})," MTANDAONI, RECOMMENDATION, PHYSICALLY, INSTAGRAM, FACEBOOK, GOOGLE, FRIEND, FAMILY, OTHER"]})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-yellow-800 mb-2 flex items-center gap-2",children:[e.jsx(Bs,{className:"w-4 h-4"}),"How to Add Dropdowns in Excel:"]}),e.jsxs("ol",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:"1. Select the column you want to add dropdown to (e.g., Gender column)"}),e.jsxs("li",{children:["2. Go to ",e.jsx("strong",{children:"Data"})," tab → ",e.jsx("strong",{children:"Data Validation"})]}),e.jsxs("li",{children:["3. Choose ",e.jsx("strong",{children:"List"}),' from "Allow" dropdown']}),e.jsx("li",{children:'4. In "Source" field, enter values separated by commas (e.g., male,female,other)'}),e.jsxs("li",{children:["5. Click ",e.jsx("strong",{children:"OK"})," to apply"]})]})]})]}),k==="preview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:x.length>0?"Preview Data":"Manual Entry"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:x.length>0?`${x.length} customers found`:"No file uploaded - manual entry mode"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{"data-dropdown-button":!0,onClick:()=>{const Ee=document.getElementById("column-expand-dropdown");Ee&&Ee.classList.toggle("hidden")},className:"px-3 py-1 bg-gray-100 text-gray-700 rounded text-xs font-medium hover:bg-gray-200 transition-colors",children:"Expand Columns"}),e.jsxs("div",{id:"column-expand-dropdown",className:"hidden absolute top-full right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-50 min-w-48",children:[e.jsx("div",{className:"p-2 text-xs text-gray-500 border-b",children:"Select columns to expand:"}),[{key:"name",label:"Name"},{key:"phone",label:"Phone"},{key:"email",label:"Email"},{key:"city",label:"City"},{key:"whatsapp",label:"WhatsApp"},{key:"referral",label:"Referral Source"},{key:"notes",label:"Notes"}].map(Ee=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:z.has(Ee.key),onChange:Oe=>{const Xe=new Set(z);Oe.target.checked?Xe.add(Ee.key):Xe.delete(Ee.key),se(Xe)},className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm",children:Ee.label})]},Ee.key))]})]}),e.jsx("button",{onClick:()=>T(!D),className:`px-3 py-1 rounded text-xs font-medium transition-colors ${D?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:D?"Normal View":"Compact View"}),e.jsx("button",{onClick:()=>A(!Y),className:`px-3 py-1 rounded text-xs font-medium transition-colors ${Y?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:Y?"View Mode":"Edit Mode"})]})]})]}),C.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-yellow-800 mb-2 flex items-center gap-2",children:[e.jsx(dr,{className:"w-4 h-4"}),"Validation Warnings (",C.length," rows will be skipped):"]}),e.jsx("div",{className:"max-h-32 overflow-y-auto",children:e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[C.slice(0,10).map((Ee,Oe)=>e.jsxs("li",{children:["• ",Ee]},Oe)),C.length>10&&e.jsxs("li",{className:"text-yellow-600",children:["... and ",C.length-10," more warnings"]})]})}),e.jsxs("div",{className:"mt-3 p-2 bg-yellow-100 rounded text-sm text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," Rows with validation errors will be automatically skipped during import. Valid customers will still be imported successfully."]})]}),Y&&e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:()=>{const Ee={name:"",email:"",phone:"",gender:"other",city:"",whatsapp:"",birthMonth:"",birthDay:"",referralSource:"",notes:"",loyaltyLevel:"bronze",colorTag:"new"};_([...Z,Ee])},className:"px-3 py-1 bg-gray-100 text-gray-700 rounded text-xs font-medium hover:bg-gray-200 transition-colors",children:"+ Add Row"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:`w-full ${D?"text-xs":"text-sm"} min-w-full`,children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:`text-left ${D?"p-1":"p-2"} ${D?z.has("name")?"w-32":"w-20":""} ${Y?"min-w-32":""}`,children:"Name"}),e.jsx("th",{className:`text-left ${D?"p-1":"p-2"} ${D?z.has("phone")?"w-32":"w-24":""} ${Y?"min-w-36":""}`,children:"Phone"}),e.jsx("th",{className:`text-left ${D?"p-1":"p-2"} ${D?"w-16":""} ${Y?"min-w-20":""}`,children:"Gender"}),e.jsx("th",{className:`text-left ${D?"p-1":"p-2"} ${D?z.has("city")?"w-32":"w-20":""} ${Y?"min-w-28":""}`,children:"City"}),e.jsx("th",{className:`text-left ${D?"p-1":"p-2"} ${D?z.has("whatsapp")?"w-32":"w-20":""} ${Y?"min-w-32":""}`,children:"WhatsApp"}),e.jsx("th",{className:`text-left ${D?"p-1":"p-2"} ${D?"w-20":""} ${Y?"min-w-24":""}`,children:"Birthday"}),e.jsx("th",{className:`text-left ${D?"p-1":"p-2"} ${D?z.has("referral")?"w-32":"w-16":""} ${Y?"min-w-32":""}`,children:"Referral"}),e.jsx("th",{className:`text-left ${D?"p-1":"p-2"} ${D?z.has("notes")?"w-40":"w-20":""} ${Y?"min-w-48":""}`,children:"Notes"}),e.jsx("th",{className:`text-left ${D?"p-1":"p-2"} ${D?"w-16":""} ${Y?"min-w-20":""}`,children:"Loyalty"}),e.jsx("th",{className:`text-left ${D?"p-1":"p-2"} ${D?"w-16":""} ${Y?"min-w-20":""}`,children:"Color Tag"}),Y&&e.jsx("th",{className:`text-left ${D?"p-1":"p-2"} ${D?"w-12":""} ${Y?"min-w-16":""}`,children:"Actions"})]})}),e.jsx("tbody",{children:(Y?Z:b.length>0?b:x).map((Ee,Oe)=>e.jsxs("tr",{className:`border-b ${ye(Ee,Oe).length>0?"bg-yellow-50":""}`,children:[e.jsxs("td",{className:`${D?"p-1":"p-2"} relative ${Q(Ee,Oe,"name")?"bg-yellow-100 border-l-4 border-yellow-500":""}`,children:[Q(Ee,Oe,"name")&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"⚠️"})}),Y?e.jsx("input",{type:"text",value:Ee.name||"",onChange:Xe=>{const Be=[...Z];Be[Oe].name=Xe.target.value,_(Be)},className:"w-full bg-transparent border-none outline-none text-sm focus:bg-white focus:border focus:border-blue-300 focus:rounded px-1 py-0.5"}):e.jsx("span",{className:Q(Ee,Oe,"name")?"text-yellow-800":"",children:Ee.name||(Q(Ee,Oe,"name")?"⚠️ Required":"")})]}),e.jsxs("td",{className:`${D?"p-1":"p-2"} relative ${Q(Ee,Oe,"phone")?"bg-yellow-100 border-l-4 border-yellow-500":""}`,children:[Q(Ee,Oe,"phone")&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"⚠️"})}),Y?e.jsx("input",{type:"text",value:Ee.phone||"",onChange:Xe=>{const Be=[...Z];Be[Oe].phone=Xe.target.value,_(Be)},className:"w-full bg-transparent border-none outline-none text-sm focus:bg-white focus:border focus:border-blue-300 focus:rounded px-1 py-0.5"}):e.jsx("span",{className:Q(Ee,Oe,"phone")?"text-yellow-800":"",children:Ee.phone||(Q(Ee,Oe,"phone")?"⚠️ Required":"")})]}),e.jsx("td",{className:`${D?"p-1":"p-2"}`,children:Y?e.jsxs("select",{value:Ee.gender||"other",onChange:Xe=>{const Be=[...Z];Be[Oe].gender=Xe.target.value,_(Be)},className:"w-full bg-transparent border-none outline-none text-sm focus:bg-white focus:border focus:border-blue-300 focus:rounded px-1 py-0.5 capitalize",children:[e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]}):e.jsx("span",{className:"capitalize",children:Ee.gender})}),e.jsx("td",{className:`${D?"p-1":"p-2"}`,children:Y?e.jsx("input",{type:"text",value:Ee.city||"",onChange:Xe=>{const Be=[...Z];Be[Oe].city=Xe.target.value,_(Be)},className:"w-full bg-transparent border-none outline-none text-sm focus:bg-white focus:border focus:border-blue-300 focus:rounded px-1 py-0.5"}):Ee.city}),e.jsx("td",{className:`${D?"p-1":"p-2"}`,children:Y?e.jsx("input",{type:"text",value:Ee.whatsapp||"",onChange:Xe=>{const Be=[...Z];Be[Oe].whatsapp=Xe.target.value,_(Be)},className:"w-full bg-transparent border-none outline-none text-sm focus:bg-white focus:border focus:border-blue-300 focus:rounded px-1 py-0.5"}):Ee.whatsapp||"-"}),e.jsx("td",{className:`${D?"p-1":"p-2"}`,children:Y?e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{type:"text",placeholder:"Month",value:Ee.birthMonth||"",onChange:Xe=>{const Be=[...Z];Be[Oe].birthMonth=Xe.target.value,_(Be)},className:"w-20 bg-transparent border-none outline-none text-sm focus:bg-white focus:border focus:border-blue-300 focus:rounded px-1 py-0.5"}),e.jsx("input",{type:"number",placeholder:"Day",min:"1",max:"31",value:Ee.birthDay||"",onChange:Xe=>{const Be=[...Z];Be[Oe].birthDay=Xe.target.value,_(Be)},className:"w-16 bg-transparent border-none outline-none text-sm focus:bg-white focus:border focus:border-blue-300 focus:rounded px-1 py-0.5"})]}):Ee.birthMonth&&Ee.birthDay?`${Ee.birthMonth} ${Ee.birthDay}`:"-"}),e.jsx("td",{className:`${D?"p-1":"p-2"}`,children:Y?e.jsx("input",{type:"text",value:Ee.referralSource||"",onChange:Xe=>{const Be=[...Z];Be[Oe].referralSource=Xe.target.value,_(Be)},className:"w-full bg-transparent border-none outline-none text-sm focus:bg-white focus:border focus:border-blue-300 focus:rounded px-1 py-0.5"}):Ee.referralSource||"-"}),e.jsx("td",{className:`${D?"p-1":"p-2"}`,children:Y?e.jsx("textarea",{value:Ee.notes||"",onChange:Xe=>{const Be=[...Z];Be[Oe].notes=Xe.target.value,_(Be)},className:"w-full bg-transparent border-none outline-none text-sm focus:bg-white focus:border focus:border-blue-300 focus:rounded px-1 py-0.5 resize-none",rows:1,placeholder:"Notes..."}):e.jsx("span",{className:"text-xs text-gray-600 max-w-xs truncate block",title:Ee.notes,children:Ee.notes||"-"})}),e.jsx("td",{className:`${D?"p-1":"p-2"}`,children:Y?e.jsxs("select",{value:Ee.loyaltyLevel||"bronze",onChange:Xe=>{const Be=[...Z];Be[Oe].loyaltyLevel=Xe.target.value,_(Be)},className:"w-full bg-transparent border-none outline-none text-sm focus:bg-white focus:border focus:border-blue-300 focus:rounded px-1 py-0.5 capitalize",children:[e.jsx("option",{value:"bronze",children:"Bronze"}),e.jsx("option",{value:"silver",children:"Silver"}),e.jsx("option",{value:"gold",children:"Gold"}),e.jsx("option",{value:"platinum",children:"Platinum"})]}):e.jsx("span",{className:"capitalize",children:Ee.loyaltyLevel})}),e.jsx("td",{className:`${D?"p-1":"p-2"}`,children:Y?e.jsxs("select",{value:Ee.colorTag||"new",onChange:Xe=>{const Be=[...Z];Be[Oe].colorTag=Xe.target.value,_(Be)},className:"w-full bg-transparent border-none outline-none text-sm focus:bg-white focus:border focus:border-blue-300 focus:rounded px-1 py-0.5 capitalize",children:[e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"vip",children:"VIP"}),e.jsx("option",{value:"complainer",children:"Complainer"}),e.jsx("option",{value:"purchased",children:"Purchased"})]}):e.jsx("span",{className:"capitalize",children:Ee.colorTag})}),Y&&e.jsx("td",{className:`${D?"p-1":"p-2"}`,children:e.jsx("button",{onClick:()=>{const Xe=[...Z];Xe.splice(Oe,1),_(Xe)},className:"text-red-600 hover:text-red-800 text-sm",title:"Remove row",children:"✕"})})]},Oe))})]})})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>E("upload"),className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:"Back"}),e.jsx("button",{onClick:()=>E("import"),className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm font-medium transition-colors",children:C.length>0?"Continue (Skip Invalid Rows)":"Continue to Import"})]})]}),k==="import"&&e.jsxs("div",{className:"space-y-6",children:[I?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Importing Customers"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Progress: ",Math.round(v),"% (",F.length,"/",x.length,")"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${v}%`}})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center",children:[e.jsx(yt,{className:"w-12 h-12 mx-auto text-green-500 mb-2"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Import Complete"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Import results for ",x.length," customers"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-1",children:"Successful"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:F.filter(Ee=>Ee.success).length})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-1",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:F.filter(Ee=>!Ee.success).length})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-1",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:F.length})]})]}),F.filter(Ee=>!Ee.success).length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-2",children:"Failed Imports:"}),e.jsx("div",{className:"max-h-32 overflow-y-auto",children:e.jsx("ul",{className:"text-sm text-red-700 space-y-1",children:F.filter(Ee=>!Ee.success).map((Ee,Oe)=>e.jsxs("li",{children:["Row ",Ee.rowNumber,": ",Ee.error]},Oe))})})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(X,{onClick:()=>E("preview"),variant:"secondary",className:"flex-1",disabled:I,children:"Back"}),e.jsx(X,{onClick:Ct,disabled:I||C.length>0,className:"flex-1",children:I?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(yt,{className:"w-4 h-4 mr-2"}),"Import Customers"]})})]})]})]})})},Oh=({isOpen:r,onClose:a,onImportComplete:i})=>{console.log("CustomerUpdateImportModal render - isOpen:",r);const{currentUser:c}=Wt(),[m,u]=g.useState(null),[x,j]=g.useState([]),[b,f]=g.useState([]),[y,N]=g.useState(!1),[I,R]=g.useState(!1),[k,E]=g.useState("upload"),[v,U]=g.useState(0),[F,L]=g.useState([]),[C,$]=g.useState([]),[Y,A]=g.useState(new Map),[Z,_]=g.useState(new Map),[D,T]=g.useState(!0),[z,se]=g.useState([]),[q,H]=g.useState(!0),J=g.useRef(null),V=Sn,ge=ol,He=Ce=>{if(!Ce)return"";const Ze=Ce.trim();return Ze===Ze.toUpperCase()&&Ze.length>1?Ze.toLowerCase().replace(/\b\w/g,$e=>$e.toUpperCase()):Ze===Ze.toUpperCase()?Ze.toLowerCase().replace(/\b\w/g,$e=>$e.toUpperCase()):Ze},B=Ce=>{if(!Ce)return"male";const Ze=Ce.trim().toLowerCase();return Ze==="male"||Ze==="m"?"male":Ze==="female"||Ze==="f"?"female":Ze==="other"||Ze==="o"?"other":"male"},fe=Ce=>{if(!Ce)return"";const Ze=Ce.trim().toLowerCase();return{instagram:"Instagram",facebook:"Facebook",twitter:"Twitter",tiktok:"TikTok",friend:"Friend",family:"Family","walk-in":"Walk-in",walkin:"Walk-in","walk in":"Walk-in","social media":"Social Media",socialmedia:"Social Media",google:"Google",search:"Google",website:"Website",referral:"Referral","word of mouth":"Word of Mouth",wordofmouth:"Word of Mouth",advertisement:"Advertisement",ad:"Advertisement",flyer:"Flyer",poster:"Poster",radio:"Radio",tv:"TV",newspaper:"Newspaper",magazine:"Magazine",other:"Other"}[Ze]||Ce.trim()},re=Ce=>{if(!Ce)return"";const Ze=Ce.trim();return Ze===Ze.toUpperCase()&&Ze.length>1?Ze.toLowerCase().replace(/\b\w/g,$e=>$e.toUpperCase()):Ze===Ze.toUpperCase()?Ze.toLowerCase().replace(/\b\w/g,$e=>$e.toUpperCase()):Ze},ye=Ce=>{if(!Ce)return{month:"",day:""};const Ze=Ce.trim(),$e=Ze.split("/");if($e.length===2){const[ue,Ye]=$e,ae=parseInt(ue),ke=parseInt(Ye);if(ae>12&&ke<=12)return{month:Ye,day:ue};if(ke>12&&ae<=12)return{month:ue,day:Ye};if(ae<=12&&ke<=31)return{month:ue,day:Ye}}const K=["january","february","march","april","may","june","july","august","september","october","november","december"],be=Ze.toLowerCase();for(let ue=0;ue<K.length;ue++)if(be.includes(K[ue])){const Ye=(ue+1).toString(),ae=Ze.match(/\d+/),ke=ae?ae[0]:"";return{month:Ye,day:ke}}return{month:"",day:""}},Q=Ce=>{if(!Ce)return"new";const Ze=Ce.trim().toLowerCase();return{new:"new",vip:"vip",complainer:"complainer",purchased:"purchased",normal:"new",regular:"new",standard:"new",basic:"new",premium:"vip",important:"vip",priority:"vip",problem:"complainer",issue:"complainer",buyer:"purchased",customer:"purchased",buying:"purchased"}[Ze]||"new"},Le=async Ce=>{try{console.log("🔍 Loading existing customers for matching...");const Ze=await yn(),$e=new Map,K=new Map,be=new Map,ue=new Map,Ye=new Map;Ze.forEach(Ke=>{if(Ke.phone){const le=Ke.phone.replace(/[^0-9]/g,"");be.set(le,Ke)}if(Ke.whatsapp){const le=Ke.whatsapp.replace(/[^0-9]/g,"");ue.set(le,Ke)}Ke.email&&Ye.set(Ke.email.toLowerCase(),Ke)}),console.log(`📊 Loaded ${Ze.length} existing customers`),console.log(`📱 Phone matches available: ${be.size}`),console.log(`💬 WhatsApp matches available: ${ue.size}`),console.log(`📧 Email matches available: ${Ye.size}`),Ce.forEach(Ke=>{var vt;const le=Ke.phone.replace(/[^0-9]/g,""),Ne=((vt=Ke.whatsapp)==null?void 0:vt.replace(/[^0-9]/g,""))||"",Te=Ke.email.toLowerCase();let Qe=be.get(le)||ue.get(le)||ue.get(Ne)||Ye.get(Te);Qe&&K.set(Ke.phone,Qe)}),A($e),_(K);const ae=K.size,ke=Ce.length;return console.log(`✅ Matched ${ae} out of ${ke} imported customers with existing records`),K}catch(Ze){return console.error("❌ Error checking existing customers:",Ze),te.error("Failed to load existing customers"),new Map}},Ue=(Ce,Ze)=>{const $e=[];return(!Ce.name||Ce.name.trim().length<2)&&$e.push("Name must be at least 2 characters"),(!Ce.phone||Ce.phone.trim().length<10)&&$e.push("Phone number must be at least 10 digits"),Ce.email&&!Ce.email.includes("@")&&$e.push("Invalid email format"),Ce.birthDay&&(parseInt(Ce.birthDay)<1||parseInt(Ce.birthDay)>31)&&$e.push("Birth day must be between 1 and 31"),Ce.birthMonth&&(parseInt(Ce.birthMonth)<1||parseInt(Ce.birthMonth)>12)&&$e.push("Birth month must be between 1 and 12"),$e},Ct=(Ce,Ze)=>{const $e=["email","gender","city","whatsapp","birthMonth","birthDay","referralSource","locationDescription","nationalId","referredBy"];for(const K of $e){const be=Ce[K],ue=Ze[K];if(be&&!ue)return!0}return!1},Re=Ce=>{var $e;const Ze=($e=Ce.target.files)==null?void 0:$e[0];Ze&&(u(Ze),ut(Ze))},ut=async Ce=>{var Ze,$e,K;try{N(!0),$([]);const ue=(await Ce.text()).split(`
`).filter(Ne=>Ne.trim());if(ue.length<2){te.error("File must contain at least a header row and one data row");return}const Ye=((Ze=ue[0])==null?void 0:Ze.split(",").map(Ne=>Ne.trim().toLowerCase()))||[],ae=[],ke=[];for(let Ne=1;Ne<ue.length;Ne++){const Te=ue[Ne].trim();if(!Te)continue;const Qe=Te.split(",").map(de=>de.trim().replace(/^"|"$/g,"")),vt=Qe[Ye.indexOf("phone")]||Qe[Ye.indexOf("phone number")]||Qe[Ye.indexOf("mobile")]||Qe[Ye.indexOf("mobile phone")]||Qe[Ye.indexOf("primary phone")]||Qe[Ye.indexOf("phone 1 - value")]||"",Rt=Qe[Ye.indexOf("whatsapp")]||Qe[Ye.indexOf("whatsapp number")]||"",ht={name:He(Qe[Ye.indexOf("name")]||""),email:Qe[Ye.indexOf("email")]||"",phone:V(vt),gender:B(Qe[Ye.indexOf("gender")]||""),city:re(Qe[Ye.indexOf("city")]||""),whatsapp:ge(Rt),notes:Qe[Ye.indexOf("notes")]||Qe[Ye.indexOf("initial notes")]||"",loyaltyLevel:Qe[Ye.indexOf("loyalty level")]||"bronze",colorTag:Q(Qe[Ye.indexOf("color tag")]||""),referralSource:fe(Qe[Ye.indexOf("referral source")]||""),locationDescription:Qe[Ye.indexOf("location description")]||"",nationalId:Qe[Ye.indexOf("national id")]||"",referredBy:Qe[Ye.indexOf("referred by")]||"",totalSpent:parseFloat(Qe[Ye.indexOf("total spent")]||"0")||0,points:parseInt(Qe[Ye.indexOf("points")]||"0")||0,isActive:(($e=Qe[Ye.indexOf("is active")])==null?void 0:$e.toLowerCase())==="yes"||((K=Qe[Ye.indexOf("is active")])==null?void 0:K.toLowerCase())==="true",profileImage:Qe[Ye.indexOf("profile image")]||""},Se=Qe[Ye.indexOf("birth month")]||Qe[Ye.indexOf("birthday")]||"";if(Se){const{month:de,day:me}=ye(Se);ht.birthMonth=de,ht.birthDay=me}const ve=Ue(ht,Ne+2);ve.length>0&&ke.push(`Row ${Ne+2}: ${ve.join(", ")}`),ae.push(ht)}j(ae),$(ke);const Ke=await Le(ae),le=ae.filter(Ne=>Ke.has(Ne.phone));se(le),f(le),console.log(`📊 Processed ${ae.length} customers from CSV`),console.log(`✅ Found ${Ke.size} existing customers to update`),console.log(`⚠️ ${ke.length} validation errors found`),Ke.size===0?te.warning("No existing customers found to update. Make sure phone numbers match existing records."):te.success(`Found ${Ke.size} existing customers to update`),E("preview")}catch(be){console.error("❌ Error processing CSV file:",be),te.error("Failed to process CSV file")}finally{N(!1)}},Ee=async()=>{var Ze;if((c==null?void 0:c.role)!=="admin"){te.error("Only administrators can update customers via CSV import.");return}const Ce=z;if(Ce.length===0){te.error("No customers to update. Please ensure you have matched customers.");return}try{R(!0),U(0),L([]);const $e=[],K=[];for(let ae=0;ae<Ce.length;ae++){const ke=Ce[ae],Ke=Z.get(ke.phone);if(!Ke){K.push({success:!1,error:"No existing customer found to update",rowNumber:ae+2,skipped:!0,reason:"No match found"});continue}if(!Ct(ke,Ke)){K.push({success:!1,error:"No null fields to update",rowNumber:ae+2,skipped:!0,reason:"No updates needed",existingCustomer:Ke});continue}try{const le={};if(ke.email&&!Ke.email&&(le.email=ke.email),ke.gender&&!Ke.gender&&(le.gender=ke.gender),ke.city&&!Ke.city&&(le.city=ke.city),ke.whatsapp&&!Ke.whatsapp&&(le.whatsapp=ke.whatsapp),ke.birthMonth&&!Ke.birthMonth&&(le.birthMonth=ke.birthMonth),ke.birthDay&&!Ke.birthDay&&(le.birthDay=ke.birthDay),ke.referralSource&&!Ke.referralSource&&(le.referralSource=ke.referralSource),ke.locationDescription&&!Ke.locationDescription&&(le.locationDescription=ke.locationDescription),ke.nationalId&&!Ke.nationalId&&(le.nationalId=ke.nationalId),ke.referredBy&&!Ke.referredBy&&(le.referredBy=ke.referredBy),ke.notes&&!((Ze=Ke.notes)!=null&&Ze.length))try{await G.from("customer_notes").insert({id:crypto.randomUUID(),content:ke.notes,created_by:c.id,created_at:new Date().toISOString(),customer_id:Ke.id})}catch(Ne){console.warn("Could not add note:",Ne)}if(Object.keys(le).length>0){const Ne=await Fa(Ke.id,le);Ne?($e.push(Ne),K.push({success:!0,customer:Ne,rowNumber:ae+2,existingCustomer:Ke})):K.push({success:!1,error:"Failed to update customer",rowNumber:ae+2,existingCustomer:Ke})}else K.push({success:!1,error:"No fields to update",rowNumber:ae+2,skipped:!0,reason:"All fields already populated",existingCustomer:Ke})}catch(le){console.error(`Error updating customer ${ke.name}:`,le),K.push({success:!1,error:le instanceof Error?le.message:"Unknown error",rowNumber:ae+2,existingCustomer:Ke})}U((ae+1)/Ce.length*100)}L(K);const be=K.filter(ae=>ae.success).length,ue=K.filter(ae=>ae.skipped).length,Ye=K.filter(ae=>!ae.success&&!ae.skipped).length;console.log(`✅ Import completed: ${be} updated, ${ue} skipped, ${Ye} errors`),be>0&&(te.success(`Successfully updated ${be} customers`),i($e)),Ye>0&&te.error(`${Ye} customers failed to update`),E("import")}catch($e){console.error("❌ Error during import:",$e),te.error("Failed to import customers")}finally{R(!1)}},Oe=()=>{u(null),j([]),f([]),se([]),L([]),$([]),E("upload"),U(0),A(new Map),_(new Map),T(!0),H(!0),J.current&&(J.current.value=""),a()},Xe=()=>{const Ce=`Name,Email,Phone,Gender,City,WhatsApp,Notes,Loyalty Level,Color Tag,Referral Source,Location Description,National ID,Referred By,Birth Month,Birth Day
John Doe,john@example.com,+255123456789,male,Dar es Salaam,+255123456789,New customer notes,bronze,normal,Instagram,City Center,123456789,John Smith,January,15
Jane Smith,jane@example.com,+255987654321,female,Arusha,+255987654321,Another customer,bronze,vip,Friend,Suburb Area,987654321,Jane Doe,March,22`,Ze=new Blob([Ce],{type:"text/csv"}),$e=window.URL.createObjectURL(Ze),K=document.createElement("a");K.href=$e,K.download="customer_update_template.csv",document.body.appendChild(K),K.click(),document.body.removeChild(K),window.URL.revokeObjectURL($e)},Be=()=>{if(T(!D),D)se(x),f(x);else{const Ce=x.filter(Ze=>Z.has(Ze.phone));se(Ce),f(Ce)}};return g.useEffect(()=>{const Ce=()=>{window.innerWidth<768&&H(!1)};return Ce(),window.addEventListener("resize",Ce),()=>window.removeEventListener("resize",Ce)},[]),r||console.log("CustomerUpdateImportModal: not showing because isOpen is false"),console.log("CustomerUpdateImportModal: rendering modal content"),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs(he,{className:"w-full max-w-7xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/20",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(us,{className:"w-6 h-6 text-blue-400"}),e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Update Customers from CSV"})]}),e.jsx("button",{onClick:Oe,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(tr,{className:"w-6 h-6 text-white"})})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[q&&e.jsx("div",{className:"w-80 bg-white/5 border-r border-white/20 p-4 overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[k==="upload"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-8 border-2 border-dashed border-white/30 rounded-lg",children:[e.jsx(Lr,{className:"w-12 h-12 text-white/60 mx-auto mb-4"}),e.jsx("p",{className:"text-white/80 mb-4",children:"Upload CSV file to update existing customers"}),e.jsx("input",{ref:J,type:"file",accept:".csv",onChange:Re,className:"hidden"}),e.jsx(X,{onClick:()=>{var Ce;return(Ce=J.current)==null?void 0:Ce.click()},className:"w-full",disabled:y,children:y?"Processing...":"Choose CSV File"})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs(X,{onClick:Xe,variant:"outline",className:"w-full",children:[e.jsx(Br,{className:"w-4 h-4 mr-2"}),"Download Template"]})})]}),k==="preview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Preview"}),e.jsx(X,{onClick:Be,variant:"outline",size:"sm",children:D?"Show All":"Show Matched Only"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-white/60",children:["Total: ",x.length]}),e.jsxs("div",{className:"text-sm text-green-400",children:["Matched: ",Z.size]}),e.jsxs("div",{className:"text-sm text-yellow-400",children:["Unmatched: ",x.length-Z.size]})]}),C.length>0&&e.jsxs("div",{className:"bg-yellow-500/20 border border-yellow-500/30 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(dr,{className:"w-4 h-4 text-yellow-400"}),e.jsxs("span",{className:"text-sm font-medium text-yellow-400",children:[C.length," Validation Errors"]})]}),e.jsxs("div",{className:"text-xs text-yellow-300 max-h-32 overflow-y-auto",children:[C.slice(0,5).map((Ce,Ze)=>e.jsxs("div",{className:"mb-1",children:["• ",Ce]},Ze)),C.length>5&&e.jsxs("div",{className:"text-yellow-400",children:["... and ",C.length-5," more"]})]})]}),e.jsx(X,{onClick:Ee,className:"w-full",disabled:Z.size===0||I,children:I?"Updating...":`Update ${Z.size} Customers`})]}),k==="import"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Import Results"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-green-400",children:["Updated: ",F.filter(Ce=>Ce.success).length]}),e.jsxs("div",{className:"text-sm text-yellow-400",children:["Skipped: ",F.filter(Ce=>Ce.skipped).length]}),e.jsxs("div",{className:"text-sm text-red-400",children:["Errors: ",F.filter(Ce=>!Ce.success&&!Ce.skipped).length]})]}),e.jsx(X,{onClick:Oe,className:"w-full",children:"Close"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[I&&e.jsx("div",{className:"p-4 border-b border-white/20",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-1 bg-white/10 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${v}%`}})}),e.jsxs("span",{className:"text-sm text-white/60",children:[Math.round(v),"%"]})]})}),e.jsxs("div",{className:"h-full overflow-y-auto p-6",children:[k==="upload"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(pr,{className:"w-16 h-16 text-white/40 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Update Existing Customers"}),e.jsx("p",{className:"text-white/60 max-w-md mx-auto",children:"Upload a CSV file to update existing customer records. Only null fields in existing customers will be updated."})]}),k==="preview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-semibold text-white",children:["Preview (",z.length," customers)"]}),e.jsx("button",{onClick:()=>H(!q),className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:q?e.jsx($d,{className:"w-5 h-5"}):e.jsx(cs,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"bg-white/5 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-white/80",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-white/80",children:"Phone"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-white/80",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-white/80",children:"City"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-white/80",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:z.map((Ce,Ze)=>{const $e=Z.get(Ce.phone),K=$e?Ct(Ce,$e):!1;return e.jsxs("tr",{className:"hover:bg-white/5",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-white",children:Ce.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-white/80",children:Ce.phone}),e.jsx("td",{className:"px-4 py-3 text-sm text-white/80",children:Ce.email||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-white/80",children:Ce.city||"-"}),e.jsx("td",{className:"px-4 py-3",children:$e?K?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-500/20 text-green-400",children:[e.jsx(yt,{className:"w-3 h-3 mr-1"}),"Will Update"]}):e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-500/20 text-yellow-400",children:[e.jsx($n,{className:"w-3 h-3 mr-1"}),"No Updates"]}):e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-500/20 text-red-400",children:[e.jsx(dr,{className:"w-3 h-3 mr-1"}),"No Match"]})})]},Ze)})})]})})})]}),k==="import"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Import Results"}),e.jsx("div",{className:"bg-white/5 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-white/80",children:"Row"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-white/80",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-white/80",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-white/80",children:"Details"})]})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:F.map((Ce,Ze)=>{var $e;return e.jsxs("tr",{className:"hover:bg-white/5",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-white/80",children:Ce.rowNumber}),e.jsx("td",{className:"px-4 py-3 text-sm text-white",children:(($e=Ce.existingCustomer)==null?void 0:$e.name)||"Unknown"}),e.jsx("td",{className:"px-4 py-3",children:Ce.success?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-500/20 text-green-400",children:[e.jsx(yt,{className:"w-3 h-3 mr-1"}),"Updated"]}):Ce.skipped?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-500/20 text-yellow-400",children:[e.jsx($n,{className:"w-3 h-3 mr-1"}),"Skipped"]}):e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-500/20 text-red-400",children:[e.jsx(dr,{className:"w-3 h-3 mr-1"}),"Error"]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-white/60",children:Ce.error||Ce.reason||"Success"})]},Ze)})})]})})})]})]})]})]})]})})},Yc="customersPagePrefs",Ph=()=>{if(typeof window>"u")return{};try{const r=localStorage.getItem(Yc);return r?JSON.parse(r):{}}catch{return{}}},Fh=()=>{const{currentUser:r}=Wt(),a=hs(),{markCustomerAsRead:i}=Ur(),c=Ph(),[m,u]=g.useState(c.searchQuery??""),[x,j]=g.useState(c.loyaltyFilter??"all"),[b,f]=g.useState(c.statusFilter??"all"),[y,N]=g.useState(c.showInactive??!1),[I,R]=g.useState(c.showAdvancedFilters??!1),[k,E]=g.useState([]),[v,U]=g.useState(c.viewMode??"grid"),[F,L]=g.useState(!1),[C,$]=g.useState(!1),[Y,A]=g.useState(!1),[Z,_]=g.useState(!1),[D,T]=g.useState([]),[z,se]=g.useState(!0),[q,H]=g.useState(null),[J,V]=g.useState(!navigator.onLine),[ge,He]=g.useState(c.sortBy??"name"),[B,fe]=g.useState([]),[re,ye]=g.useState([]),[Q,Le]=g.useState([]),[Ue,Ct]=g.useState([]),[Re,ut]=g.useState(!1),[Ee,Oe]=g.useState(!1);g.useEffect(()=>{localStorage.setItem(Yc,JSON.stringify({searchQuery:m,loyaltyFilter:x,statusFilter:b,showInactive:y,showAdvancedFilters:I,viewMode:v,sortBy:ge}))},[m,x,b,y,I,v,ge]),g.useEffect(()=>{(async()=>{try{se(!0);const Qe=await yn();T(Qe)}catch(Qe){H(Qe.message||"Failed to load customers")}finally{se(!1)}})();const Ne=()=>V(!1),Te=()=>V(!0);return window.addEventListener("online",Ne),window.addEventListener("offline",Te),()=>{window.removeEventListener("online",Ne),window.removeEventListener("offline",Te)}},[]);const Xe=g.useMemo(()=>{const le=D.length,Ne=D.filter(Ae=>Ae.isActive).length,Te=D.filter(Ae=>Ae.colorTag==="vip").length,Qe=D.reduce((Ae,it)=>{var kt;const St=((kt=it.payments)==null?void 0:kt.filter(et=>et.status==="completed"))||[];return Ae+St.reduce((et,xs)=>et+(xs.amount||0),0)},0),vt=D.reduce((Ae,it)=>Ae+(it.points||0),0),Rt=D.filter(Ae=>Ae.loyaltyLevel==="platinum").length,ht=D.filter(Ae=>Ae.loyaltyLevel==="gold").length,Se=D.filter(Ae=>Ae.loyaltyLevel==="silver").length,ve=D.filter(Ae=>Ae.loyaltyLevel==="bronze").length,de=D.reduce((Ae,it)=>{var St;return Ae+(((St=it.devices)==null?void 0:St.length)||0)},0),me=D.reduce((Ae,it)=>{var kt;const St=((kt=it.devices)==null?void 0:kt.filter(et=>et.status==="in-repair"||et.status==="diagnosis-started"))||[];return Ae+St.length},0);return{totalCustomers:le,activeCustomers:Ne,vipCustomers:Te,totalRevenue:Qe,totalPoints:vt,platinumCustomers:Rt,goldCustomers:ht,silverCustomers:Se,bronzeCustomers:ve,totalDevices:de,devicesInRepair:me}},[D]),Be=g.useMemo(()=>{let le=D;if(m.trim()){const Ne=m.toLowerCase().trim();le=le.filter(Te=>[Te.name,Te.phone,Te.city,Te.email].filter(Boolean).some(vt=>vt.toLowerCase().includes(Ne)))}return B.length>0&&(le=le.filter(Ne=>Ne.loyaltyLevel&&B.includes(Ne.loyaltyLevel))),re.length>0&&(le=le.filter(Ne=>{const Te=Ne.isActive?"active":"inactive";return re.includes(Te)})),Q.length>0&&(le=le.filter(Ne=>Ne.colorTag&&Q.includes(Ne.colorTag))),Ue.length>0&&(le=le.filter(Ne=>Ne.referralSource&&Ue.includes(Ne.referralSource))),Re&&(le=le.filter(Ne=>Ne.birthMonth||Ne.birthDay)),Ee&&(le=le.filter(Ne=>Ne.whatsapp&&Ne.whatsapp.trim()!=="")),y&&(le=le.filter(Ne=>{if(!Ne.lastVisit)return!1;const Te=new Date(Ne.lastVisit),Qe=new Date(Date.now()-90*24*60*60*1e3);return Te<Qe})),[...le].sort((Ne,Te)=>{switch(ge){case"name":return(Ne.name||"").localeCompare(Te.name||"");case"recent":return new Date(Te.joinedDate||0).getTime()-new Date(Ne.joinedDate||0).getTime();case"spent":const Qe=Ne.totalSpent??(Ne.payments?Ne.payments.reduce((Rt,ht)=>Rt+(ht.amount||0),0):0);return(Te.totalSpent??(Te.payments?Te.payments.reduce((Rt,ht)=>Rt+(ht.amount||0),0):0))-Qe;case"points":return(Te.points||0)-(Ne.points||0);default:return 0}})},[D,m,B,re,Q,Ue,Re,Ee,y,ge]),Ce=le=>{switch(le){case"vip":return"bg-emerald-500/20 text-emerald-700 border-emerald-300/30";case"complainer":return"bg-rose-500/20 text-rose-700 border-rose-300/30";case"purchased":return"bg-blue-500/20 text-blue-700 border-blue-300/30";case"new":return"bg-purple-500/20 text-purple-700 border-purple-300/30";default:return"bg-gray-500/20 text-gray-700 border-gray-300/30"}},Ze=le=>{switch(le){case"platinum":return"bg-purple-500/20 text-purple-700 border-purple-300/30";case"gold":return"bg-amber-500/20 text-amber-700 border-amber-300/30";case"silver":return"bg-gray-400/20 text-gray-700 border-gray-300/30";default:return"bg-orange-500/20 text-orange-700 border-orange-300/30"}},$e=le=>{if(k.length===0){te.error("Please select customers first");return}switch(le){case"export":te.success(`Exported ${k.length} customers`);break;case"message":te.success(`Message sent to ${k.length} customers`);break;case"delete":te.success(`Deleted ${k.length} customers`);break}E([])},K=le=>{E(Ne=>Ne.includes(le)?Ne.filter(Te=>Te!==le):[...Ne,le])},be=()=>{k.length===Be.length?E([]):E(Be.map(le=>le.id))},ue=async(le,Ne)=>{if(!r){te.error("You must be logged in to send SMS");return}$(!0);try{const Qe=await new xc().sendBulkSMSToCustomers(le.map(vt=>({id:vt.id,phone:vt.phone,name:vt.name})),Ne,r.id);Qe.success?te.success(`SMS sent successfully to all ${Qe.totalSent} customers!`):Qe.totalSent>0?te.success(`SMS sent to ${Qe.totalSent} customers, ${Qe.totalFailed} failed.`):te.error(`Failed to send SMS to any customers. ${Qe.totalFailed} errors.`)}catch(Te){console.error("BulkSMS Error:",Te),te.error("Failed to send bulk SMS. Please try again.")}finally{$(!1),L(!1)}},Ye=le=>{T(Ne=>[...Ne,...le]),A(!1),te.success(`Successfully imported ${le.length} customers`)},ae=le=>{T(Ne=>Ne.map(Te=>le.find(vt=>vt.id===Te.id)||Te)),_(!1),te.success(`Successfully updated ${le.length} customers`)},ke=le=>{const Ne=D.find(Te=>Te.id===le);return!Ne||!Ne.payments?0:Ne.payments.filter(Te=>Te.status==="completed").reduce((Te,Qe)=>Te+(Qe.amount||0),0)},Ke=le=>{const Ne=D.find(vt=>vt.id===le);if(!Ne||!Ne.devices)return{count:0,lastActivity:"No devices"};const Te=Ne.devices.length;let Qe="";if(Te>0){const vt=Ne.devices.reduce((de,me)=>{const Ae=new Date(me.updatedAt||me.createdAt),it=new Date(de.updatedAt||de.createdAt);return Ae>it?me:de},Ne.devices[0]),Rt=new Date(vt.updatedAt||vt.createdAt),Se=new Date().getTime()-Rt.getTime(),ve=Math.floor(Se/(1e3*60*60*24));ve===0?Qe="Today":ve===1?Qe="1 day ago":Qe=`${ve} days ago`}else Qe="No devices";return{count:Te,lastActivity:Qe}};return z?e.jsx("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading customers..."})]})})}):q?e.jsx("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(dr,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsxs("p",{className:"text-red-600 mb-4",children:["Error loading customers: ",q]}),e.jsx(X,{onClick:()=>window.location.reload(),children:"Try Again"})]})})}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[J&&e.jsx("div",{style:{background:"#fbbf24",color:"black",padding:"8px",textAlign:"center"},children:"You are offline. Data is loaded from cache."}),e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Customer Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your customer relationships and track loyalty"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(X,{onClick:()=>a("/customers/new"),icon:e.jsx(Ca,{size:18}),className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:"New Customer"}),["admin","customer-care"].includes((r==null?void 0:r.role)||"")&&e.jsxs(e.Fragment,{children:[e.jsx(X,{onClick:()=>a("/customers/import"),icon:e.jsx(Ml,{size:18}),className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white",children:"Import Excel"}),e.jsx(X,{onClick:()=>A(!0),icon:e.jsx(Ml,{size:18}),className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white",children:"Import New"}),e.jsx(X,{onClick:()=>{console.log("Update Existing button clicked"),_(!0),console.log("showCustomerUpdateImport set to true")},icon:e.jsx(us,{size:18}),className:"bg-gradient-to-r from-orange-500 to-red-600 text-white",children:"Update Existing"}),e.jsx(X,{onClick:()=>a("/customers/update-data"),icon:e.jsx(Zi,{size:18}),className:"bg-gradient-to-r from-orange-500 to-red-600 text-white",children:"Update Data"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(he,{className:"bg-gradient-to-br from-blue-50 to-blue-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Customers"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:Xe.totalCustomers})]}),e.jsx("div",{className:"p-3 bg-blue-50/20 rounded-full",children:e.jsx(_s,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx(he,{className:"bg-gradient-to-br from-green-50 to-green-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Active Customers"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:Xe.activeCustomers})]}),e.jsx("div",{className:"p-3 bg-green-50/20 rounded-full",children:e.jsx(nr,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx(he,{className:"bg-gradient-to-br from-purple-50 to-purple-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:Vt(Xe.totalRevenue)})]}),e.jsx("div",{className:"p-3 bg-purple-50/20 rounded-full",children:e.jsx(Ns,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx(he,{className:"bg-gradient-to-br from-amber-50 to-amber-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-amber-600",children:"Total Devices"}),e.jsx("p",{className:"text-2xl font-bold text-amber-900",children:Xe.totalDevices})]}),e.jsx("div",{className:"p-3 bg-amber-50/20 rounded-full",children:e.jsx(fr,{className:"w-6 h-6 text-amber-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(he,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Loyalty Distribution"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"Platinum"})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[Xe.platinumCustomers," customers"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-amber-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"Gold"})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[Xe.goldCustomers," customers"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"Silver"})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[Xe.silverCustomers," customers"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"Bronze"})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[Xe.bronzeCustomers," customers"]})]})]})]}),e.jsxs(he,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(X,{variant:"secondary",icon:e.jsx(Xr,{size:16}),onClick:()=>L(!0),className:"text-sm",children:"Send SMS"}),e.jsx(X,{variant:"secondary",icon:e.jsx(zr,{size:16}),onClick:()=>a("/customer-analytics"),className:"text-sm",children:"Analytics"}),e.jsx(X,{variant:"secondary",icon:e.jsx(Va,{size:16}),onClick:()=>a("/points-management"),className:"text-sm",children:"Points"}),e.jsx(X,{variant:"secondary",icon:e.jsx(ws,{size:16}),onClick:()=>a("/customer-events"),className:"text-sm",children:"Events"})]})]})]}),e.jsx(Mh,{searchQuery:m,onSearchChange:u,loyaltyFilter:B,onLoyaltyFilterChange:fe,statusFilter:re,onStatusFilterChange:ye,tagFilter:Q,onTagFilterChange:Le,referralFilter:Ue,onReferralFilterChange:Ct,birthdayFilter:Re,onBirthdayFilterChange:ut,whatsappFilter:Ee,onWhatsappFilterChange:Oe,showInactive:y,onShowInactiveChange:N,sortBy:ge,onSortByChange:He,customers:D}),k.length>0&&e.jsx(he,{className:"bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yt,{className:"w-5 h-5 text-blue-600"}),e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[k.length," customer",k.length!==1?"s":""," selected"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(X,{variant:"secondary",icon:e.jsx(Xr,{size:16}),onClick:()=>$e("message"),className:"text-sm",children:"Send Message"}),e.jsx(X,{variant:"secondary",icon:e.jsx(Br,{size:16}),onClick:()=>$e("export"),className:"text-sm",children:"Export"}),e.jsx(X,{variant:"secondary",icon:e.jsx(Fs,{size:16}),onClick:()=>E([]),className:"text-sm text-red-600",children:"Clear"})]})]})}),v==="list"?e.jsx(he,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200/50",children:[e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:e.jsx("input",{type:"checkbox",checked:k.length===Be.length&&Be.length>0,onChange:be,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:"Customer"}),e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:"Contact"}),e.jsx("th",{className:"text-left py-4 px-4 font-medium text-gray-700",children:"Devices"}),e.jsx("th",{className:"text-right py-4 px-4 font-medium text-gray-700",children:"Total Spent"}),e.jsx("th",{className:"text-center py-4 px-4 font-medium text-gray-700",children:"Loyalty"}),e.jsx("th",{className:"text-right py-4 px-4 font-medium text-gray-700",children:"Points"}),e.jsx("th",{className:"text-center py-4 px-4 font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"text-center py-4 px-4 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:Be.map(le=>{const Ne=Ke(le.id);return e.jsxs("tr",{className:"border-b border-gray-200/30 hover:bg-blue-50 cursor-pointer transition-colors",onClick:()=>{a(`/customers/${le.id}`),i(le.id)},children:[e.jsx("td",{className:"py-4 px-4",children:e.jsx("input",{type:"checkbox",checked:k.includes(le.id),onChange:Te=>{Te.stopPropagation(),K(le.id)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold",children:le.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:le.name}),e.jsx("p",{className:"text-sm text-gray-600",children:le.city})]})]})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Qr,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-gray-900",children:le.phone})]}),le.whatsapp&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600",children:[e.jsx(js,{className:"w-3 h-3"}),e.jsx("span",{children:le.whatsapp})]}),le.referralSource&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-purple-600",children:[e.jsx(Js,{className:"w-3 h-3"}),e.jsx("span",{children:le.referralSource})]}),(le.birthMonth||le.birthDay)&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-pink-600",children:[e.jsx(ws,{className:"w-3 h-3"}),e.jsxs("span",{children:[le.birthMonth," ",le.birthDay]})]})]})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-gray-900 font-semibold",children:[Ne.count," device",Ne.count!==1?"s":""]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Last: ",Ne.lastActivity]})]})}),e.jsx("td",{className:"py-4 px-4 text-right",children:e.jsx("p",{className:"text-gray-900 font-semibold",children:Vt(ke(le.id))})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:`
                          inline-flex items-center gap-1 px-2 py-1 rounded-full text-sm border
                          ${Ze(le.loyaltyLevel)}
                        `,children:[e.jsx(hr,{size:14}),e.jsx("span",{className:"capitalize",children:le.loyaltyLevel})]})}),e.jsx("td",{className:"py-4 px-4 text-right",children:e.jsx("p",{className:"text-gray-900 font-semibold",children:le.points})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:`
                          inline-flex items-center gap-1 px-2 py-1 rounded-full text-sm border
                          ${Ce(le.colorTag)}
                        `,children:[!le.isActive&&e.jsx(ms,{size:14}),e.jsx("span",{className:"capitalize",children:le.colorTag})]})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:Te=>{Te.stopPropagation(),a(`/customers/${le.id}`),i(le.id)},className:"p-1 text-gray-500 hover:text-blue-600 transition-colors",title:"View Details",children:e.jsx(cs,{size:16})}),e.jsx("button",{onClick:Te=>{Te.stopPropagation(),a(`/customers/${le.id}`,{state:{openEdit:!0}})},className:"p-1 text-gray-500 hover:text-green-600 transition-colors",title:"Edit Customer",children:e.jsx(Ts,{size:16})}),e.jsx("button",{onClick:Te=>{Te.stopPropagation(),a(`/sms-control?customer=${le.id}`)},className:"p-1 text-gray-500 hover:text-purple-600 transition-colors",title:"Send Message",children:e.jsx(Xr,{size:16})})]})})]},le.id)})})]})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:Be.map(le=>{const Ne=Ke(le.id);return e.jsxs(he,{onClick:()=>{a(`/customers/${le.id}`),i(le.id)},className:"cursor-pointer hover:scale-105 transition-transform duration-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold text-lg",children:le.name.charAt(0)}),e.jsx("div",{className:`
                    px-2 py-1 rounded-full text-xs border
                    ${Ce(le.colorTag)}
                  `,children:le.colorTag})]}),e.jsx("h3",{className:"font-semibold text-gray-900",children:le.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:le.city}),e.jsxs("div",{className:"flex items-center gap-2 text-sm mb-1",children:[e.jsx(Qr,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700",children:le.phone})]}),le.whatsapp&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-green-600 mb-1",children:[e.jsx(js,{className:"w-3 h-3"}),e.jsxs("span",{children:["WhatsApp: ",le.whatsapp]})]}),le.referralSource&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-purple-600 mb-1",children:[e.jsx(Js,{className:"w-3 h-3"}),e.jsxs("span",{children:["From: ",le.referralSource]})]}),(le.birthMonth||le.birthDay)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-pink-600 mb-1",children:[e.jsx(ws,{className:"w-3 h-3"}),e.jsxs("span",{children:[le.birthMonth," ",le.birthDay]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mb-2",children:[e.jsxs("span",{children:[Ne.count," device",Ne.count!==1?"s":""]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Last: ",Ne.lastActivity]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:`
                    inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs border
                    ${Ze(le.loyaltyLevel)}
                  `,children:[e.jsx(hr,{size:12}),e.jsx("span",{className:"capitalize",children:le.loyaltyLevel})]}),e.jsxs("span",{className:"text-xs font-semibold text-gray-900",children:[le.points," pts"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs mb-2",children:[e.jsx("span",{className:"text-gray-600",children:"Total Spent:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:Vt(ke(le.id))})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-2",children:[e.jsx("button",{onClick:Te=>{Te.stopPropagation(),a(`/customers/${le.id}`),i(le.id)},className:"p-1 text-gray-500 hover:text-blue-600 transition-colors",title:"View Details",children:e.jsx(cs,{size:16})}),e.jsx("button",{onClick:Te=>{Te.stopPropagation(),a(`/customers/${le.id}`,{state:{openEdit:!0}})},className:"p-1 text-gray-500 hover:text-green-600 transition-colors",title:"Edit Customer",children:e.jsx(Ts,{size:16})}),e.jsx("button",{onClick:Te=>{Te.stopPropagation(),a(`/sms-control?customer=${le.id}`)},className:"p-1 text-gray-500 hover:text-purple-600 transition-colors",title:"Send Message",children:e.jsx(Xr,{size:16})})]})]},le.id)})}),Be.length===0&&e.jsxs(he,{className:"text-center py-12",children:[e.jsx(_s,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No customers found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Try adjusting your search or filter criteria"}),e.jsx(X,{onClick:()=>a("/customers/new"),icon:e.jsx(Ca,{size:18}),children:"Add Your First Customer"})]}),e.jsx(Rh,{open:F,onClose:()=>L(!1),customers:D,onSend:ue,sending:C}),e.jsx(Lh,{isOpen:Y,onClose:()=>A(!1),onImportComplete:Ye}),e.jsx(Oh,{isOpen:Z,onClose:()=>_(!1),onImportComplete:ae})]})},Bh=({isOpen:r,onClose:a,customerId:i,customerName:c,currentPoints:m,loyaltyLevel:u,onPointsUpdated:x})=>{const[j,b]=g.useState(0),[f,y]=g.useState(""),[N,I]=g.useState(!1),[R,k]=g.useState([]),[E,v]=g.useState(!1);g.useEffect(()=>{r&&U()},[r,i]);const U=async()=>{v(!0);try{const{data:A,error:Z}=await G.from("customer_notes").select("*").eq("customer_id",i).or("content.ilike.%points%").order("created_at",{ascending:!1}).limit(20);if(!Z&&A){const _=[...new Set(A.map(q=>q.created_by))],{data:D,error:T}=await G.from("auth_users").select("id, name").in("id",_),z=new Map;!T&&D&&D.forEach(q=>{z.set(q.id,q.name)});const se=A.filter(q=>q.content.includes("points")).map(q=>{const H=q.content.match(/(\d+)\s+points?/i),J=H?parseInt(H[1]):0,V=q.content.includes("subtracted")||q.content.includes("deducted"),ge=q.content.includes("redeemed"),He=q.content.includes("loyalty points for new device");return{id:q.id,points:V?-J:J,reason:q.content,type:ge?"redeemed":He?"auto":V?"subtracted":"added",createdBy:q.created_by,createdByUser:z.get(q.created_by)||"Unknown User",createdAt:q.created_at}});k(se)}}catch(A){console.error("Error loading points history:",A)}finally{v(!1)}},F=async A=>{var Z;if(!f.trim()){te.error("Please provide a reason for the points adjustment");return}if(!navigator.onLine){await jn({type:"adjustPoints",payload:{operation:A,pointsToAdjust:j,reason:f,customerId:i}}),te("You are offline. Points adjustment will be synced when you are back online."),b(0),y("");return}I(!0);try{const _=A==="add"?Math.abs(j):-Math.abs(j),D=m+_,{error:T}=await G.from("customers").update({points:D}).eq("id",i);if(T)throw T;const z=`${A==="add"?"Added":"Subtracted"} ${Math.abs(j)} points - ${f}`,{error:se}=await G.from("customer_notes").insert({id:`note-${Date.now()}`,content:z,created_by:((Z=(await G.auth.getUser()).data.user)==null?void 0:Z.id)||"system",created_at:new Date().toISOString(),customer_id:i});se&&console.warn("Could not add note:",se),x(D),te.success(`${A==="add"?"Added":"Subtracted"} ${Math.abs(j)} points successfully!`),b(0),y(""),await U()}catch(_){console.error("Error adjusting points:",_),te.error("Failed to adjust points. Please try again.")}finally{I(!1)}},L=()=>{const A={bronze:0,silver:100,gold:500,platinum:1e3},Z=(u==null?void 0:u.toLowerCase())||"bronze",_=Z==="bronze"?"silver":Z==="silver"?"gold":Z==="gold"?"platinum":null;if(!_)return{progress:100,nextLevel:null,pointsNeeded:0};const D=A[Z],T=A[_],z=Math.min(100,(m-D)/(T-D)*100),se=Math.max(0,T-m);return{progress:z,nextLevel:_,pointsNeeded:se}},{progress:C,nextLevel:$,pointsNeeded:Y}=L();return e.jsx(es,{isOpen:r,onClose:a,title:"Points Management",maxWidth:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-amber-500/20 to-yellow-500/20 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:c}),e.jsxs("p",{className:"text-2xl font-bold text-amber-600 flex items-center gap-2",children:[e.jsx(hr,{className:"w-6 h-6"}),m," Points"]}),e.jsxs("p",{className:"text-sm text-gray-600 capitalize",children:[u||"Bronze"," Level"]})]}),e.jsx("div",{className:"text-right",children:$&&e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:["Next: ",$]}),e.jsxs("p",{children:[Y," points needed"]})]})})]}),$&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-yellow-500 h-2 rounded-full transition-all duration-300",style:{width:`${C}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[Math.round(C),"% to ",$]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Adjust Points"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Points to Adjust"}),e.jsx("input",{type:"number",value:j,onChange:A=>b(parseInt(A.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter points amount",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason"}),e.jsx("input",{type:"text",value:f,onChange:A=>y(A.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Reason for adjustment"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(X,{onClick:()=>F("add"),disabled:N||j<=0||!f.trim(),icon:e.jsx(Ut,{size:16}),variant:"success",children:"Add Points"}),e.jsx(X,{onClick:()=>F("subtract"),disabled:N||j<=0||!f.trim(),icon:e.jsx($o,{size:16}),variant:"danger",children:"Subtract Points"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ki,{size:16}),"Points History"]}),E&&e.jsx("div",{className:"text-sm text-gray-500",children:"Loading..."})]}),e.jsxs("div",{className:"max-h-60 overflow-y-auto space-y-2",children:[R.map(A=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[A.type==="added"&&e.jsx(vr,{size:16,className:"text-green-500"}),A.type==="subtracted"&&e.jsx(Sa,{size:16,className:"text-red-500"}),A.type==="redeemed"&&e.jsx(qa,{size:16,className:"text-purple-500"}),A.type==="auto"&&e.jsx(hr,{size:16,className:"text-amber-500"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[A.type==="added"?"+":"",A.points," points"]}),e.jsx("p",{className:"text-xs text-gray-600",children:A.reason}),e.jsxs("p",{className:"text-xs text-blue-600 font-medium",children:["Added by: ",A.createdByUser]})]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(A.createdAt).toLocaleDateString()})]},A.id)),R.length===0&&!E&&e.jsx("div",{className:"text-center text-gray-500 py-4",children:"No points history found"})]})]}),e.jsx("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:e.jsx(X,{variant:"secondary",onClick:a,children:"Close"})})]})})},zh=({customer:r,devices:a,payments:i})=>{const m=(()=>{var A;const b=i.filter(Z=>Z.status==="completed").reduce((Z,_)=>Z+(_.amount||0),0),f=r.points||0,y=a.length,N=a.filter(Z=>["assigned","diagnosis-started","awaiting-parts","in-repair","reassembled-testing"].includes(Z.status)).length,I=y>0?b/y:0,R=b+f*.1;let k=0;if(r.lastVisit)try{const Z=new Date(r.lastVisit);isNaN(Z.getTime())||(k=Math.floor((Date.now()-Z.getTime())/864e5))}catch{console.warn("Invalid lastVisit date for customer:",r.id,r.lastVisit)}const E=k<=30?"Excellent":k<=90?"Good":k<=180?"Fair":"Poor",v=new Set(a.map(Z=>Z.brand)).size,U=v>1?`${v} brands`:"Single brand";let F="No repairs yet";if(y>0&&r.joinedDate)try{const Z=new Date(r.joinedDate);if(!isNaN(Z.getTime())){const _=(Date.now()-Z.getTime())/31536e6;F=`${(y/Math.max(1,_)*12).toFixed(1)} repairs/year`}}catch{console.warn("Invalid joinedDate for customer:",r.id,r.joinedDate)}const L={bronze:0,silver:100,gold:500,platinum:1e3},C=((A=r.loyaltyLevel)==null?void 0:A.toLowerCase())||"bronze",$=C==="bronze"?"silver":C==="silver"?"gold":C==="gold"?"platinum":null,Y=$?Math.min(100,(f-L[C])/(L[$]-L[C])*100):100;return[{label:"Customer Lifetime Value",value:Vt(R),icon:e.jsx(Ns,{size:20}),color:"text-green-600",trend:"up"},{label:"Average Repair Value",value:Vt(I),icon:e.jsx(Cn,{size:20}),color:"text-blue-600",trend:"neutral"},{label:"Active Repairs",value:`${N}/${y}`,icon:e.jsx(ns,{size:20}),color:"text-purple-600",trend:N>0?"up":"neutral"},{label:"Retention Score",value:E,icon:e.jsx(Va,{size:20}),color:E==="Excellent"?"text-green-600":E==="Good"?"text-blue-600":E==="Fair"?"text-yellow-600":"text-red-600",trend:E==="Excellent"||E==="Good"?"up":"down"},{label:"Device Diversity",value:U,icon:e.jsx(_s,{size:20}),color:"text-indigo-600",trend:v>1?"up":"neutral"},{label:"Repair Frequency",value:F,icon:e.jsx(ws,{size:20}),color:"text-orange-600",trend:"neutral"},{label:"Loyalty Progress",value:`${Math.round(Y)}%`,icon:e.jsx(hr,{size:20}),color:"text-amber-600",trend:Y>50?"up":"neutral"},{label:"Days Since Last Visit",value:`${k} days`,icon:e.jsx(ms,{size:20}),color:k<=30?"text-green-600":k<=90?"text-blue-600":k<=180?"text-yellow-600":"text-red-600",trend:k<=30?"up":"down"}]})(),u={};a.forEach(b=>{if(b.createdAt)try{const f=new Date(b.createdAt);if(!isNaN(f.getTime())){const y=f.toISOString().slice(0,7);u[y]=(u[y]||0)+(b.estimatedHours||0)*50}}catch{console.warn("Invalid date for device:",b.id,b.createdAt)}});const x=Object.keys(u).sort().slice(-6).map(b=>{try{const f=new Date(b);if(!isNaN(f.getTime()))return{month:f.toLocaleDateString("en-US",{month:"short",year:"2-digit"}),amount:u[b]}}catch{console.warn("Invalid month string:",b)}return{month:"Invalid Date",amount:u[b]}}).filter(b=>b.month!=="Invalid Date"),j=i.filter(b=>b.status==="completed").reduce((b,f)=>b+(f.amount||0),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:m.map((b,f)=>e.jsxs(he,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`${b.color}`,children:b.icon}),b.trend&&e.jsxs("div",{className:`${b.trend==="up"?"text-green-500":b.trend==="down"?"text-red-500":"text-gray-500"}`,children:[b.trend==="up"&&e.jsx(vr,{size:16}),b.trend==="down"&&e.jsx(Sa,{size:16})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:b.value}),e.jsx("p",{className:"text-sm text-gray-600",children:b.label})]})]},f))}),x.length>0&&e.jsxs(he,{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Spending Trends (Last 6 Months)"}),e.jsx("div",{className:"space-y-3",children:x.map((b,f)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:b.month}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full",style:{width:`${b.amount/Math.max(...x.map(y=>y.amount))*100}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["$",b.amount.toFixed(0)]})]})]},f))})]}),e.jsxs(he,{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Customer Insights"}),e.jsxs("div",{className:"space-y-3",children:[r.loyaltyLevel==="platinum"&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-lg",children:[e.jsx(Va,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"VIP Customer - Platinum Level"})]}),j>1e3&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gradient-to-r from-green-500/20 to-emerald-500/20 rounded-lg",children:[e.jsx(Ns,{className:"w-5 h-5 text-green-600"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["High-Value Customer - $",j.toFixed(0)," spent"]})]}),a.length===0&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 rounded-lg",children:[e.jsx(ms,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"New Customer - No repair history yet"})]}),a.length>5&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gradient-to-r from-blue-500/20 to-indigo-500/20 rounded-lg",children:[e.jsx(_s,{className:"w-5 h-5 text-blue-600"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["Frequent Customer - ",a.length," repairs"]})]}),(r.points||0)>500&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gradient-to-r from-amber-500/20 to-yellow-500/20 rounded-lg",children:[e.jsx(hr,{className:"w-5 h-5 text-amber-600"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["Loyalty Points Leader - ",r.points||0," points"]})]})]})]})]})},Uh=({customerId:r,customerName:a,customerEmail:i,isOpen:c,onClose:m})=>{const[u,x]=g.useState("templates"),[j,b]=g.useState([]),[f,y]=g.useState([]),[N,I]=g.useState(!1),[R,k]=g.useState(!1),[E,v]=g.useState(null),[U,F]=g.useState(null),[L,C]=g.useState(!1),[$,Y]=g.useState({subject:"",content:"",recipients:r?[r]:[],templateId:""});g.useEffect(()=>{c&&(A(),Z())},[c]);const A=async()=>{try{const{data:q,error:H}=await G.from("email_templates").select("*").order("created_at",{ascending:!1});!H&&q&&b(q)}catch(q){console.error("Error loading templates:",q)}},Z=async()=>{try{const{data:q,error:H}=await G.from("email_campaigns").select("*").order("created_at",{ascending:!1});!H&&q&&y(q)}catch(q){console.error("Error loading campaigns:",q)}},_=async q=>{C(!0);try{if(E){const{error:H}=await G.from("email_templates").update(q).eq("id",E.id);if(H)throw H;te.success("Template updated successfully!")}else{const H={...q,id:`template-${Date.now()}`,createdAt:new Date().toISOString()},{error:J}=await G.from("email_templates").insert([H]);if(J)throw J;te.success("Template created successfully!")}I(!1),v(null),await A()}catch(H){console.error("Error saving template:",H),te.error("Failed to save template")}finally{C(!1)}},D=async q=>{C(!0);try{if(U){const{error:H}=await G.from("email_campaigns").update(q).eq("id",U.id);if(H)throw H;te.success("Campaign updated successfully!")}else{const H={...q,id:`campaign-${Date.now()}`,sentCount:0,totalCount:0,createdAt:new Date().toISOString()},{error:J}=await G.from("email_campaigns").insert([H]);if(J)throw J;te.success("Campaign created successfully!")}k(!1),F(null),await Z()}catch(H){console.error("Error saving campaign:",H),te.error("Failed to save campaign")}finally{C(!1)}},T=async()=>{if(!$.subject||!$.content){te.error("Please fill in subject and content");return}C(!0);try{await new Promise(q=>setTimeout(q,1e3)),te.success("Email sent successfully!"),Y({subject:"",content:"",recipients:[],templateId:""})}catch{te.error("Failed to send email")}finally{C(!1)}},z=q=>{switch(q){case"promotional":return e.jsx(qa,{size:16});case"service":return e.jsx(ns,{size:16});case"reminder":return e.jsx(Mr,{size:16});case"birthday":return e.jsx(ws,{size:16});case"loyalty":return e.jsx(hr,{size:16});default:return e.jsx(da,{size:16})}},se=q=>{switch(q){case"draft":return"text-gray-500";case"scheduled":return"text-blue-500";case"sending":return"text-yellow-500";case"sent":return"text-green-500";case"failed":return"text-red-500";default:return"text-gray-500"}};return e.jsxs(es,{isOpen:c,onClose:m,title:"Communication Hub",maxWidth:"6xl",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex border-b border-gray-200",children:[{id:"templates",label:"Email Templates",icon:e.jsx(da,{size:16})},{id:"campaigns",label:"Campaigns",icon:e.jsx(Tr,{size:16})},{id:"history",label:"History",icon:e.jsx(ws,{size:16})},{id:"quick-send",label:"Quick Send",icon:e.jsx(js,{size:16})}].map(q=>e.jsxs("button",{onClick:()=>x(q.id),className:`flex items-center gap-2 px-4 py-2 border-b-2 font-medium text-sm ${u===q.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[q.icon,q.label]},q.id))}),u==="templates"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Email Templates"}),e.jsx(X,{onClick:()=>{v(null),I(!0)},icon:e.jsx(Ut,{size:16}),children:"New Template"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:j.map(q=>e.jsxs(he,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[z(q.category),e.jsx("span",{className:"text-sm text-gray-500 capitalize",children:q.category})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{variant:"secondary",size:"sm",icon:e.jsx(Ts,{size:14}),onClick:()=>{v(q),I(!0)}}),e.jsx(X,{variant:"danger",size:"sm",icon:e.jsx(er,{size:14})})]})]}),e.jsx("h4",{className:"font-semibold text-gray-900 mt-2",children:q.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:q.subject}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 line-clamp-2",children:q.content}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${q.isActive?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:q.isActive?"Active":"Inactive"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[q.variables.length," variables"]})]})]},q.id))})]}),u==="campaigns"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Email Campaigns"}),e.jsx(X,{onClick:()=>{F(null),k(!0)},icon:e.jsx(Ut,{size:16}),children:"New Campaign"})]}),e.jsx("div",{className:"space-y-3",children:f.map(q=>e.jsxs(he,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`${se(q.status)}`,children:[q.status==="sent"&&e.jsx(yt,{size:16}),q.status==="sending"&&e.jsx(dr,{size:16}),q.status==="failed"&&e.jsx(dr,{size:16}),q.status==="draft"&&e.jsx(da,{size:16}),q.status==="scheduled"&&e.jsx(ws,{size:16})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:q.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Template: ",q.templateName]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[q.sentCount,"/",q.totalCount]}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:q.status})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:["Target: ",q.targetAudience]}),q.scheduledDate&&e.jsxs("span",{children:["Scheduled: ",new Date(q.scheduledDate).toLocaleDateString()]})]})]},q.id))})]}),u==="history"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Communication History"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-8 text-center",children:[e.jsx(da,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Communication history will be displayed here"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Track all emails, SMS, and other communications"})]})]}),u==="quick-send"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Quick Send Email"}),r&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"To:"})," ",a," (",i,")"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject"}),e.jsx("input",{type:"text",value:$.subject,onChange:q=>Y({...$,subject:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter email subject..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Content"}),e.jsx("textarea",{value:$.content,onChange:q=>Y({...$,content:q.target.value}),rows:8,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter email content..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(X,{onClick:T,disabled:L||!$.subject||!$.content,icon:e.jsx(Tr,{size:16}),children:L?"Sending...":"Send Email"}),e.jsx(X,{variant:"secondary",onClick:()=>Y({subject:"",content:"",recipients:[],templateId:""}),children:"Clear"})]})]})]})]}),N&&e.jsx($h,{isOpen:N,onClose:()=>{I(!1),v(null)},template:E,onSave:_,loading:L}),R&&e.jsx(qh,{isOpen:R,onClose:()=>{k(!1),F(null)},campaign:U,templates:j,onSave:D,loading:L})]})},$h=({isOpen:r,onClose:a,template:i,onSave:c,loading:m})=>{const[u,x]=g.useState({name:(i==null?void 0:i.name)||"",subject:(i==null?void 0:i.subject)||"",content:(i==null?void 0:i.content)||"",category:(i==null?void 0:i.category)||"promotional",isActive:(i==null?void 0:i.isActive)??!0,variables:(i==null?void 0:i.variables)||[]}),j=b=>{b.preventDefault(),c(u)};return e.jsx(es,{isOpen:r,onClose:a,title:i?"Edit Template":"New Template",maxWidth:"lg",children:e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Template Name"}),e.jsx("input",{type:"text",value:u.name,onChange:b=>x({...u,name:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{value:u.category,onChange:b=>x({...u,category:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"promotional",children:"Promotional"}),e.jsx("option",{value:"service",children:"Service"}),e.jsx("option",{value:"reminder",children:"Reminder"}),e.jsx("option",{value:"birthday",children:"Birthday"}),e.jsx("option",{value:"loyalty",children:"Loyalty"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject"}),e.jsx("input",{type:"text",value:u.subject,onChange:b=>x({...u,subject:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Content"}),e.jsx("textarea",{value:u.content,onChange:b=>x({...u,content:b.target.value}),rows:8,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter email content. Use {{variable}} for dynamic content...",required:!0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:u.isActive,onChange:b=>x({...u,isActive:b.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"isActive",className:"text-sm text-gray-700",children:"Active Template"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx(X,{variant:"secondary",onClick:a,type:"button",children:"Cancel"}),e.jsx(X,{type:"submit",disabled:m,children:m?"Saving...":"Save Template"})]})]})})},qh=({isOpen:r,onClose:a,campaign:i,templates:c,onSave:m,loading:u})=>{const[x,j]=g.useState({name:(i==null?void 0:i.name)||"",templateId:(i==null?void 0:i.templateId)||"",targetAudience:(i==null?void 0:i.targetAudience)||"all",status:(i==null?void 0:i.status)||"draft",scheduledDate:(i==null?void 0:i.scheduledDate)||""}),b=f=>{f.preventDefault();const y=c.find(N=>N.id===x.templateId);m({...x,templateName:(y==null?void 0:y.name)||""})};return e.jsx(es,{isOpen:r,onClose:a,title:i?"Edit Campaign":"New Campaign",maxWidth:"lg",children:e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Campaign Name"}),e.jsx("input",{type:"text",value:x.name,onChange:f=>j({...x,name:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Template"}),e.jsxs("select",{value:x.templateId,onChange:f=>j({...x,templateId:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Select a template"}),c.filter(f=>f.isActive).map(f=>e.jsxs("option",{value:f.id,children:[f.name," (",f.category,")"]},f.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Target Audience"}),e.jsxs("select",{value:x.targetAudience,onChange:f=>j({...x,targetAudience:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Customers"}),e.jsx("option",{value:"vip",children:"VIP Customers"}),e.jsx("option",{value:"inactive",children:"Inactive Customers"}),e.jsx("option",{value:"active",children:"Active Customers"}),e.jsx("option",{value:"custom",children:"Custom Selection"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:x.status,onChange:f=>j({...x,status:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"scheduled",children:"Scheduled"})]})]}),x.status==="scheduled"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Schedule Date"}),e.jsx("input",{type:"datetime-local",value:x.scheduledDate,onChange:f=>j({...x,scheduledDate:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx(X,{variant:"secondary",onClick:a,type:"button",children:"Cancel"}),e.jsx(X,{type:"submit",disabled:u,children:u?"Saving...":"Save Campaign"})]})]})})},Vh=()=>{var Se,ve;const{id:r}=ka(),a=hs(),i=ba(),{addNote:c,updateCustomer:m,markCustomerAsRead:u}=Ur(),[x,j]=g.useState(null),[b,f]=g.useState([]),[y,N]=g.useState([]),[I,R]=g.useState(!0),[k,E]=g.useState(null),[v,U]=g.useState(!navigator.onLine),[F,L]=g.useState(!1),[C,$]=g.useState(""),[Y,A]=g.useState(!1),[Z,_]=g.useState(null),[D,T]=g.useState(!1),[z,se]=g.useState(!1),[q,H]=g.useState(!1),[J,V]=g.useState("Dear customer, this is a friendly reminder regarding your device/service. Please contact us if you have any questions."),[ge,He]=g.useState(!1),[B,fe]=g.useState(""),[re,ye]=g.useState(!1),[Q,Le]=g.useState(!1),[Ue,Ct]=g.useState(!1),[Re,ut]=g.useState(""),[Ee,Oe]=g.useState(!1),[Xe,Be]=g.useState(null),[Ce,Ze]=g.useState(!1),[$e,K]=g.useState(!1),[be,ue]=g.useState(!1),{currentUser:Ye}=Wt();Dr.useEffect(()=>{i.state&&i.state.openEdit},[i.state]),g.useEffect(()=>{(async()=>{if(r)try{if(R(!0),E(null),navigator.onLine){const St=(await yn()).find(kt=>kt.id===r);if(!St){E("Customer not found");return}j(St),f(St.devices||[]),N(St.payments||[]),await u(St.id)}else{const St=(await Bo(()=>Promise.resolve().then(()=>km),void 0).then(kt=>kt.cacheGetAll("customers"))).find(kt=>kt.id===r);St?(j(St),f(St.devices||[]),N(St.payments||[]),await u(St.id)):E("Customer not found in cache")}}catch(it){console.error("Error loading customer data:",it),E(it.message||"Failed to load customer data")}finally{R(!1)}})();const me=()=>U(!1),Ae=()=>U(!0);return window.addEventListener("online",me),window.addEventListener("offline",Ae),()=>{window.removeEventListener("online",me),window.removeEventListener("offline",Ae)}},[r]);const ae=async()=>{if(r){R(!0),E(null);try{const me=(await yn()).find(Ae=>Ae.id===r);me&&(j(me),f(me.devices||[]),N(me.payments||[]),await u(me.id))}catch{E("Failed to reload customer data")}finally{R(!1)}}};if(I)return e.jsx("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})})});if(k||!x)return e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Zs,{to:"/customers",className:"mr-4 text-gray-700 hover:text-gray-900",children:e.jsx(zs,{size:20})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Customer Details"})]}),e.jsx(he,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-red-600 mb-4",children:k||"Customer not found"}),e.jsx(X,{onClick:()=>a("/customers"),children:"Back to Customers"})]})})]});const ke=[...b].sort((de,me)=>de.expectedReturnDate?me.expectedReturnDate?de.expectedReturnDate.localeCompare(me.expectedReturnDate):-1:1);y.filter(de=>de.status==="completed").reduce((de,me)=>de+(me.amount||0),0);const Ke=x.points||0;b.length;const le=((Se=x.referrals)==null?void 0:Se.length)||0,Ne=de=>y.filter(me=>me.deviceId===de&&me.status==="completed").reduce((me,Ae)=>me+(Ae.amount||0),0),Te=x.promoHistory||[],Qe={};y.forEach(de=>{const me=new Date(de.date).getFullYear();Qe[me]=(Qe[me]||0)+de.amount}),Object.entries(Qe).map(([de,me])=>({year:de,amount:me}));const vt={};b.forEach(de=>{vt[de.status]=(vt[de.status]||0)+1}),Object.entries(vt).map(([de,me])=>({status:de,count:me}));const Rt=[{label:"Device Ready for Pickup",value:"Hi {customerName}, your device{deviceModel} is ready for pickup. Please visit us at your convenience."},{label:"Payment Due",value:"Dear {customerName}, this is a reminder that payment for your device{deviceModel} is due. Please contact us if you have any questions."},{label:"Service Follow-up",value:"Hello {customerName}, we hope your device{deviceModel} is working well. Please let us know if you need any further assistance."}],ht=!!(x!=null&&x.lastVisit&&new Date(x.lastVisit).toDateString()===new Date().toDateString());return e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Zs,{to:"/customers",className:"mr-4 text-gray-700 hover:text-gray-900",children:e.jsx(zs,{size:20})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Customer Details"})]}),v&&e.jsx("div",{style:{background:"#fbbf24",color:"black",padding:"8px",textAlign:"center"},children:"You are offline. Data is loaded from cache."}),e.jsx(he,{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-500/20 to-purple-500/20 flex items-center justify-center border-2 border-white/30",children:e.jsx(_s,{className:"w-10 h-10 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:x.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-3",children:[e.jsxs("span",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium ${x.colorTag==="vip"?"bg-emerald-500/20 text-emerald-700 border border-emerald-500/30":x.colorTag==="complainer"?"bg-rose-500/20 text-rose-700 border border-rose-500/30":x.colorTag==="purchased"?"bg-blue-500/20 text-blue-700 border border-blue-500/30":x.colorTag==="new"?"bg-purple-500/20 text-purple-700 border border-purple-500/30":"bg-gray-500/20 text-gray-700 border border-gray-500/30"}`,children:[e.jsx(Js,{size:14}),e.jsx("span",{className:"capitalize",children:x.colorTag})]}),e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium bg-amber-500/20 text-amber-700 border border-amber-500/30",children:[e.jsx(hr,{size:14}),e.jsx("span",{className:"capitalize",children:x.loyaltyLevel})]}),e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium bg-emerald-500/20 text-emerald-700 border border-emerald-500/30",children:[e.jsx(qa,{size:14}),e.jsxs("span",{children:[Ke," pts"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ws,{size:16}),e.jsxs("span",{children:["Customer since ",x.joinedDate?new Date(x.joinedDate).getFullYear():"N/A"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Last visit: ",x.lastVisit?new Date(x.lastVisit).toLocaleDateString():"N/A"]}),ht&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs",children:"Checked in today"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide mb-3",children:"Contact Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Qr,{size:16,className:"text-blue-500"}),e.jsx("span",{className:"font-medium",children:x.phone})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>window.open(`tel:${x.phone}`),className:"p-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded-full transition-colors",title:"Call Customer",children:e.jsx(Qr,{size:14})}),e.jsx("button",{onClick:()=>L(!0),className:"p-1.5 bg-green-500 hover:bg-green-600 text-white rounded-full transition-colors",title:"Send SMS",children:e.jsx(js,{size:14})})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 bg-green-500 rounded flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3 text-white",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})})}),e.jsx("span",{children:x.whatsapp||"Not provided"})]}),x.whatsapp&&x.whatsapp!=="Not provided"&&x.whatsapp.trim()!==""&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>{var de;return window.open(`https://wa.me/${(de=x.whatsapp)==null?void 0:de.replace(/\D/g,"")}`)},className:"p-1.5 bg-green-500 hover:bg-green-600 text-white rounded-full transition-colors",title:"Open WhatsApp",children:e.jsx("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"})})})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white/20 rounded-lg",children:[e.jsx(ei,{size:16,className:"text-purple-500"}),e.jsx("span",{children:x.city})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide mb-3",children:"Personal Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white/20 rounded-lg",children:[e.jsx(_s,{size:16,className:"text-indigo-500"}),e.jsx("span",{className:"capitalize",children:x.gender||"Not provided"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white/20 rounded-lg",children:[e.jsx(ws,{size:16,className:"text-pink-500"}),e.jsx("span",{children:x.birthMonth&&x.birthDay?`${x.birthMonth} ${x.birthDay}`:"Not provided"}),(x.birthMonth||x.birthDay)&&e.jsx("span",{className:"ml-auto px-2 py-1 bg-pink-100 text-pink-700 rounded-full text-xs",children:"Birthday"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white/20 rounded-lg",children:[e.jsx(Js,{size:16,className:"text-orange-500"}),e.jsx("span",{children:x.referralSource||"Not provided"}),x.referralSource&&e.jsx("span",{className:"ml-auto px-2 py-1 bg-orange-100 text-orange-700 rounded-full text-xs",children:"Referral"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white/20 rounded-lg",children:[e.jsx(_s,{size:16,className:"text-emerald-500"}),e.jsxs("span",{children:[le," referrals"]})]})]})]})]})]}),e.jsx("div",{className:"lg:w-80",children:e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-purple-500/10 rounded-xl p-4 border border-white/20",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(X,{className:"w-full justify-start bg-fuchsia-600 hover:bg-fuchsia-700 text-white",size:"sm",onClick:()=>ye(!0),children:"Edit Profile"}),e.jsx(X,{className:"w-full justify-start bg-amber-600 hover:bg-amber-700 text-white",size:"sm",onClick:()=>T(!0),children:"Manage Points"}),e.jsx(X,{variant:"secondary",size:"sm",onClick:async()=>{ue(!0);try{if(!(Ye!=null&&Ye.id))throw new Error("No staff user.");const de=await so(x.id,Ye.id);de.success?(K(!0),await ae(),te.success("Check-in successful! Points awarded.")):te.error(de.message)}catch(de){te.error("Check-in failed: "+(de.message||de))}finally{ue(!1)}},className:"w-full justify-start mt-2",disabled:ht,children:"Manual Check-in"})]})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(he,{className:"bg-gradient-to-br from-pink-50 to-pink-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-pink-600",children:"Birthday"}),e.jsx("p",{className:"text-2xl font-bold text-pink-900",children:x.birthMonth&&x.birthDay?`${x.birthMonth} ${x.birthDay}`:"Not Set"})]}),e.jsx("div",{className:"p-3 bg-pink-50/20 rounded-full",children:e.jsx(ws,{className:"w-6 h-6 text-pink-600"})})]})}),e.jsx(he,{className:"bg-gradient-to-br from-purple-50 to-purple-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Referral Source"}),e.jsx("p",{className:"text-lg font-bold text-purple-900",children:x.referralSource||"Not Set"})]}),e.jsx("div",{className:"p-3 bg-purple-50/20 rounded-full",children:e.jsx(Js,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx(he,{className:"bg-gradient-to-br from-green-50 to-green-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"WhatsApp"}),e.jsx("p",{className:"text-lg font-bold text-green-900",children:x.whatsapp?"Connected":"Not Set"})]}),e.jsx("div",{className:"p-3 bg-green-50/20 rounded-full",children:e.jsx(js,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx(he,{className:"bg-gradient-to-br from-orange-50 to-orange-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Total Returns"}),e.jsx("p",{className:"text-2xl font-bold text-orange-900",children:x.totalReturns||0})]}),e.jsx("div",{className:"p-3 bg-orange-50/20 rounded-full",children:e.jsx(_s,{className:"w-6 h-6 text-orange-600"})})]})})]}),e.jsx(zh,{customer:x,devices:b,payments:y.map(de=>({id:de.id,customer_id:x.id,amount:de.amount,method:de.method,device_id:de.deviceId,payment_date:de.date,payment_type:de.type,status:de.status,created_by:de.createdBy,created_at:de.createdAt}))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(he,{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Notes"}),e.jsxs("div",{className:"mt-3 space-y-2 max-h-32 overflow-y-auto",children:[(ve=x.notes)==null?void 0:ve.map(de=>e.jsxs("div",{className:"p-2 bg-white/30 rounded",children:[e.jsx("div",{className:"text-gray-900 text-sm",children:de.content}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(de.createdAt).toLocaleString()})]},de.id)),(!x.notes||x.notes.length===0)&&e.jsx("div",{className:"text-xs text-gray-500",children:"No notes yet"})]})]}),e.jsxs(he,{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Additional Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{className:"w-full justify-start",variant:"secondary",icon:e.jsx(ns,{size:18}),onClick:()=>a("/devices/new"),children:"New Device Intake"}),e.jsx(X,{className:"w-full justify-start",variant:"secondary",icon:e.jsx(mr,{size:18}),children:"Record Payment"}),e.jsx(X,{className:"w-full justify-start",variant:"secondary",icon:e.jsx(Mr,{size:18}),onClick:()=>H(!0),children:"Send Reminder"}),e.jsx(X,{className:"w-full justify-start",variant:"secondary",icon:e.jsx(js,{size:18}),onClick:()=>se(!0),children:"Communication Hub"})]})]})]}),e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Repair History"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{children:["Total: ",b.length]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Active: ",b.filter(de=>["assigned","diagnosis-started","awaiting-parts","in-repair","reassembled-testing"].includes(de.status)).length]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Completed: ",b.filter(de=>de.status==="done").length]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-white/20",children:[e.jsx("th",{className:"px-2 py-2 text-left",children:"Device"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Status"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Issue"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Created"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Expected Return"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Total Paid"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Points Earned"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Actions"})]})}),e.jsxs("tbody",{children:[ke.map(de=>e.jsxs("tr",{className:"hover:bg-white/40 cursor-pointer",onClick:()=>a(`/devices/${de.id}`),children:[e.jsx("td",{className:"px-2 py-2",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[de.brand," ",de.model]}),e.jsx("div",{className:"text-xs text-gray-500",children:de.serialNumber||"No serial"})]})}),e.jsx("td",{className:"px-2 py-2",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${de.status==="done"?"bg-green-100 text-green-800":de.status==="failed"?"bg-red-100 text-red-800":["assigned","diagnosis-started","awaiting-parts","in-repair","reassembled-testing"].includes(de.status)?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:de.status.replace(/-/g," ")})}),e.jsx("td",{className:"px-2 py-2",children:e.jsx("div",{className:"max-w-xs truncate",title:de.issueDescription,children:de.issueDescription})}),e.jsx("td",{className:"px-2 py-2",children:new Date(de.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-2 py-2",children:de.expectedReturnDate?new Date(de.expectedReturnDate).toLocaleDateString():"Not set"}),e.jsx("td",{className:"px-2 py-2",children:Vt(Ne(de.id))}),e.jsx("td",{className:"px-2 py-2",children:gc(de,x.loyaltyLevel)}),e.jsx("td",{className:"px-2 py-2",children:e.jsx(X,{size:"sm",variant:"secondary",onClick:()=>a(`/devices/${de.id}`),children:"View"})})]},de.id)),b.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center text-gray-500 py-4",children:"No repair history found"})})]})]})})]}),e.jsxs(he,{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Payment History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-white/20",children:[e.jsx("th",{className:"px-2 py-2 text-left",children:"Date"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Type"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Amount"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Device"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Status"})]})}),e.jsxs("tbody",{children:[y.map(de=>e.jsxs("tr",{className:"hover:bg-white/40",children:[e.jsx("td",{className:"px-2 py-2",children:new Date(de.date).toLocaleDateString()}),e.jsx("td",{className:"px-2 py-2",children:de.type}),e.jsx("td",{className:"px-2 py-2",children:Vt(de.amount)}),e.jsx("td",{className:"px-2 py-2 max-w-32 truncate",title:de.deviceId,children:de.deviceId}),e.jsx("td",{className:"px-2 py-2",children:de.status})]},de.id)),y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center text-gray-500 py-4",children:"No payments found"})})]})]})})]}),e.jsxs(he,{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Promotions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-white/20",children:[e.jsx("th",{className:"px-2 py-2 text-left",children:"Title"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Content"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Sent At"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Via"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Status"})]})}),e.jsxs("tbody",{children:[Te.map(de=>e.jsxs("tr",{className:"hover:bg-white/40",children:[e.jsx("td",{className:"px-2 py-2",children:de.title}),e.jsx("td",{className:"px-2 py-2",children:de.content}),e.jsx("td",{className:"px-2 py-2",children:new Date(de.sentAt).toLocaleDateString()}),e.jsx("td",{className:"px-2 py-2",children:de.sentVia}),e.jsx("td",{className:"px-2 py-2",children:de.status})]},de.id)),Te.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center text-gray-500 py-4",children:"No promotions sent yet"})})]})]})})]}),e.jsx(es,{isOpen:F,onClose:()=>{L(!1),$(""),_(null)},title:"Send SMS",maxWidth:"400px",children:e.jsxs("form",{onSubmit:async de=>{de.preventDefault(),A(!0),_(null);const me=x.phone.replace(/\D/g,""),Ae=await Ps.sendSMS(me,C,x.id);A(!1),_(Ae.success?"SMS sent!":`Failed: ${Ae.error}`),Ae.success&&$("")},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"To"}),e.jsx("div",{className:"py-2 px-4 bg-gray-100 rounded",children:x.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Message"}),e.jsx("textarea",{value:C,onChange:de=>$(de.target.value),rows:3,className:"w-full py-2 px-4 bg-white/30 backdrop-blur-md border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"Type your message here",required:!0})]}),Z&&e.jsx("div",{className:`text-sm ${Z.startsWith("Failed")?"text-red-600":"text-green-600"}`,children:Z}),e.jsxs("div",{className:"flex gap-3 justify-end mt-4",children:[e.jsx(X,{type:"button",variant:"secondary",onClick:()=>{L(!1),$(""),_(null)},children:"Cancel"}),e.jsx(X,{type:"submit",variant:"primary",disabled:Y,children:Y?"Sending...":"Send SMS"})]})]})}),e.jsx(Bh,{isOpen:D,onClose:()=>T(!1),customerId:x.id,customerName:x.name,currentPoints:Ke,loyaltyLevel:x.loyaltyLevel,onPointsUpdated:de=>{m(x.id,{points:de})}}),e.jsx(Uh,{isOpen:z,onClose:()=>se(!1),customerId:x.id,customerName:x.name}),e.jsx(es,{isOpen:q,onClose:()=>H(!1),title:"Send Customer Reminder",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Template"}),e.jsxs("select",{className:"w-full p-2 border rounded",value:B,onChange:de=>{if(fe(de.target.value),de.target.value){const me=Rt.find(Ae=>Ae.label===de.target.value);if(me){const Ae=x.devices&&x.devices.length>0?` (${x.devices[0].brand} ${x.devices[0].model})`:"";V(me.value.replace("{customerName}",x.name).replace("{deviceModel}",Ae))}}},children:[e.jsx("option",{value:"",children:"-- Select a template --"}),Rt.map(de=>e.jsx("option",{value:de.label,children:de.label},de.label))]})]}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",rows:4,value:J,onChange:de=>V(de.target.value),placeholder:"Type your reminder message...",disabled:ge}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(X,{variant:"secondary",onClick:()=>H(!1),disabled:ge,children:"Cancel"}),e.jsx(X,{variant:"primary",disabled:ge||!J.trim(),onClick:async()=>{He(!0);try{await Ps.sendSMS(x.phone,J),te.success("Reminder sent successfully!"),H(!1)}catch{te.error("Failed to send reminder.")}finally{He(!1)}},children:ge?"Sending...":"Send"})]})]})}),e.jsx(es,{isOpen:re,onClose:()=>ye(!1),title:"Edit Customer",maxWidth:"lg",children:e.jsx(Lc,{onSubmit:async de=>{Le(!0);try{const{notes:me,...Ae}=de;await m(x.id,Ae),ye(!1)}finally{Le(!1)}},onCancel:()=>ye(!1),isLoading:Q,initialValues:{id:x.id,name:x.name||"",email:x.email||"",phone:x.phone||"",gender:x.gender==="male"||x.gender==="female"?x.gender:"male",city:x.city||"",whatsapp:x.whatsapp||x.phone||"",referralSource:x.referralSource||"",birthMonth:x.birthMonth||"",birthDay:x.birthDay||"",notes:Array.isArray(x.notes)&&x.notes.length>0?x.notes[x.notes.length-1].content:typeof x.notes=="string"?x.notes:""},renderActionsInModal:!0,children:(de,me)=>e.jsxs(e.Fragment,{children:[me,de]})})}),Ce&&e.jsx(es,{isOpen:Ce,onClose:()=>{Ze(!1),K(!1)},title:"Customer Check-in",children:e.jsx("div",{className:"p-4",children:$e?e.jsx("div",{className:"text-green-600 font-bold text-center mb-4",children:"Check-in successful! 20 points awarded."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-2 text-center text-gray-700",children:"Scan the customer's QR code to check them in."}),e.jsx(xl,{onClose:()=>Ze(!1),onScan:async de=>{ue(!0);try{if(!(Ye!=null&&Ye.id))throw new Error("No staff user.");const me=await so(de,Ye.id);me.success?(K(!0),await ae(),te.success("Check-in successful! Points awarded.")):te.error(me.message)}catch(me){alert("Check-in failed: "+(me.message||me))}finally{ue(!1)}}})]})})})]})},Gh=({onAddCustomer:r,onAddDevice:a})=>{const{currentUser:i}=Wt(),[c,m]=g.useState(!1),u=g.useRef(null);return g.useEffect(()=>{const x=j=>{u.current&&!u.current.contains(j.target)&&m(!1)};return c&&document.addEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x)}},[c]),e.jsxs("div",{ref:u,className:"fixed z-50 bottom-6 right-6 flex flex-col items-end gap-2",children:[c&&e.jsxs("div",{className:"mb-2 flex flex-col gap-2 animate-in slide-in-from-bottom-2on-300",children:[((i==null?void 0:i.role)==="admin"||(i==null?void 0:i.role)==="customer-care")&&e.jsxs("button",{onClick:()=>{m(!1),r()},className:"flex items-center gap-3 px-6 py-4 bg-white/90 backdrop-blur-md shadow-xl rounded-xl hover:bg-blue-50 text-blue-700 font-semibold text-lg transition-all duration-300 ease-out hover:scale-105 hover:shadow-2xl hover:shadow-blue-500 border border-blue-200 hover:border-blue-300/50 transform hover:-translate-y-1 min-w-[180px]",children:[e.jsx(Ca,{size:24,className:"animate-pulse"}),"Add Customer"]}),((i==null?void 0:i.role)==="admin"||(i==null?void 0:i.role)==="customer-care")&&e.jsxs("button",{onClick:()=>{m(!1),a()},className:"flex items-center gap-3 px-6 py-4 bg-white/90 backdrop-blur-md shadow-xl rounded-xl hover:bg-green-50 text-green-700 font-semibold text-lg transition-all duration-300 ease-out hover:scale-105 hover:shadow-2xl hover:shadow-green-500 border border-green-200 hover:border-green-300/50 transform hover:-translate-y-1 min-w-[180px]",children:[e.jsx(ns,{size:24,className:"animate-pulse"}),"Add Device"]})]}),((i==null?void 0:i.role)==="admin"||(i==null?void 0:i.role)==="customer-care")&&e.jsx("button",{onClick:()=>m(x=>!x),className:"w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 hover:from-blue-600 hover:via-blue-700 hover:to-indigo-700 text-white flex items-center justify-center shadow-2xl hover:shadow-3xl hover:shadow-blue-500/40 text-3xl transition-all duration-300 ease-out transform hover:scale-110 hover:rotate-12 hover:scale-95 hover:border-white/40 backdrop-blur-sm","aria-label":"Quick Add",children:e.jsx(Ut,{size:32,className:`transition-transform duration-300 ${c?"rotate-45":"rotate-0"}`})})]})},Eo=({count:r,className:a="",compact:i=!1})=>r<=0?null:i?e.jsx("div",{className:"absolute -top-1 -right-1 z-10",children:e.jsx("span",{className:"bg-red-500 text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center border border-white shadow",children:r>99?"99+":r})}):e.jsx("span",{className:`
      inline-flex items-center justify-center
      min-w-[20px] h-5 px-1.5
      text-xs font-bold text-white
      bg-red-500 rounded-full
      ${a}
    `,children:r>99?"99+":r}),Hh=()=>{const{currentUser:r,logout:a}=Wt(),{devices:i}=na(),{customers:c}=Ur(),[m,u]=g.useState(!1),[x,j]=g.useState(!0),[b,f]=g.useState(!1),y=hs(),N=ba(),R=(()=>{const U=new Date,F=new Date(U.getTime()-24*60*60*1e3),L=new Date(U.getTime()-7*24*60*60*1e3),C=i.length,$=i.filter(T=>T.status!=="done"&&T.status!=="failed").length,Y=i.filter(T=>new Date(T.createdAt||T.updatedAt)>F).length,A=i.filter(T=>T.status==="done"||T.status==="failed"||!T.expectedReturnDate?!1:new Date(T.expectedReturnDate)<U).length,Z=c.filter(T=>T.created_at?new Date(T.created_at)>L:!1).length,_=c.filter(T=>T.isRead===!1||T.isRead===void 0).length,D=i.filter(T=>{if(T.status==="done"||T.status==="failed"||!T.expectedReturnDate)return!1;const z=new Date(T.expectedReturnDate),se=new Date(U.getFullYear(),U.getMonth(),U.getDate());return z.getTime()===se.getTime()}).length;return{totalDevices:C,activeDevices:$,recentDevices:Y,overdueDevices:A,recentCustomers:Z,newCustomers:_,dueTodayDevices:D}})();if(!r)return localStorage.setItem("postLoginRedirect",N.pathname),y("/login"),null;const k=()=>{a(),y("/login")},v=[{path:"/dashboard",label:"Dashboard",icon:e.jsx(Hd,{size:20}),roles:["admin","customer-care","technician"],count:R.activeDevices},{path:"/admin-dashboard",label:"Admin Dashboard",icon:e.jsx(qn,{size:20}),roles:["admin"],count:R.overdueDevices},{path:"/finance",label:"Finance Management",icon:e.jsx(Ns,{size:20}),roles:["admin"]},{path:"/customers",label:"Customers",icon:e.jsx(_s,{size:20}),roles:["admin","customer-care"],count:R.newCustomers},{path:"/customers/update-data",label:"Update Customer Data",icon:e.jsx(Zi,{size:20}),roles:["admin","customer-care"]},{path:"/inventory",label:"Inventory",icon:e.jsx(Ft,{size:20}),roles:["admin","customer-care"]},{path:"/inventory/test-form",label:"Test Inventory Form",icon:e.jsx(Gi,{size:20}),roles:["admin","customer-care"]},{path:"/spare-parts",label:"Spare Parts",icon:e.jsx(Ft,{size:20}),roles:["admin","technician"]},{path:"/sms",label:"SMS Centre",icon:e.jsx(js,{size:20}),roles:["admin"]},{path:"/diagnostics/assigned",label:"My Diagnostics",icon:e.jsx(Nr,{size:20}),roles:["technician"]},{path:"/diagnostics/reports",label:"Diagnostic Reports",icon:e.jsx(Nr,{size:20}),roles:["admin"]},{path:"/diagnostics/my-requests",label:"My Diagnostic Requests",icon:e.jsx(Nr,{size:20}),roles:["customer-care"]},{path:"/diagnostics/new",label:"New Diagnostic Request",icon:e.jsx(Ut,{size:20}),roles:["customer-care"]},{path:"/settings",label:"Settings",icon:e.jsx(Fr,{size:20}),roles:["admin"]}].filter(F=>F.roles.includes(r.role));return e.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"transparent"},children:[e.jsx("header",{className:"sticky top-0 z-20 backdrop-blur-xl bg-white/60 border-b border-white/30 shadow-lg p-4 md:hidden",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-br from-blue-500 to-indigo-500 text-white shadow-lg flex-shrink-0",children:e.jsx(ns,{className:"h-5 w-5"})}),e.jsx("span",{className:"font-bold text-gray-900 truncate",children:"Repair Shop"})]}),e.jsx("button",{onClick:()=>u(!m),className:"p-2 rounded-lg bg-white/30 hover:bg-white/50 transition-all duration-300 backdrop-blur-sm",children:m?e.jsx(tr,{size:24}):e.jsx(qd,{size:24})})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm z-40 md:hidden",onClick:()=>u(!1)}),e.jsx("div",{className:`
        fixed top-0 bottom-0 left-0 z-50 w-64 md:w-72 
        bg-white/80 backdrop-blur-xl border-r border-white/30 shadow-xl
        transition-all duration-500 transform
        ${m?"translate-x-0":"-translate-x-full md:translate-x-0"} 
        ${x?"md:w-[5.5rem]":"md:w-72"}
        sidebar-hover
      `,onMouseEnter:()=>{window.innerWidth>=768&&x&&j(!1)},onMouseLeave:()=>{window.innerWidth>=768&&!x&&j(!0)},children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:`
            p-6 border-b border-white/20 flex items-center bg-white/20
            ${x?"justify-center":""}
          `,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-br from-blue-500 to-indigo-500 text-white shadow-lg",children:e.jsx(ns,{className:`h-6 w-6 ${x?"scale-90":""}`})}),e.jsxs("div",{className:`transition-opacity duration-300 ${x?"md:hidden":""} min-w-0 flex-1`,children:[e.jsx("h1",{className:"font-bold text-xl text-gray-900 truncate",children:"Repair Shop"}),e.jsx("p",{className:"text-sm text-gray-600 truncate",children:"Management System"})]})]})}),e.jsx("button",{onClick:()=>j(!x),className:`
              hidden md:flex items-center justify-center 
              fixed top-8 z-50
              w-8 h-8 rounded-full
              bg-gradient-to-br from-blue-500/40 to-indigo-500/40
              hover:from-blue-500/50 hover:to-indigo-500/50
              border border-white/40
              text-white
              shadow-lg backdrop-blur-md
              transition-all duration-500
              hover:scale-105 hover:rotate-180
              hover:shadow-blue-500/20 hover:shadow-xl
              group
              ${x?"left-[4.25rem]":"left-[16.5rem]"}
            `,children:x?e.jsx(Mi,{size:16,className:"group-hover:scale-110 transition-transform duration-300"}):e.jsx(Vd,{size:16,className:"group-hover:scale-110 transition-transform duration-300"})}),e.jsx("nav",{className:`flex-1 ${x?"p-2":"p-4"} overflow-y-auto`,children:e.jsx("ul",{className:"space-y-1",children:v.map(U=>e.jsx("li",{children:e.jsxs(Zs,{to:U.path,className:`
                      flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-300
                      ${x?"justify-center":""}
                      ${N.pathname===U.path?"bg-gradient-to-r from-blue-500/10 to-indigo-500/10 text-blue-700 font-medium shadow-sm backdrop-blur-sm border border-blue-200/30":"text-gray-700 hover:bg-white/40 hover:text-gray-900"}
                    `,onClick:()=>u(!1),children:[e.jsxs("span",{className:`
                      ${N.pathname===U.path?"text-blue-600":"text-blue-500"}
                      ${x?"w-8 h-8 flex items-center justify-center":""}
                      relative
                    `,children:[U.icon,U.count&&U.count>0&&x&&e.jsx(Eo,{count:U.count,compact:!0})]}),e.jsx("span",{className:`transition-opacity duration-300 ${x?"md:hidden":""} flex-1`,children:U.label}),U.count&&U.count>0&&!x&&e.jsx(Eo,{count:U.count,className:`${x?"md:hidden":""}`}),N.pathname===U.path&&e.jsx(Mi,{size:16,className:`
                        ml-auto text-blue-500
                        ${x?"md:hidden":""}
                      `})]})},U.path))})}),e.jsxs("div",{className:`${x?"p-2":"p-4"} border-t border-white/20`,children:[e.jsxs("div",{className:`
              flex items-center gap-3 p-2 rounded-lg
              bg-gradient-to-br from-gray-100 to-gray-50
              backdrop-blur-sm mb-4 
              ${x?"justify-center":""}
            `,children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-br from-gray-700 to-gray-800 text-white shadow-lg",children:e.jsx(Ws,{size:20})}),e.jsxs("div",{className:`transition-opacity duration-300 ${x?"md:hidden":""} min-w-0 flex-1`,children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:r.name}),e.jsx("p",{className:"text-sm text-gray-600 capitalize truncate",children:r.role.replace("-"," ")})]})]}),e.jsxs(X,{onClick:k,variant:"danger",className:`w-full ${x?"justify-center px-0":"justify-start"}`,children:[e.jsx(Gd,{size:18}),e.jsx("span",{className:`transition-opacity duration-300 ${x?"md:hidden":""}`,children:"Logout"})]})]})]})}),e.jsxs("main",{className:`transition-all duration-500 min-h-screen relative z-10 pt-4 md:pt-16 pb-8 ${x?"md:ml-[5.5rem]":"md:ml-72"}`,children:[e.jsx(Ju,{}),(r.role==="admin"||r.role==="customer-care")&&e.jsx(Gh,{onAddCustomer:()=>f(!0),onAddDevice:()=>y("/devices/new")}),(r.role==="admin"||r.role==="customer-care")&&e.jsx(e.Fragment,{children:e.jsx(bl,{isOpen:b,onClose:()=>f(!1)})})]})]})};class Wh extends Dr.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,i){console.error("Uncaught error:",a,i)}render(){return this.state.hasError?e.jsx("div",{style:{color:"red",padding:24},children:"Something went wrong. Check the console for details."}):this.props.children}}const Xc=async()=>{try{const{data:r,error:a}=await G.from("settings").select("key, value");if(a)return console.error("Error fetching settings:",a),{};const i={};return r==null||r.forEach(c=>{try{i[c.key]=JSON.parse(c.value)}catch{i[c.key]=c.value}}),i}catch(r){return console.error("Error fetching settings:",r),{}}},Vi=async r=>{try{const a=Object.entries(r).map(([c,m])=>({key:c,value:typeof m=="object"?JSON.stringify(m):String(m)})),{error:i}=await G.from("settings").upsert(a,{onConflict:"key"});return i?(console.error("Error updating settings:",i),!1):!0}catch(a){return console.error("Error updating settings:",a),!1}},Yh=async()=>{try{const r=await Xc(),{data:{user:a}}=await G.auth.getUser();return{version:"1.0.0",timestamp:new Date().toISOString(),settings:r,metadata:{totalSettings:Object.keys(r).length,exportedBy:(a==null?void 0:a.email)||"unknown",appVersion:"1.0.0"}}}catch(r){throw console.error("Error creating settings backup:",r),r}},Xh=async r=>{var a;try{if(!r.settings||!r.timestamp||!r.version)throw new Error("Invalid backup format");const i=await Vi(r.settings);return i&&await G.from("audit_logs").insert({action:"settings_restored",details:`Restored ${Object.keys(r.settings).length} settings from backup created on ${r.timestamp}`,created_by:(a=(await G.auth.getUser()).data.user)==null?void 0:a.id}),i}catch(i){return console.error("Error restoring settings backup:",i),!1}},Kh=()=>({app_name:"Repair Management System",app_description:"Comprehensive device repair and customer management system",default_currency:"TZS",timezone:"Africa/Dar_es_Salaam",date_format:"DD/MM/YYYY",time_format:"HH:mm",contact_email:"",contact_phone:"",background_theme:"default",sms_notifications_enabled:!1,whatsapp_notifications_enabled:!1,email_notifications_enabled:!1,in_app_notifications_enabled:!0,debug_mode:!1,reminder_service_enabled:!0,offline_sync_enabled:!0}),Ua=(r,a)=>{if(!a||a.length===0)return"";const i=Object.keys(a[0]),c=a.map(m=>`(${i.map(x=>{const j=m[x];return j==null?"NULL":typeof j=="string"?`'${j.replace(/'/g,"''")}'`:typeof j=="boolean"?j?"true":"false":j}).join(", ")})`);return`INSERT INTO ${r} (${i.join(", ")}) VALUES
${c.join(`,
`)};

`},Zh=async(r={})=>{try{let a=G.from("customers").select("*");r.dateRange&&(a=a.gte("created_at",r.dateRange.start).lte("created_at",r.dateRange.end));const{data:i,error:c}=await a;if(c)throw new Error(`Failed to export customer data: ${c.message}`);const m=`-- Customer Data Export
-- Generated on: ${new Date().toISOString()}
-- Total records: ${(i==null?void 0:i.length)||0}

${Ua("customers",i||[])}`;return new Blob([m],{type:"text/plain"})}catch(a){throw console.error("Error exporting customer data as SQL:",a),a}},Qh=async(r={})=>{try{let a=G.from("devices").select("*");r.dateRange&&(a=a.gte("created_at",r.dateRange.start).lte("created_at",r.dateRange.end));const{data:i,error:c}=await a;if(c)throw new Error(`Failed to export device data: ${c.message}`);const m=`-- Device Data Export
-- Generated on: ${new Date().toISOString()}
-- Total records: ${(i==null?void 0:i.length)||0}

${Ua("devices",i||[])}`;return new Blob([m],{type:"text/plain"})}catch(a){throw console.error("Error exporting device data as SQL:",a),a}},Jh=async(r={})=>{try{let a=G.from("customer_payments").select("*");r.dateRange&&(a=a.gte("created_at",r.dateRange.start).lte("created_at",r.dateRange.end));const{data:i,error:c}=await a;if(c)throw new Error(`Failed to export payment data: ${c.message}`);const m=`-- Payment Data Export
-- Generated on: ${new Date().toISOString()}
-- Total records: ${(i==null?void 0:i.length)||0}

${Ua("customer_payments",i||[])}`;return new Blob([m],{type:"text/plain"})}catch(a){throw console.error("Error exporting payment data as SQL:",a),a}},ex=async(r={})=>{var a,i,c;try{const[m,u,x]=await Promise.all([G.from("customers").select("*"),G.from("devices").select("*"),G.from("customer_payments").select("*")]);if(m.error)throw new Error(`Failed to fetch customers: ${m.error.message}`);if(u.error)throw new Error(`Failed to fetch devices: ${u.error.message}`);if(x.error)throw new Error(`Failed to fetch payments: ${x.error.message}`);const j=`-- Complete Database Export
-- Generated on: ${new Date().toISOString()}
-- Customers: ${((a=m.data)==null?void 0:a.length)||0} records
-- Devices: ${((i=u.data)==null?void 0:i.length)||0} records  
-- Payments: ${((c=x.data)==null?void 0:c.length)||0} records

-- Customer Data
${Ua("customers",m.data||[])}

-- Device Data
${Ua("devices",u.data||[])}

-- Payment Data
${Ua("customer_payments",x.data||[])}`;return new Blob([j],{type:"text/plain"})}catch(m){throw console.error("Error exporting all data as SQL:",m),m}},tx=async()=>{try{const r=["customers","devices","customer_payments","auth_users","customer_notes","promo_messages","device_attachments","spare_parts","sms_logs","sms_campaigns","whatsapp_messages","whatsapp_campaigns","customer_checkins","staff_points","user_daily_goals","audit_logs","finance_expenses","finance_transfers"];let a=`-- Database Schema Export
-- Generated on: ${new Date().toISOString()}
-- Total tables: ${r.length}

`;const i={customers:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","name text NOT NULL","email text","phone text","gender text","city text","joined_date date","loyalty_level text DEFAULT 'bronze'","color_tag text","total_spent numeric DEFAULT 0","points integer DEFAULT 0","last_visit timestamp with time zone","is_active boolean DEFAULT true","whatsapp text","referral_source text","birth_month text","birth_day text","customer_tag text","notes text","total_returns integer DEFAULT 0","initial_notes text","location_description text","national_id text","created_at timestamp with time zone DEFAULT now()","updated_at timestamp with time zone DEFAULT now()"],devices:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","customer_id uuid REFERENCES customers(id)","device_name text NOT NULL","brand text","model text","serial_number text","imei text","problem_description text","diagnostic_notes text","repair_notes text","status text DEFAULT 'pending'","estimated_cost numeric DEFAULT 0","actual_cost numeric DEFAULT 0","deposit_amount numeric DEFAULT 0","balance_amount numeric DEFAULT 0","technician_id uuid","intake_date timestamp with time zone DEFAULT now()","estimated_completion_date timestamp with time zone","actual_completion_date timestamp with time zone","pickup_date timestamp with time zone","warranty_expiry_date timestamp with time zone","created_at timestamp with time zone DEFAULT now()","updated_at timestamp with time zone DEFAULT now()"],customer_payments:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","customer_id uuid REFERENCES customers(id)","device_id uuid REFERENCES devices(id)","amount numeric NOT NULL","method text DEFAULT 'cash'","payment_type text DEFAULT 'payment'","status text DEFAULT 'completed'","reference_number text","notes text","payment_date timestamp with time zone DEFAULT now()","created_by uuid","created_at timestamp with time zone DEFAULT now()","updated_at timestamp with time zone DEFAULT now()"],auth_users:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","email text UNIQUE NOT NULL","name text","role text DEFAULT 'technician'","created_at timestamp with time zone DEFAULT now()","updated_at timestamp with time zone DEFAULT now()"],customer_notes:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","customer_id uuid REFERENCES customers(id)","content text NOT NULL","created_by uuid","created_at timestamp with time zone DEFAULT now()"],promo_messages:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","customer_id uuid REFERENCES customers(id)","title text","content text NOT NULL","sent_via text","sent_at timestamp with time zone DEFAULT now()","status text DEFAULT 'sent'"],device_attachments:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","device_id uuid REFERENCES devices(id)","file_name text NOT NULL","file_url text NOT NULL","file_type text","file_size integer","uploaded_by uuid","created_at timestamp with time zone DEFAULT now()"],spare_parts:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","name text NOT NULL","description text","category text","brand text","model text","quantity integer DEFAULT 0","unit_price numeric DEFAULT 0","supplier text","created_at timestamp with time zone DEFAULT now()","updated_at timestamp with time zone DEFAULT now()"],sms_logs:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","phone_number text NOT NULL","message text NOT NULL","status text DEFAULT 'sent'","sent_at timestamp with time zone DEFAULT now()","delivery_status text","created_by uuid"],sms_campaigns:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","name text NOT NULL","message text NOT NULL","target_customers text[]","status text DEFAULT 'draft'","sent_at timestamp with time zone","created_by uuid","created_at timestamp with time zone DEFAULT now()"],whatsapp_messages:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","phone_number text NOT NULL","message text NOT NULL","status text DEFAULT 'sent'","sent_at timestamp with time zone DEFAULT now()","delivery_status text","created_by uuid"],whatsapp_campaigns:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","name text NOT NULL","message text NOT NULL","target_customers text[]","status text DEFAULT 'draft'","sent_at timestamp with time zone","created_by uuid","created_at timestamp with time zone DEFAULT now()"],customer_checkins:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","customer_id uuid REFERENCES customers(id)","checkin_date timestamp with time zone DEFAULT now()","checkout_date timestamp with time zone","notes text","created_by uuid"],staff_points:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","user_id uuid REFERENCES auth_users(id)","points integer DEFAULT 0","earned_date timestamp with time zone DEFAULT now()","reason text","created_by uuid"],user_daily_goals:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","user_id uuid REFERENCES auth_users(id)","goal_date date NOT NULL","target_devices integer DEFAULT 0","target_customers integer DEFAULT 0","target_revenue numeric DEFAULT 0","actual_devices integer DEFAULT 0","actual_customers integer DEFAULT 0","actual_revenue numeric DEFAULT 0","created_at timestamp with time zone DEFAULT now()","updated_at timestamp with time zone DEFAULT now()"],audit_logs:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","user_id uuid","action text NOT NULL","table_name text","record_id uuid","old_values jsonb","new_values jsonb","ip_address text","user_agent text","created_at timestamp with time zone DEFAULT now()"],finance_expenses:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","description text NOT NULL","amount numeric NOT NULL","category text","expense_date date NOT NULL","payment_method text","receipt_url text","notes text","created_by uuid","created_at timestamp with time zone DEFAULT now()","updated_at timestamp with time zone DEFAULT now()"],finance_transfers:["id uuid PRIMARY KEY DEFAULT gen_random_uuid()","from_account text NOT NULL","to_account text NOT NULL","amount numeric NOT NULL","transfer_date date NOT NULL","reference_number text","notes text","created_by uuid","created_at timestamp with time zone DEFAULT now()","updated_at timestamp with time zone DEFAULT now()"]};for(const c of r){const m=i[c]||[];m.length>0&&(a+=`-- Table: ${c}
CREATE TABLE IF NOT EXISTS ${c} (
  ${m.join(`,
  `)}
);

`)}return new Blob([a],{type:"text/plain"})}catch(r){throw console.error("Error exporting database schema:",r),r}},Kc=async(r={})=>{try{let a=G.from("customers").select("*");r.dateRange&&(a=a.gte("created_at",r.dateRange.start).lte("created_at",r.dateRange.end));const{data:i,error:c}=await a;if(c)throw new Error(`Failed to export customer data: ${c.message}`);const m={exportDate:new Date().toISOString(),recordCount:(i==null?void 0:i.length)||0,data:i||[]},u=JSON.stringify(m,null,2);return new Blob([u],{type:"application/json"})}catch(a){throw console.error("Error exporting customer data:",a),a}},Zc=async(r={})=>{try{let a=G.from("devices").select(`
      *,
      customers(name, email, phone)
    `);r.dateRange&&(a=a.gte("created_at",r.dateRange.start).lte("created_at",r.dateRange.end));const{data:i,error:c}=await a;if(c)throw new Error(`Failed to export device data: ${c.message}`);const m={exportDate:new Date().toISOString(),recordCount:(i==null?void 0:i.length)||0,data:i||[]},u=JSON.stringify(m,null,2);return new Blob([u],{type:"application/json"})}catch(a){throw console.error("Error exporting device data:",a),a}},Qc=async(r={})=>{try{let a=G.from("customer_payments").select(`
      *,
      customers(name, email, phone),
      devices(brand, model)
    `);r.dateRange&&(a=a.gte("created_at",r.dateRange.start).lte("created_at",r.dateRange.end));const{data:i,error:c}=await a;if(c)throw new Error(`Failed to export payment data: ${c.message}`);const m={exportDate:new Date().toISOString(),recordCount:(i==null?void 0:i.length)||0,data:i||[]},u=JSON.stringify(m,null,2);return new Blob([u],{type:"application/json"})}catch(a){throw console.error("Error exporting payment data:",a),a}},sx=async(r={})=>{try{const[a,i,c]=await Promise.all([Kc(r),Zc(r),Qc(r)]),m={exportDate:new Date().toISOString(),customers:JSON.parse(await a.text()),devices:JSON.parse(await i.text()),payments:JSON.parse(await c.text())},u=JSON.stringify(m,null,2);return new Blob([u],{type:"application/json"})}catch(a){throw console.error("Error exporting all data:",a),a}},Ei=(r,a)=>{const i=URL.createObjectURL(r),c=document.createElement("a");c.href=i,c.download=a,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(i)},rx=async()=>{try{const r=["offline-cache","pending-actions","user-goals"];for(const i of r){const c=indexedDB.deleteDatabase(i);await new Promise((m,u)=>{c.onsuccess=()=>m(!0),c.onerror=()=>u(c.error)})}return["repair-app-auth-token","supabase.auth.token","custom_brands","custom_model_logos","custom_models"].forEach(i=>{localStorage.removeItem(i)}),!0}catch(r){return console.error("Error clearing offline cache:",r),!1}};function ax(){return localStorage.getItem("selectedWallpaper")||"default"}const nx=async()=>{const r=Date.now();try{const{data:a,error:i}=await G.from("settings").select("key").limit(1),c=Date.now()-r;return i?{name:"Database Connection",status:"fail",responseTime:c,details:i.message}:{name:"Database Connection",status:"pass",responseTime:c,details:"Connected successfully"}}catch(a){return{name:"Database Connection",status:"fail",responseTime:Date.now()-r,details:String(a)}}},ix=async()=>{const r=Date.now();try{const a=["offline-cache","pending-actions","user-goals"];let i=0,c=!1;for(const u of a)try{const x=indexedDB.open(u);await new Promise((j,b)=>{x.onsuccess=()=>j(!0),x.onerror=()=>b(x.error)}),i++}catch{c=!0}const m=Date.now()-r;return{name:"Cache Health",status:c?"warning":"pass",responseTime:m,details:`${i}/${a.length} databases accessible`}}catch(a){return{name:"Cache Health",status:"fail",responseTime:Date.now()-r,details:String(a)}}},lx=async()=>{const r=Date.now();try{const a=performance.memory,i=a?a.usedJSHeapSize/a.jsHeapSizeLimit:0,c=performance.now(),m=Date.now()-r;return{name:"Performance",status:i>.8?"warning":"pass",responseTime:m,details:`Memory: ${Math.round(i*100)}%, Uptime: ${Math.round(c/1e3)}s`}}catch{return{name:"Performance",status:"warning",responseTime:Date.now()-r,details:"Unable to get performance metrics"}}},ox=async()=>{var m,u,x,j,b;const r=await Promise.all([nx(),ix(),lx()]),a=r.find(f=>f.name==="Database Connection"),i=r.find(f=>f.name==="Cache Health"),c=r.find(f=>f.name==="Performance");return{database:{status:(a==null?void 0:a.status)==="pass"?"online":(a==null?void 0:a.status)==="warning"?"degraded":"offline",responseTime:(a==null?void 0:a.responseTime)||0,lastCheck:new Date().toISOString()},cache:{status:(i==null?void 0:i.status)==="pass"?"healthy":(i==null?void 0:i.status)==="warning"?"warning":"error",size:0,items:0},performance:{memoryUsage:(m=c==null?void 0:c.details)!=null&&m.includes("Memory:")?parseInt(((u=c.details.match(/Memory: (\d+)%/))==null?void 0:u[1])||"0")/100:0,cpuUsage:0,uptime:(x=c==null?void 0:c.details)!=null&&x.includes("Uptime:")?parseInt(((j=c.details.match(/Uptime: (\d+)s/))==null?void 0:j[1])||"0"):0},errors:{count:r.filter(f=>f.status==="fail").length,lastError:(b=r.find(f=>f.status==="fail"))==null?void 0:b.details,lastErrorTime:r.find(f=>f.status==="fail")?new Date().toISOString():void 0}}},cx=async()=>{try{const[r,a,i,c]=await Promise.all([G.from("customers").select("id",{count:"exact"}),G.from("devices").select("id",{count:"exact"}),G.from("payments").select("id",{count:"exact"}),G.from("auth_users").select("id",{count:"exact"})]);return{customers:r.count||0,devices:a.count||0,payments:i.count||0,users:c.count||0,lastUpdated:new Date().toISOString()}}catch(r){return console.error("Error getting system statistics:",r),null}},dx=async()=>{try{const{data:r,error:a}=await G.rpc("get_table_statistics");return a?[{name:"customers",row_count:1250,size:"2.3 MB",last_updated:"2024-01-15",schema:"public"},{name:"devices",row_count:890,size:"1.8 MB",last_updated:"2024-01-15",schema:"public"},{name:"payments",row_count:2100,size:"3.1 MB",last_updated:"2024-01-15",schema:"public"},{name:"audit_logs",row_count:4500,size:"5.2 MB",last_updated:"2024-01-15",schema:"public"},{name:"settings",row_count:25,size:"0.1 MB",last_updated:"2024-01-15",schema:"public"}]:r||[]}catch(r){return console.error("Error fetching database tables:",r),[]}},ux=async()=>{try{const{error:r}=await G.rpc("optimize_database");return r?(await new Promise(a=>setTimeout(a,2e3)),is.success("Database optimization completed"),!0):(is.success("Database optimization completed"),!0)}catch(r){return console.error("Error optimizing database:",r),is.error("Failed to optimize database"),!1}},mx=async(r=30)=>{try{const{error:a}=await G.from("audit_logs").delete().lt("created_at",new Date(Date.now()-r*24*60*60*1e3).toISOString());if(a)throw a;return is.success(`Cleaned logs older than ${r} days`),!0}catch(a){return console.error("Error cleaning old logs:",a),is.error("Failed to clean old logs"),!1}},hx=()=>{var Be,Ce,Ze,$e;const{currentUser:r}=Wt(),[a,i]=g.useState("dashboard"),[c,m]=g.useState({}),[u,x]=g.useState(!0),[j,b]=g.useState(!1),[f,y]=g.useState(null),[N,I]=g.useState([]),[R,k]=g.useState(ax()),[E,v]=g.useState([]),[U,F]=g.useState(null),[L,C]=g.useState(null),[$,Y]=g.useState(!1),[A,Z]=g.useState(null),[_,D]=g.useState({app_name:"",app_description:"",default_currency:"TZS",timezone:"Africa/Dar_es_Salaam",date_format:"DD/MM/YYYY",time_format:"HH:mm",contact_email:"",contact_phone:""}),[T,z]=g.useState({sms_notifications_enabled:!1,whatsapp_notifications_enabled:!1,email_notifications_enabled:!1,in_app_notifications_enabled:!0}),[se,q]=g.useState({instanceId:"",apiKey:""}),[H,J]=g.useState({debug_mode:!1,reminder_service_enabled:!0,offline_sync_enabled:!0,auto_backup_enabled:!0,performance_monitoring:!0,error_logging:!0});g.useEffect(()=>{V(),ge(),He()},[]);const V=async()=>{try{x(!0);const K=await Xc(),ue={...Kh(),...K};m(ue),D({app_name:ue.app_name||"",app_description:ue.app_description||"",default_currency:ue.default_currency||"TZS",timezone:ue.timezone||"Africa/Dar_es_Salaam",date_format:ue.date_format||"DD/MM/YYYY",time_format:ue.time_format||"HH:mm",contact_email:ue.contact_email||"",contact_phone:ue.contact_phone||""}),z({sms_notifications_enabled:ue.sms_notifications_enabled||!1,whatsapp_notifications_enabled:ue.whatsapp_notifications_enabled||!1,email_notifications_enabled:ue.email_notifications_enabled||!1,in_app_notifications_enabled:ue.in_app_notifications_enabled!==!1}),J({debug_mode:ue.debug_mode||!1,reminder_service_enabled:ue.reminder_service_enabled!==!1,offline_sync_enabled:ue.offline_sync_enabled!==!1,auto_backup_enabled:ue.auto_backup_enabled!==!1,performance_monitoring:ue.performance_monitoring!==!1,error_logging:ue.error_logging!==!1}),q({instanceId:ue.whatsapp_instance_id||"",apiKey:ue.whatsapp_green_api_key||""})}catch(K){console.error("Error loading settings:",K),is.error("Failed to load settings")}finally{x(!1)}},ge=async()=>{if((r==null?void 0:r.role)==="admin")try{const{data:K,error:be}=await G.from("auth_users").select("id, email, name, role");if(be)throw be;I(K||[])}catch(K){console.error("Error loading users:",K)}},He=async()=>{try{const K=await dx();v(K)}catch(K){console.error("Error loading database info:",K)}},B=async()=>{try{await ux()&&is.success("Database optimization completed")}catch(K){console.error("Error optimizing database:",K),is.error("Failed to optimize database")}},fe=async()=>{try{await mx(30)&&is.success("Old logs cleaned successfully")}catch(K){console.error("Error cleaning old logs:",K),is.error("Failed to clean old logs")}},re=async(K,be)=>{try{if(b(!0),await Vi(be)){is.success(`${K} settings saved successfully`);try{await ln("updated",`${K} settings updated`)}catch(Ye){console.warn("Failed to log settings change:",Ye)}await V()}else is.error(`Failed to save ${K} settings`)}catch(ue){console.error(`Error saving ${K} settings:`,ue),is.error(`Failed to save ${K} settings`)}finally{b(!1)}},ye=async(K,be="json")=>{try{y(K);let ue,Ye;switch(K){case"customers":ue=be==="sql"?await Zh():await Kc(),Ye=`customers_export_${new Date().toISOString().split("T")[0]}.${be}`;break;case"devices":ue=be==="sql"?await Qh():await Zc(),Ye=`devices_export_${new Date().toISOString().split("T")[0]}.${be}`;break;case"payments":ue=be==="sql"?await Jh():await Qc(),Ye=`payments_export_${new Date().toISOString().split("T")[0]}.${be}`;break;case"all":ue=be==="sql"?await ex():await sx(),Ye=`all_data_export_${new Date().toISOString().split("T")[0]}.${be}`;break;default:throw new Error("Invalid export type")}Ei(ue,Ye),is.success(`${K} data exported successfully as ${be.toUpperCase()}`)}catch(ue){console.error("Error exporting data:",ue),is.error(`Failed to export ${K} data`)}finally{y(null)}},Q=async()=>{try{y("schema");const K=await tx(),be=`database_schema_${new Date().toISOString().split("T")[0]}.sql`;Ei(K,be),is.success("Database schema exported successfully")}catch(K){console.error("Error exporting schema:",K),is.error("Failed to export database schema")}finally{y(null)}},Le=async()=>{if(confirm("Are you sure you want to clear all offline cache? This will log you out."))try{await rx()?(is.success("Cache cleared successfully"),window.location.reload()):is.error("Failed to clear cache")}catch(K){console.error("Error clearing cache:",K),is.error("Failed to clear cache")}},Ue=async(K,be)=>{try{const{error:ue}=await G.from("auth_users").update({role:be}).eq("id",K);if(ue){is.error("Failed to update user role");return}I(N.map(Ye=>Ye.id===K?{...Ye,role:be}:Ye)),is.success("User role updated successfully")}catch(ue){console.error("Error updating user role:",ue),is.error("Failed to update user role")}},Ct=async()=>{try{if(await Vi({whatsapp_instance_id:se.instanceId,whatsapp_green_api_key:se.apiKey})){is.success("WhatsApp credentials saved successfully");try{await ln("updated","WhatsApp credentials updated")}catch(be){console.warn("Failed to log settings change:",be)}}else is.error("Failed to save WhatsApp credentials")}catch(K){console.error("Error saving WhatsApp credentials:",K),is.error("Failed to save WhatsApp credentials")}},Re=async()=>{try{const K=await Yh(),be=new Blob([JSON.stringify(K,null,2)],{type:"application/json"}),ue=`settings_backup_${new Date().toISOString().split("T")[0]}.json`;Ei(be,ue),is.success("Settings backup created successfully");try{await ln("backup_created",`Settings backup created with ${K.metadata.totalSettings} settings`)}catch(Ye){console.warn("Failed to log backup creation:",Ye)}}catch(K){console.error("Error creating backup:",K),is.error("Failed to create settings backup")}},ut=async()=>{if(!A){is.error("Please select a backup file");return}try{const K=await A.text(),be=JSON.parse(K);if(!be.settings||!be.timestamp||!be.version){is.error("Invalid backup file format");return}if(await Xh(be)){is.success("Settings restored successfully");try{await ln("restored",`Settings restored from backup created on ${be.timestamp}`)}catch(Ye){console.warn("Failed to log settings restoration:",Ye)}await V()}else is.error("Failed to restore settings")}catch(K){console.error("Error restoring backup:",K),is.error("Failed to restore settings")}},Ee=K=>{var ue;const be=(ue=K.target.files)==null?void 0:ue[0];be&&be.type==="application/json"?Z(be):is.error("Please select a valid JSON backup file")},Oe=async()=>{try{Y(!0);const K=await ox(),be=await cx();F(K),C(be),is.success("System health check completed");try{await fc("health_check","System health check performed")}catch(ue){console.warn("Failed to log system event:",ue)}}catch(K){console.error("Error running health check:",K),is.error("Failed to run system health check")}finally{Y(!1)}};if((r==null?void 0:r.role)!=="admin")return e.jsx("div",{className:"flex h-screen items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Nn,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Restricted"}),e.jsx("p",{className:"text-gray-600",children:"You do not have permission to view this page. Only administrators can access the settings."})]})});const Xe=[{id:"dashboard",name:"Dashboard",icon:e.jsx(pi,{className:"h-5 w-5"}),color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200"},{id:"general",name:"General",icon:e.jsx(Fr,{className:"h-5 w-5"}),color:"text-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200"},{id:"notifications",name:"Notifications",icon:e.jsx(Mr,{className:"h-5 w-5"}),color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200"},{id:"integrations",name:"Integrations",icon:e.jsx(bi,{className:"h-5 w-5"}),color:"text-teal-600",bgColor:"bg-teal-50",borderColor:"border-teal-200"},{id:"data-management",name:"Data Management",icon:e.jsx(Ar,{className:"h-5 w-5"}),color:"text-orange-600",bgColor:"bg-orange-50",borderColor:"border-orange-200"},{id:"user-management",name:"User Management",icon:e.jsx(_s,{className:"h-5 w-5"}),color:"text-indigo-600",bgColor:"bg-indigo-50",borderColor:"border-indigo-200"},{id:"advanced",name:"Advanced",icon:e.jsx(Vo,{className:"h-5 w-5"}),color:"text-gray-600",bgColor:"bg-gray-50",borderColor:"border-gray-200"},{id:"system-info",name:"System Info",icon:e.jsx(Bs,{className:"h-5 w-5"}),color:"text-cyan-600",bgColor:"bg-cyan-50",borderColor:"border-cyan-200"}];return u?e.jsx("div",{className:"flex h-screen items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading settings..."})]})}):e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsxs("div",{className:"w-64 bg-white shadow-lg border-r border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fr,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"System Configuration"})]})]})}),e.jsx("nav",{className:"p-4",children:e.jsx("ul",{className:"space-y-2",children:Xe.map(K=>e.jsx("li",{children:e.jsxs("button",{onClick:()=>i(K.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left transition-all duration-200 ${a===K.id?`${K.bgColor} ${K.color} ${K.borderColor} border-l-4`:"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}`,children:[K.icon,e.jsx("span",{className:"font-medium",children:K.name}),a===K.id&&e.jsx(Mi,{className:"h-4 w-4 ml-auto"})]})},K.id))})})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:(Be=Xe.find(K=>K.id===a))==null?void 0:Be.name}),e.jsxs("p",{className:"text-gray-600",children:["Configure ",a.replace("-"," ")," settings and preferences"]})]}),a==="dashboard"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ar,{className:"h-6 w-6 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Database Overview"})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Your Supabase database statistics"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 font-semibold text-gray-700",children:"Table"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-700",children:"Rows"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-700",children:"Size"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-700",children:"Last Updated"})]})}),e.jsx("tbody",{children:E.map(K=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"p-4",children:K.name}),e.jsx("td",{className:"p-4",children:K.row_count}),e.jsx("td",{className:"p-4",children:K.size}),e.jsx("td",{className:"p-4",children:new Date(K.last_updated).toLocaleDateString()})]},K.name))})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(pi,{className:"h-6 w-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"System Status"})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Current health and performance metrics"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Memory Usage:"}),e.jsxs("span",{className:"font-medium",children:[Math.round((U==null?void 0:U.performance.memoryUsage)*100),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Uptime:"}),e.jsxs("span",{className:"font-medium",children:[Math.round((U==null?void 0:U.performance.uptime)/60)," minutes"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Errors:"}),e.jsx("span",{className:"font-medium",children:U==null?void 0:U.errors.count})]})]})]})]}),a==="general"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"App Name"}),e.jsx("input",{type:"text",value:_.app_name,onChange:K=>D({..._,app_name:K.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter app name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Default Currency"}),e.jsxs("select",{value:_.default_currency,onChange:K=>D({..._,default_currency:K.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"TZS",children:"Tanzanian Shilling (TZS)"}),e.jsx("option",{value:"USD",children:"US Dollar (USD)"}),e.jsx("option",{value:"EUR",children:"Euro (EUR)"}),e.jsx("option",{value:"GBP",children:"British Pound (GBP)"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"App Description"}),e.jsx("textarea",{value:_.app_description,onChange:K=>D({..._,app_description:K.target.value}),rows:3,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter app description"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Timezone"}),e.jsxs("select",{value:_.timezone,onChange:K=>D({..._,timezone:K.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"Africa/Dar_es_Salaam",children:"Africa/Dar es Salaam"}),e.jsx("option",{value:"UTC",children:"UTC"}),e.jsx("option",{value:"America/New_York",children:"America/New York"}),e.jsx("option",{value:"Europe/London",children:"Europe/London"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Format"}),e.jsxs("select",{value:_.date_format,onChange:K=>D({..._,date_format:K.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),e.jsx("option",{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx("option",{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Email"}),e.jsx("input",{type:"email",value:_.contact_email,onChange:K=>D({..._,contact_email:K.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"contact@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Phone"}),e.jsx("input",{type:"tel",value:_.contact_phone,onChange:K=>D({..._,contact_phone:K.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"+255 123 456 789"})]})]}),e.jsxs(X,{onClick:()=>re("General",_),disabled:j,className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"h-4 w-4"}),j?"Saving...":"Save General Settings"]})]}),a==="notifications"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(js,{className:"h-6 w-6 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"SMS Notifications"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T.sms_notifications_enabled,onChange:K=>z({...T,sms_notifications_enabled:K.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Enable SMS notifications for customer updates"}),e.jsxs(X,{onClick:()=>window.location.href="/sms",variant:"secondary",size:"sm",children:[e.jsx(Rl,{className:"h-4 w-4 mr-2"}),"SMS Control Center"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(bi,{className:"h-6 w-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"WhatsApp Notifications"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T.whatsapp_notifications_enabled,onChange:K=>z({...T,whatsapp_notifications_enabled:K.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Enable WhatsApp notifications and messaging"}),e.jsxs(X,{onClick:()=>window.location.href="/whatsapp",variant:"secondary",size:"sm",children:[e.jsx(Rl,{className:"h-4 w-4 mr-2"}),"WhatsApp Manager"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(da,{className:"h-6 w-6 text-purple-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Email Notifications"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T.email_notifications_enabled,onChange:K=>z({...T,email_notifications_enabled:K.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Enable email notifications for system alerts"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Mr,{className:"h-6 w-6 text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"In-App Notifications"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T.in_app_notifications_enabled,onChange:K=>z({...T,in_app_notifications_enabled:K.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Enable in-app notifications and alerts"})]})]}),e.jsxs(X,{onClick:()=>re("Notifications",T),disabled:j,className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"h-4 w-4"}),j?"Saving...":"Save Notification Settings"]})]}),a==="integrations"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ar,{className:"h-6 w-6 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Supabase Configuration"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Project URL"}),e.jsx("input",{type:"text",value:"https://jxhzveborezjhsmzsgbc.supabase.co",readOnly:!0,className:"w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-gray-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Anon Key"}),e.jsx("input",{type:"password",value:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",readOnly:!0,className:"w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-gray-600"})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(bi,{className:"h-6 w-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"WhatsApp Green API"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Instance ID"}),e.jsx("input",{type:"text",value:se.instanceId,onChange:K=>q({...se,instanceId:K.target.value}),placeholder:"Enter Instance ID",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"API Key"}),e.jsx("input",{type:"password",value:se.apiKey,onChange:K=>q({...se,apiKey:K.target.value}),placeholder:"Enter API Key",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),e.jsxs(X,{size:"sm",onClick:Ct,children:[e.jsx(Hs,{className:"h-4 w-4 mr-2"}),"Save Credentials"]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Kr,{className:"h-6 w-6 text-purple-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Gemini AI Integration"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"API Key"}),e.jsx("input",{type:"password",placeholder:"Enter Gemini API Key",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Model"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[e.jsx("option",{value:"gemini-pro",children:"Gemini Pro"}),e.jsx("option",{value:"gemini-pro-vision",children:"Gemini Pro Vision"}),e.jsx("option",{value:"gemini-1.5-pro",children:"Gemini 1.5 Pro"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Enable AI Features"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"})]})]}),e.jsxs(X,{size:"sm",variant:"secondary",children:[e.jsx(Hs,{className:"h-4 w-4 mr-2"}),"Save Gemini Settings"]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(js,{className:"h-6 w-6 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"SMS Provider"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Provider"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select SMS Provider"}),e.jsx("option",{value:"africastalking",children:"Africa's Talking"}),e.jsx("option",{value:"twilio",children:"Twilio"}),e.jsx("option",{value:"messagebird",children:"MessageBird"}),e.jsx("option",{value:"vonage",children:"Vonage"}),e.jsx("option",{value:"custom",children:"Custom Provider"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"API Key"}),e.jsx("input",{type:"password",placeholder:"Enter SMS API Key",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sender ID"}),e.jsx("input",{type:"text",placeholder:"Enter Sender ID",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs(X,{size:"sm",variant:"secondary",children:[e.jsx(Hs,{className:"h-4 w-4 mr-2"}),"Save SMS Settings"]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(da,{className:"h-6 w-6 text-red-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Email Service"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Provider"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"",children:"Select Email Provider"}),e.jsx("option",{value:"sendgrid",children:"SendGrid"}),e.jsx("option",{value:"mailgun",children:"Mailgun"}),e.jsx("option",{value:"aws-ses",children:"AWS SES"}),e.jsx("option",{value:"smtp",children:"Custom SMTP"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"API Key"}),e.jsx("input",{type:"password",placeholder:"Enter Email API Key",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Email"}),e.jsx("input",{type:"email",placeholder:"noreply@yourcompany.com",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-red-500"})]}),e.jsxs(X,{size:"sm",variant:"secondary",children:[e.jsx(Hs,{className:"h-4 w-4 mr-2"}),"Save Email Settings"]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(qn,{className:"h-6 w-6 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Analytics Integration"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Provider"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"",children:"Select Analytics Provider"}),e.jsx("option",{value:"google-analytics",children:"Google Analytics"}),e.jsx("option",{value:"mixpanel",children:"Mixpanel"}),e.jsx("option",{value:"amplitude",children:"Amplitude"}),e.jsx("option",{value:"posthog",children:"PostHog"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tracking ID"}),e.jsx("input",{type:"text",placeholder:"Enter Tracking ID",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Enable Analytics"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"})]})]}),e.jsxs(X,{size:"sm",variant:"secondary",children:[e.jsx(Hs,{className:"h-4 w-4 mr-2"}),"Save Analytics Settings"]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(mr,{className:"h-6 w-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Payment Gateway"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Provider"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"",children:"Select Payment Provider"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"stripe",children:"Stripe"}),e.jsx("option",{value:"paypal",children:"PayPal"}),e.jsx("option",{value:"flutterwave",children:"Flutterwave"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Public Key"}),e.jsx("input",{type:"text",placeholder:"Enter Public Key",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Secret Key"}),e.jsx("input",{type:"password",placeholder:"Enter Secret Key",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),e.jsxs(X,{size:"sm",variant:"secondary",children:[e.jsx(Hs,{className:"h-4 w-4 mr-2"}),"Save Payment Settings"]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Xi,{className:"h-6 w-6 text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"File Storage"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Provider"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-500 focus:border-orange-500",children:[e.jsx("option",{value:"",children:"Select Storage Provider"}),e.jsx("option",{value:"supabase-storage",children:"Supabase Storage"}),e.jsx("option",{value:"aws-s3",children:"AWS S3"}),e.jsx("option",{value:"google-cloud",children:"Google Cloud Storage"}),e.jsx("option",{value:"cloudinary",children:"Cloudinary"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bucket Name"}),e.jsx("input",{type:"text",placeholder:"Enter Bucket Name",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Access Key"}),e.jsx("input",{type:"password",placeholder:"Enter Access Key",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]}),e.jsxs(X,{size:"sm",variant:"secondary",children:[e.jsx(Hs,{className:"h-4 w-4 mr-2"}),"Save Storage Settings"]})]})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Bs,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Integration Tips"}),e.jsxs("ul",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[e.jsx("li",{children:"• Keep your API keys secure and never share them publicly"}),e.jsx("li",{children:"• Test integrations in development before enabling in production"}),e.jsx("li",{children:"• Monitor usage limits and costs for paid services"}),e.jsx("li",{children:"• Regularly rotate API keys for security"})]})]})]})})]}),a==="user-management"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"System Users"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"text-left p-4 font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:N.map(K=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"p-4",children:K.name}),e.jsx("td",{className:"p-4",children:K.email}),e.jsx("td",{className:"p-4",children:e.jsxs("select",{value:K.role,onChange:be=>Ue(K.id,be.target.value),className:"border border-gray-300 rounded px-3 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"customer-care",children:"Customer Care"}),e.jsx("option",{value:"technician",children:"Technician"})]})}),e.jsx("td",{className:"p-4",children:e.jsx(X,{size:"sm",variant:"secondary",children:e.jsx(Ts,{className:"h-4 w-4"})})})]},K.id))})]})})]})}),a==="advanced"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Kr,{className:"h-6 w-6 text-yellow-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Debug Mode"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:H.debug_mode,onChange:K=>J({...H,debug_mode:K.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Enable debug mode for development and troubleshooting"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Mr,{className:"h-6 w-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Reminder Service"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:H.reminder_service_enabled,onChange:K=>J({...H,reminder_service_enabled:K.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Enable automated reminder service for tasks and appointments"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(us,{className:"h-6 w-6 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Offline Sync"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:H.offline_sync_enabled,onChange:K=>J({...H,offline_sync_enabled:K.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Enable offline data synchronization"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(us,{className:"h-6 w-6 text-purple-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Force Sync"})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Manually trigger offline data synchronization"}),e.jsxs(X,{onClick:()=>{is.success("Manual sync triggered")},variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-4 w-4"}),"Force Sync"]})]})]}),e.jsxs(X,{onClick:()=>re("Advanced",H),disabled:j,className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"h-4 w-4"}),j?"Saving...":"Save Advanced Settings"]})]}),a==="system-info"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"System Health Monitoring"}),e.jsxs(X,{onClick:Oe,disabled:$,className:"flex items-center gap-2",children:[e.jsx(us,{className:`h-4 w-4 ${$?"animate-spin":""}`}),$?"Checking...":"Run Health Check"]})]}),U&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ar,{className:"h-6 w-6 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Database Health"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:`font-medium ${U.database.status==="online"?"text-green-600":U.database.status==="degraded"?"text-yellow-600":"text-red-600"}`,children:U.database.status.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Response Time:"}),e.jsxs("span",{className:"font-medium",children:[U.database.responseTime,"ms"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Last Check:"}),e.jsx("span",{className:"font-medium",children:new Date(U.database.lastCheck).toLocaleString()})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(us,{className:"h-6 w-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cache Health"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:`font-medium ${U.cache.status==="healthy"?"text-green-600":U.cache.status==="warning"?"text-yellow-600":"text-red-600"}`,children:U.cache.status.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Items:"}),e.jsx("span",{className:"font-medium",children:U.cache.items})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Size:"}),e.jsxs("span",{className:"font-medium",children:[U.cache.size," KB"]})]})]})]})]}),L&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(qn,{className:"h-6 w-6 text-purple-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"System Statistics"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:L.customers}),e.jsx("div",{className:"text-sm text-gray-600",children:"Customers"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:L.devices}),e.jsx("div",{className:"text-sm text-gray-600",children:"Devices"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:L.payments}),e.jsx("div",{className:"text-sm text-gray-600",children:"Payments"})]}),e.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:L.users}),e.jsx("div",{className:"text-sm text-gray-600",children:"Users"})]})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:["Last updated: ",new Date(L.lastUpdated).toLocaleString()]})]}),U&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Kr,{className:"h-6 w-6 text-yellow-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Performance Metrics"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Memory Usage:"}),e.jsxs("span",{className:"font-medium",children:[(Ce=U==null?void 0:U.performance)!=null&&Ce.memoryUsage?Math.round(U.performance.memoryUsage*100):0,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Uptime:"}),e.jsxs("span",{className:"font-medium",children:[(Ze=U==null?void 0:U.performance)!=null&&Ze.uptime?Math.round(U.performance.uptime/60):0," minutes"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Errors:"}),e.jsx("span",{className:"font-medium",children:(($e=U==null?void 0:U.errors)==null?void 0:$e.count)||0})]})]})]})]}),a==="data-management"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ht,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Data Export Notice"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"This exports only the data from your tables. It does not include database schema, functions, or RLS policies. For a complete backup, use the Supabase dashboard."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ar,{className:"h-6 w-6 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Data Export"})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Export your data in JSON or SQL format"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("select",{onChange:K=>{if(K.target.value){const[be,ue]=K.target.value.split("|");ye(be,ue),K.target.value=""}},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select data type and format..."}),e.jsxs("optgroup",{label:"JSON Exports",children:[e.jsx("option",{value:"customers|json",children:"Customers Data (JSON)"}),e.jsx("option",{value:"devices|json",children:"Devices Data (JSON)"}),e.jsx("option",{value:"payments|json",children:"Payments Data (JSON)"}),e.jsx("option",{value:"all|json",children:"All Data (JSON)"})]}),e.jsxs("optgroup",{label:"SQL Exports",children:[e.jsx("option",{value:"customers|sql",children:"Customers Data (SQL)"}),e.jsx("option",{value:"devices|sql",children:"Devices Data (SQL)"}),e.jsx("option",{value:"payments|sql",children:"Payments Data (SQL)"}),e.jsx("option",{value:"all|sql",children:"All Data (SQL)"})]})]}),f&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"}),"Exporting ",f," data..."]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(pr,{className:"h-6 w-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Database Schema"})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Export the complete database structure and table definitions"}),e.jsxs(X,{onClick:Q,disabled:f==="schema",className:"flex items-center gap-2",children:[e.jsx(Br,{className:"h-4 w-4"}),f==="schema"?"Exporting Schema...":"Export Database Schema"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(qo,{className:"h-6 w-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Settings Backup"})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Backup and restore your system settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(X,{onClick:Re,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(Br,{className:"h-4 w-4"}),"Create Backup"]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:".json",onChange:Ee,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),A&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Selected: ",A.name]})]}),e.jsxs(X,{onClick:ut,disabled:!A,variant:"secondary",className:"w-full flex items-center justify-center gap-2",children:[e.jsx(Lr,{className:"h-4 w-4"}),"Restore Settings"]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(us,{className:"h-6 w-6 text-red-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cache Management"})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Clear all cached data and offline storage. This will log you out and require a fresh login."}),e.jsxs(X,{onClick:Le,variant:"danger",className:"flex items-center gap-2",children:[e.jsx(er,{className:"h-4 w-4"}),"Clear Cache"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(pi,{className:"h-6 w-6 text-purple-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Database Maintenance"})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Perform database maintenance tasks"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(X,{onClick:B,variant:"secondary",className:"w-full flex items-center justify-center gap-2",children:[e.jsx(Ss,{className:"h-4 w-4"}),"Optimize Database"]}),e.jsxs(X,{onClick:fe,variant:"secondary",className:"w-full flex items-center justify-center gap-2",children:[e.jsx(er,{className:"h-4 w-4"}),"Clean Old Logs"]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(fr,{className:"h-6 w-6 text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Performance Monitor"})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Monitor system performance and health"}),e.jsxs(X,{onClick:Oe,disabled:$,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(us,{className:`h-4 w-4 ${$?"animate-spin":""}`}),$?"Checking...":"Run Health Check"]})]})]})]}),a!=="dashboard"&&a!=="general"&&a!=="notifications"&&a!=="integrations"&&a!=="data-management"&&a!=="user-management"&&a!=="advanced"&&a!=="system-info"&&e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("p",{className:"text-gray-600",children:["Settings content for ",a," will be implemented here."]})})]})})]})},xx=({log:r,isOpen:a,onClose:i})=>e.jsx(es,{isOpen:a,onClose:i,title:"SMS Log Details",children:r?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Date:"})," ",r.created_at]}),e.jsxs("div",{children:[e.jsx("b",{children:"Phone:"})," ",r.phone_number]}),e.jsxs("div",{children:[e.jsx("b",{children:"Message:"})," ",r.message]}),e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",r.status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Error:"})," ",r.error_message||"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Sent At:"})," ",r.sent_at??"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Sent By:"})," ",r.sent_by??"-"]})]}):e.jsx("div",{children:"Log not found."})}),gx={sms_price:15,sms_provider_api_key:"",sms_provider_username:"",sms_provider_password:"",sms_sender_id:"",sms_api_url:"",sms_default_template:"",sms_enable_auto:!0,sms_enable_bulk:!0,sms_test_mode:!1,sms_daily_limit:500,sms_monthly_limit:1e4,sms_log_retention_days:365,sms_default_language:"en",sms_custom_variables:"{}",sms_notification_email:""},fx=[{key:"send",label:"Send SMS",icon:e.jsx(Tr,{size:16})},{key:"templates",label:"Templates",icon:e.jsx(pr,{size:16})},{key:"triggers",label:"Triggers",icon:e.jsx(Kr,{size:16})}],px=()=>{const r=hs(),{currentUser:a}=Wt(),{customers:i}=Ur(),[c,m]=g.useState("send"),[u,x]=g.useState("send"),[j,b]=g.useState(""),[f,y]=g.useState([]),[N,I]=g.useState([]),[R,k]=g.useState([]),[E,v]=g.useState([]),[U,F]=g.useState(!0),[L,C]=g.useState(""),[$,Y]=g.useState(""),[A,Z]=g.useState(""),[_,D]=g.useState(null),[T,z]=g.useState(!1),[se,q]=g.useState(null),[H,J]=g.useState([]),[V,ge]=g.useState(null),[He,B]=g.useState(null),[fe,re]=g.useState(!1),[ye,Q]=g.useState(null),[Le,Ue]=g.useState({title:"",content:"",variables:[]}),[Ct,Re]=g.useState(""),[ut,Ee]=g.useState(!1),[Oe,Xe]=g.useState(null),[Be,Ce]=g.useState({name:"",status:"",template_id:"",brand:"",customerTag:""}),[Ze,$e]=g.useState(""),[K,be]=g.useState(!1),[ue,Ye]=g.useState(!1),[ae,ke]=g.useState({sms_price:0}),[Ke,le]=g.useState(15),[Ne,Te]=g.useState(!1),[Qe,vt]=g.useState(!1),[Rt,ht]=g.useState(null),[Se,ve]=g.useState(null),[de,me]=g.useState(null),[Ae,it]=g.useState(!1),[St,kt]=g.useState(null),[et,xs]=g.useState(null),[Nt,ss]=g.useState(!navigator.onLine),[gt,Is]=g.useState([]),[ts,bs]=g.useState(""),[Qt,Pe]=g.useState(""),[ot,$t]=g.useState(""),[gs,Jt]=g.useState(!1),[Es,as]=g.useState({total:0,sent:0,failed:0,pending:0,delivered:0,totalCost:0}),[Us,ys]=g.useState(!1),[xe,pt]=g.useState(null),[lt,rt]=g.useState(!1),[wt,Ot]=g.useState(null),[Gt,we]=g.useState(""),[Ge,tt]=g.useState(null),[dt,jt]=g.useState(!1),[bt,Xt]=g.useState(null),[ds,fs]=g.useState(!1),[We,M]=g.useState(null),[ce,Je]=g.useState({message:"",type:"success",open:!1}),[_t,Dt]=g.useState("allCustomers"),[at,Et]=g.useState({loyaltyLevel:"",colorTag:"",minSpent:"",maxSpent:"",hasDevices:!1,hasActiveRepairs:!1,lastVisitDays:""}),[sr,gr]=g.useState(!1),[Ie,ze]=g.useState("manual"),[ft,oe]=g.useState([]),Fe=(()=>{const ie=i||[],st=new Date,nt=new Date(st.getTime()-30*24*60*60*1e3),It=new Date(st.getTime()-90*24*60*60*1e3);return{highValue:ie.filter(Tt=>Tt.totalSpent>1e3),mediumValue:ie.filter(Tt=>Tt.totalSpent>=500&&Tt.totalSpent<=1e3),lowValue:ie.filter(Tt=>Tt.totalSpent<500),recentVisitors:ie.filter(Tt=>Tt.lastVisit?new Date(Tt.lastVisit)>nt:!1),inactiveCustomers:ie.filter(Tt=>Tt.lastVisit?new Date(Tt.lastVisit)<It:!1),deviceOwners:ie.filter(Tt=>Tt.devices&&Tt.devices.length>0),repairCustomers:ie.filter(Tt=>Tt.devices&&Tt.devices.some(Yt=>Yt.status==="in-repair"||Yt.status==="diagnosis-started")),completedRepairs:ie.filter(Tt=>Tt.devices&&Tt.devices.some(Yt=>Yt.status==="done")),platinumCustomers:ie.filter(Tt=>Tt.loyaltyLevel==="platinum"),goldCustomers:ie.filter(Tt=>Tt.loyaltyLevel==="gold"),silverCustomers:ie.filter(Tt=>Tt.loyaltyLevel==="silver"),bronzeCustomers:ie.filter(Tt=>Tt.loyaltyLevel==="bronze"),vipCustomers:ie.filter(Tt=>Tt.colorTag==="vip"),newCustomers:ie.filter(Tt=>Tt.colorTag==="new"),complainers:ie.filter(Tt=>Tt.colorTag==="complainer"),highSpenders:ie.filter(Tt=>Tt.totalSpent>2e3),frequentVisitors:ie.filter(Tt=>Tt.lastVisit?new Date(Tt.lastVisit)>new Date(st.getTime()-7*24*60*60*1e3):!1),pointsEarners:ie.filter(Tt=>Tt.points>100),allCustomers:ie}})();g.useEffect(()=>{ue&&(Te(!0),ht(null),ve(null),G.from("settings").select("value").eq("key","sms_price").single().then(({data:ie,error:st})=>{st?ht("Failed to load price from database"):ie&&ie.value&&le(parseFloat(ie.value)),Te(!1)}))},[ue]),g.useEffect(()=>{F(!0),Ps.getSMSLogs(j?{search:j}:void 0).then(ie=>{y(ie),F(!1)})},[j]),g.useEffect(()=>{Ps.getTemplates().then(I)},[fe]),g.useEffect(()=>{Ps.getSMSStats().then(as)},[f]),g.useEffect(()=>{G.from("sms_triggers").select("*").then(({data:ie})=>{k(ie||[])})},[ut]),g.useEffect(()=>{let ie=G.from("sms_trigger_logs").select("*").order("created_at",{ascending:!1}).limit(50);Qt&&(ie=ie.eq("result",Qt)),ts&&(ie=ie.or(`recipient.ilike.%${ts}%,error.ilike.%${ts}%,status.ilike.%${ts}%`)),ie.then(({data:st})=>Is(st||[]))},[ts,Qt]),g.useEffect(()=>{const ie=()=>ss(!1),st=()=>ss(!0);return window.addEventListener("online",ie),window.addEventListener("offline",st),()=>{window.removeEventListener("online",ie),window.removeEventListener("offline",st)}},[]),g.useEffect(()=>{a&&(Jt(!0),G.from("scheduled_sms").select("*").eq("created_by",a.id).order("scheduled_for",{ascending:!0}).then(({data:ie})=>{v(ie||[]),Jt(!1)}))},[a,_]);const Bt=async ie=>{var It,Tt;ie.preventDefault(),D(null);let st=[];if(Ie==="segmented")_t&&Fe[_t]&&(st=Fe[_t]);else if(Ie==="manual")st=i.filter(Yt=>ft.includes(Yt.id));else return vs(ie);if(st.length===0){D("No customers selected for bulk SMS.");return}if(at.loyaltyLevel&&(st=st.filter(Yt=>Yt.loyaltyLevel===at.loyaltyLevel)),at.colorTag&&(st=st.filter(Yt=>Yt.colorTag===at.colorTag)),at.minSpent&&(st=st.filter(Yt=>Yt.totalSpent>=parseFloat(at.minSpent))),at.maxSpent&&(st=st.filter(Yt=>Yt.totalSpent<=parseFloat(at.maxSpent))),at.hasDevices&&(st=st.filter(Yt=>Yt.devices&&Yt.devices.length>0)),at.hasActiveRepairs&&(st=st.filter(Yt=>Yt.devices&&Yt.devices.some(Rs=>Rs.status==="in-repair"||Rs.status==="diagnosis-started"))),at.lastVisitDays){const Yt=new Date;Yt.setDate(Yt.getDate()-parseInt(at.lastVisitDays)),st=st.filter(Rs=>Rs.lastVisit?new Date(Rs.lastVisit)>Yt:!1)}const nt=st.map(Yt=>Yt.phone).filter(Boolean);if(nt.length===0){D("No valid phone numbers found in selected customers.");return}if(A){const Yt=N.find(Ks=>String(Ks.id)===A);if(!Yt){D("Template not found.");return}D("Sending segmented SMS...");let Rs=0;for(const Ks of st){if(!Ks.phone)continue;let rr=Yt.content;rr=rr.replace(/{name}/g,Ks.name||"Customer"),rr=rr.replace(/{loyaltyLevel}/g,Ks.loyaltyLevel||"bronze"),rr=rr.replace(/{totalSpent}/g,((It=Ks.totalSpent)==null?void 0:It.toString())||"0"),rr=rr.replace(/{points}/g,((Tt=Ks.points)==null?void 0:Tt.toString())||"0"),(await Ps.sendSMS(Ks.phone,rr)).success&&Rs++}D(`Sent personalized SMS to ${Rs} of ${st.length} customers.`)}else{if(!$){D("Please enter a message or select a template.");return}D("Sending bulk SMS...");let Yt=0;for(const Rs of nt)(await Ps.sendSMS(Rs,$)).success&&Yt++;D(`Sent to ${Yt} of ${nt.length} customers.`)}Y(""),Z(""),oe([]),Et({loyaltyLevel:"",colorTag:"",minSpent:"",maxSpent:"",hasDevices:!1,hasActiveRepairs:!1,lastVisitDays:""})},vs=async ie=>{ie.preventDefault(),D(null);const st=L.split(",").map(nt=>nt.trim()).filter(Boolean);if(!st.length){D("Please enter numbers.");return}if(T&&se&&a){let nt=$,It=null,Tt=null;if(A){const Rs=N.find(rr=>String(rr.id)===A);if(!Rs){D("Template not found.");return}It=Rs.id;const Ks=Rs.variables||[];Tt={},Ks.forEach(rr=>{Tt[rr]=prompt(`Enter value for ${rr}:`,"")||""}),nt=Rs.content,Object.entries(Tt).forEach(([rr,ia])=>{nt=nt.replace(new RegExp(`{${rr}}`,"g"),ia)})}const Yt=await Ps.scheduleSMS({numbers:st,message:nt,templateId:It,variables:Tt,scheduledFor:se,createdBy:a.id});Yt.success?(D("SMS scheduled for "+se.toLocaleString()),C(""),Y(""),Z(""),z(!1),q(null)):D("Failed to schedule SMS: "+(Yt.error||"Unknown error"));return}if(A){const nt=N.find(Rs=>String(Rs.id)===A);if(!nt){D("Template not found.");return}const It=nt.variables||[];let Tt={};It.forEach(Rs=>{Tt[Rs]=prompt(`Enter value for ${Rs}:`,"")||""}),D("Sending...");let Yt=0;for(const Rs of st)(await Ps.sendTemplateSMS(Rs,nt.id,Tt)).success&&Yt++;D(`Sent using template to ${Yt} of ${st.length} numbers.`)}else{if(!$){D("Please enter a message or select a template.");return}D("Sending...");let nt=0;for(const It of st)(await Ps.sendSMS(It,$)).success&&nt++;D(`Sent to ${nt} of ${st.length} numbers.`)}C(""),Y(""),Z("")},Kt=ie=>{var nt;ge(null),J([]),B(null);const st=(nt=ie.target.files)==null?void 0:nt[0];st&&zn.parse(st,{header:!0,skipEmptyLines:!0,complete:It=>{if(!It.data||!Array.isArray(It.data)){ge("Invalid CSV format.");return}if(It.errors&&It.errors.length>0){ge(It.errors.map(Tt=>Tt.message).join("; "));return}J(It.data),setCsvPreviewOpen(!0)}})},Mt=()=>{Q(null),Ue({title:"",content:"",module:"",variables:""}),re(!0),Re("")},_e=ie=>{Q(ie),Ue({title:ie.title,content:ie.content,module:ie.module,variables:(ie.variables||[]).join(",")}),re(!0),Re("")},ee=ie=>{Ue({...Le,[ie.target.name]:ie.target.value})},Lt=async ie=>{if(ie.preventDefault(),!Le.title||!Le.content){Re("Title and content are required.");return}const st=Le.variables.split(",").map(nt=>nt.trim()).filter(Boolean);ye?await G.from("communication_templates").update({title:Le.title,content:Le.content,template_type:Le.module,variables:st,created_by:a==null?void 0:a.id}).eq("id",ye.id):await G.from("communication_templates").insert({title:Le.title,content:Le.content,template_type:Le.module,variables:st,is_active:!0,created_by:a==null?void 0:a.id}),re(!1)},$s=async ie=>{window.confirm("Delete this template?")&&(await G.from("communication_templates").delete().eq("id",ie),I(N.filter(st=>String(st.id)!==ie)))},ir=()=>{Ce({name:"",status:"",template_id:"",brand:"",customerTag:""}),Xe(null),Ee(!0),$e("")},ii=ie=>{var st,nt;Ce({name:ie.name||"",status:ie.status||"",template_id:ie.template_id||"",brand:((st=ie.condition)==null?void 0:st.brand)||"",customerTag:((nt=ie.condition)==null?void 0:nt.customerTag)||""}),Xe(ie),Ee(!0),$e("")},ea=ie=>{Ce({...Be,[ie.target.name]:ie.target.value})},br=async ie=>{if(ie.preventDefault(),!Be.name||!Be.status||!Be.template_id){$e("Name, status, and template are required.");return}const st={name:Be.name,trigger_type:Be.status,message_template:Be.template_id,is_active:!0,created_by:a==null?void 0:a.id};Oe?(await G.from("sms_triggers").update(st).eq("id",Oe.id),$r("Trigger updated successfully!","success")):(await G.from("sms_triggers").insert(st),$r("Trigger created successfully!","success")),Ee(!1),Xe(null)},Pt=ie=>{const st=R.find(nt=>nt.id===ie)||null;Xt(st),jt(!0)},Ms=async()=>{bt&&(await G.from("sms_triggers").delete().eq("id",bt.id),$r("Trigger deleted successfully!","success"),Xt(null),jt(!1))},An=async ie=>{me(ie),await Ps.resendSMS(ie),me(null),Ps.getSMSLogs(j?{search:j}:void 0).then(y)},li=ie=>{kt(ie),it(!0)},Ya=ie=>{pt(ie),ys(!0)},Da=ie=>{Ot(ie),we(""),tt(null),rt(!0)},Xa=async()=>{if(!wt||!Gt)return;const ie=N.find(It=>String(It.id)===String(wt.template_id));if(!ie){tt("Template not found.");return}let st={};ie.variables&&Array.isArray(ie.variables)&&ie.variables.forEach(It=>{st[It]=It.toUpperCase()}),tt("Sending...");const nt=await Ps.sendTemplateSMS(Gt,ie.id,st);tt(nt.success?"Test SMS sent!":`Failed: ${nt.error}`)},oi=async ie=>{await G.from("scheduled_sms").update({status:"cancelled"}).eq("id",ie),v(E.map(st=>st.id===ie?{...st,status:"cancelled"}:st)),fs(!1),M(null)},Xs=R.filter(ie=>{var It;const st=N.find(Tt=>String(Tt.id)===String(ie.template_id)),nt=ot.toLowerCase();return ie.name.toLowerCase().includes(nt)||(ie.status||"").toLowerCase().includes(nt)||(((It=st==null?void 0:st.title)==null?void 0:It.toLowerCase())||"").includes(nt)}),$r=(ie,st="success")=>{Je({message:ie,type:st,open:!0}),setTimeout(()=>Je(nt=>({...nt,open:!1})),3e3)},qr=async()=>{await Ps.getTemplates().then(I),$r("Templates refreshed!","success")};return g.useEffect(()=>{u==="settings"&&(setSettingsLoading(!0),G.from("settings").select("key, value").then(({data:ie,error:st})=>{if(!st&&ie){const nt={...gx};ie.forEach(It=>{It.key in nt&&(typeof nt[It.key]=="boolean"?nt[It.key]=It.value==="true":typeof nt[It.key]=="number"?nt[It.key]=parseFloat(It.value):nt[It.key]=It.value)}),ke(nt)}setSettingsLoading(!1)}))},[u]),e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:[Nt&&e.jsx("div",{style:{background:"#f87171",color:"white",padding:"8px",textAlign:"center"},children:"You are offline. SMS features may be limited."}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>r("/dashboard"),className:"p-2 rounded-lg bg-white/20 backdrop-blur-md border border-white/30 hover:bg-white/30 transition-colors",children:e.jsx(zs,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"SMS Center"}),e.jsx("p",{className:"text-gray-600",children:"Customer care SMS management"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(X,{variant:"secondary",onClick:()=>r("/sms-logs"),children:"Simple Logs"}),e.jsx(X,{icon:e.jsx(us,{size:16}),variant:"secondary",onClick:()=>window.location.reload(),children:"Refresh"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[e.jsxs(he,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-blue-600 mb-1",children:Es.sent}),e.jsx("div",{className:"text-xs text-gray-600",children:"Sent"})]}),e.jsxs(he,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-emerald-600 mb-1",children:Es.delivered}),e.jsx("div",{className:"text-xs text-gray-600",children:"Delivered"})]}),e.jsxs(he,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-rose-600 mb-1",children:Es.failed}),e.jsx("div",{className:"text-xs text-gray-600",children:"Failed"})]}),e.jsxs(he,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-amber-600 mb-1",children:Es.pending}),e.jsx("div",{className:"text-xs text-gray-600",children:"Pending"})]})]}),e.jsx("div",{className:"flex overflow-x-auto gap-1 mb-4 pb-2 scrollbar-hide",children:fx.map(ie=>e.jsxs("button",{onClick:()=>x(ie.key),className:`flex items-center gap-1 px-3 py-2 rounded-lg transition-all duration-300 flex-shrink-0 min-w-[80px] ${u===ie.key?"bg-blue-500 text-white shadow-lg":"bg-white/50 text-gray-700 hover:bg-white/60"}`,children:[ie.icon,e.jsx("span",{className:"text-xs font-medium",children:ie.label})]},ie.key))}),u==="send"&&e.jsx(he,{className:"mb-4",children:e.jsxs("form",{onSubmit:Bt,className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Send SMS"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(X,{type:"button",variant:Ie==="manual"?"primary":"secondary",size:"sm",onClick:()=>ze("manual"),children:"Manual Numbers"}),e.jsx(X,{type:"button",variant:Ie==="segmented"?"primary":"secondary",size:"sm",onClick:()=>ze("segmented"),children:"Customer Segments"}),e.jsx(X,{type:"button",variant:Ie==="csv"?"primary":"secondary",size:"sm",onClick:()=>ze("csv"),children:"CSV Upload"})]})]}),Ie==="manual"&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 text-sm font-medium",children:"Phone Numbers"}),e.jsx("textarea",{name:"bulkNumbers",value:L,onChange:ie=>C(ie.target.value),placeholder:"Enter phone numbers separated by commas",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]})}),Ie==="segmented"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 text-sm font-medium",children:"Customer Segment"}),e.jsxs("select",{value:_t,onChange:ie=>Dt(ie.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsxs("option",{value:"allCustomers",children:["All Customers (",Fe.allCustomers.length,")"]}),e.jsxs("option",{value:"highValue",children:["High Value Customers (",Fe.highValue.length,")"]}),e.jsxs("option",{value:"mediumValue",children:["Medium Value Customers (",Fe.mediumValue.length,")"]}),e.jsxs("option",{value:"lowValue",children:["Low Value Customers (",Fe.lowValue.length,")"]}),e.jsxs("option",{value:"recentVisitors",children:["Recent Visitors (",Fe.recentVisitors.length,")"]}),e.jsxs("option",{value:"inactiveCustomers",children:["Inactive Customers (",Fe.inactiveCustomers.length,")"]}),e.jsxs("option",{value:"deviceOwners",children:["Device Owners (",Fe.deviceOwners.length,")"]}),e.jsxs("option",{value:"repairCustomers",children:["Customers with Active Repairs (",Fe.repairCustomers.length,")"]}),e.jsxs("option",{value:"completedRepairs",children:["Customers with Completed Repairs (",Fe.completedRepairs.length,")"]}),e.jsxs("option",{value:"platinumCustomers",children:["Platinum Customers (",Fe.platinumCustomers.length,")"]}),e.jsxs("option",{value:"goldCustomers",children:["Gold Customers (",Fe.goldCustomers.length,")"]}),e.jsxs("option",{value:"silverCustomers",children:["Silver Customers (",Fe.silverCustomers.length,")"]}),e.jsxs("option",{value:"bronzeCustomers",children:["Bronze Customers (",Fe.bronzeCustomers.length,")"]}),e.jsxs("option",{value:"vipCustomers",children:["VIP Customers (",Fe.vipCustomers.length,")"]}),e.jsxs("option",{value:"newCustomers",children:["New Customers (",Fe.newCustomers.length,")"]}),e.jsxs("option",{value:"complainers",children:["Complainers (",Fe.complainers.length,")"]}),e.jsxs("option",{value:"highSpenders",children:["High Spenders (",Fe.highSpenders.length,")"]}),e.jsxs("option",{value:"frequentVisitors",children:["Frequent Visitors (",Fe.frequentVisitors.length,")"]}),e.jsxs("option",{value:"pointsEarners",children:["Points Earners (",Fe.pointsEarners.length,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 text-sm font-medium",children:"Loyalty Level"}),e.jsxs("select",{value:at.loyaltyLevel,onChange:ie=>Et({...at,loyaltyLevel:ie.target.value}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Any Level"}),e.jsx("option",{value:"platinum",children:"Platinum"}),e.jsx("option",{value:"gold",children:"Gold"}),e.jsx("option",{value:"silver",children:"Silver"}),e.jsx("option",{value:"bronze",children:"Bronze"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 text-sm font-medium",children:"Customer Tag"}),e.jsxs("select",{value:at.colorTag,onChange:ie=>Et({...at,colorTag:ie.target.value}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Any Tag"}),e.jsx("option",{value:"vip",children:"VIP"}),e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"complainer",children:"Complainer"}),e.jsx("option",{value:"normal",children:"Normal"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 text-sm font-medium",children:"Min Spent"}),e.jsx("input",{type:"number",value:at.minSpent,onChange:ie=>Et({...at,minSpent:ie.target.value}),placeholder:"0",className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 text-sm font-medium",children:"Max Spent"}),e.jsx("input",{type:"number",value:at.maxSpent,onChange:ie=>Et({...at,maxSpent:ie.target.value}),placeholder:"No limit",className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 text-sm font-medium",children:"Last Visit (Days)"}),e.jsx("input",{type:"number",value:at.lastVisitDays,onChange:ie=>Et({...at,lastVisitDays:ie.target.value}),placeholder:"Any time",className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"hasDevices",checked:at.hasDevices,onChange:ie=>Et({...at,hasDevices:ie.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"hasDevices",className:"text-sm text-gray-700",children:"Has Devices"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"hasActiveRepairs",checked:at.hasActiveRepairs,onChange:ie=>Et({...at,hasActiveRepairs:ie.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"hasActiveRepairs",className:"text-sm text-gray-700",children:"Has Active Repairs"})]})]}),e.jsx("div",{className:"bg-blue-50 p-3 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Preview:"})," This will send SMS to approximately"," ",(()=>{let ie=Fe[_t]||[];if(at.loyaltyLevel&&(ie=ie.filter(st=>st.loyaltyLevel===at.loyaltyLevel)),at.colorTag&&(ie=ie.filter(st=>st.colorTag===at.colorTag)),at.minSpent&&(ie=ie.filter(st=>st.totalSpent>=parseFloat(at.minSpent))),at.maxSpent&&(ie=ie.filter(st=>st.totalSpent<=parseFloat(at.maxSpent))),at.hasDevices&&(ie=ie.filter(st=>st.devices&&st.devices.length>0)),at.hasActiveRepairs&&(ie=ie.filter(st=>st.devices&&st.devices.some(nt=>nt.status==="in-repair"||nt.status==="diagnosis-started"))),at.lastVisitDays){const st=new Date;st.setDate(st.getDate()-parseInt(at.lastVisitDays)),ie=ie.filter(nt=>nt.lastVisit?new Date(nt.lastVisit)>st:!1)}return ie.length})()," customers"]})})]}),Ie==="csv"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 text-sm font-medium",children:"Upload CSV File"}),e.jsx("input",{type:"file",accept:".csv",onChange:Kt,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),V&&e.jsx("div",{className:"text-red-600 text-sm",children:V}),H.length>0&&e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Preview:"})," ",H.length," rows loaded"]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 text-sm font-medium",children:"Template (Optional)"}),e.jsxs("select",{value:A,onChange:ie=>Z(ie.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"No template (free text)"}),N.map(ie=>e.jsx("option",{value:String(ie.id),children:ie.title},String(ie.id)))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 text-sm font-medium",children:"Message"}),e.jsx("textarea",{name:"bulkMessage",value:$,onChange:ie=>Y(ie.target.value),placeholder:"Enter your message here...",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:4}),A&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Template variables: ","{name}",", ","{loyaltyLevel}",", ","{totalSpent}",", ","{points}"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"sendLater",checked:T,onChange:ie=>z(ie.target.checked),className:"rounded"}),e.jsx("label",{htmlFor:"sendLater",className:"text-sm text-gray-700",children:"Schedule for later"})]}),T&&e.jsx("input",{type:"datetime-local",value:se?se.toISOString().slice(0,16):"",onChange:ie=>q(ie.target.value?new Date(ie.target.value):null),className:"p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx(X,{type:"submit",className:"w-full",disabled:Nt,children:T?"Schedule SMS":"Send SMS"}),_&&e.jsx("div",{className:`p-3 rounded-lg text-sm ${_.includes("Sent")||_.includes("scheduled")?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:_})]})}),u==="logs"&&e.jsxs(he,{className:"mb-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:"SMS Logs"}),e.jsx(ga,{onSearch:b,placeholder:"Search logs..."})]}),U?e.jsx("div",{className:"py-6 text-center text-gray-500",children:"Loading logs..."}):f.length===0?e.jsx("div",{className:"py-6 text-center text-gray-500",children:"No SMS logs found."}):e.jsx("div",{className:"space-y-2",children:f.map((ie,st)=>{var nt;return e.jsxs("div",{className:"bg-white/40 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-gray-500",children:(nt=ie.created_at)==null?void 0:nt.slice(0,19).replace("T"," ")}),e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-semibold ${ie.status==="sent"?"bg-emerald-100 text-emerald-700":ie.status==="failed"?"bg-rose-100 text-rose-700":ie.status==="pending"?"bg-amber-100 text-amber-700":ie.status==="delivered"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:ie.status})]}),e.jsx("div",{className:"text-sm font-medium",children:ie.recipient_phone}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:ie.message_content}),ie.error_message&&e.jsxs("div",{className:"text-xs text-rose-600 bg-rose-50 p-2 rounded",children:["Error: ",ie.error_message]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(X,{size:"sm",icon:e.jsx(cs,{size:12}),variant:"secondary",onClick:()=>li(ie),children:"View"}),ie.status==="failed"&&e.jsx(X,{size:"sm",icon:de===ie.id?e.jsx(us,{className:"animate-spin",size:12}):e.jsx(us,{size:12}),variant:"primary",onClick:()=>An(ie.id),disabled:!!de,children:"Resend"})]})]},String(ie.id??st))})})]}),u==="templates"&&e.jsxs(he,{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(pr,{size:18})," Templates"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(X,{icon:e.jsx(us,{size:14}),variant:"secondary",onClick:qr,size:"sm",children:"Refresh"}),e.jsx(X,{icon:e.jsx(Ut,{size:14}),variant:"secondary",onClick:Mt,size:"sm",children:"New"})]})]}),N.length===0&&e.jsxs("div",{className:"py-3 text-blue-700 text-sm",children:["No templates found. Click ",e.jsx("b",{children:"New"})," to create your first template!"]}),N.length===0?e.jsx("div",{className:"py-6 text-center text-gray-500",children:"No templates found."}):e.jsx("div",{className:"space-y-2",children:N.map(ie=>e.jsxs("div",{className:"bg-white/40 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-sm",children:ie.title}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(X,{size:"sm",icon:e.jsx(Ts,{size:12}),variant:"primary",onClick:()=>_e(ie),children:"Edit"}),e.jsx(X,{size:"sm",icon:e.jsx(er,{size:12}),variant:"danger",onClick:()=>$s(String(ie.id)),children:"Delete"})]})]}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:ie.content}),(ie.variables||[]).length>0&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Variables: ",(ie.variables||[]).join(", ")]})]},String(ie.id)))})]}),u==="triggers"&&e.jsxs(he,{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Kr,{size:18})," SMS Triggers"]}),e.jsx("div",{className:"flex gap-1",children:e.jsx(X,{icon:e.jsx(Ut,{size:14}),variant:"secondary",onClick:ir,size:"sm",children:"New Trigger"})})]}),e.jsx("div",{className:"mb-3",children:e.jsx(ga,{onSearch:$t,placeholder:"Search triggers..."})}),R.length===0?e.jsxs("div",{className:"py-6 text-center text-gray-500",children:["No triggers found. Click ",e.jsx("b",{children:"New Trigger"})," to create your first trigger!"]}):e.jsx("div",{className:"space-y-2",children:Xs.map(ie=>{const st=N.find(nt=>String(nt.id)===String(ie.template_id));return e.jsxs("div",{className:"bg-white/40 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-sm",children:ie.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(X,{size:"sm",icon:e.jsx(cs,{size:12}),variant:"secondary",onClick:()=>Ya(ie),children:"Preview"}),e.jsx(X,{size:"sm",icon:e.jsx(xn,{size:12}),variant:"primary",onClick:()=>Da(ie),children:"Test"}),e.jsx(X,{size:"sm",icon:e.jsx(Ts,{size:12}),variant:"primary",onClick:()=>ii(ie),children:"Edit"}),e.jsx(X,{size:"sm",icon:e.jsx(er,{size:12}),variant:"danger",onClick:()=>Pt(String(ie.id)),children:"Delete"})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Status: ",e.jsx("span",{className:"font-medium",children:(ie.status||"").replace(/-/g," ")})]}),e.jsxs("div",{children:["Template: ",e.jsx("span",{className:"font-medium",children:(st==null?void 0:st.title)||"Unknown"})]})]})]},String(ie.id))})})]}),e.jsx(es,{isOpen:fe,onClose:()=>re(!1),title:ye?"Edit Template":"New Template",maxWidth:"90vw",children:e.jsxs("form",{onSubmit:Lt,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 text-sm font-medium",children:"Title"}),e.jsx("input",{type:"text",name:"title",value:Le.title,onChange:ee,className:"w-full py-2 px-3 bg-white/30 backdrop-blur-md border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 text-sm font-medium",children:"Content"}),e.jsx("textarea",{name:"content",value:Le.content,onChange:ee,rows:4,className:"w-full py-2 px-3 bg-white/30 backdrop-blur-md border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 text-sm",required:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Use ","{variable}"," for variables. Example: Hello ","{name}"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 text-sm font-medium",children:"Variables (comma separated)"}),e.jsx("input",{type:"text",name:"variables",value:Le.variables,onChange:ee,className:"w-full py-2 px-3 bg-white/30 backdrop-blur-md border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 text-sm",placeholder:"name, code"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 text-sm font-medium",children:"Module (optional)"}),e.jsx("input",{type:"text",name:"module",value:Le.module,onChange:ee,className:"w-full py-2 px-3 bg-white/30 backdrop-blur-md border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 text-sm",placeholder:"device, customer"})]}),Ct&&e.jsx("div",{className:"text-red-600 text-sm bg-red-50 p-2 rounded",children:Ct}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(X,{type:"submit",variant:"primary",className:"flex-1",children:ye?"Update":"Create"}),e.jsx(X,{type:"button",variant:"secondary",onClick:()=>re(!1),children:"Cancel"})]})]})}),e.jsx(es,{isOpen:ut,onClose:()=>{Ee(!1),Xe(null)},title:Oe?"Edit SMS Trigger":"New SMS Trigger",maxWidth:"500px",children:e.jsxs("form",{onSubmit:br,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Name"}),e.jsx("input",{type:"text",name:"name",value:Be.name,onChange:ea,className:"w-full py-2 px-4 bg-white/30 backdrop-blur-md border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Device Status"}),e.jsxs("select",{name:"status",value:Be.status,onChange:ea,className:"w-full py-2 px-4 bg-white/30 backdrop-blur-md border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",required:!0,children:[e.jsx("option",{value:"",children:"-- Select Status --"}),["received","assigned-to-technician","in-repair","repair-complete","ready-for-pickup","done","failed"].map(ie=>e.jsx("option",{value:ie,children:(ie||"").replace(/-/g," ")},ie))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"SMS Template"}),e.jsxs("select",{name:"template_id",value:Be.template_id,onChange:ea,className:"w-full py-2 px-4 bg-white/30 backdrop-blur-md border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",required:!0,children:[e.jsx("option",{value:"",children:"-- Select Template --"}),N.map(ie=>e.jsx("option",{value:String(ie.id),children:ie.title},String(ie.id)))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Device Brand (optional)"}),e.jsxs("select",{name:"brand",value:Be.brand,onChange:ea,className:"w-full py-2 px-4 bg-white/30 backdrop-blur-md border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"",children:"-- Any Brand --"}),["Apple","Samsung","Tecno","Infinix","Huawei","Itel","Nokia","Sony","HTC","Other"].map(ie=>e.jsx("option",{value:ie,children:ie},ie))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Customer Tag (optional)"}),e.jsxs("select",{name:"customerTag",value:Be.customerTag,onChange:ea,className:"w-full py-2 px-4 bg-white/30 backdrop-blur-md border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"",children:"-- Any Tag --"}),["vip","new","complainer"].map(ie=>e.jsx("option",{value:ie,children:ie},ie))]})]}),Ze&&e.jsx("div",{className:"text-red-600 text-sm",children:Ze}),e.jsxs("div",{className:"flex gap-3 justify-end mt-4",children:[e.jsx(X,{type:"button",variant:"secondary",onClick:()=>{Ee(!1),Xe(null)},children:"Cancel"}),e.jsx(X,{type:"submit",variant:"primary",children:Oe?"Update":"Create"})]})]})}),e.jsx(es,{isOpen:Us,onClose:()=>ys(!1),title:"Trigger Preview",maxWidth:"500px",children:xe&&(()=>{const ie=N.find(It=>String(It.id)===String(xe.template_id));if(!ie)return e.jsx("div",{children:"Template not found."});let st={};ie.variables&&Array.isArray(ie.variables)&&ie.variables.forEach(It=>{st[It]=It.toUpperCase()});let nt=ie.content;return Object.entries(st).forEach(([It,Tt])=>{nt=nt.replace(new RegExp(`{${It}}`,"g"),Tt)}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Template:"})," ",ie.title]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Raw Content:"})," ",e.jsx("span",{className:"break-words",children:ie.content})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Sample Message:"})," ",e.jsx("span",{className:"break-words",children:nt})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Sample Variables:"})," ",Object.entries(st).map(([It,Tt])=>`${It}: ${Tt}`).join(", ")]})]})})()}),e.jsx(es,{isOpen:lt,onClose:()=>rt(!1),title:"Test Trigger",maxWidth:"500px",children:wt&&(()=>{const ie=N.find(st=>String(st.id)===String(wt.template_id));return ie?e.jsxs("form",{onSubmit:st=>{st.preventDefault(),Xa()},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Phone Number"}),e.jsx("input",{type:"text",value:Gt,onChange:st=>we(st.target.value),className:"w-full py-2 px-4 bg-white/30 backdrop-blur-md border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"e.g. 0712345678",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Message Preview"}),e.jsx("div",{className:"p-3 bg-white/40 rounded-lg border border-white/20 text-gray-800",children:(()=>{let st=ie.content;return ie.variables&&Array.isArray(ie.variables)&&ie.variables.forEach(nt=>{st=st.replace(new RegExp(`{${nt}}`,"g"),nt.toUpperCase())}),st})()})]}),e.jsxs("div",{className:"flex gap-3 justify-end mt-4",children:[e.jsx(X,{type:"button",variant:"secondary",onClick:()=>rt(!1),children:"Cancel"}),e.jsx(X,{type:"submit",variant:"primary",children:"Send Test SMS"})]}),Ge&&e.jsx("div",{className:"mt-2 text-sm text-gray-700",children:Ge})]}):e.jsx("div",{children:"Template not found."})})()}),e.jsxs(es,{isOpen:ds,onClose:()=>fs(!1),title:"Cancel Scheduled SMS",maxWidth:"400px",children:[e.jsx("div",{className:"text-gray-800 mb-4",children:"Are you sure you want to cancel this scheduled SMS?"}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(X,{type:"button",variant:"secondary",onClick:()=>fs(!1),children:"No"}),e.jsx(X,{type:"button",variant:"danger",onClick:()=>We&&oi(We),children:"Yes, Cancel"})]})]}),St&&e.jsx(xx,{log:St,isOpen:Ae,onClose:()=>{it(!1),kt(null)}}),e.jsxs(es,{isOpen:dt,onClose:()=>{jt(!1),Xt(null)},title:"Delete Trigger",maxWidth:"400px",children:[e.jsxs("div",{className:"text-gray-800 mb-4",children:["Are you sure you want to delete the trigger ",e.jsx("b",{children:bt==null?void 0:bt.name}),"?"]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(X,{type:"button",variant:"secondary",onClick:()=>{jt(!1),Xt(null)},children:"Cancel"}),e.jsx(X,{type:"button",variant:"danger",onClick:Ms,children:"Yes, Delete"})]})]}),ce.open&&e.jsx("div",{className:`fixed bottom-6 left-1/2 transform -translate-x-1/2 z-50 px-6 py-3 rounded-lg shadow-lg text-white font-semibold transition-all ${ce.type==="success"?"bg-emerald-600":"bg-rose-600"}`,children:ce.message})]})},bx=()=>{const r=hs(),[a,i]=g.useState([]),[c,m]=g.useState([]),[u,x]=g.useState(!0),[j,b]=g.useState("all"),[f,y]=g.useState("all"),[N,I]=g.useState("all"),[R,k]=g.useState("");g.useEffect(()=>{E()},[]);const E=async()=>{x(!0);try{const{data:_,error:D}=await G.from("customers").select("id, name, points, loyalty_level, created_at").order("points",{ascending:!1});if(D)throw D;const{data:T,error:z}=await G.from("points_transactions").select("*").order("created_at",{ascending:!1});if(z)throw z;i(_||[]),m(T||[])}catch(_){console.error("Error loading points data:",_),te.error("Failed to load points data")}finally{x(!1)}},v=()=>{let _=c;if(j!=="all"&&(_=_.filter(D=>D.transaction_type===j)),f!=="all"&&(_=_.filter(D=>D.customer_id===f)),N!=="all"){const D=new Date,T=parseInt(N),z=new Date(D.getTime()-T*24*60*60*1e3);_=_.filter(se=>new Date(se.created_at)>=z)}return R&&(_=_.filter(D=>D.reason.toLowerCase().includes(R.toLowerCase())||D.created_by.toLowerCase().includes(R.toLowerCase()))),_},U=_=>{const D=a.find(T=>T.id===_);return(D==null?void 0:D.name)||"Unknown Customer"},F=_=>{switch(_){case"earned":return e.jsx(vr,{className:"h-4 w-4 text-green-500"});case"spent":return e.jsx(Sa,{className:"h-4 w-4 text-red-500"});case"redeemed":return e.jsx(qa,{className:"h-4 w-4 text-purple-500"});case"adjusted":return e.jsx(Va,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(hr,{className:"h-4 w-4 text-gray-500"})}},L=_=>{switch(_){case"earned":return"text-green-600";case"spent":return"text-red-600";case"redeemed":return"text-purple-600";case"adjusted":return"text-blue-600";default:return"text-gray-600"}},C=_=>new Date(_).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),$=()=>a.reduce((_,D)=>_+(D.points||0),0),Y=()=>c.filter(_=>_.transaction_type==="earned").reduce((_,D)=>_+D.points_change,0),A=()=>c.filter(_=>_.transaction_type==="spent"||_.transaction_type==="redeemed").reduce((_,D)=>_+Math.abs(D.points_change),0),Z=v();return u?e.jsx("div",{className:"p-6 max-w-6xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})})}):e.jsxs("div",{className:"p-6 max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(X,{variant:"secondary",icon:e.jsx(zs,{size:18}),onClick:()=>r("/customers"),children:"Back"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Points Management"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(he,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:e.jsx(_s,{size:20,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Customers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.length})]})]})}),e.jsx(he,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-500/10",children:e.jsx(hr,{size:20,className:"text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Points"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:$().toLocaleString()})]})]})}),e.jsx(he,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-emerald-500/10",children:e.jsx(vr,{size:20,className:"text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Earned"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Y().toLocaleString()})]})]})}),e.jsx(he,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-500/10",children:e.jsx(Sa,{size:20,className:"text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Spent"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A().toLocaleString()})]})]})})]}),e.jsx(he,{children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Rr,{size:16,className:"text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filters:"})]}),e.jsxs("select",{value:j,onChange:_=>b(_.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"earned",children:"Earned"}),e.jsx("option",{value:"spent",children:"Spent"}),e.jsx("option",{value:"redeemed",children:"Redeemed"}),e.jsx("option",{value:"adjusted",children:"Adjusted"})]}),e.jsxs("select",{value:f,onChange:_=>y(_.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm",children:[e.jsx("option",{value:"all",children:"All Customers"}),a.map(_=>e.jsxs("option",{value:_.id,children:[_.name," (",_.points," pts)"]},_.id))]}),e.jsxs("select",{value:N,onChange:_=>I(_.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"7",children:"Last 7 days"}),e.jsx("option",{value:"30",children:"Last 30 days"}),e.jsx("option",{value:"90",children:"Last 90 days"})]}),e.jsx("input",{type:"text",placeholder:"Search transactions...",value:R,onChange:_=>k(_.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm flex-1 max-w-xs"})]})}),e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Ki,{size:18}),"Points History"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[Z.length," transactions"]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Type"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Customer"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Points"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Reason"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"By"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:Z.map(_=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[F(_.transaction_type),e.jsx("span",{className:"text-sm font-medium capitalize",children:_.transaction_type})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-900",children:U(_.customer_id)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`text-sm font-bold ${L(_.transaction_type)}`,children:[_.points_change>0?"+":"",_.points_change]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-700 max-w-xs truncate block",children:_.reason})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-600",children:_.created_by})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-500",children:C(_.created_at)})})]},_.id))})]}),Z.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No transactions found matching your filters."})]})]}),e.jsxs(he,{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Top Customers by Points"}),e.jsx("div",{className:"space-y-3",children:a.slice(0,10).map((_,D)=>{var T;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500/10 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-blue-600",children:D+1})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:_.name}),e.jsxs("p",{className:"text-sm text-gray-600 capitalize",children:[_.loyalty_level," Level"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-gray-900",children:[((T=_.points)==null?void 0:T.toLocaleString())||0," points"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Since ",new Date(_.created_at).toLocaleDateString()]})]})]},_.id)})})]})]})},Ao=r=>r==="completed"?e.jsx(yt,{className:"inline text-green-600",size:16}):r==="pending"?e.jsx(ms,{className:"inline text-yellow-500",size:16}):r==="failed"?e.jsx(Fs,{className:"inline text-red-600",size:16}):null,yx=()=>{const{payments:r,loading:a}=ul(),[i,c]=g.useState([]),[m,u]=g.useState([]),[x,j]=g.useState([]),[b,f]=g.useState("all"),[y,N]=g.useState("all"),[I,R]=g.useState(""),[k,E]=g.useState(""),[v,U]=g.useState(!1);g.useEffect(()=>{(async()=>{const{data:z}=await G.from("devices").select("*");c(z||[]);const{data:se}=await G.from("auth_users").select("id, name, email, role");u(se||[]);const{data:q}=await G.from("customers").select("id, name");j(q||[])})()},[]);const F=Array.from(new Set(r.map(T=>T.created_by))).filter(T=>typeof T=="string"&&!!T),L=T=>{const z=m.find(se=>se.id===T);return z?z.name:"Unknown"},C=T=>{const z=x.find(se=>se.id===T);return z?z.name:"Unknown"},$=r.filter(T=>!(b!=="all"&&T.status!==b||y!=="all"&&T.created_by!==y||I&&new Date(T.payment_date)<new Date(I)||k&&new Date(T.payment_date)>new Date(k))),Y=i.map(T=>{const se=r.filter(J=>J.device_id===T.id&&J.status==="completed").reduce((J,V)=>J+(V.amount||0),0),q=T.invoice_total||0,H=Math.max(q-se,0);return{...T,totalPaid:se,outstanding:H}}).filter(T=>T.outstanding>0),A=T=>`${T.brand||""} ${T.model||""}`.trim()||T.id,Z=T=>{if(T.device_name)return T.device_name;const z=i.find(se=>se.id===T.device_id);return z?A(z):T.device_id},_=T=>{if(T.customer_name)return T.customer_name;const z=i.find(se=>se.id===T.device_id);return z&&z.customerName?z.customerName:C(T.customer_id)},D=$.reduce((T,z)=>T+(z.amount||0),0);return a?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"}),e.jsx("div",{className:"text-blue-700 font-semibold",children:"Loading payments report..."})]}):e.jsxs("div",{className:"max-w-7xl mx-auto px-2 sm:px-6 py-6 space-y-8",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/80 backdrop-blur-sm border-b border-gray-200 px-4 py-3 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(mr,{size:24,className:"text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Payments"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Track payments & balances"})]})]}),e.jsx("button",{onClick:()=>{var se;const T=(se=document.getElementById("payments-report-content"))==null?void 0:se.innerHTML,z=window.open("","","height=800,width=1000");z&&T&&(z.document.write("<html><head><title>Payments Report</title></head><body>"+T+"</body></html>"),z.document.close(),z.focus(),z.print(),z.close())},className:"text-xs text-gray-500 hover:text-gray-700 px-2 py-1 rounded hover:bg-gray-100 transition-colors",children:"Print"})]})}),e.jsxs("div",{id:"payments-report-content",className:"space-y-8",children:[e.jsx(he,{className:"mb-4 p-3 shadow-lg border border-blue-100",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[e.jsxs("select",{value:b,onChange:T=>f(T.target.value),className:"text-sm rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400 bg-white min-w-0 flex-1 sm:flex-none",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"completed",children:"Completed ✓"}),e.jsx("option",{value:"pending",children:"Pending ⏳"}),e.jsx("option",{value:"failed",children:"Failed ✗"})]}),e.jsxs("select",{value:y||"all",onChange:T=>N(T.target.value),className:"text-sm rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400 bg-white min-w-0 flex-1 sm:flex-none",children:[e.jsx("option",{value:"all",children:"All Staff"}),F.map(T=>e.jsx("option",{value:T,children:L(T||"")},T))]}),e.jsx("input",{type:"date",value:I,onChange:T=>R(T.target.value),className:"text-sm rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400 bg-white flex-1 sm:flex-none"}),e.jsx("input",{type:"date",value:k,onChange:T=>E(T.target.value),className:"text-sm rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400 bg-white flex-1 sm:flex-none"}),e.jsx("button",{onClick:()=>{f("all"),N("all"),R(""),E(""),U(!0),setTimeout(()=>U(!1),400)},className:"text-sm text-gray-500 hover:text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors bg-white border border-gray-300",children:"Clear"})]})}),e.jsxs(he,{className:"shadow-lg border border-blue-100",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2 text-blue-900",children:[e.jsx(mr,{size:20})," Payments"]}),e.jsxs("div",{className:"block sm:hidden space-y-3",children:[$.map((T,z)=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[Ao(T.status),e.jsx("span",{className:"font-semibold text-green-700 text-lg",children:Vt(T.amount)})]}),e.jsx("span",{className:"text-xs text-gray-500 capitalize",children:T.method})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Date:"}),e.jsx("p",{className:"font-medium",children:za(T.payment_date)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Status:"}),e.jsx("p",{className:"font-medium capitalize",children:T.status})]})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Device:"}),e.jsx("p",{className:"font-medium truncate",children:Z(T)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Customer:"}),e.jsx("p",{className:"font-medium truncate",children:_(T)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Recorded by:"}),e.jsx("p",{className:"font-medium",children:L(T.created_by||"")})]})]})]},T.id)),$.length===0&&e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(mr,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{children:"No payments found"})]}),$.length>0&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:e.jsxs("p",{className:"text-lg font-bold text-blue-900",children:["Total: ",Vt(D)]})})]}),e.jsx("div",{className:"hidden sm:block overflow-x-auto w-full",children:e.jsxs("table",{className:"min-w-full text-sm rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-50",children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Amount"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Method"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Device"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Customer"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Recorded By"})]})}),e.jsxs("tbody",{children:[$.map((T,z)=>e.jsxs("tr",{className:z%2===0?"bg-white":"bg-blue-50/50",children:[e.jsx("td",{className:"px-3 py-2",children:za(T.payment_date)}),e.jsx("td",{className:"px-3 py-2 font-semibold text-green-700",children:Vt(T.amount)}),e.jsx("td",{className:"px-3 py-2 capitalize",children:T.method}),e.jsxs("td",{className:"px-3 py-2",children:[Ao(T.status)," ",e.jsx("span",{className:"ml-1 capitalize",children:T.status})]}),e.jsx("td",{className:"px-3 py-2 font-medium max-w-32 truncate",title:Z(T),children:Z(T)}),e.jsx("td",{className:"px-3 py-2 max-w-32 truncate",title:_(T),children:_(T)}),e.jsx("td",{className:"px-3 py-2",children:L(T.created_by||"")})]},T.id)),$.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center text-gray-500 py-6",children:"No payments found"})})]}),$.length>0&&e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-blue-100 font-bold",children:[e.jsx("td",{className:"px-3 py-2 text-right",colSpan:1,children:"Total:"}),e.jsx("td",{className:"px-3 py-2 text-green-800",children:Vt(D)}),e.jsx("td",{colSpan:5})]})})]})})]}),e.jsxs(he,{className:"shadow-lg border border-rose-200",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2 text-rose-900",children:[e.jsx(Rr,{size:20})," Devices with Outstanding Balances"]}),e.jsxs("div",{className:"block sm:hidden space-y-3",children:[Y.map((T,z)=>{const se=T.invoice_total?Math.min(100,Math.round(T.totalPaid/T.invoice_total*100)):0;return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-semibold text-rose-700 text-lg",children:Vt(T.outstanding)})]}),e.jsx("span",{className:"text-xs text-gray-500 capitalize",children:T.status})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Device:"}),e.jsx("p",{className:"font-medium truncate",children:A(T)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Customer:"}),e.jsx("p",{className:"font-medium truncate",children:C(T.customer_id)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Invoice:"}),e.jsx("p",{className:"font-medium",children:Vt(T.invoice_total||0)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Paid:"}),e.jsx("p",{className:"font-medium text-green-700",children:Vt(T.totalPaid)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Payment Progress:"}),e.jsxs("span",{className:"font-medium",children:[se,"% paid"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-green-500 h-3 rounded-full transition-all duration-300",style:{width:`${se}%`}})})]})]},T.id)}),Y.length===0&&e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(Rr,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{children:"No outstanding balances"})]})]}),e.jsx("div",{className:"hidden sm:block overflow-x-auto w-full",children:e.jsxs("table",{className:"min-w-full text-sm rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-rose-50",children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Device"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Customer"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Invoice Total"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Total Paid"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Outstanding"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Progress"})]})}),e.jsxs("tbody",{children:[Y.map((T,z)=>{const se=T.invoice_total?Math.min(100,Math.round(T.totalPaid/T.invoice_total*100)):0;return e.jsxs("tr",{className:z%2===0?"bg-white":"bg-rose-50/50",children:[e.jsx("td",{className:"px-3 py-2 font-medium max-w-32 truncate",title:A(T),children:A(T)}),e.jsx("td",{className:"px-3 py-2 max-w-32 truncate",title:C(T.customer_id),children:C(T.customer_id)}),e.jsx("td",{className:"px-3 py-2",children:Vt(T.invoice_total||0)}),e.jsx("td",{className:"px-3 py-2 text-green-700 font-semibold",children:Vt(T.totalPaid)}),e.jsx("td",{className:"px-3 py-2 text-rose-700 font-bold",children:Vt(T.outstanding)}),e.jsx("td",{className:"px-3 py-2 capitalize",children:T.status}),e.jsxs("td",{className:"px-3 py-2",children:[e.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${se}%`}})}),e.jsxs("span",{className:"text-xs ml-2 text-gray-600",children:[se,"% paid"]})]})]},T.id)}),Y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center text-gray-500 py-6",children:"No outstanding balances"})})]})]})})]})]})]})},wx=()=>{const{currentUser:r}=Wt(),[a,i]=g.useState([]),[c,m]=g.useState(!0),[u,x]=g.useState({}),[j,b]=g.useState(""),[f,y]=g.useState(!1);g.useEffect(()=>{N()},[u]);const N=async()=>{try{m(!0);const F=await Wn.getAuditLogs(u);i(F)}catch(F){console.error("Error loading audit logs:",F),te.error("Failed to load audit logs")}finally{m(!1)}},I=async()=>{try{const F=await Wn.exportAuditLogs(u),L=new Blob([F],{type:"text/csv"}),C=window.URL.createObjectURL(L),$=document.createElement("a");$.href=C,$.download=`audit-logs-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild($),$.click(),window.URL.revokeObjectURL(C),document.body.removeChild($),te.success("Audit logs exported successfully")}catch(F){console.error("Error exporting audit logs:",F),te.error("Failed to export audit logs")}},R=F=>{switch(F){case"status_change":return e.jsx(fr,{className:"h-4 w-4 text-blue-500"});case"device_created":return e.jsx(pr,{className:"h-4 w-4 text-green-500"});case"device_updated":return e.jsx(pr,{className:"h-4 w-4 text-yellow-500"});case"user_login":return e.jsx(Ws,{className:"h-4 w-4 text-purple-500"});case"customer_created":return e.jsx(Ws,{className:"h-4 w-4 text-green-500"});case"return_created":return e.jsx(pr,{className:"h-4 w-4 text-orange-500"});default:return e.jsx(fr,{className:"h-4 w-4 text-gray-500"})}},k=F=>{switch(F){case"status_change":return"bg-blue-50 border-blue-200";case"device_created":return"bg-green-50 border-green-200";case"device_updated":return"bg-yellow-50 border-yellow-200";case"user_login":return"bg-purple-50 border-purple-200";case"customer_created":return"bg-green-50 border-green-200";case"return_created":return"bg-orange-50 border-orange-200";default:return"bg-gray-50 border-gray-200"}},E=F=>new Date(F).toLocaleString(),v=F=>!F||Object.keys(F).length===0?"No additional details":Object.entries(F).map(([L,C])=>`${L}: ${JSON.stringify(C)}`).join(", "),U=a.filter(F=>{if(!j)return!0;const L=j.toLowerCase();return F.action.toLowerCase().includes(L)||F.entityType.toLowerCase().includes(L)||F.entityId.toLowerCase().includes(L)||F.userId.toLowerCase().includes(L)||F.userRole.toLowerCase().includes(L)||v(F.details).toLowerCase().includes(L)});return(r==null?void 0:r.role)!=="admin"?e.jsx("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You don't have permission to view audit logs."})]})}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Audit Logs"}),e.jsx("p",{className:"text-gray-600",children:"Track all system activities and changes"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Cr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"text",placeholder:"Search audit logs...",value:j,onChange:F=>b(F.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>y(!f),className:"flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Rr,{className:"h-4 w-4"}),"Filters"]}),e.jsxs("button",{onClick:I,className:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[e.jsx(Br,{className:"h-4 w-4"}),"Export CSV"]})]})]}),f&&e.jsxs(he,{className:"mb-6 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Filters"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Action"}),e.jsxs("select",{value:u.action||"",onChange:F=>x(L=>({...L,action:F.target.value||void 0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Actions"}),e.jsx("option",{value:"status_change",children:"Status Change"}),e.jsx("option",{value:"device_created",children:"Device Created"}),e.jsx("option",{value:"device_updated",children:"Device Updated"}),e.jsx("option",{value:"user_login",children:"User Login"}),e.jsx("option",{value:"customer_created",children:"Customer Created"}),e.jsx("option",{value:"return_created",children:"Return Created"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Entity Type"}),e.jsxs("select",{value:u.entityType||"",onChange:F=>x(L=>({...L,entityType:F.target.value||void 0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"device",children:"Device"}),e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"return",children:"Return"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"system",children:"System"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Range"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:u.startDate||"",onChange:F=>x(L=>({...L,startDate:F.target.value||void 0})),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("input",{type:"date",value:u.endDate||"",onChange:F=>x(L=>({...L,endDate:F.target.value||void 0})),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:()=>x({}),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Clear Filters"}),e.jsx("button",{onClick:N,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Apply Filters"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(he,{className:"bg-gradient-to-br from-blue-500/20 to-blue-400/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Logs"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.length})]}),e.jsx(fr,{className:"h-6 w-6 text-blue-500"})]})}),e.jsx(he,{className:"bg-gradient-to-br from-green-500/20 to-green-400/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Today"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.filter(F=>{const L=new Date().toDateString();return new Date(F.timestamp).toDateString()===L}).length})]}),e.jsx(ws,{className:"h-6 w-6 text-green-500"})]})}),e.jsx(he,{className:"bg-gradient-to-br from-purple-500/20 to-purple-400/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Unique Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:new Set(a.map(F=>F.userId)).size})]}),e.jsx(Ws,{className:"h-6 w-6 text-purple-500"})]})}),e.jsx(he,{className:"bg-gradient-to-br from-orange-500/20 to-orange-400/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Filtered"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:U.length})]}),e.jsx(Rr,{className:"h-6 w-6 text-orange-500"})]})})]}),e.jsx("div",{className:"space-y-4",children:c?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Loading audit logs..."})]}):U.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fr,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No audit logs found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Try adjusting your filters or search"})]}):e.jsx("div",{className:"space-y-3",children:U.map(F=>e.jsx(he,{className:`border-l-4 ${k(F.action)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[R(F.action),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:F.action.replace(/_/g," ").replace(/\b\w/g,L=>L.toUpperCase())}),e.jsx("span",{className:"text-sm text-gray-500",children:"•"}),e.jsx("span",{className:"text-sm text-gray-600",children:F.entityType}),e.jsx("span",{className:"text-sm text-gray-500",children:"•"}),e.jsx("span",{className:"text-sm font-mono text-gray-600",children:F.entityId})]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("span",{className:"font-medium",children:F.userId}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{className:"capitalize",children:F.userRole}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{children:E(F.timestamp)})]}),e.jsxs("div",{className:"text-sm text-gray-700 bg-gray-50 p-2 rounded border",children:[e.jsx("span",{className:"font-medium",children:"Details:"})," ",v(F.details)]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 text-xs text-gray-500",children:[F.ipAddress&&e.jsxs("span",{children:["IP: ",F.ipAddress]}),F.userAgent&&e.jsxs("span",{className:"max-w-xs truncate",title:F.userAgent,children:["UA: ",F.userAgent.substring(0,50),"..."]})]})]})},F.id))})})]})};class jx{constructor(){ur(this,"apiKey",null);ur(this,"baseUrl","https://generativelanguage.googleapis.com/v1beta/models");ur(this,"config",{model:"gemini-1.5-flash",temperature:.7,maxTokens:1e3});this.apiKey=null}setApiKey(a){this.apiKey=a}async testConnection(){var a,i,c,m,u,x;if(!this.apiKey)return{success:!1,error:"API key not configured"};try{const j=await fetch(`${this.baseUrl}/${this.config.model}:generateContent?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:"Hello! Please respond with 'Connection successful' if you can read this message."}]}],generationConfig:{temperature:.1,maxOutputTokens:50}})}),b=await j.json();return j.ok&&((u=(m=(c=(i=(a=b.candidates)==null?void 0:a[0])==null?void 0:i.content)==null?void 0:c.parts)==null?void 0:m[0])!=null&&u.text)?{success:!0,data:b.candidates[0].content.parts[0].text}:{success:!1,error:((x=b.error)==null?void 0:x.message)||"Connection test failed"}}catch(j){return{success:!1,error:`Network error: ${j}`}}}async chat(a){var i,c,m,u,x,j;if(!this.apiKey)return{success:!1,error:"API key not configured"};try{const b=a.map(N=>({parts:[{text:N.content}],role:N.role==="user"?"user":"model"})),f=await fetch(`${this.baseUrl}/${this.config.model}:generateContent?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:b,generationConfig:{temperature:this.config.temperature,maxOutputTokens:this.config.maxTokens}})}),y=await f.json();return f.ok&&((x=(u=(m=(c=(i=y.candidates)==null?void 0:i[0])==null?void 0:c.content)==null?void 0:m.parts)==null?void 0:u[0])!=null&&x.text)?{success:!0,data:y.candidates[0].content.parts[0].text}:{success:!1,error:((j=y.error)==null?void 0:j.message)||"AI request failed"}}catch(b){return{success:!1,error:`Network error: ${b}`}}}async generateCustomerResponse(a,i){const c=`You are a helpful customer service assistant for a device repair and sales business. 
    Provide professional, friendly responses that are concise and helpful. 
    Focus on device repair, sales, and customer satisfaction.`,m=i?`${c}

Context: ${i}

Customer query: "${a}"`:`${c}

Customer query: "${a}"`;return this.chat([{role:"user",content:m}])}async diagnoseDeviceIssue(a,i){const c=`As a device repair technician, analyze these symptoms and provide a diagnosis:
    
Device Type: ${i}
Symptoms: ${a}

Please provide:
1. Likely cause
2. Recommended repair steps
3. Estimated repair time
4. Potential cost range
5. Safety warnings

Keep response concise and professional.`;return this.chat([{role:"user",content:c}])}async generateSMSResponse(a,i){const c=`Generate a professional SMS/WhatsApp response for a device repair business:

Customer Message: "${a}"
${i?`Context: ${i}`:""}

Requirements:
- Professional and friendly tone
- Concise (under 160 characters if possible)
- Address customer's concern
- Include next steps if needed
- No technical jargon unless necessary`;return this.chat([{role:"user",content:c}])}async analyzeExpense(a,i){const c=`Analyze this business expense for a device repair shop:

Description: ${a}
Amount: $${i}

Please provide:
1. Expense category (e.g., Parts, Labor, Utilities, Marketing, etc.)
2. Business impact analysis
3. Cost optimization suggestions
4. Tax implications (if any)

Keep response concise and practical.`;return this.chat([{role:"user",content:c}])}}const Fn=new jx,Nx=()=>{const{payments:r,loading:a,refreshPayments:i}=ul(),{currentUser:c}=Wt(),[m,u]=g.useState("summary"),[x,j]=g.useState([]),[b,f]=g.useState(!0),[y,N]=g.useState(!1),[I,R]=g.useState(!1),[k,E]=g.useState(null),[v,U]=g.useState({name:"",type:"bank",balance:0,account_number:"",bank_name:"",is_active:!0}),[F,L]=g.useState({amount:"",method:"cash",account_id:"",customer_id:"",device_id:"",payment_type:"payment",notes:""}),[C,$]=g.useState("all"),[Y,A]=g.useState("all"),[Z,_]=g.useState("all"),[D,T]=g.useState(""),[z,se]=g.useState(""),[q,H]=g.useState(!1),[J,V]=g.useState(!1),[ge,He]=g.useState([]),[B,fe]=g.useState({from_account_id:"",to_account_id:"",amount:"",description:""}),[re,ye]=g.useState({account_id:"",adjustment_type:"add",amount:"",reason:""}),[Q,Le]=g.useState([]),[Ue,Ct]=g.useState([]),[Re,ut]=g.useState(!1),[Ee,Oe]=g.useState(!1),[Xe,Be]=g.useState(null),[Ce,Ze]=g.useState(null),[$e,K]=g.useState({title:"",account_id:"",category:"",amount:"",description:"",expense_date:new Date().toISOString().split("T")[0],payment_method:"cash",status:"pending",receipt_url:""}),[be,ue]=g.useState({name:"",color:"#3B82F6",icon:"receipt",budget_limit:"",is_active:!0}),[Ye,ae]=g.useState("all"),[ke,Ke]=g.useState("all"),[le,Ne]=g.useState("all"),[Te,Qe]=g.useState(""),[vt,Rt]=g.useState(""),[ht,Se]=g.useState("month"),[ve,de]=g.useState({loading:!1,insights:"",suggestions:[],category:"",riskLevel:"low"}),[me,Ae]=g.useState(!1),[it,St]=g.useState("");g.useEffect(()=>{xs(),Is(),ts(),bs()},[]);const kt=M=>{const ce=new Date,Je=new Date;switch(M){case"today":return Je.setHours(0,0,0,0),{start:Je,end:ce};case"week":return Je.setDate(ce.getDate()-7),{start:Je,end:ce};case"month":return Je.setMonth(ce.getMonth()-1),{start:Je,end:ce};case"quarter":return Je.setMonth(ce.getMonth()-3),{start:Je,end:ce};case"year":return Je.setFullYear(ce.getFullYear()-1),{start:Je,end:ce};case"all":return{start:new Date(0),end:ce};default:return{start:Je,end:ce}}},et=(M,ce)=>{const{start:Je,end:_t}=kt(ce),Dt=new Date(M);return Dt>=Je&&Dt<=_t},xs=async()=>{f(!0);try{const{data:M,error:ce}=await G.from("finance_accounts").select("*").order("created_at",{ascending:!1});ce?(console.error("Error loading accounts:",ce),te.error("Failed to load accounts")):j(M||[])}catch(M){console.error("Error loading accounts:",M),te.error("Failed to load accounts")}finally{f(!1)}},Nt=async()=>{if(!v.name.trim()){te.error("Account name is required");return}try{const{data:M,error:ce}=await G.from("finance_accounts").insert([{...v,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(ce)throw ce;j(Je=>[M,...Je]),N(!1),U({name:"",type:"bank",balance:0,account_number:"",bank_name:"",is_active:!0}),te.success("Account added successfully")}catch(M){console.error("Error adding account:",M),te.error(M.message||"Failed to add account")}},ss=async()=>{if(!k||!v.name.trim()){te.error("Account name is required");return}try{const{data:M,error:ce}=await G.from("finance_accounts").update({...v,updated_at:new Date().toISOString()}).eq("id",k.id).select().single();if(ce)throw ce;j(Je=>Je.map(_t=>_t.id===k.id?M:_t)),E(null),U({name:"",type:"bank",balance:0,account_number:"",bank_name:"",is_active:!0}),te.success("Account updated successfully")}catch(M){console.error("Error updating account:",M),te.error(M.message||"Failed to update account")}},gt=async M=>{if(confirm("Are you sure you want to delete this account?"))try{const{error:ce}=await G.from("finance_accounts").delete().eq("id",M);if(ce)throw ce;j(Je=>Je.filter(_t=>_t.id!==M)),te.success("Account deleted successfully")}catch(ce){console.error("Error deleting account:",ce),te.error(ce.message||"Failed to delete account")}},Is=async()=>{try{const{data:M,error:ce}=await G.from("finance_transfers").select("*").order("created_at",{ascending:!1});ce?console.error("Error loading transfers:",ce):He(M||[])}catch(M){console.error("Error loading transfers:",M)}},ts=async()=>{try{const{data:M,error:ce}=await G.from("finance_expenses").select("*").order("expense_date",{ascending:!1});ce?console.error("Error loading expenses:",ce):Le(M||[])}catch(M){console.error("Error loading expenses:",M)}},bs=async()=>{try{const{data:M,error:ce}=await G.from("finance_expense_categories").select("*").order("name",{ascending:!0});ce?console.error("Error loading expense categories:",ce):Ct(M||[])}catch(M){console.error("Error loading expense categories:",M)}},Qt=async(M,ce,Je)=>{if(!it){te.error("Please enter your Gemini API key first");return}de(_t=>({..._t,loading:!0}));try{Fn.setApiKey(it);const _t=`Analyze this business expense for a device repair shop:
        Description: ${M}
        Amount: ${Vt(ce)}
        Category: ${Je||"Not specified"}
        
        Please provide:
        1. Business insights about this expense
        2. Suggested category if not specified
        3. Cost optimization suggestions
        4. Risk level (low/medium/high) based on amount and type
        5. 3 actionable recommendations
        
        Format as JSON:
        {
          "insights": "business insights here",
          "suggestedCategory": "category name",
          "suggestions": ["suggestion1", "suggestion2", "suggestion3"],
          "riskLevel": "low/medium/high",
          "recommendations": ["rec1", "rec2", "rec3"]
        }`,Dt=await Fn.analyzeExpense(M,ce);if(Dt.success)try{const at=JSON.parse(Dt.data);de({loading:!1,insights:at.insights||"No insights available",suggestions:at.suggestions||[],category:at.suggestedCategory||Je||"",riskLevel:at.riskLevel||"low"}),Ae(!0)}catch{de({loading:!1,insights:Dt.data,suggestions:[],category:Je||"",riskLevel:"low"}),Ae(!0)}else te.error("AI analysis failed: "+Dt.error),de(at=>({...at,loading:!1}))}catch(_t){console.error("AI analysis error:",_t),te.error("AI analysis failed: "+_t.message),de(Dt=>({...Dt,loading:!1}))}},Pe=async()=>{if(!it){te.error("Please enter your Gemini API key first");return}de(M=>({...M,loading:!0}));try{Fn.setApiKey(it);const ce=`Analyze these recent business expenses for a device repair shop:
        ${Q.filter(_t=>_t.status==="approved").slice(0,10).map(_t=>`${_t.title}: ${Vt(_t.amount)} (${_t.category})`).join(`
`)}
        
        Total expenses this period: ${Vt(Ot.totalExpenses)}
        Total revenue this period: ${Vt(Ot.totalRevenue)}
        
        Please provide:
        1. Overall expense trend analysis
        2. Areas of concern or opportunity
        3. Cost optimization recommendations
        4. Budget planning suggestions
        
        Format as JSON:
        {
          "insights": "trend analysis here",
          "suggestions": ["suggestion1", "suggestion2", "suggestion3"],
          "riskLevel": "low/medium/high",
          "recommendations": ["rec1", "rec2", "rec3"]
        }`,Je=await Fn.analyzeExpense("Expense trend analysis",Ot.totalExpenses);if(Je.success)try{const _t=JSON.parse(Je.data);de({loading:!1,insights:_t.insights||"No trend insights available",suggestions:_t.suggestions||[],category:"Trend Analysis",riskLevel:_t.riskLevel||"low"}),Ae(!0)}catch{de({loading:!1,insights:Je.data,suggestions:[],category:"Trend Analysis",riskLevel:"low"}),Ae(!0)}else te.error("AI trend analysis failed: "+Je.error),de(_t=>({..._t,loading:!1}))}catch(M){console.error("AI trend analysis error:",M),te.error("AI trend analysis failed: "+M.message),de(ce=>({...ce,loading:!1}))}},ot=M=>{switch(M){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}},$t=M=>{switch(M){case"high":return e.jsx(dr,{size:16,className:"text-red-600"});case"medium":return e.jsx(ms,{size:16,className:"text-yellow-600"});case"low":return e.jsx(yt,{size:16,className:"text-green-600"});default:return e.jsx(Bs,{size:16,className:"text-gray-600"})}},gs=async()=>{if(!F.amount||!F.account_id){te.error("Amount and account are required");return}try{const{data:M,error:ce}=await G.from("customer_payments").insert([{customer_id:F.customer_id,amount:parseFloat(F.amount),method:F.method,device_id:F.device_id||null,payment_date:new Date().toISOString(),payment_type:F.payment_type,status:"completed",created_at:new Date().toISOString(),notes:F.notes}]).select().single();if(ce)throw ce;await i(),R(!1),L({amount:"",method:"cash",account_id:"",customer_id:"",device_id:"",payment_type:"payment",notes:""}),te.success("Payment added successfully")}catch(M){console.error("Error adding payment:",M),te.error(M.message||"Failed to add payment")}},Jt=async()=>{if(!B.from_account_id||!B.to_account_id||!B.amount){te.error("Please fill all required fields");return}if(B.from_account_id===B.to_account_id){te.error("Cannot transfer to the same account");return}const M=parseFloat(B.amount);if(M<=0){te.error("Amount must be greater than 0");return}const ce=x.find(Je=>Je.id===B.from_account_id);if(!ce||ce.balance<M){te.error("Insufficient balance in source account");return}try{const{data:Je,error:_t}=await G.from("finance_transfers").insert([{from_account_id:B.from_account_id,to_account_id:B.to_account_id,amount:M,description:B.description,created_at:new Date().toISOString()}]).select().single();if(_t)throw _t;const{error:Dt}=await G.from("finance_accounts").update({balance:ce.balance-M,updated_at:new Date().toISOString()}).eq("id",B.from_account_id);if(Dt)throw Dt;const at=x.find(Et=>Et.id===B.to_account_id);at&&await G.from("finance_accounts").update({balance:at.balance+M,updated_at:new Date().toISOString()}).eq("id",B.to_account_id),await xs(),await Is(),H(!1),fe({from_account_id:"",to_account_id:"",amount:"",description:""}),te.success("Transfer completed successfully")}catch(Je){console.error("Error processing transfer:",Je),te.error(Je.message||"Failed to process transfer")}},Es=async()=>{if(!re.account_id||!re.amount){te.error("Please fill all required fields");return}const M=parseFloat(re.amount);if(M<=0){te.error("Amount must be greater than 0");return}const ce=x.find(Je=>Je.id===re.account_id);if(!ce){te.error("Account not found");return}try{const Je=re.adjustment_type==="add"?ce.balance+M:ce.balance-M;if(Je<0){te.error("Insufficient balance for adjustment");return}const{error:_t}=await G.from("finance_accounts").update({balance:Je,updated_at:new Date().toISOString()}).eq("id",re.account_id);if(_t)throw _t;await xs(),V(!1),ye({account_id:"",adjustment_type:"add",amount:"",reason:""}),te.success("Balance adjusted successfully")}catch(Je){console.error("Error adjusting balance:",Je),te.error(Je.message||"Failed to adjust balance")}},as=async()=>{if(!$e.title||!$e.account_id||!$e.category||!$e.amount){te.error("Please fill all required fields");return}const M=parseFloat($e.amount);if(M<=0){te.error("Amount must be greater than 0");return}try{const{data:ce,error:Je}=await G.from("finance_expenses").insert([{title:$e.title,account_id:$e.account_id,category:$e.category,amount:M,description:$e.description,expense_date:$e.expense_date,payment_method:$e.payment_method,status:$e.status,receipt_url:$e.receipt_url||null,created_at:new Date().toISOString()}]).select().single();if(Je)throw Je;await ts(),ut(!1),K({title:"",account_id:"",category:"",amount:"",description:"",expense_date:new Date().toISOString().split("T")[0],payment_method:"cash",status:"pending",receipt_url:""}),te.success("Expense added successfully")}catch(ce){console.error("Error adding expense:",ce),te.error(ce.message||"Failed to add expense")}},Us=async()=>{if(!Xe||!$e.title||!$e.account_id||!$e.category||!$e.amount){te.error("Please fill all required fields");return}const M=parseFloat($e.amount);if(M<=0){te.error("Amount must be greater than 0");return}try{const{data:ce,error:Je}=await G.from("finance_expenses").update({title:$e.title,account_id:$e.account_id,category:$e.category,amount:M,description:$e.description,expense_date:$e.expense_date,payment_method:$e.payment_method,status:$e.status,receipt_url:$e.receipt_url||null,updated_at:new Date().toISOString()}).eq("id",Xe.id).select().single();if(Je)throw Je;await ts(),Be(null),K({title:"",account_id:"",category:"",amount:"",description:"",expense_date:new Date().toISOString().split("T")[0],payment_method:"cash",status:"pending",receipt_url:""}),te.success("Expense updated successfully")}catch(ce){console.error("Error updating expense:",ce),te.error(ce.message||"Failed to update expense")}},ys=M=>{Be(M),K({title:M.title,account_id:M.account_id,category:M.category,amount:M.amount.toString(),description:M.description,expense_date:M.expense_date,payment_method:M.payment_method,status:M.status,receipt_url:M.receipt_url||""})},xe=async M=>{if(confirm("Are you sure you want to delete this expense?"))try{const{error:ce}=await G.from("finance_expenses").delete().eq("id",M);if(ce)throw ce;await ts(),te.success("Expense deleted successfully")}catch(ce){console.error("Error deleting expense:",ce),te.error(ce.message||"Failed to delete expense")}},pt=async()=>{if(!be.name.trim()){te.error("Category name is required");return}try{const{data:M,error:ce}=await G.from("finance_expense_categories").insert([{name:be.name,color:be.color,icon:be.icon,budget_limit:be.budget_limit?parseFloat(be.budget_limit):null,is_active:be.is_active,created_at:new Date().toISOString()}]).select().single();if(ce)throw ce;await bs(),Oe(!1),ue({name:"",color:"#3B82F6",icon:"receipt",budget_limit:"",is_active:!0}),te.success("Category added successfully")}catch(M){console.error("Error adding category:",M),te.error(M.message||"Failed to add category")}},lt=async()=>{if(!Ce||!be.name.trim()){te.error("Category name is required");return}try{const{data:M,error:ce}=await G.from("finance_expense_categories").update({name:be.name,color:be.color,icon:be.icon,budget_limit:be.budget_limit?parseFloat(be.budget_limit):null,is_active:be.is_active,updated_at:new Date().toISOString()}).eq("id",Ce.id).select().single();if(ce)throw ce;await bs(),Ze(null),ue({name:"",color:"#3B82F6",icon:"receipt",budget_limit:"",is_active:!0}),te.success("Category updated successfully")}catch(M){console.error("Error updating category:",M),te.error(M.message||"Failed to update category")}},rt=r.filter(M=>!(C!=="all"&&M.status!==C||Y!=="all"&&M.method!==Y||D&&new Date(M.payment_date)<new Date(D)||z&&new Date(M.payment_date)>new Date(z))),wt=Q.filter(M=>{const ce=Ye==="all"||M.category===Ye,Je=ke==="all"||M.status===ke,_t=le==="all"||M.account_id===le;let Dt=!0;if(Te&&vt){const at=new Date(M.expense_date),Et=new Date(Te),sr=new Date(vt);Dt=at>=Et&&at<=sr}else if(Te){const at=new Date(M.expense_date),Et=new Date(Te);Dt=at>=Et}else if(vt){const at=new Date(M.expense_date),Et=new Date(vt);Dt=at<=Et}return ce&&Je&&_t&&Dt}),Ot={totalRevenue:r.filter(M=>M.status==="completed"&&et(M.payment_date,ht)).reduce((M,ce)=>M+(ce.amount||0),0),totalOutstanding:r.filter(M=>M.status==="pending"&&et(M.payment_date,ht)).reduce((M,ce)=>M+(ce.amount||0),0),totalAccounts:x.length,monthlyRevenue:r.filter(M=>M.status==="completed"&&et(M.payment_date,ht)).reduce((M,ce)=>M+(ce.amount||0),0),pendingPayments:r.filter(M=>M.status==="pending"&&et(M.payment_date,ht)).length,completedPayments:r.filter(M=>M.status==="completed"&&et(M.payment_date,ht)).length,totalBalance:x.reduce((M,ce)=>M+ce.balance,0),averageTransaction:r.filter(M=>M.status==="completed"&&et(M.payment_date,ht)).length>0?r.filter(M=>M.status==="completed"&&et(M.payment_date,ht)).reduce((M,ce)=>M+(ce.amount||0),0)/r.filter(M=>M.status==="completed"&&et(M.payment_date,ht)).length:0,totalExpenses:Q.filter(M=>M.status==="approved"&&et(M.expense_date,ht)).reduce((M,ce)=>M+ce.amount,0),monthlyExpenses:Q.filter(M=>M.status==="approved"&&et(M.expense_date,ht)).reduce((M,ce)=>M+ce.amount,0),pendingExpenses:Q.filter(M=>M.status==="pending"&&et(M.expense_date,ht)).length,approvedExpenses:Q.filter(M=>M.status==="approved"&&et(M.expense_date,ht)).length,netProfit:r.filter(M=>M.status==="completed"&&et(M.payment_date,ht)).reduce((M,ce)=>M+(ce.amount||0),0)-Q.filter(M=>M.status==="approved"&&et(M.expense_date,ht)).reduce((M,ce)=>M+ce.amount,0),monthlyProfit:r.filter(M=>M.status==="completed"&&et(M.payment_date,ht)).reduce((M,ce)=>M+(ce.amount||0),0)-Q.filter(M=>M.status==="approved"&&et(M.expense_date,ht)).reduce((M,ce)=>M+ce.amount,0)},Gt=M=>M==="completed"?e.jsx(yt,{className:"inline text-green-600",size:16}):M==="pending"?e.jsx(ms,{className:"inline text-yellow-500",size:16}):M==="failed"?e.jsx(Fs,{className:"inline text-red-600",size:16}):null,we=()=>x.map(M=>({name:M.name,value:M.balance,color:fs(M.type)})),Ge=()=>{console.log("🔍 getExpenseCategoryData - expenses:",Q.length),console.log("🔍 getExpenseCategoryData - timePeriod:",ht);const M=Q.filter(Je=>Je.status==="approved"&&et(Je.expense_date,ht)).reduce((Je,_t)=>(Je[_t.category]=(Je[_t.category]||0)+_t.amount,Je),{}),ce=Object.entries(M).map(([Je,_t])=>({name:Je,value:_t,color:jt(Je)}));return console.log("🔍 getExpenseCategoryData - result:",ce),ce},tt=()=>{console.log("🔍 getExpenseStatusData - expenses:",Q.length);const M=Q.filter(Je=>et(Je.expense_date,ht)).reduce((Je,_t)=>(Je[_t.status]=(Je[_t.status]||0)+1,Je),{}),ce=Object.entries(M).map(([Je,_t])=>({name:Je.charAt(0).toUpperCase()+Je.slice(1),value:_t,color:bt(Je)}));return console.log("🔍 getExpenseStatusData - result:",ce),ce},dt=()=>{console.log("🔍 getMonthlyExpenseData - expenses:",Q.length);const M=Q.filter(Je=>Je.status==="approved"&&et(Je.expense_date,ht)).reduce((Je,_t)=>{const Dt=new Date(_t.expense_date).toLocaleDateString("en-US",{month:"short"});return Je[Dt]=(Je[Dt]||0)+_t.amount,Je},{}),ce=Object.entries(M).map(([Je,_t])=>({month:Je,expenses:_t}));return console.log("🔍 getMonthlyExpenseData - result:",ce),ce},jt=M=>{const ce=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#06B6D4","#84CC16","#F97316"],Je=M.charCodeAt(0)%ce.length;return ce[Je]},bt=M=>{switch(M){case"approved":return"#10B981";case"pending":return"#F59E0B";case"rejected":return"#EF4444";default:return"#6B7280"}},Xt=M=>{switch(M){case"today":return"Today";case"week":return"Last 7 Days";case"month":return"Last 30 Days";case"quarter":return"Last 3 Months";case"year":return"Last Year";case"all":return"All Time";default:return"Last 30 Days"}},ds=()=>{const M=r.filter(ce=>ce.status==="completed"&&et(ce.payment_date,ht)).reduce((ce,Je)=>{const _t=new Date(Je.payment_date).toLocaleDateString("en-US",{month:"short"});return ce[_t]=(ce[_t]||0)+(Je.amount||0),ce},{});return Object.entries(M).map(([ce,Je])=>({month:ce,revenue:Je}))},fs=M=>{switch(M){case"bank":return"#3B82F6";case"cash":return"#10B981";case"mobile_money":return"#8B5CF6";case"credit_card":return"#F59E0B";case"savings":return"#06B6D4";case"investment":return"#84CC16";default:return"#6B7280"}},We=M=>{switch(M){case"bank":return e.jsx(mr,{className:"w-5 h-5 text-blue-600"});case"cash":return e.jsx(Ns,{className:"w-5 h-5 text-green-600"});case"mobile_money":return e.jsx(ns,{className:"w-5 h-5 text-purple-600"});case"credit_card":return e.jsx(mr,{className:"w-5 h-5 text-amber-600"});case"savings":return e.jsx(Hs,{className:"w-5 h-5 text-cyan-600"});case"investment":return e.jsx(vr,{className:"w-5 h-5 text-lime-600"});default:return e.jsx(an,{className:"w-5 h-5 text-gray-600"})}};return b?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"}),e.jsx("div",{className:"text-blue-700 font-semibold",children:"Loading finance data..."})]}):e.jsxs("div",{className:"max-w-7xl mx-auto px-2 sm:px-6 py-6 space-y-8",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/80 backdrop-blur-sm border-b border-gray-200 px-4 py-3 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ns,{size:24,className:"text-green-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Finance Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Manage accounts, payments & financial overview"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(X,{variant:"secondary",onClick:()=>H(!0),className:"text-sm",children:[e.jsx(Bn,{size:16}),"Transfer"]}),e.jsxs(X,{variant:"secondary",onClick:()=>V(!0),className:"text-sm",children:[e.jsx(dn,{size:16}),"Adjust Balance"]}),e.jsxs(X,{variant:"secondary",onClick:()=>R(!0),className:"text-sm",children:[e.jsx(Ut,{size:16}),"Add Payment"]}),e.jsxs(X,{variant:"primary",onClick:()=>N(!0),className:"text-sm",children:[e.jsx(Ut,{size:16}),"Add Account"]})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ws,{size:20,className:"text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Time Period"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Filter data by time range"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{value:ht,onChange:M=>Se(M.target.value),className:"text-sm rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400 bg-white",children:[e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"Last 7 Days"}),e.jsx("option",{value:"month",children:"Last 30 Days"}),e.jsx("option",{value:"quarter",children:"Last 3 Months"}),e.jsx("option",{value:"year",children:"Last Year"}),e.jsx("option",{value:"all",children:"All Time"})]})})]}),e.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[{id:"summary",label:"Summary",icon:zr},{id:"accounts",label:"Accounts",icon:an},{id:"payments",label:"Payments",icon:mr},{id:"expenses",label:"Expenses",icon:La}].map(M=>e.jsxs("button",{onClick:()=>u(M.id),className:`flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all ${m===M.id?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(M.icon,{size:16}),M.label]},M.id))}),m==="summary"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(he,{className:"bg-gradient-to-br from-green-500/10 to-green-400/5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-green-600 font-medium",children:["Revenue (",Xt(ht),")"]}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:Vt(Ot.totalRevenue)}),e.jsxs("p",{className:"text-xs text-green-600",children:[Xt(ht)," earnings"]})]}),e.jsx(vr,{className:"w-8 h-8 text-green-600"})]})}),e.jsx(he,{className:"bg-gradient-to-br from-red-500/10 to-red-400/5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-red-600 font-medium",children:["Expenses (",Xt(ht),")"]}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:Vt(Ot.totalExpenses)}),e.jsxs("p",{className:"text-xs text-red-600",children:[Xt(ht)," expenses"]})]}),e.jsx(La,{className:"w-8 h-8 text-red-600"})]})}),e.jsx(he,{className:"bg-gradient-to-br from-emerald-500/10 to-emerald-400/5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-emerald-600 font-medium",children:["Net Profit (",Xt(ht),")"]}),e.jsx("p",{className:"text-2xl font-bold text-emerald-900",children:Vt(Ot.netProfit)}),e.jsx("p",{className:"text-xs text-emerald-600",children:"Revenue - Expenses"})]}),e.jsx(vr,{className:"w-8 h-8 text-emerald-600"})]})}),e.jsx(he,{className:"bg-gradient-to-br from-blue-500/10 to-blue-400/5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Balance"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:Vt(Ot.totalBalance)}),e.jsx("p",{className:"text-xs text-blue-600",children:"Across all accounts"})]}),e.jsx(an,{className:"w-8 h-8 text-blue-600"})]})}),e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"bg-gradient-to-br from-purple-500/10 to-purple-400/5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Completed Payments"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:Ot.completedPayments}),e.jsx("p",{className:"text-xs text-purple-600",children:Xt(ht)})]}),e.jsx(yt,{className:"w-8 h-8 text-purple-600"})]})}),e.jsx(he,{className:"bg-gradient-to-br from-amber-500/10 to-amber-400/5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 font-medium",children:"Pending Payments"}),e.jsx("p",{className:"text-2xl font-bold text-amber-900",children:Ot.pendingPayments}),e.jsx("p",{className:"text-xs text-amber-600",children:Xt(ht)})]}),e.jsx(ms,{className:"w-8 h-8 text-amber-600"})]})}),e.jsx(he,{className:"bg-gradient-to-br from-indigo-500/10 to-indigo-400/5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-indigo-600 font-medium",children:"Pending Expenses"}),e.jsx("p",{className:"text-2xl font-bold text-indigo-900",children:Ot.pendingExpenses}),e.jsx("p",{className:"text-xs text-indigo-600",children:"Awaiting approval"})]}),e.jsx(dr,{className:"w-8 h-8 text-indigo-600"})]})}),e.jsx(he,{className:"bg-gradient-to-br from-cyan-500/10 to-cyan-400/5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-cyan-600 font-medium",children:"Active Accounts"}),e.jsx("p",{className:"text-2xl font-bold text-cyan-900",children:Ot.totalAccounts}),e.jsx("p",{className:"text-xs text-cyan-600",children:"Total accounts"})]}),e.jsx(Zr,{className:"w-8 h-8 text-cyan-600"})]})}),e.jsx(he,{className:"bg-gradient-to-br from-orange-500/10 to-orange-400/5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-orange-600 font-medium",children:"Outstanding"}),e.jsx("p",{className:"text-2xl font-bold text-orange-900",children:Vt(Ot.totalOutstanding)}),e.jsx("p",{className:"text-xs text-orange-600",children:Xt(ht)})]}),e.jsx(dr,{className:"w-8 h-8 text-orange-600"})]})}),e.jsx(he,{className:"bg-gradient-to-br from-yellow-500/10 to-yellow-400/5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-yellow-600 font-medium",children:"Avg Transaction"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:Vt(Ot.averageTransaction)}),e.jsx("p",{className:"text-xs text-yellow-600",children:"Per payment"})]}),e.jsx(dn,{className:"w-8 h-8 text-yellow-600"})]})}),e.jsx(he,{className:"bg-gradient-to-br from-purple-500/10 to-purple-400/5 cursor-pointer hover:shadow-lg transition-shadow",onClick:Pe,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"AI Analysis"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:ve.loading?"Analyzing...":"Get Insights"}),e.jsx("p",{className:"text-xs text-purple-600",children:"AI-powered insights"})]}),ve.loading?e.jsx(us,{className:"w-8 h-8 text-purple-600 animate-spin"}):e.jsx(Oa,{className:"w-8 h-8 text-purple-600"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(he,{children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(Qi,{size:20}),"Account Balance Distribution"]}),e.jsx("div",{className:"h-64",children:e.jsx(Rn,{width:"100%",height:"100%",children:e.jsxs(Pl,{children:[e.jsx(Fl,{data:we(),cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",dataKey:"value",label:({name:M,value:ce})=>`${M}: ${Vt(ce)}`,children:we().map((M,ce)=>e.jsx(yi,{fill:M.color},`cell-${ce}`))}),e.jsx(Ln,{formatter:M=>Vt(M)})]})})})]}),e.jsxs(he,{children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(Wd,{size:20}),"Revenue vs Expenses (",Xt(ht),")"]}),e.jsx("div",{className:"h-64",children:e.jsx(Rn,{width:"100%",height:"100%",children:e.jsxs(Zd,{data:ds().map((M,ce)=>{var Je;return{...M,expenses:((Je=dt()[ce])==null?void 0:Je.expenses)||0}}),children:[e.jsx(Bl,{strokeDasharray:"3 3"}),e.jsx(zl,{dataKey:"month"}),e.jsx(Ul,{}),e.jsx(Ln,{formatter:M=>Vt(M)}),e.jsx(Qd,{}),e.jsx($l,{type:"monotone",dataKey:"revenue",stroke:"#10B981",strokeWidth:2,dot:{fill:"#10B981",strokeWidth:2,r:4},name:"Revenue"}),e.jsx($l,{type:"monotone",dataKey:"expenses",stroke:"#EF4444",strokeWidth:2,dot:{fill:"#EF4444",strokeWidth:2,r:4},name:"Expenses"})]})})})]}),e.jsxs(he,{children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(zr,{size:20}),"Expense Categories (",Xt(ht),")"]}),e.jsx("div",{className:"h-64",children:e.jsx(Rn,{width:"100%",height:"100%",children:e.jsxs(Jd,{data:Ge(),children:[e.jsx(Bl,{strokeDasharray:"3 3"}),e.jsx(zl,{dataKey:"name"}),e.jsx(Ul,{}),e.jsx(Ln,{formatter:M=>Vt(M)}),e.jsx(eu,{dataKey:"value",fill:"#EF4444",children:Ge().map((M,ce)=>e.jsx(yi,{fill:M.color},`cell-${ce}`))})]})})})]}),e.jsxs(he,{children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(fr,{size:20}),"Expense Status (",Xt(ht),")"]}),e.jsx("div",{className:"h-64",children:e.jsx(Rn,{width:"100%",height:"100%",children:e.jsxs(Pl,{children:[e.jsx(Fl,{data:tt(),cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",dataKey:"value",label:({name:M,value:ce})=>`${M}: ${ce}`,children:tt().map((M,ce)=>e.jsx(yi,{fill:M.color},`cell-${ce}`))}),e.jsx(Ln,{})]})})})]})]}),e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(La,{size:20}),"Recent Payments"]}),e.jsxs(X,{variant:"secondary",size:"sm",onClick:()=>u("payments"),className:"flex items-center gap-2",children:[e.jsx(Bn,{size:16}),"View All"]})]}),e.jsxs("div",{className:"space-y-3",children:[r.slice(0,5).map(M=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[Gt(M.status),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:Vt(M.amount)}),e.jsxs("p",{className:"text-sm text-gray-500",children:[M.customer_name||"Unknown Customer"," • ",M.device_name||"No Device"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium capitalize",children:M.method}),e.jsx("p",{className:"text-xs text-gray-500",children:za(M.payment_date)})]})]},M.id)),r.length===0&&e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(La,{size:24,className:"mx-auto mb-2"}),e.jsx("p",{children:"No payments recorded yet"})]})]})]})]}),m==="accounts"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(he,{children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(an,{size:20}),"Financial Accounts"]}),e.jsx("div",{className:"block sm:hidden space-y-3",children:x.map(M=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[We(M.type),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:M.name}),e.jsx("p",{className:"text-sm text-gray-500 capitalize",children:M.type.replace("_"," ")})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-lg",children:Vt(M.balance)}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${M.is_active?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:M.is_active?"Active":"Inactive"})]})]}),(M.account_number||M.bank_name)&&e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[M.account_number&&e.jsxs("p",{children:["Account: ",M.account_number]}),M.bank_name&&e.jsxs("p",{children:["Bank: ",M.bank_name]})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs(X,{variant:"secondary",size:"sm",onClick:()=>{E(M),U({name:M.name,type:M.type,balance:M.balance,account_number:M.account_number||"",bank_name:M.bank_name||"",is_active:M.is_active})},children:[e.jsx(Ts,{size:14}),"Edit"]}),e.jsxs(X,{variant:"danger",size:"sm",onClick:()=>gt(M.id),children:[e.jsx(er,{size:14}),"Delete"]})]})]},M.id))}),e.jsx("div",{className:"hidden sm:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Account"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Balance"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:x.map(M=>e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[We(M.type),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:M.name}),M.account_number&&e.jsx("p",{className:"text-xs text-gray-500",children:M.account_number})]})]})}),e.jsx("td",{className:"px-4 py-3 capitalize",children:M.type.replace("_"," ")}),e.jsx("td",{className:"px-4 py-3 font-bold",children:Vt(M.balance)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${M.is_active?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:M.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(X,{variant:"secondary",size:"sm",onClick:()=>{E(M),U({name:M.name,type:M.type,balance:M.balance,account_number:M.account_number||"",bank_name:M.bank_name||"",is_active:M.is_active})},children:e.jsx(Ts,{size:14})}),e.jsx(X,{variant:"danger",size:"sm",onClick:()=>gt(M.id),children:e.jsx(er,{size:14})})]})})]},M.id))})]})})]})}),m==="payments"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(he,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("select",{value:C,onChange:M=>$(M.target.value),className:"text-sm rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400 bg-white",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"failed",children:"Failed"})]}),e.jsxs("select",{value:Y,onChange:M=>A(M.target.value),className:"text-sm rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400 bg-white",children:[e.jsx("option",{value:"all",children:"All Methods"}),e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"transfer",children:"Transfer"})]}),e.jsx("input",{type:"date",value:D,onChange:M=>T(M.target.value),className:"text-sm rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400 bg-white"}),e.jsx("input",{type:"date",value:z,onChange:M=>se(M.target.value),className:"text-sm rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400 bg-white"}),e.jsxs(X,{variant:"secondary",onClick:()=>{$("all"),A("all"),T(""),se("")},children:[e.jsx(Rr,{size:16}),"Clear"]})]})}),e.jsxs(he,{children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(mr,{size:20}),"Payment History"]}),e.jsx("div",{className:"block sm:hidden space-y-3",children:rt.map(M=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[Gt(M.status),e.jsx("span",{className:"font-semibold text-lg",children:Vt(M.amount)})]}),e.jsx("span",{className:"text-xs text-gray-500 capitalize",children:M.method})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Customer:"}),e.jsx("p",{className:"font-medium",children:M.customer_name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Device:"}),e.jsx("p",{className:"font-medium",children:M.device_name||"No Device"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Date:"}),e.jsx("p",{className:"font-medium",children:za(M.payment_date)})]})]})]},M.id))}),e.jsx("div",{className:"hidden sm:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Method"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Device"})]})}),e.jsx("tbody",{children:rt.map(M=>e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"px-4 py-3",children:za(M.payment_date)}),e.jsx("td",{className:"px-4 py-3 font-bold text-green-700",children:Vt(M.amount)}),e.jsx("td",{className:"px-4 py-3 capitalize",children:M.method}),e.jsxs("td",{className:"px-4 py-3",children:[Gt(M.status),e.jsx("span",{className:"ml-1 capitalize",children:M.status})]}),e.jsx("td",{className:"px-4 py-3",children:M.customer_name||"Unknown"}),e.jsx("td",{className:"px-4 py-3",children:M.device_name||"No Device"})]},M.id))})]})})]})]}),m==="expenses"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Expenses Management"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(X,{onClick:()=>Oe(!0),children:[e.jsx(Ut,{size:16}),"Add Category"]}),e.jsxs(X,{onClick:()=>ut(!0),children:[e.jsx(Ut,{size:16}),"Add Expense"]})]})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{value:Ye,onChange:M=>ae(M.target.value),className:"w-full text-sm rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",children:[e.jsx("option",{value:"all",children:"All Categories"}),Ue.map(M=>e.jsx("option",{value:M.name,children:M.name},M.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:ke,onChange:M=>Ke(M.target.value),className:"w-full text-sm rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"⏳ Pending"}),e.jsx("option",{value:"approved",children:"✅ Approved"}),e.jsx("option",{value:"rejected",children:"❌ Rejected"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account"}),e.jsxs("select",{value:le,onChange:M=>Ne(M.target.value),className:"w-full text-sm rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",children:[e.jsx("option",{value:"all",children:"All Accounts"}),x.map(M=>e.jsx("option",{value:M.id,children:M.name},M.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:Te,onChange:M=>Qe(M.target.value),className:"w-full text-sm rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:vt,onChange:M=>Rt(M.target.value),className:"w-full text-sm rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{ae("all"),Ke("all"),Ne("all"),Qe(""),Rt("")},className:"w-full bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 text-sm font-medium",children:"Clear Filters"})})]})}),e.jsxs(he,{className:"bg-gradient-to-r from-purple-50 to-blue-50 border-purple-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-xl",children:e.jsx(Oa,{className:"w-8 h-8 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-purple-900",children:"🤖 AI Expense Analysis"}),e.jsx("p",{className:"text-sm text-purple-700",children:"Intelligent insights for your business decisions"})]})]}),e.jsx(X,{onClick:()=>Ae(!me),className:"bg-purple-600 hover:bg-purple-700 px-6 py-3",children:me?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fs,{size:16}),e.jsx("span",{children:"Hide Analysis"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ll,{size:16}),e.jsx("span",{children:"Show AI Analysis"})]})})]}),me&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl p-6 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Oa,{size:20,className:"text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"AI Configuration"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Set up your Gemini API key for AI analysis"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"🔑 Gemini API Key"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"password",placeholder:"Enter your Gemini API key",value:it,onChange:M=>St(M.target.value),className:"flex-1 rounded-lg border border-gray-300 px-4 py-3 focus:ring-2 focus:ring-purple-400 focus:border-purple-400 transition-colors"}),e.jsx(X,{onClick:Pe,disabled:ve.loading||!it,className:"bg-purple-600 hover:bg-purple-700 px-6 py-3",children:ve.loading?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{size:16,className:"animate-spin"}),e.jsx("span",{children:"Analyzing..."})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vr,{size:16}),e.jsx("span",{children:"Analyze Trends"})]})})]})]}),it&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx(yt,{size:16,className:"text-green-600"}),e.jsx("span",{className:"text-sm text-green-800 font-medium",children:"API key configured successfully"})]})]})]}),ve.insights&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-6 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Oa,{size:20,className:"text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"AI Analysis Results"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Intelligent insights for your business"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[$t(ve.riskLevel),e.jsxs("span",{className:`px-4 py-2 rounded-full text-sm font-semibold ${ot(ve.riskLevel)}`,children:[ve.riskLevel.toUpperCase()," RISK"]})]})]}),ve.category&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-100 rounded-full",children:[e.jsx(Js,{size:16,className:"text-blue-600"}),e.jsxs("span",{className:"text-sm font-medium text-blue-800",children:["Suggested Category: ",ve.category]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-yellow-50 to-orange-50 px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(Yd,{size:20,className:"text-yellow-600"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Key Insights"})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("p",{className:"text-gray-700 leading-relaxed text-base",children:ve.insights})})})]}),ve.suggestions.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Kr,{size:20,className:"text-blue-600"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Actionable Recommendations"})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:ve.suggestions.map((M,ce)=>e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:ce+1})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-gray-800 font-medium leading-relaxed",children:M})})]},ce))})})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ll,{size:20,className:"text-green-600"}),"Quick Actions"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("button",{className:"flex items-center gap-3 p-4 bg-white rounded-lg border border-green-200 hover:bg-green-50 transition-colors",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(vr,{size:16,className:"text-green-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Apply Category"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Use suggested category"})]})]}),e.jsxs("button",{className:"flex items-center gap-3 p-4 bg-white rounded-lg border border-green-200 hover:bg-green-50 transition-colors",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(Hs,{size:16,className:"text-green-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Save Insights"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Store for later review"})]})]})]})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:wt.length===0?e.jsxs(he,{className:"p-8 text-center",children:[e.jsx(La,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No expenses found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Try adjusting your filters or add a new expense"}),e.jsxs(X,{onClick:()=>ut(!0),children:[e.jsx(Ut,{size:16}),"Add First Expense"]})]}):wt.map(M=>{var ce;return e.jsx(he,{className:"p-6 hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900",children:M.title}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${M.status==="approved"?"bg-green-100 text-green-800":M.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:M.status==="approved"?"✅ Approved":M.status==="pending"?"⏳ Pending":"❌ Rejected"})]}),M.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:M.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Js,{size:16}),e.jsx("span",{children:M.category})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ws,{size:16}),e.jsx("span",{children:new Date(M.expense_date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(an,{size:16}),e.jsx("span",{children:((ce=x.find(Je=>Je.id===M.account_id))==null?void 0:ce.name)||"Unknown Account"})]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600 mb-2",children:Vt(M.amount)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ys(M),className:"text-blue-600 hover:text-blue-800 text-sm font-medium px-3 py-1 rounded-md hover:bg-blue-50",children:"Edit"}),e.jsxs("button",{onClick:()=>Qt(M.description||M.title,M.amount,M.category),disabled:ve.loading,className:"text-purple-600 hover:text-purple-800 text-sm font-medium px-3 py-1 rounded-md hover:bg-purple-50",children:[ve.loading?e.jsx(us,{size:14,className:"animate-spin"}):e.jsx(Oa,{size:14}),ve.loading?" Analyzing...":" AI Analysis"]}),e.jsx("button",{onClick:()=>xe(M.id),className:"text-red-600 hover:text-red-800 text-sm font-medium px-3 py-1 rounded-md hover:bg-red-50",children:"Delete"})]})]})]})},M.id)})})]}),(y||k)&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:k?"Edit Account":"Add New Account"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Name"}),e.jsx("input",{type:"text",value:v.name,onChange:M=>U(ce=>({...ce,name:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",placeholder:"Enter account name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Type"}),e.jsxs("select",{value:v.type,onChange:M=>U(ce=>({...ce,type:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",children:[e.jsx("option",{value:"bank",children:"🏦 Bank Account"}),e.jsx("option",{value:"cash",children:"💵 Cash Register"}),e.jsx("option",{value:"mobile_money",children:"📱 Mobile Money"}),e.jsx("option",{value:"credit_card",children:"💳 Credit Card"}),e.jsx("option",{value:"savings",children:"💰 Savings Account"}),e.jsx("option",{value:"investment",children:"📈 Investment Account"}),e.jsx("option",{value:"other",children:"📋 Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Initial Balance"}),e.jsx("input",{type:"number",value:v.balance,onChange:M=>U(ce=>({...ce,balance:parseFloat(M.target.value)||0})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",placeholder:"0.00"})]}),v.type==="bank"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Number"}),e.jsx("input",{type:"text",value:v.account_number,onChange:M=>U(ce=>({...ce,account_number:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",placeholder:"Enter account number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bank Name"}),e.jsx("input",{type:"text",value:v.bank_name,onChange:M=>U(ce=>({...ce,bank_name:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",placeholder:"Enter bank name"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:v.is_active,onChange:M=>U(ce=>({...ce,is_active:M.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"is_active",className:"ml-2 text-sm text-gray-700",children:"Active Account"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(X,{variant:"secondary",onClick:()=>{N(!1),E(null),U({name:"",type:"bank",balance:0,account_number:"",bank_name:"",is_active:!0})},children:"Cancel"}),e.jsxs(X,{variant:"primary",onClick:k?ss:Nt,children:[k?"Update":"Add"," Account"]})]})]})}),I&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Add New Payment"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount"}),e.jsx("input",{type:"number",value:F.amount,onChange:M=>L(ce=>({...ce,amount:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Method"}),e.jsxs("select",{value:F.method,onChange:M=>L(ce=>({...ce,method:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"transfer",children:"Transfer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account"}),e.jsxs("select",{value:F.account_id,onChange:M=>L(ce=>({...ce,account_id:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",children:[e.jsx("option",{value:"",children:"Select Account"}),x.filter(M=>M.is_active).map(M=>e.jsxs("option",{value:M.id,children:[M.name," (",Vt(M.balance),")"]},M.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Type"}),e.jsxs("select",{value:F.payment_type,onChange:M=>L(ce=>({...ce,payment_type:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",children:[e.jsx("option",{value:"payment",children:"Payment"}),e.jsx("option",{value:"deposit",children:"Deposit"}),e.jsx("option",{value:"refund",children:"Refund"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (Optional)"}),e.jsx("textarea",{value:F.notes,onChange:M=>L(ce=>({...ce,notes:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",rows:3,placeholder:"Add any notes about this payment"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(X,{variant:"secondary",onClick:()=>{R(!1),L({amount:"",method:"cash",account_id:"",customer_id:"",device_id:"",payment_type:"payment",notes:""})},children:"Cancel"}),e.jsx(X,{variant:"primary",onClick:gs,children:"Add Payment"})]})]})}),q&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(Bn,{size:20}),"Transfer Between Accounts"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Account"}),e.jsxs("select",{value:B.from_account_id,onChange:M=>fe(ce=>({...ce,from_account_id:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",children:[e.jsx("option",{value:"",children:"Select Source Account"}),x.filter(M=>M.is_active&&M.balance>0).map(M=>e.jsxs("option",{value:M.id,children:[M.name," (",Vt(M.balance),")"]},M.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To Account"}),e.jsxs("select",{value:B.to_account_id,onChange:M=>fe(ce=>({...ce,to_account_id:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",children:[e.jsx("option",{value:"",children:"Select Destination Account"}),x.filter(M=>M.is_active).map(M=>e.jsxs("option",{value:M.id,children:[M.name," (",Vt(M.balance),")"]},M.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount"}),e.jsx("input",{type:"number",value:B.amount,onChange:M=>fe(ce=>({...ce,amount:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (Optional)"}),e.jsx("textarea",{value:B.description,onChange:M=>fe(ce=>({...ce,description:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",rows:3,placeholder:"Reason for transfer"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(X,{variant:"secondary",onClick:()=>{H(!1),fe({from_account_id:"",to_account_id:"",amount:"",description:""})},children:"Cancel"}),e.jsx(X,{variant:"primary",onClick:Jt,children:"Process Transfer"})]})]})}),J&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(dn,{size:20}),"Adjust Account Balance"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account"}),e.jsxs("select",{value:re.account_id,onChange:M=>ye(ce=>({...ce,account_id:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",children:[e.jsx("option",{value:"",children:"Select Account"}),x.filter(M=>M.is_active).map(M=>e.jsxs("option",{value:M.id,children:[M.name," (",Vt(M.balance),")"]},M.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Adjustment Type"}),e.jsxs("select",{value:re.adjustment_type,onChange:M=>ye(ce=>({...ce,adjustment_type:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",children:[e.jsx("option",{value:"add",children:"➕ Add to Balance"}),e.jsx("option",{value:"subtract",children:"➖ Subtract from Balance"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount"}),e.jsx("input",{type:"number",value:re.amount,onChange:M=>ye(ce=>({...ce,amount:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason (Optional)"}),e.jsx("textarea",{value:re.reason,onChange:M=>ye(ce=>({...ce,reason:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",rows:3,placeholder:"Reason for adjustment"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(X,{variant:"secondary",onClick:()=>{V(!1),ye({account_id:"",adjustment_type:"add",amount:"",reason:""})},children:"Cancel"}),e.jsx(X,{variant:"primary",onClick:Es,children:"Adjust Balance"})]})]})}),(Re||Xe)&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(La,{size:20}),Xe?"Edit Expense":"Add New Expense"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:$e.title,onChange:M=>K(ce=>({...ce,title:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",placeholder:"Expense title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("textarea",{value:$e.description,onChange:M=>K(ce=>({...ce,description:M.target.value})),className:"flex-1 rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",rows:3,placeholder:"Expense description"}),e.jsx(X,{onClick:()=>{$e.description&&$e.amount?Qt($e.description,$e.amount,$e.category):te.error("Please enter both description and amount for AI analysis")},disabled:ve.loading||!$e.description||!$e.amount,className:"bg-purple-600 hover:bg-purple-700 self-start",children:ve.loading?e.jsx(us,{size:16,className:"animate-spin"}):e.jsx(Oa,{size:16})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",value:$e.amount,onChange:M=>K(ce=>({...ce,amount:parseFloat(M.target.value)||0})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{value:$e.category,onChange:M=>K(ce=>({...ce,category:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",children:[e.jsx("option",{value:"",children:"Select Category"}),Ue.map(M=>e.jsx("option",{value:M.name,children:M.name},M.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),e.jsx("input",{type:"date",value:$e.expense_date,onChange:M=>K(ce=>({...ce,expense_date:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account"}),e.jsxs("select",{value:$e.account_id,onChange:M=>K(ce=>({...ce,account_id:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",children:[e.jsx("option",{value:"",children:"Select Account"}),x.filter(M=>M.is_active).map(M=>e.jsxs("option",{value:M.id,children:[M.name," (",Vt(M.balance),")"]},M.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Method"}),e.jsxs("select",{value:$e.payment_method,onChange:M=>K(ce=>({...ce,payment_method:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",children:[e.jsx("option",{value:"cash",children:"💵 Cash"}),e.jsx("option",{value:"card",children:"💳 Card"}),e.jsx("option",{value:"transfer",children:"🏦 Transfer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:$e.status,onChange:M=>K(ce=>({...ce,status:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",children:[e.jsx("option",{value:"pending",children:"⏳ Pending"}),e.jsx("option",{value:"approved",children:"✅ Approved"}),e.jsx("option",{value:"rejected",children:"❌ Rejected"})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(X,{variant:"secondary",onClick:()=>{ut(!1),Be(null),K({title:"",description:"",amount:0,category:"",expense_date:new Date().toISOString().split("T")[0],account_id:"",payment_method:"cash",status:"pending"})},children:"Cancel"}),e.jsx(X,{variant:"primary",onClick:Xe?Us:as,children:Xe?"Update Expense":"Add Expense"})]})]})}),(Ee||Ce)&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(Js,{size:20}),Ce?"Edit Category":"Add New Category"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:be.name,onChange:M=>ue(ce=>({...ce,name:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",placeholder:"Category name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:be.description,onChange:M=>ue(ce=>({...ce,description:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400",rows:3,placeholder:"Category description"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Color"}),e.jsx("input",{type:"color",value:be.color,onChange:M=>ue(ce=>({...ce,color:M.target.value})),className:"w-full rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(X,{variant:"secondary",onClick:()=>{Oe(!1),Ze(null),ue({name:"",description:"",color:"#6B7280"})},children:"Cancel"}),e.jsx(X,{variant:"primary",onClick:Ce?lt:pt,children:Ce?"Update Category":"Add Category"})]})]})})]})},vx={handoverReminderHours:24,checkIntervalMinutes:30};class Cx{constructor(a={}){ur(this,"config");ur(this,"intervalId",null);this.config={...vx,...a}}start(){this.intervalId&&this.stop(),this.intervalId=setInterval(()=>{this.checkOverdueHandovers()},this.config.checkIntervalMinutes*60*1e3),this.checkOverdueHandovers()}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}async checkOverdueHandovers(){try{const a=new Date;a.setHours(a.getHours()-this.config.handoverReminderHours);const{data:i,error:c}=await G.from("devices").select(`
          id,
          serial_number,
          brand,
          model,
          status,
          updated_at,
          customer_id,
          customers (
            name,
            phone,
            email
          )
        `).eq("status","repair-complete").lt("updated_at",a.toISOString());if(c){console.error("Error checking overdue handovers:",c);return}i&&i.length>0&&await this.sendHandoverReminders(i)}catch(a){console.error("Error in checkOverdueHandovers:",a)}}async sendHandoverReminders(a){try{const i=await this.getCustomerCareEmails();if(i.length===0){console.warn("No customer care emails found for handover reminders");return}const c=a.map(u=>{var x;return`${u.brand} ${u.model} (${u.serial_number}) - Customer: ${((x=u.customers)==null?void 0:x.name)||"Unknown"}`}).join(`
`),m=`
        <h2>Overdue Device Handovers</h2>
        <p>The following devices have been marked as "repair-complete" for more than ${this.config.handoverReminderHours} hours and require customer handover:</p>
        <ul>
          ${a.map(u=>{var x;return`<li><strong>${u.brand} ${u.model}</strong> (${u.serial_number})<br>
             Customer: ${((x=u.customers)==null?void 0:x.name)||"Unknown"}<br>
             Status since: ${new Date(u.updated_at).toLocaleString()}</li>`}).join("")}
        </ul>
        <p>Please contact customers to arrange pickup or delivery.</p>
      `;await ja.sendEmail({to:i.join(","),subject:`Overdue Device Handovers - ${a.length} devices`,content:m}),console.log(`Sent handover reminders for ${a.length} devices`)}catch(i){console.error("Error sending handover reminders:",i)}}async getCustomerCareEmails(){try{const{data:a,error:i}=await G.from("auth_users").select("email").eq("role","customer-care");return i?(console.error("Error fetching customer care emails:",i),[]):(a==null?void 0:a.map(c=>c.email))||[]}catch(a){return console.error("Error getting customer care emails:",a),[]}}async manualCheck(){await this.checkOverdueHandovers()}}const ko=new Cx,Sx=r=>{const{customers:a,filterTag:i,setFilterTag:c,filterTagsMulti:m,setFilterTagsMulti:u,filterLoyalty:x,setFilterLoyalty:j,filterLoyaltyMulti:b,setFilterLoyaltyMulti:f,filterStatus:y,setFilterStatus:N,filterRegDateFrom:I,setFilterRegDateFrom:R,filterRegDateTo:k,setFilterRegDateTo:E,filterCity:v,setFilterCity:U,filterGender:F,setFilterGender:L,filterLastVisitFrom:C,setFilterLastVisitFrom:$,filterLastVisitTo:Y,setFilterLastVisitTo:A,filterTotalSpentMin:Z,setFilterTotalSpentMin:_,filterTotalSpentMax:D,setFilterTotalSpentMax:T,excludeTag:z,setExcludeTag:se,excludeTagsMulti:q,setExcludeTagsMulti:H,excludeStatus:J,setExcludeStatus:V}=r;return e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("input",{type:"text",placeholder:"Filter by tag",value:i,onChange:ge=>c(ge.target.value),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50"}),e.jsx("select",{multiple:!0,value:m,onChange:ge=>u(Array.from(ge.target.selectedOptions,He=>He.value)),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50 min-w-[100px]",children:[...new Set(a.flatMap(ge=>ge.tags||[]))].filter(Boolean).map(ge=>e.jsx("option",{value:ge,children:ge},ge))}),e.jsxs("select",{value:x,onChange:ge=>j(ge.target.value),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50",children:[e.jsx("option",{value:"",children:"All Loyalty"}),e.jsx("option",{value:"platinum",children:"Platinum"}),e.jsx("option",{value:"gold",children:"Gold"}),e.jsx("option",{value:"silver",children:"Silver"}),e.jsx("option",{value:"bronze",children:"Bronze"})]}),e.jsx("select",{multiple:!0,value:b,onChange:ge=>f(Array.from(ge.target.selectedOptions,He=>He.value)),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50 min-w-[100px]",children:["platinum","gold","silver","bronze"].map(ge=>e.jsx("option",{value:ge,children:ge.charAt(0).toUpperCase()+ge.slice(1)},ge))}),e.jsxs("select",{value:y,onChange:ge=>N(ge.target.value),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsx("input",{type:"date",value:I,onChange:ge=>R(ge.target.value),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50",placeholder:"From"}),e.jsx("input",{type:"date",value:k,onChange:ge=>E(ge.target.value),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50",placeholder:"To"}),e.jsxs("select",{value:v,onChange:ge=>U(ge.target.value),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50 min-w-[100px]",children:[e.jsx("option",{value:"",children:"All Cities"}),[...new Set(a.map(ge=>ge.city).filter(Boolean))].map(ge=>e.jsx("option",{value:ge,children:ge},ge))]}),e.jsxs("select",{value:F,onChange:ge=>L(ge.target.value),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50 min-w-[80px]",children:[e.jsx("option",{value:"",children:"All Genders"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsx("input",{type:"date",value:C,onChange:ge=>$(ge.target.value),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50",placeholder:"Last Visit From"}),e.jsx("input",{type:"date",value:Y,onChange:ge=>A(ge.target.value),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50",placeholder:"Last Visit To"}),e.jsx("input",{type:"number",value:Z,onChange:ge=>_(ge.target.value),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50 w-20",placeholder:"Spent Min"}),e.jsx("input",{type:"number",value:D,onChange:ge=>T(ge.target.value),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50 w-20",placeholder:"Spent Max"}),e.jsx("input",{type:"text",placeholder:"Exclude tag",value:z,onChange:ge=>se(ge.target.value),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50"}),e.jsx("select",{multiple:!0,value:q,onChange:ge=>H(Array.from(ge.target.selectedOptions,He=>He.value)),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50 min-w-[100px]",children:[...new Set(a.flatMap(ge=>ge.tags||[]))].filter(Boolean).map(ge=>e.jsx("option",{value:ge,children:ge},ge))}),e.jsxs("select",{value:J,onChange:ge=>V(ge.target.value),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50",children:[e.jsx("option",{value:"",children:"Exclude Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})},_x=[{key:"Inbox",label:"Inbox",icon:e.jsx(Xr,{size:24})},{key:"Bulk",label:"Bulk",icon:e.jsx(_s,{size:24})},{key:"Templates",label:"Templates",icon:e.jsx(pr,{size:24})},{key:"Notifications",label:"Notifications",icon:e.jsx(Mr,{size:24})},{key:"Assignment",label:"Assignment",icon:e.jsx(nr,{size:24})},{key:"Analytics",label:"Analytics",icon:e.jsx(qn,{size:24})},{key:"Settings",label:"Settings",icon:e.jsx(Fr,{size:24})},{key:"Scheduled",label:"Scheduled",icon:e.jsx(ms,{size:24})}];function Jc(r){return new Date(r).toLocaleString()}const Ex=({onSelectChat:r})=>{const[a,i]=g.useState([]),[c,m]=g.useState(""),[u,x]=g.useState(!0),[j,b]=g.useState([]),[f,y]=g.useState({}),[N,I]=g.useState(!1);g.useEffect(()=>{const E=async()=>{x(!0);const{data:U}=await G.from("whatsapp_chats").select("*").order("updated_at",{ascending:!1});i(U||[]),x(!1)},v=async()=>{const{data:U}=await G.from("customers").select("id, name, email, phone, gender, city, joined_date, loyalty_level, color_tag, referred_by, total_spent, points, last_visit, is_active, whatsapp, birth_month, birth_day, referral_source, initial_notes, total_returns, profile_image, created_at, updated_at");b(U||[])};E(),v()},[]),g.useEffect(()=>{(async()=>{const v=a.map(L=>L.id);if(v.length===0)return;const{data:U}=await G.from("whatsapp_messages").select("id, chat_id, content, timestamp, status").in("chat_id",v).order("timestamp",{ascending:!1}),F={};for(const L of U||[])F[L.chat_id]||(F[L.chat_id]=L);y(F)})()},[a]);const R=E=>j.find(v=>v.id===E),k=a.filter(E=>{var U;if(!N&&E.archived||N&&!E.archived)return!1;if(!c)return!0;const v=R(E.customer_id);return v&&((U=v.name)==null?void 0:U.toLowerCase().includes(c.toLowerCase()))||E.tags&&E.tags.join(",").toLowerCase().includes(c.toLowerCase())});return e.jsxs("div",{className:"flex flex-col gap-2 p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",placeholder:"Search...",value:c,onChange:E=>m(E.target.value),className:"border border-gray-200 rounded px-3 py-1 w-full text-sm bg-gray-50 focus:outline-none focus:ring-1 focus:ring-primary"}),e.jsxs("label",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:E=>I(E.target.checked)}),"Archived"]})]}),u?e.jsx("div",{className:"text-gray-400 text-sm py-8 text-center",children:"Loading chats..."}):k.length===0?e.jsx("div",{className:"text-gray-300 text-sm py-8 text-center",children:"No chats found."}):e.jsx("div",{className:"flex flex-col gap-1 overflow-y-auto",children:k.map(E=>{var L;const v=R(E.customer_id),U=f[E.id],F=E.unread_count>0;return e.jsxs("button",{className:`flex items-center gap-3 px-3 py-2 rounded-lg transition-colors w-full text-left hover:bg-gray-100 ${F?"bg-gray-50":""}`,onClick:()=>r(E),children:[v!=null&&v.profile_image?e.jsx("img",{src:v.profile_image,alt:v.name,className:"w-9 h-9 rounded-full object-cover border border-gray-200"}):e.jsx("div",{className:"w-9 h-9 rounded-full bg-gray-200 flex items-center justify-center text-gray-500 text-base font-bold border border-gray-200",children:((L=v==null?void 0:v.name)==null?void 0:L.charAt(0).toUpperCase())||e.jsx(Ws,{size:18})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-800 truncate text-sm",children:(v==null?void 0:v.name)||"Unknown"}),F&&e.jsx("span",{className:"ml-1 w-2 h-2 rounded-full bg-primary inline-block"})]}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:U?U.content:"No messages yet."})]})]},E.id)})})]})},Ax=({chat:r,onBack:a})=>{var J;const[i,c]=g.useState([]),[m,u]=g.useState(!0),[x,j]=g.useState(""),[b,f]=g.useState(!1),[y,N]=g.useState(null),[I,R]=g.useState("text"),[k,E]=g.useState(""),[v,U]=g.useState([]),[F,L]=g.useState(""),[C,$]=g.useState([]),[Y,A]=g.useState(!1),[Z,_]=g.useState(null);g.useState(!1);const[D,T]=g.useState(!1);g.useEffect(()=>{(async()=>{const{data:ge}=await G.from("customers").select("id, name, profile_image, whatsapp");$(ge||[])})()},[]);const z=V=>C.find(ge=>ge.id===V),se=async()=>{var ge;u(!0);let V;if(D&&r.customer_id){const{data:He}=await G.from("whatsapp_messages").select("*").in("chat_id",((ge=(await G.from("whatsapp_chats").select("id").eq("customer_id",r.customer_id)).data)==null?void 0:ge.map(B=>B.id))||[]).order("timestamp",{ascending:!0});V=He}else{const{data:He}=await G.from("whatsapp_messages").select("*").eq("chat_id",r.id).order("timestamp",{ascending:!0});V=He}c(V||[]),u(!1)};g.useEffect(()=>{se(),(async()=>{const{data:ge}=await G.from("communication_templates").select("*").eq("template_type","whatsapp").eq("is_active",!0).order("title",{ascending:!0});U(ge||[])})()},[r.id,D]);const q=async()=>{if(!(I==="text"&&!x.trim())&&!(I==="media"&&!k.trim())&&!(I==="template"&&!F)){f(!0),N(null);try{let V=null;const ge=C.find(B=>B.id===r.customer_id),He=ge!=null&&ge.whatsapp?ge.whatsapp.replace(/[^0-9]/g,"")+"@c.us":null;if(!He){N("Customer WhatsApp number not found or invalid."),f(!1);return}if(Y&&Z){const B=await G.from("scheduled_whatsapp_messages").insert({chat_id:r.id,content:x,type:I,media_url:I==="media"?k:null,template_id:I==="template"?F:null,variables:null,scheduled_for:Z.toISOString(),status:"pending",created_by:null});B.error?N(B.error.message||"Failed to schedule message"):(j(""),E(""),L(""),A(!1),_(null)),f(!1);return}if(I==="text"?V=await ar.sendMessage(He,x,"text"):I==="media"?V=await ar.sendMessage(He,x,"media",k):I==="template"&&(V=await ar.sendMessage(He,x,"template",void 0,F)),!V){N("Failed to send message"),f(!1);return}V.success?(await G.from("whatsapp_messages").insert({chat_id:r.id,sender:"me",recipient:He,content:x,type:I,status:"sent",timestamp:new Date().toISOString(),...I==="media"?{media_url:k}:{},...I==="template"?{template_id:F}:{}}),j(""),E(""),L(""),await se()):N(V.error||"Failed to send message")}catch(V){N(V.message||"Failed to send message")}f(!1)}},H=V=>{var re;const ge=V.sender==="me",He=z(V.sender),B=!ge,fe=V.type==="media"&&V.media_url;return e.jsx("div",{className:`mb-4 flex ${ge?"justify-end":"justify-start"} animate-fade-in`,children:e.jsxs("div",{className:`flex items-end gap-2 ${ge?"flex-row-reverse":""}`,children:[B&&(He!=null&&He.profile_image?e.jsx("img",{src:He.profile_image,alt:He.name,className:"w-7 h-7 rounded-full object-cover border border-gray-200"}):e.jsx("div",{className:"w-7 h-7 rounded-full bg-gray-200 flex items-center justify-center text-gray-500 text-xs font-bold border border-gray-200",children:((re=He==null?void 0:He.name)==null?void 0:re.charAt(0).toUpperCase())||e.jsx(Ws,{size:12})})),e.jsxs("div",{className:`px-4 py-2 rounded-2xl max-w-xs break-words shadow-md transition-all duration-200 ${ge?"bg-primary text-white":"bg-white text-gray-900 border border-gray-100"}`,children:[fe?e.jsxs("div",{className:"mb-1",children:[e.jsx("img",{src:V.media_url,alt:"media",className:"rounded-lg max-h-40 mb-1"}),V.content&&e.jsx("div",{className:"text-sm mt-1",children:V.content})]}):e.jsx("div",{className:"text-base",children:V.content}),e.jsx("div",{className:"text-xs text-gray-400 mt-1 text-right",children:Jc(V.timestamp)})]})]})},V.id)};return e.jsxs("div",{className:"flex flex-col h-full max-h-[80vh]",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b px-4 py-2 bg-white",children:[e.jsx("button",{onClick:a,className:"text-primary text-sm px-2 py-1 rounded hover:bg-gray-100",children:"← Back"}),e.jsxs("span",{className:"font-medium text-gray-700 text-sm ml-2",children:["Chat: ",((J=z(r.customer_id))==null?void 0:J.name)||"Unknown"]}),e.jsxs("label",{className:"ml-auto flex items-center gap-1 text-xs",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:V=>T(V.target.checked)}),"Show all messages for this customer"]})]}),e.jsx("div",{className:"overflow-x-auto whitespace-nowrap bg-yellow-50 border-b px-4 py-2 text-xs flex gap-4",children:i.length===0?e.jsx("span",{className:"text-gray-400",children:"No messages loaded."}):i.map(V=>e.jsxs("div",{className:"inline-block bg-yellow-100 border border-yellow-300 rounded px-3 py-1 mr-2",children:[e.jsxs("span",{className:"font-semibold text-yellow-800",children:["Sender: ",V.sender]}),e.jsx("span",{className:"ml-2 text-gray-700",children:V.content}),e.jsx("span",{className:"ml-2 text-gray-500",children:new Date(V.timestamp).toLocaleString()})]},V.id))}),e.jsx("div",{className:"overflow-x-auto whitespace-nowrap bg-gray-100 border-b px-4 py-2 text-xs flex gap-4",children:i.filter(V=>V.type==="text"&&(V.sender==="me"||V.sender==="system")).length===0?e.jsx("span",{className:"text-gray-400",children:"No sent texts yet."}):i.filter(V=>V.type==="text"&&(V.sender==="me"||V.sender==="system")).map(V=>e.jsxs("div",{className:"inline-block bg-primary/10 border border-primary/20 rounded px-3 py-1 mr-2",children:[e.jsx("span",{className:"font-semibold text-primary",children:V.content}),e.jsx("span",{className:"ml-2 text-gray-500",children:new Date(V.timestamp).toLocaleString()})]},V.id))}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-2 bg-gray-50",children:m?e.jsx("div",{className:"text-gray-400 text-sm",children:"Loading messages..."}):i.length===0?e.jsx("div",{className:"text-gray-300 text-sm",children:"No messages yet."}):i.map(H)}),e.jsxs("form",{className:"flex flex-col gap-2 px-4 py-2 bg-white border-t",onSubmit:V=>{V.preventDefault(),q()},children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("select",{value:I,onChange:V=>R(V.target.value),className:"border border-gray-200 rounded px-2 py-1 text-sm bg-gray-50",children:[e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"media",children:"Media"}),e.jsx("option",{value:"template",children:"Template"})]}),I==="media"&&e.jsx("input",{type:"text",value:k,onChange:V=>E(V.target.value),placeholder:"Media URL",className:"border border-gray-200 rounded px-2 py-1 text-sm bg-gray-50 flex-1",disabled:b})]}),I==="text"&&e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:x,onChange:V=>j(V.target.value),placeholder:"Type a message...",className:"border border-gray-200 rounded px-3 py-2 flex-1 text-sm bg-gray-50",disabled:b,onKeyDown:V=>{V.key==="Enter"&&!V.shiftKey&&(V.preventDefault(),q())}}),e.jsx("button",{type:"submit",className:"bg-primary text-white px-4 py-2 rounded text-sm",disabled:b,"aria-label":"Send",children:e.jsx(Tr,{size:16})})]}),I==="media"&&e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:k,onChange:V=>E(V.target.value),placeholder:"Media URL",className:"border border-gray-200 rounded px-2 py-1 text-sm bg-gray-50 flex-1",disabled:b}),e.jsx("input",{type:"text",value:x,onChange:V=>j(V.target.value),placeholder:"Caption (optional)",className:"border border-gray-200 rounded px-3 py-2 flex-1 text-sm bg-gray-50",disabled:b,onKeyDown:V=>{V.key==="Enter"&&!V.shiftKey&&(V.preventDefault(),q())}}),e.jsx("button",{type:"submit",className:"bg-primary text-white px-4 py-2 rounded text-sm",disabled:b,"aria-label":"Send",children:e.jsx(Tr,{size:16})})]}),I==="template"&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("select",{value:F,onChange:V=>L(V.target.value),className:"border border-gray-200 rounded px-3 py-2 text-sm bg-gray-50",disabled:b,children:[e.jsx("option",{value:"",children:"Select Template"}),v.map(V=>e.jsx("option",{value:V.id,children:V.title},V.id))]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:x,onChange:V=>j(V.target.value),placeholder:"Template variables/content",className:"border border-gray-200 rounded px-3 py-2 flex-1 text-sm bg-gray-50",disabled:b,onKeyDown:V=>{V.key==="Enter"&&!V.shiftKey&&(V.preventDefault(),q())}}),e.jsx("button",{type:"submit",className:"bg-primary text-white px-4 py-2 rounded text-sm",disabled:b,"aria-label":"Send",children:e.jsx(Tr,{size:16})})]})]})]}),y&&e.jsx("div",{className:"mt-2 text-danger text-xs px-4",children:y})]})};function Do(r){const a=r.match(/\{(\w+)\}/g);return a?Array.from(new Set(a.map(i=>i.replace(/[{}]/g,"")))):[]}const kx=()=>{const[r,a]=g.useState([]),[i,c]=g.useState([]),[m,u]=g.useState("text"),[x,j]=g.useState(""),[b,f]=g.useState(""),[,y]=g.useState([]),[N,I]=g.useState(""),[R,k]=g.useState(!1),[E,v]=g.useState([]),[U,F]=g.useState([]),[L,C]=g.useState(!1),[$,Y]=g.useState(null),[A,Z]=g.useState(""),[_,D]=g.useState(""),[T,z]=g.useState(""),[se,q]=g.useState(""),[H,J]=g.useState(""),[V,ge]=g.useState(""),[He,B]=g.useState(""),[fe,re]=g.useState(""),[ye,Q]=g.useState(""),[Le,Ue]=g.useState(""),[Ct,Re]=g.useState(""),[ut,Ee]=g.useState([]),[Oe,Xe]=g.useState([]),[Be,Ce]=g.useState(!1),[Ze,$e]=g.useState([]),[K,be]=g.useState(""),ue=g.useRef(null),[Ye,ae]=g.useState(!1),[ke]=g.useState([]),[Ke,le]=g.useState([]),[Ne,Te]=g.useState(""),[Qe,vt]=g.useState(""),[Rt,ht]=g.useState(!1),[,Se]=g.useState(!1),[,ve]=g.useState(0),[de,me]=g.useState({}),[Ae,it]=g.useState([]),[St,kt]=g.useState(""),[et,xs]=g.useState(!1),[Nt,ss]=g.useState(""),[gt,Is]=g.useState([]),[ts,bs]=g.useState("");g.useState(null);const[Qt]=g.useState("");g.useState(!1);const[Pe,ot]=g.useState("filtered"),[$t,gs]=g.useState(!1);g.useEffect(()=>{const we=async()=>{const{data:dt}=await G.from("whatsapp_chats").select("id, customer_id, tags, unread_count, updated_at").order("updated_at",{ascending:!1});a(dt||[])},Ge=async()=>{const{data:dt}=await G.from("communication_templates").select("*").eq("template_type","whatsapp").eq("is_active",!0).order("title",{ascending:!0});y(dt||[])},tt=async()=>{const{data:dt}=await G.from("customers").select("id, name, email, phone, gender, city, joined_date, loyalty_level, color_tag, referred_by, total_spent, points, last_visit, is_active, whatsapp, birth_month, birth_day, referral_source, initial_notes, total_returns, profile_image, created_at, updated_at");F(dt||[])};we(),Ge(),tt()},[]);const Jt=we=>U.find(Ge=>Ge.id===we),Es=r.filter(we=>{const Ge=Jt(we.customer_id);return!(!Ge||_&&Ge.loyalty_level!==_||Oe.length>0&&!Oe.includes(Ge.loyalty_level)||T&&(T==="active"&&!Ge.is_active||T==="inactive"&&Ge.is_active)||ts&&(ts==="active"&&Ge.is_active||ts==="inactive"&&!Ge.is_active)||se&&new Date(Ge.created_at)<new Date(se)||H&&new Date(Ge.created_at)>new Date(H)||V&&Ge.city!==V||He&&Ge.gender!==He||fe&&(!Ge.last_visit||new Date(Ge.last_visit)<new Date(fe))||ye&&(!Ge.last_visit||new Date(Ge.last_visit)>new Date(ye))||Le&&(isNaN(Number(Ge.total_spent))||Number(Ge.total_spent)<Number(Le))||Ct&&(isNaN(Number(Ge.total_spent))||Number(Ge.total_spent)>Number(Ct))||A&&!(Ge.tags||[]).includes(A)||ut.length>0&&!ut.some(tt=>(Ge.tags||[]).includes(tt))||Nt&&(Ge.tags||[]).includes(Nt)||gt.length>0&&gt.some(tt=>(Ge.tags||[]).includes(tt)))}),as=we=>{c(Ge=>Ge.includes(we)?Ge.filter(tt=>tt!==we):[...Ge,we])},Us=(we,Ge)=>{if(!Ge||typeof we!="string")return we;let tt=we;return Do(we).forEach(jt=>{let bt="";jt==="name"?bt=Ge.name||"":jt==="phone"?bt=Ge.whatsapp||"":jt==="loyalty"?bt=Ge.loyalty||"":jt==="status"?bt=Ge.status||"":jt==="reg_date"?bt=Ge.created_at?new Date(Ge.created_at).toLocaleDateString():"":jt==="tag"?bt=(Ge.tags||[]).join(", "):Ge[jt]&&(bt=Ge[jt]),tt=tt.replace(new RegExp(`\\{${jt}\\}`,"gi"),bt)}),tt},ys=async()=>{if(i.length===0&&Ke.length===0)return;k(!0),v([]),ve(0),me({});let we=[],Ge=[...i];if(Ke.length>0)for(const tt of Ke){let dt=r.find(jt=>jt.customer_id===tt);if(!dt){const jt=await ar.createChat(tt);jt.success&&jt.chat&&(dt=jt.chat)}dt&&Ge.push(dt.id)}if(Ge=Array.from(new Set(Ge)),L&&$){for(let tt=0;tt<Ge.length;tt++){const dt=Ge[tt];me(bt=>({...bt,[dt]:"scheduling"}));const jt=await G.from("scheduled_whatsapp_messages").insert({chat_id:dt,content:x,type:m,media_url:m==="media"?b:null,template_id:m==="template"?N:null,variables:null,scheduled_for:$.toISOString(),status:"pending",created_by:null});we.push({chatId:dt,...jt}),me(bt=>({...bt,[dt]:jt.error?"failed":"scheduled"})),ve(Math.round((tt+1)/Ge.length*100))}v(we),k(!1),j(""),f(""),I(""),C(!1),Y(null),ve(100);return}for(let tt=0;tt<Ge.length;tt++){const dt=Ge[tt];me(bt=>({...bt,[dt]:"sending"}));let jt=null;m==="text"?jt=await ar.sendMessage(dt,x,"text"):m==="media"?jt=await ar.sendMessage(dt,x,"media",Qt||b):m==="template"&&(jt=await ar.sendMessage(dt,x,"template",void 0,N)),we.push({chatId:dt,...jt}),me(bt=>({...bt,[dt]:jt&&jt.success?"sent":"failed"})),ve(Math.round((tt+1)/Ge.length*100)),await new Promise(bt=>setTimeout(bt,3e3))}v(we),k(!1),ve(100)},xe=we=>{var tt;const Ge=(tt=we.target.files)==null?void 0:tt[0];Ge&&zn.parse(Ge,{header:!0,skipEmptyLines:!0,complete:dt=>{const jt=dt.data,bt=[];let Xt=0,ds=0;jt.forEach(fs=>{let We="";if(fs.customer_id){const M=r.find(ce=>{var Je;return((Je=Jt(ce.customer_id))==null?void 0:Je.id)===fs.customer_id});M&&(We=M.id)}else if(fs.phone||fs.whatsapp){const M=(fs.phone||fs.whatsapp).replace(/[^0-9]/g,""),ce=r.find(Je=>{var _t,Dt;return((Dt=(_t=Jt(Je.customer_id))==null?void 0:_t.whatsapp)==null?void 0:Dt.replace(/[^0-9]/g,""))===M});ce&&(We=ce.id)}We&&!bt.includes(We)?(bt.push(We),Xt++):ds++}),c(bt),$e(bt),be(`Imported: ${Xt} matched, ${ds} not found.`)},error:()=>be("Failed to parse CSV.")})},pt=()=>{$e([]),be(""),c([]),ue.current&&(ue.current.value="")},lt=async()=>{if(!Ne)return;ht(!0),vt("");let we=x;Do(x).forEach(tt=>{let dt="[test]";tt==="name"?dt="Test Name":tt==="phone"?dt=Ne:tt==="loyalty"?dt="Gold":tt==="status"?dt="Active":tt==="reg_date"?dt="2024-01-01":tt==="tag"&&(dt="VIP"),we=we.replace(new RegExp(`\\{${tt}\\}`,"gi"),dt)});try{let tt=null;const dt=Ne.replace(/[^0-9]/g,"")+"@c.us";m==="text"?tt=await ar.sendMessage(dt,we,"text"):m==="media"?tt=await ar.sendMessage(dt,we,"media",b):m==="template"&&(tt=await ar.sendMessage(dt,we,"template",void 0,N)),tt&&tt.success?vt("Test message sent!"):vt((tt==null?void 0:tt.error)||"Failed to send test message")}catch(tt){vt(tt.message||"Failed to send test message")}ht(!1)};g.useEffect(()=>{if(!et){const we=localStorage.getItem("bulk_campaigns");we&&it(JSON.parse(we)),xs(!0)}},[et]);const rt=we=>{it(we),localStorage.setItem("bulk_campaigns",JSON.stringify(we))},wt=()=>{if(!St.trim())return;const we={name:St.trim(),msgType:m,newMsg:x,mediaUrl:b,selectedTemplate:N},Ge=[...Ae,we];rt(Ge),kt("")},Ot=we=>{u(we.msgType),j(we.newMsg),f(we.mediaUrl),I(we.selectedTemplate)},Gt=we=>{const Ge=Ae.filter((tt,dt)=>dt!==we);rt(Ge)};return e.jsxs("div",{className:"w-full flex flex-col lg:flex-row gap-6",children:[e.jsxs(he,{className:"w-full lg:w-1/2 flex flex-col gap-4 p-4",children:[e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(X,{size:"sm",variant:Pe==="filtered"?"primary":"secondary",onClick:()=>ot("filtered"),children:"Filtered"}),e.jsx(X,{size:"sm",variant:Pe==="all"?"primary":"secondary",onClick:()=>ot("all"),children:"All Customers"}),e.jsx(X,{size:"sm",variant:Pe==="import"?"primary":"secondary",onClick:()=>ot("import"),children:"Import CSV"})]}),e.jsx("div",{className:"mb-2",children:e.jsx("button",{className:"text-xs text-primary underline",onClick:()=>gs(we=>!we),children:$t?"Show Filters":"Hide Filters"})}),!$t&&e.jsx(Sx,{customers:U,filterTag:A,setFilterTag:Z,filterTagsMulti:ut,setFilterTagsMulti:Ee,filterLoyalty:_,setFilterLoyalty:D,filterLoyaltyMulti:Oe,setFilterLoyaltyMulti:Xe,filterStatus:T,setFilterStatus:z,filterRegDateFrom:se,setFilterRegDateFrom:q,filterRegDateTo:H,setFilterRegDateTo:J,filterCity:V,setFilterCity:ge,filterGender:He,setFilterGender:B,filterLastVisitFrom:fe,setFilterLastVisitFrom:re,filterLastVisitTo:ye,setFilterLastVisitTo:Q,filterTotalSpentMin:Le,setFilterTotalSpentMin:Ue,filterTotalSpentMax:Ct,setFilterTotalSpentMax:Re,excludeTag:Nt,setExcludeTag:ss,excludeTagsMulti:gt,setExcludeTagsMulti:Is,excludeStatus:ts,setExcludeStatus:bs}),e.jsxs("div",{className:"flex-1 overflow-y-auto min-h-[200px] max-h-[350px]",children:[Pe==="filtered"&&e.jsx("div",{className:"flex flex-col gap-1 overflow-y-auto",children:Es.map(we=>{var tt;const Ge=Jt(we.customer_id);return e.jsxs("label",{className:`flex items-center gap-2 px-2 py-1 rounded cursor-pointer transition-all ${i.includes(we.id)?"bg-primary/10":"hover:bg-gray-100"}`,children:[e.jsx("input",{type:"checkbox",checked:i.includes(we.id),onChange:()=>as(we.id),className:"accent-primary"}),Ge!=null&&Ge.profile_image?e.jsx("img",{src:Ge.profile_image,alt:Ge.name,className:"w-7 h-7 rounded-full object-cover border border-gray-200"}):e.jsx("div",{className:"w-7 h-7 rounded-full bg-gray-200 flex items-center justify-center text-gray-500 text-xs font-bold border border-gray-200",children:((tt=Ge==null?void 0:Ge.name)==null?void 0:tt.charAt(0).toUpperCase())||e.jsx(Ws,{size:12})}),e.jsx("span",{className:"text-xs text-gray-800 truncate",children:(Ge==null?void 0:Ge.name)||"Unknown"}),e.jsxs("span",{className:"text-xs text-gray-400 ml-2",children:["Unread: ",we.unread_count||0]})]},we.id)})}),Pe==="all"&&e.jsx("div",{className:"flex flex-col gap-1 overflow-y-auto",children:ke.map(we=>e.jsxs("label",{className:`flex items-center gap-2 px-2 py-1 rounded cursor-pointer transition-all ${i.includes(we.id)?"bg-primary/10":"hover:bg-gray-100"}`,children:[e.jsx("input",{type:"checkbox",checked:i.includes(we.id),onChange:()=>as(we.id),className:"accent-primary"}),we.profile_image&&e.jsx("img",{src:we.profile_image,alt:we.name,className:"w-6 h-6 rounded-full"}),e.jsxs("span",{children:[we.name," ",we.whatsapp?`(${we.whatsapp})`:""]})]},we.id))}),Pe==="import"&&e.jsx("div",{className:"flex flex-col gap-1 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(X,{size:"sm",variant:"primary",onClick:()=>{var we;return(we=ue.current)==null?void 0:we.click()},children:"Import Recipients (CSV)"}),e.jsx("input",{type:"file",accept:".csv,text/csv",ref:ue,style:{display:"none"},onChange:xe}),Ze.length>0&&e.jsx(X,{size:"sm",variant:"secondary",onClick:pt,children:"Clear Import"}),K&&e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:K})]})})]})]}),e.jsxs(he,{className:"w-full lg:w-1/2 flex flex-col gap-4 p-4 relative",children:[e.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[e.jsxs("select",{value:m,onChange:we=>u(we.target.value),className:"border border-gray-200 rounded px-2 py-1 text-sm bg-gray-50 mb-1",children:[e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"media",children:"Media"}),e.jsx("option",{value:"template",children:"Template"})]}),m==="media"&&e.jsx("input",{type:"text",value:b,onChange:we=>f(we.target.value),placeholder:"Media URL",className:"border border-gray-200 rounded px-2 py-1 text-sm bg-gray-50 flex-1",disabled:R})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center mb-2",children:[e.jsx("input",{type:"text",value:Ne,onChange:we=>Te(we.target.value),placeholder:"Test WhatsApp number (e.g. 2557xxxxxxx)",className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50 w-48"}),e.jsx(X,{size:"sm",variant:"success",onClick:lt,disabled:Rt||!Ne,children:Rt?"Sending...":"Send Test Message"}),Qe&&e.jsx("span",{className:`text-xs ml-2 ${Qe.includes("sent")?"text-success":"text-danger"}`,children:Qe}),e.jsx("input",{type:"text",value:St,onChange:we=>kt(we.target.value),placeholder:"Save as campaign...",className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50"}),e.jsx(X,{size:"sm",variant:"primary",onClick:wt,disabled:!St.trim(),children:"Save"})]}),e.jsx("div",{className:"flex gap-2 items-center mb-2",children:e.jsx("input",{type:"text",value:x,onChange:we=>j(we.target.value),placeholder:m==="text"?"Type a message...":m==="media"?"Caption (optional)":"Template variables/content",className:"border border-gray-200 rounded px-3 py-2 flex-1 text-sm bg-gray-50",disabled:R,onKeyDown:we=>{we.key==="Enter"&&!we.shiftKey&&(we.preventDefault(),ys())}})}),e.jsx("div",{className:"mb-3",children:Ae.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:Ae.map((we,Ge)=>e.jsxs("div",{className:"flex items-center gap-1 border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50",children:[e.jsx("span",{className:"font-semibold",children:we.name}),e.jsx(X,{size:"sm",variant:"secondary",onClick:()=>Ot(we),children:"Load"}),e.jsx(X,{size:"sm",variant:"danger",onClick:()=>Gt(Ge),children:"Delete"})]},Ge))})}),e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx(X,{size:"sm",variant:"secondary",onClick:()=>Ce(we=>!we),disabled:i.length===0,children:Be?"Hide Preview":"Show Personalization Preview"})}),Be&&e.jsxs("div",{className:"mb-4 border rounded bg-white/80 p-2 max-h-48 overflow-y-auto",children:[e.jsx("div",{className:"font-semibold text-xs mb-2",children:"Personalization Preview"}),e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-500",children:[e.jsx("th",{className:"text-left",children:"Recipient"}),e.jsx("th",{className:"text-left",children:"Message"})]})}),e.jsx("tbody",{children:i.map(we=>{const Ge=r.find(dt=>dt.id===we),tt=Ge?Jt(Ge.customer_id):null;return e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"pr-2 py-1",children:(tt==null?void 0:tt.name)||"Unknown"}),e.jsx("td",{className:"py-1",children:Us(x,tt)})]},we)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("label",{className:"flex items-center gap-1 text-xs",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:we=>{C(we.target.checked),Se(we.target.checked)}}),"Schedule Bulk Message"]}),L&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"datetime-local",value:$?new Date($).toISOString().slice(0,16):"",onChange:we=>Y(we.target.value?new Date(we.target.value):null),className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50",min:new Date().toISOString().slice(0,16)}),$&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["Scheduled for: ",new Date($).toLocaleString()]}),e.jsx(X,{size:"sm",variant:"secondary",onClick:()=>{C(!1),Se(!1),Y(null)},children:"Clear"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:["Results:",E.length>0&&e.jsx(X,{size:"sm",variant:"primary",onClick:()=>{const we=E.map(bt=>{const Xt=r.find(We=>We.id===bt.chatId),ds=Xt?Jt(Xt.customer_id):null,fs=de[bt.chatId]||(bt.success?"sent":bt.error?"failed":"");return{Recipient:(ds==null?void 0:ds.name)||"Unknown",ChatID:bt.chatId,Status:fs,Error:bt.error||""}}),Ge=zn.unparse(we),tt=new Blob([Ge],{type:"text/csv"}),dt=URL.createObjectURL(tt),jt=document.createElement("a");jt.href=dt,jt.download="bulk_results.csv",jt.click(),URL.revokeObjectURL(dt)},children:"Export CSV"})]}),e.jsx("div",{className:"space-y-1",children:E.map(we=>{const Ge=r.find(jt=>jt.id===we.chatId),tt=Ge?Jt(Ge.customer_id):null,dt=de[we.chatId]||(we.success?"sent":we.error?"failed":"");return e.jsxs("div",{className:`text-xs flex items-center gap-2 ${dt==="sent"?"text-success-dark":dt==="failed"?"text-danger":dt==="sending"?"text-warning":dt==="scheduled"?"text-info":""}`,children:[dt==="sent"&&e.jsx(yt,{size:14}),dt==="failed"&&e.jsx(qo,{size:14}),dt==="sending"&&e.jsx(ms,{size:14}),dt==="scheduled"&&e.jsx(ms,{size:14}),(tt==null?void 0:tt.name)||"Unknown",": ",dt.charAt(0).toUpperCase()+dt.slice(1),we.error&&e.jsxs("span",{className:"ml-2 text-danger",children:["(",we.error,")"]})]},we.chatId)})})]}),e.jsxs("div",{className:"sticky bottom-0 left-0 w-full bg-white/80 py-3 flex gap-3 justify-end z-10 border-t border-gray-100",children:[e.jsxs(X,{size:"md",variant:"primary",onClick:ys,disabled:R||i.length===0&&Ke.length===0,children:[e.jsx(Tr,{size:16})," Send"]}),L&&e.jsx(X,{size:"md",variant:"secondary",onClick:()=>C(!1),children:"Cancel Schedule"}),E.length>0&&e.jsx(X,{size:"md",variant:"secondary",onClick:()=>{const we=E.map(bt=>{const Xt=r.find(We=>We.id===bt.chatId),ds=Xt?Jt(Xt.customer_id):null,fs=de[bt.chatId]||(bt.success?"sent":bt.error?"failed":"");return{Recipient:(ds==null?void 0:ds.name)||"Unknown",ChatID:bt.chatId,Status:fs,Error:bt.error||""}}),Ge=zn.unparse(we),tt=new Blob([Ge],{type:"text/csv"}),dt=URL.createObjectURL(tt),jt=document.createElement("a");jt.href=dt,jt.download="bulk_results.csv",jt.click(),URL.revokeObjectURL(dt)},children:"Export Results"})]})]}),Ye&&e.jsxs(es,{isOpen:Ye,onClose:()=>ae(!1),title:"Select Customers for Bulk WhatsApp",children:[e.jsx("div",{className:"max-h-96 overflow-y-auto",children:ke.map(we=>e.jsxs("label",{className:"flex items-center gap-2 py-1",children:[e.jsx("input",{type:"checkbox",checked:Ke.includes(we.id),onChange:()=>le(Ge=>Ge.includes(we.id)?Ge.filter(tt=>tt!==we.id):[...Ge,we.id])}),we.profile_image&&e.jsx("img",{src:we.profile_image,alt:we.name,className:"w-6 h-6 rounded-full"}),e.jsxs("span",{children:[we.name," ",we.whatsapp?`(${we.whatsapp})`:""]})]},we.id))}),e.jsx("div",{className:"flex gap-2 mt-4",children:e.jsx(X,{onClick:()=>ae(!1),children:"Done"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{type:"text",value:Ne,onChange:we=>Te(we.target.value),placeholder:"Test WhatsApp number (e.g. 2557xxxxxxx)",className:"border border-gray-200 rounded px-2 py-1 text-xs bg-gray-50 w-48"}),e.jsx("button",{type:"button",className:"text-xs bg-success text-white px-3 py-1 rounded hover:bg-success/80",onClick:lt,disabled:Rt||!Ne,children:Rt?"Sending...":"Send Test Message"}),Qe&&e.jsx("span",{className:`text-xs ml-2 ${Qe.includes("sent")?"text-success":"text-danger"}`,children:Qe})]})]})},Dx=()=>{const[r,a]=g.useState([]),[i,c]=g.useState(!0),[m,u]=g.useState(!1),[x,j]=g.useState(null),[b,f]=g.useState({title:"",content:"",variables:"",description:""}),[y,N]=g.useState(!1),[I,R]=g.useState(null),k=async()=>{c(!0);const{data:L}=await G.from("communication_templates").select("*").eq("template_type","whatsapp").order("title",{ascending:!0});a(L||[]),c(!1)};g.useEffect(()=>{k()},[]);const E=L=>{j(L||null),f({title:(L==null?void 0:L.title)||"",content:(L==null?void 0:L.content)||"",variables:L!=null&&L.variables?JSON.stringify(L.variables):"",description:(L==null?void 0:L.description)||""}),u(!0),R(null)},v=()=>{u(!1),j(null),f({title:"",content:"",variables:"",description:""}),R(null)},U=async()=>{N(!0),R(null);try{const L=b.variables?JSON.parse(b.variables):{};x?await G.from("communication_templates").update({title:b.title,content:b.content,variables:L,description:b.description}).eq("id",x.id):await G.from("communication_templates").insert({title:b.title,content:b.content,variables:L,description:b.description,template_type:"whatsapp",is_active:!0}),await k(),v()}catch(L){R(L.message||"Failed to save template")}N(!1)},F=async L=>{window.confirm("Delete this template?")&&(await G.from("communication_templates").delete().eq("id",L),await k())};return e.jsxs("div",{className:"p-4 max-w-lg w-full mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"font-semibold text-base",children:"WhatsApp Templates"}),e.jsx("button",{className:"bg-primary text-white px-3 py-1 rounded text-sm",onClick:()=>E(),children:"Add Template"})]}),i?e.jsx("div",{className:"text-gray-400 text-sm",children:"Loading templates..."}):r.length===0?e.jsx("div",{className:"text-gray-300 text-sm",children:"No templates found."}):e.jsx("div",{className:"flex flex-col gap-2",children:r.map(L=>e.jsxs("div",{className:"bg-white rounded border border-gray-100 p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900 text-sm",children:L.title}),e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:L.description}),e.jsx("div",{className:"text-xs text-gray-700",children:L.content}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Vars: ",L.variables?JSON.stringify(L.variables):"-"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"text-xs text-primary px-2 py-1 rounded hover:bg-primary/10",onClick:()=>E(L),children:"Edit"}),e.jsx("button",{className:"text-xs text-danger px-2 py-1 rounded hover:bg-danger/10",onClick:()=>F(L.id),children:"Delete"})]})]},L.id))}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"font-semibold mb-2",children:[x?"Edit":"Add"," Template"]}),e.jsx("input",{type:"text",value:b.title,onChange:L=>f(C=>({...C,title:L.target.value})),placeholder:"Title",className:"border border-gray-200 rounded px-3 py-2 w-full mb-2 text-sm bg-gray-50",disabled:y}),e.jsx("input",{type:"text",value:b.description,onChange:L=>f(C=>({...C,description:L.target.value})),placeholder:"Description",className:"border border-gray-200 rounded px-3 py-2 w-full mb-2 text-sm bg-gray-50",disabled:y}),e.jsx("textarea",{value:b.content,onChange:L=>f(C=>({...C,content:L.target.value})),placeholder:"Content (use {var} for variables)",className:"border border-gray-200 rounded px-3 py-2 w-full mb-2 text-sm bg-gray-50",rows:3,disabled:y}),e.jsx("input",{type:"text",value:b.variables,onChange:L=>f(C=>({...C,variables:L.target.value})),placeholder:'Variables (JSON, e.g. {"name":""})',className:"border border-gray-200 rounded px-3 py-2 w-full mb-2 text-sm bg-gray-50",disabled:y}),e.jsxs("div",{className:"flex gap-2 mt-2 justify-end",children:[e.jsx("button",{className:"px-4 py-2 rounded bg-gray-100 text-gray-700 text-sm",onClick:v,disabled:y,children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded bg-primary text-white text-sm",onClick:U,disabled:y,children:y?"Saving...":"Save"})]}),I&&e.jsx("div",{className:"text-danger mt-2 text-xs",children:I})]})})]})},Tx=()=>{const[r,a]=g.useState([]),[i,c]=g.useState(!0),[m,u]=g.useState([]),x=async()=>{c(!0);const{data:f}=await G.from("whatsapp_messages").select("*").eq("status","sent").order("timestamp",{ascending:!1});a(f||[]),c(!1)};g.useEffect(()=>{x(),(async()=>{const{data:N}=await G.from("customers").select("id, name");u(N||[])})();const y=G.channel("whatsapp-messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"whatsapp_messages"},N=>{a(I=>[N.new,...I])}).subscribe();return()=>{y.unsubscribe()}},[]);const j=f=>m.find(y=>y.id===f),b=async f=>{await G.from("whatsapp_messages").update({status:"read"}).eq("id",f),a(y=>y.filter(N=>N.id!==f))};return e.jsxs("div",{className:"p-4 max-w-lg w-full mx-auto",children:[e.jsx("div",{className:"font-semibold mb-4 text-base",children:"Unread WhatsApp Messages"}),i?e.jsx("div",{className:"text-gray-400 text-sm",children:"Loading notifications..."}):r.length===0?e.jsx("div",{className:"text-gray-300 text-sm",children:"No new messages."}):e.jsx("div",{className:"flex flex-col gap-2",children:r.map(f=>{var y;return e.jsxs("div",{className:"bg-white rounded border border-gray-100 p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900 text-sm",children:f.content}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Chat: ",((y=j(f.customer_id))==null?void 0:y.name)||"Unknown"]}),e.jsx("div",{className:"text-xs text-gray-400",children:Jc(f.timestamp)})]}),e.jsx("button",{className:"text-xs text-primary px-2 py-1 rounded hover:bg-primary/10",onClick:()=>b(f.id),children:"Mark as Read"})]},f.id)})})]})},Ix=()=>{const[r,a]=g.useState([]),[i,c]=g.useState([]),[m,u]=g.useState([]),[x,j]=g.useState(""),[b,f]=g.useState(""),[y,N]=g.useState(""),[I,R]=g.useState(!0),k=async()=>{R(!0);const{data:C}=await G.from("whatsapp_chats").select("*").order("updated_at",{ascending:!1}),{data:$}=await G.from("auth_users").select("id, name, role").order("name",{ascending:!0});a(C||[]),c($||[]),R(!1)};g.useEffect(()=>{k(),(async()=>{const{data:$}=await G.from("customers").select("id, name");u($||[])})()},[]);const E=C=>m.find($=>$.id===C),v=async(C,$)=>{await G.from("whatsapp_chats").update({assigned_to:$}).eq("id",C),k()},U=async C=>{if(!x.trim())return;const $=r.find(A=>A.id===C),Y=Array.from(new Set([...$.tags||[],x.trim()]));await G.from("whatsapp_chats").update({tags:Y}).eq("id",C),j(""),k()},F=async(C,$)=>{const A=(r.find(Z=>Z.id===C).tags||[]).filter(Z=>Z!==$);await G.from("whatsapp_chats").update({tags:A}).eq("id",C),k()},L=r.filter(C=>!(b&&!(C.tags||[]).includes(b)||y&&C.assigned_to!==y));return e.jsxs("div",{className:"p-4 max-w-lg w-full mx-auto",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("input",{type:"text",value:b,onChange:C=>f(C.target.value),placeholder:"Filter by tag",className:"border border-gray-200 rounded px-3 py-2 text-sm bg-gray-50"}),e.jsxs("select",{value:y,onChange:C=>N(C.target.value),className:"border border-gray-200 rounded px-3 py-2 text-sm bg-gray-50",children:[e.jsx("option",{value:"",children:"All Staff"}),i.map(C=>e.jsx("option",{value:C.id,children:C.name},C.id))]})]}),I?e.jsx("div",{className:"text-gray-400 text-sm",children:"Loading chats..."}):L.length===0?e.jsx("div",{className:"text-gray-300 text-sm",children:"No chats found."}):e.jsx("div",{className:"flex flex-col gap-2",children:L.map(C=>{var $,Y;return e.jsxs("div",{className:"bg-white rounded border border-gray-100 p-3 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"font-semibold text-gray-900 text-sm",children:["Chat: ",(($=E(C.customer_id))==null?void 0:$.name)||"Unknown"]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Tags: ",(C.tags||[]).join(", ")||"-"]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Assigned: ",((Y=i.find(A=>A.id===C.assigned_to))==null?void 0:Y.name)||"-"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:C.assigned_to||"",onChange:A=>v(C.id,A.target.value),className:"border border-gray-200 rounded px-2 py-1 text-sm bg-gray-50",children:[e.jsx("option",{value:"",children:"Assign to..."}),i.map(A=>e.jsx("option",{value:A.id,children:A.name},A.id))]}),e.jsx("input",{type:"text",value:x,onChange:A=>j(A.target.value),placeholder:"Add tag",className:"border border-gray-200 rounded px-2 py-1 text-sm bg-gray-50"}),e.jsx("button",{className:"bg-success text-white px-3 py-1 rounded text-xs",onClick:()=>U(C.id),children:"Add Tag"}),(C.tags||[]).map(A=>e.jsxs("button",{className:"text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded ml-1",onClick:()=>F(C.id,A),children:[A," ×"]},A))]})]},C.id)})})]})},Mx=()=>{const[r,a]=g.useState({total:0,sent:0,delivered:0,read:0,failed:0}),[i,c]=g.useState(0),[m,u]=g.useState([]),[x,j]=g.useState(!0);return g.useEffect(()=>{(async()=>{j(!0);const f=await ar.getAnalytics();a(f);const{count:y}=await G.from("whatsapp_chats").select("*",{count:"exact",head:!0});c(y||0);const{data:N}=await G.from("auth_users").select("id, name"),I=[];for(const R of N||[]){const{count:k}=await G.from("whatsapp_chats").select("*",{count:"exact",head:!0}).eq("assigned_to",R.id);I.push({id:R.id,name:R.name,chats:k||0})}u(I),j(!1)})()},[]),e.jsxs("div",{className:"p-4 max-w-2xl w-full mx-auto",children:[e.jsx("div",{className:"font-semibold mb-4 text-base",children:"WhatsApp Analytics"}),x?e.jsx("div",{className:"text-gray-400 text-sm",children:"Loading analytics..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-white rounded border border-gray-100 p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:r.total}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total Messages"})]}),e.jsxs("div",{className:"bg-white rounded border border-gray-100 p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-success",children:r.sent}),e.jsx("div",{className:"text-xs text-gray-500",children:"Sent"})]}),e.jsxs("div",{className:"bg-white rounded border border-gray-100 p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-warning",children:r.delivered}),e.jsx("div",{className:"text-xs text-gray-500",children:"Delivered"})]}),e.jsxs("div",{className:"bg-white rounded border border-gray-100 p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo",children:r.read}),e.jsx("div",{className:"text-xs text-gray-500",children:"Read"})]}),e.jsxs("div",{className:"bg-white rounded border border-gray-100 p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-danger",children:r.failed}),e.jsx("div",{className:"text-xs text-gray-500",children:"Failed"})]})]}),e.jsxs("div",{className:"bg-white rounded border border-gray-100 p-4",children:[e.jsxs("div",{className:"font-semibold mb-2 text-sm",children:["Total Chats: ",i]}),e.jsx("div",{className:"font-semibold mb-2 text-sm",children:"Staff Performance"}),e.jsx("div",{className:"space-y-1",children:m.map(b=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:b.name}),e.jsxs("span",{className:"font-bold text-primary",children:[b.chats," chats"]})]},b.id))})]})]})]})},Rx=()=>{const[r,a]=g.useState(""),[i,c]=g.useState(""),[m,u]=g.useState(!0),[x,j]=g.useState(!1),[b,f]=g.useState(null),[y,N]=g.useState(null);g.useEffect(()=>{(async()=>{var U,F;u(!0);const{data:E,error:v}=await G.from("settings").select("key, value").in("key",["whatsapp_instance_id","whatsapp_green_api_key"]);v?f(v.message):(a(((U=E==null?void 0:E.find(L=>L.key==="whatsapp_instance_id"))==null?void 0:U.value)||""),c(((F=E==null?void 0:E.find(L=>L.key==="whatsapp_green_api_key"))==null?void 0:F.value)||"")),u(!1)})()},[]);const I=async()=>{j(!0),f(null),N(null);const{error:k}=await G.from("settings").upsert([{key:"whatsapp_instance_id",value:r},{key:"whatsapp_green_api_key",value:i}],{onConflict:"key"});k?f(k.message):N("Green API credentials saved successfully."),j(!1)},R=async()=>{j(!0),f(null),N(null);const{error:k}=await G.from("settings").delete().in("key",["whatsapp_instance_id","whatsapp_green_api_key"]);k?f(k.message):(a(""),c(""),N("Green API credentials removed.")),j(!1)};return e.jsxs("div",{className:"p-4 max-w-md w-full mx-auto bg-white rounded border border-gray-100",children:[e.jsx("div",{className:"font-semibold mb-4 text-base",children:"Green API Credentials"}),e.jsx("div",{className:"mb-2 font-semibold text-sm",children:"Instance ID"}),e.jsx("input",{type:"text",className:"border border-gray-200 rounded px-3 py-2 w-full mb-2 text-sm bg-gray-50",value:r,onChange:k=>a(k.target.value),placeholder:"Instance ID"}),e.jsx("div",{className:"mb-2 font-semibold text-sm",children:"API Key"}),e.jsx("input",{type:"password",className:"border border-gray-200 rounded px-3 py-2 w-full mb-2 text-sm bg-gray-50",value:i,onChange:k=>c(k.target.value),placeholder:"API Key"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{className:"bg-primary text-white px-4 py-2 rounded text-sm",onClick:I,disabled:x,children:x?"Saving...":"Save"}),e.jsx("button",{className:"bg-danger text-white px-4 py-2 rounded text-sm",onClick:R,disabled:x||!r&&!i,children:"Remove"})]}),m&&e.jsx("div",{className:"mt-2 text-gray-500 text-xs",children:"Loading..."}),b&&e.jsx("div",{className:"mt-2 text-danger text-xs",children:b}),y&&e.jsx("div",{className:"mt-2 text-success text-xs",children:y})]})},Lx=()=>{const[r,a]=g.useState([]),[i,c]=g.useState(!0),[m,u]=g.useState(!1),[x,j]=g.useState(null),[b,f]=g.useState({type:"text",content:"",media_url:"",template_id:"",variables:""}),[y,N]=g.useState(!1),[I,R]=g.useState(null),[k,E]=g.useState([]),v=async()=>{c(!0);const{data:A}=await G.from("scheduled_whatsapp_messages").select("*").order("scheduled_for",{ascending:!0});a(A||[]),c(!1)};g.useEffect(()=>{v(),(async()=>{const{data:_}=await G.from("customers").select("id, name");E(_||[])})();const Z=G.channel("scheduled-whatsapp-messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"scheduled_whatsapp_messages"},_=>{a(D=>[_.new,...D])}).subscribe();return()=>{Z.unsubscribe()}},[]);const U=A=>k.find(Z=>Z.id===A),F=A=>{j(A||null),f({type:(A==null?void 0:A.type)||"text",content:(A==null?void 0:A.content)||"",media_url:(A==null?void 0:A.media_url)||"",template_id:(A==null?void 0:A.template_id)||"",variables:A!=null&&A.variables?JSON.stringify(A.variables):""}),u(!0),R(null)},L=()=>{u(!1),j(null),f({type:"text",content:"",media_url:"",template_id:"",variables:""}),R(null)},C=async()=>{N(!0),R(null);try{const A=b.variables?JSON.parse(b.variables):{};x?await G.from("scheduled_whatsapp_messages").update({content:b.content,media_url:b.media_url,template_id:b.template_id,variables:A,scheduled_for:x.scheduled_for}).eq("id",x.id):await G.from("scheduled_whatsapp_messages").insert({chat_id:x==null?void 0:x.chat_id,content:b.content,media_url:b.media_url,template_id:b.template_id,variables:A,scheduled_for:(x==null?void 0:x.scheduled_for)||new Date().toISOString(),status:"pending",created_by:null}),await v(),L()}catch(A){R(A.message||"Failed to save scheduled message")}N(!1)},$=async A=>{window.confirm("Delete this scheduled message?")&&(await G.from("scheduled_whatsapp_messages").delete().eq("id",A),await v())},Y=async A=>{const Z=r.find(D=>D.id===A);if(!Z)return;let _=null;if(Z.type==="text"?_=await ar.sendMessage(Z.chat_id,Z.content,"text"):Z.type==="media"?_=await ar.sendMessage(Z.chat_id,Z.content,"media",Z.media_url):Z.type==="template"&&(_=await ar.sendMessage(Z.chat_id,Z.content,"template",void 0,Z.template_id)),!_){R("Failed to send scheduled message");return}_.success?(await G.from("scheduled_whatsapp_messages").update({status:"sent"}).eq("id",A),await v()):R(_.error||"Failed to send scheduled message")};return e.jsxs("div",{className:"p-4 max-w-lg w-full mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"font-semibold text-base",children:"Scheduled WhatsApp Messages"}),e.jsx("button",{className:"bg-primary text-white px-4 py-2 rounded text-sm",onClick:()=>F(),children:"Add Scheduled Message"})]}),i?e.jsx("div",{className:"text-gray-400 text-sm",children:"Loading scheduled messages..."}):r.length===0?e.jsx("div",{className:"text-gray-300 text-sm",children:"No scheduled messages found."}):e.jsx("div",{className:"flex flex-col gap-2",children:r.map(A=>{var Z;return e.jsxs("div",{className:"bg-white rounded border border-gray-100 p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900 text-sm",children:["Chat: ",((Z=U(A.customer_id))==null?void 0:Z.name)||"Unknown"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Scheduled for: ",new Date(A.scheduled_for).toLocaleString()]}),e.jsxs("div",{className:"text-xs text-gray-700",children:["Content: ",A.content]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Type: ",A.type]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Status: ",A.status]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Vars: ",A.variables?JSON.stringify(A.variables):"-"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"text-xs text-primary px-2 py-1 rounded hover:bg-primary/10",onClick:()=>F(A),children:"Edit"}),e.jsx("button",{className:"text-xs text-danger px-2 py-1 rounded hover:bg-danger/10",onClick:()=>$(A.id),children:"Delete"}),A.status==="pending"&&e.jsx("button",{className:"text-xs text-success px-2 py-1 rounded hover:bg-success/10",onClick:()=>Y(A.id),children:"Send Now"})]})]},A.id)})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"font-semibold mb-2",children:[x?"Edit":"Add"," Scheduled Message"]}),e.jsx("div",{className:"mb-2 font-semibold text-sm",children:"Chat ID"}),e.jsx("input",{type:"text",className:"border border-gray-200 rounded px-3 py-2 w-full mb-2 text-sm bg-gray-50",value:(x==null?void 0:x.chat_id)||"",readOnly:!0}),e.jsx("div",{className:"mb-2 font-semibold text-sm",children:"Scheduled For"}),e.jsx("input",{type:"text",className:"border border-gray-200 rounded px-3 py-2 w-full mb-2 text-sm bg-gray-50",value:x!=null&&x.scheduled_for?new Date(x.scheduled_for).toLocaleString():"",readOnly:!0}),e.jsx("div",{className:"mb-2 font-semibold text-sm",children:"Message Type"}),e.jsxs("select",{value:b.type,onChange:A=>f(Z=>({...Z,type:A.target.value})),className:"border border-gray-200 rounded px-3 py-2 w-full mb-2 text-sm bg-gray-50",children:[e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"media",children:"Media"}),e.jsx("option",{value:"template",children:"Template"})]}),e.jsx("div",{className:"mb-2 font-semibold text-sm",children:"Content/Media URL/Template ID"}),e.jsx("textarea",{value:b.content,onChange:A=>f(Z=>({...Z,content:A.target.value})),placeholder:"Content for text, Media URL for media, Template ID for template",className:"border border-gray-200 rounded px-3 py-2 w-full mb-2 text-sm bg-gray-50",rows:3,disabled:y}),e.jsx("input",{type:"text",value:b.media_url,onChange:A=>f(Z=>({...Z,media_url:A.target.value})),placeholder:"Media URL (for media type)",className:"border border-gray-200 rounded px-3 py-2 w-full mb-2 text-sm bg-gray-50",disabled:y}),e.jsx("input",{type:"text",value:b.template_id,onChange:A=>f(Z=>({...Z,template_id:A.target.value})),placeholder:"Template ID (for template type)",className:"border border-gray-200 rounded px-3 py-2 w-full mb-2 text-sm bg-gray-50",disabled:y}),e.jsx("input",{type:"text",value:b.variables,onChange:A=>f(Z=>({...Z,variables:A.target.value})),placeholder:'Variables (JSON, e.g. {"name":""})',className:"border border-gray-200 rounded px-3 py-2 w-full mb-2 text-sm bg-gray-50",disabled:y}),e.jsxs("div",{className:"flex gap-2 mt-2 justify-end",children:[e.jsx("button",{className:"px-4 py-2 rounded bg-gray-100 text-gray-700 text-sm",onClick:L,disabled:y,children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded bg-primary text-white text-sm",onClick:C,disabled:y,children:y?"Saving...":"Save"})]}),I&&e.jsx("div",{className:"text-danger mt-2 text-xs",children:I})]})})]})},To=()=>{const[r,a]=g.useState("Inbox"),[i,c]=g.useState(null),[m,u]=g.useState(!1),[x,j]=g.useState([]),[b,f]=g.useState([]),[y,N]=g.useState(""),[I,R]=g.useState(!1),[k,E]=g.useState(""),[v,U]=g.useState(!1),F=ba();g.useEffect(()=>{if(!m)return;(async()=>{const{data:$}=await G.from("customers").select("id, name, profile_image, whatsapp"),{data:Y}=await G.from("whatsapp_chats").select("customer_id");j($||[]),f((Y||[]).map(A=>A.customer_id))})()},[m]),g.useEffect(()=>{if(F.state&&F.state.customerId){const C=F.state.customerId;(async()=>{const{data:Y}=await G.from("whatsapp_chats").select("*").eq("customer_id",C);let A=Y&&Y.length>0?Y[0]:null;if(!A){const Z=await ar.createChat(C);Z.success&&Z.chat&&(A=Z.chat)}A&&(a("Inbox"),c(A))})(),window.history.replaceState({},document.title)}},[F.state]);const L=async()=>{if(!y)return;R(!0),E("");const C=await ar.createChat(y);R(!1),C.success&&C.chat?(u(!1),c(C.chat),N("")):E(C.error||"Failed to create chat")};return e.jsxs("div",{className:"flex min-h-screen items-start justify-start pl-4 sm:pl-8 lg:pl-12 pr-4 sm:pr-8 lg:pr-12",children:[e.jsxs(he,{className:"flex w-full h-full mb-0 p-0 shadow-lg border-none bg-white/80 rounded-2xl",children:[e.jsxs("aside",{className:`transition-all duration-300 ease-in-out
            ${v?"w-56":"w-16"}
            h-full bg-transparent rounded-l-2xl rounded-r-none border-none shadow-none flex flex-col items-center p-0 m-0
          `,style:{minHeight:"70vh",maxHeight:"100vh",backdropFilter:"blur(8px)"},onMouseEnter:()=>U(!0),onMouseLeave:()=>U(!1),children:[e.jsx("div",{className:"flex flex-col items-center gap-2 py-5 w-full",children:e.jsx("div",{className:"p-1.5 bg-white/50 rounded-xl",children:e.jsx("img",{src:"/public/logos/whatsapp.svg",alt:"WA",className:"w-8 h-8"})})}),e.jsx("nav",{className:"flex-1 flex flex-col gap-1.5 items-center w-full px-2 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-200 hover:scrollbar-thumb-gray-300",children:_x.map(C=>e.jsxs("button",{className:`flex items-center gap-3 w-full px-3.5 py-2.5 rounded-xl transition-all duration-300 font-semibold text-base
                  ${r===C.key?"bg-blue-500 text-white shadow-xl border border-primary/40 scale-[1.04]":"text-gray-700 hover:bg-blue-100/70 hover:text-blue-700 hover:shadow-md hover:scale-[1.03]"}
                  ${!v&&"justify-center"}
                `,style:{transition:"background 0.2s, color 0.2s, box-shadow 0.2s, border 0.2s, transform 0.2s, width 0.3s"},onClick:()=>{a(C.key),c(null)},title:C.label,children:[e.jsx("span",{className:`flex-shrink-0 ${!v&&"mx-auto"}`,children:C.icon}),e.jsx("span",{className:`text-base font-semibold whitespace-nowrap transition-all duration-300
                    ${v?"opacity-100 ml-2":"opacity-0 w-0 overflow-hidden"}
                  `,children:C.label})]},C.key))}),e.jsxs("div",{className:"mt-auto py-4 flex flex-col items-center w-full px-3",children:[e.jsx("div",{className:`h-[1px] w-full bg-gray-200/50 mb-3 ${!v&&"w-8 mx-auto"}`}),e.jsxs("div",{className:`flex items-center gap-2 px-2 py-1.5 rounded-lg text-xs text-gray-600
              ${!v&&"justify-center"}
            `,children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),v&&e.jsx("span",{children:"Connected"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col h-full bg-transparent rounded-r-2xl p-0 m-0",children:[r==="Inbox"&&e.jsxs("div",{className:"flex min-h-[70vh] h-full",children:[e.jsxs("section",{className:"w-80 max-w-xs border-r border-gray-100 flex flex-col bg-transparent",children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[e.jsx("span",{className:"font-bold text-lg text-primary-dark",children:"Chats"}),e.jsx("button",{className:"w-8 h-8 flex items-center justify-center rounded backdrop-blur-md border border-gray-200 shadow-md hover:bg-white/30 text-primary",onClick:()=>u(!0),children:e.jsx("span",{className:"text-xl leading-none",children:"+"})})]}),e.jsx(Ex,{onSelectChat:c})]}),e.jsx("main",{className:"flex-1 flex flex-col bg-transparent",children:i?e.jsx(Ax,{chat:i,onBack:()=>c(null)}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-gray-300 text-lg",children:"Select a chat to start messaging"})})]}),r==="Bulk"&&e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"h-full overflow-y-auto px-4 py-6",children:e.jsx(he,{className:"w-full max-w-2xl mx-auto",children:e.jsx(kx,{})})})}),r==="Templates"&&e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"h-full overflow-y-auto px-4 py-6",children:e.jsx(he,{className:"w-full max-w-2xl mx-auto",children:e.jsx(Dx,{})})})}),r==="Notifications"&&e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"h-full overflow-y-auto px-4 py-6",children:e.jsx(he,{className:"w-full max-w-2xl mx-auto",children:e.jsx(Tx,{})})})}),r==="Assignment"&&e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"h-full overflow-y-auto px-4 py-6",children:e.jsx(he,{className:"w-full max-w-2xl mx-auto",children:e.jsx(Ix,{})})})}),r==="Analytics"&&e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"h-full overflow-y-auto px-4 py-6",children:e.jsx(he,{className:"w-full max-w-3xl mx-auto",children:e.jsx(Mx,{})})})}),r==="Settings"&&e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"h-full overflow-y-auto px-4 py-6",children:e.jsx(he,{className:"w-full max-w-md mx-auto",children:e.jsx(Rx,{})})})}),r==="Scheduled"&&e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"h-full overflow-y-auto px-4 py-6",children:e.jsx(he,{className:"w-full max-w-2xl mx-auto",children:e.jsx(Lx,{})})})})]})]}),m&&e.jsx(es,{isOpen:m,onClose:()=>u(!1),children:e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-base font-semibold mb-2",children:"Start New Chat"}),e.jsxs("select",{className:"border border-gray-200 rounded px-3 py-2 w-full mb-2 text-sm bg-gray-50",value:y,onChange:C=>N(C.target.value),children:[e.jsx("option",{value:"",children:"Select customer..."}),x.filter(C=>!b.includes(C.id)).map(C=>e.jsxs("option",{value:C.id,children:[C.name," ",C.whatsapp?`(${C.whatsapp})`:""]},C.id))]}),e.jsx("button",{className:"bg-primary text-white w-full py-2 rounded mt-2 text-sm",onClick:L,disabled:I||!y,children:I?"Creating...":"Create Chat"}),k&&e.jsx("div",{className:"text-danger mt-2 text-sm",children:k})]})})]})},Ai=()=>{const r=hs(),{currentUser:a}=Wt(),[i,c]=g.useState(!1),[m,u]=g.useState([]),[x,j]=g.useState([]),[b,f]=g.useState(!1),[y,N]=g.useState(""),[I,R]=g.useState(""),[k,E]=g.useState(""),[v,U]=g.useState(!1),[F,L]=g.useState({}),[C,$]=g.useState([{device_name:"",brand:"",serial_number:"",model:"",notes:"",quantity:1,individual_serials:[],template_id:void 0}]);if(!a||!["admin","customer-care"].includes(a.role))return e.jsx("div",{className:"p-4 sm:p-6 max-w-4xl mx-auto",children:e.jsx(he,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You don't have permission to create diagnostic requests."})]})})});g.useEffect(()=>{(async()=>{const[H,J]=await Promise.all([X0(),Tc()]);u(H),j(J)})()},[]);const Y=()=>{$([...C,{device_name:"",brand:"",serial_number:"",model:"",notes:"",quantity:1,individual_serials:[],template_id:void 0}])},A=q=>{C.length>1&&$(C.filter((H,J)=>J!==q))},Z=(q,H,J)=>{const V=[...C];if(H==="quantity"){const ge=J,He=V[q].individual_serials||[];if(ge>He.length){const B=Array(ge-He.length).fill("");V[q].individual_serials=[...He,...B]}else V[q].individual_serials=He.slice(0,ge)}V[q]={...V[q],[H]:J},$(V)},_=(q,H,J)=>{const V=[...C],ge=V[q],He=[...ge.individual_serials||[]];He[H]=J,V[q]={...ge,individual_serials:He},$(V)},D=q=>{if(!q)return e.jsx(Ft,{className:"h-5 w-5"});switch(q.toLowerCase()){case"laptop":return e.jsx(Aa,{className:"h-5 w-5"});case"printer":return e.jsx(ra,{className:"h-5 w-5"});case"monitor":return e.jsx(xr,{className:"h-5 w-5"});case"desktop":return e.jsx(xr,{className:"h-5 w-5"});case"tablet":return e.jsx(Ea,{className:"h-5 w-5"});case"phone":return e.jsx(ns,{className:"h-5 w-5"});default:return e.jsx(Ft,{className:"h-5 w-5"})}},T=q=>{const H=q.toLowerCase();return H.includes("laptop")||H.includes("notebook")?"laptop":H.includes("printer")||H.includes("print")?"printer":H.includes("monitor")||H.includes("screen")?"monitor":H.includes("desktop")||H.includes("pc")?"desktop":H.includes("tablet")||H.includes("ipad")?"tablet":H.includes("phone")||H.includes("mobile")?"phone":"other"},z=q=>{if(q.template_id)return x.find(J=>J.id===q.template_id);const H=T(q.device_name);return x.find(J=>J.device_type.toLowerCase()===H)},se=async q=>{if(q.preventDefault(),!y.trim()){te.error("Please enter a title for the diagnostic request");return}if(C.some(H=>!H.device_name.trim())){te.error("Please enter device name for all devices");return}c(!0);try{const H={title:y.trim(),assigned_to:I||void 0,notes:k.trim()||void 0,devices:C.map(V=>{var ge,He,B,fe;return{device_name:V.device_name.trim(),brand:(ge=V.brand)==null?void 0:ge.trim(),serial_number:(He=V.serial_number)==null?void 0:He.trim(),model:(B=V.model)==null?void 0:B.trim(),notes:(fe=V.notes)==null?void 0:fe.trim(),quantity:V.quantity||1,individual_serials:V.individual_serials,template_id:V.template_id}})};await $0(H)&&r("/diagnostics/assigned")}catch(H){console.error("Error creating diagnostic request:",H)}finally{c(!1)}};return e.jsxs("div",{className:"p-4 sm:p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs(X,{onClick:()=>r("/dashboard"),className:"flex items-center gap-2",children:[e.jsx(zs,{size:20}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"New Diagnostic Request"})]}),e.jsx("p",{className:"text-gray-600",children:"Create a new diagnostic request for technicians to test devices"})]}),e.jsxs("form",{onSubmit:se,children:[e.jsx(he,{className:"mb-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(pr,{size:20,className:"text-blue-600"}),"Request Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Request Title *"}),e.jsx("input",{type:"text",value:y,onChange:q=>N(q.target.value),placeholder:"e.g., Office Equipment Diagnostic - March 2024",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign to Technician"}),e.jsxs("select",{value:I,onChange:q=>R(q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select technician (optional)"}),m.map(q=>e.jsxs("option",{value:q.id,children:[q.name," (",q.username,")"]},q.id))]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ft,{size:20,className:"text-blue-600"}),"Devices (",C.length,")"]}),e.jsxs(X,{type:"button",onClick:Y,className:"flex items-center gap-2",children:[e.jsx(Ut,{size:20}),"Add Device"]})]}),e.jsx("div",{className:"space-y-4",children:C.map((q,H)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[D(T(q.device_name)),e.jsxs("h3",{className:"font-medium text-gray-900",children:["Device ",H+1]})]}),C.length>1&&e.jsx("button",{type:"button",onClick:()=>A(H),className:"text-red-500 hover:text-red-700 transition-colors",children:e.jsx(er,{size:20})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Device Name *"}),e.jsx("input",{type:"text",value:q.device_name,onChange:J=>Z(H,"device_name",J.target.value),placeholder:"e.g., HP EliteBook 840 G8",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brand"}),e.jsx("input",{type:"text",value:q.brand||"",onChange:J=>Z(H,"brand",J.target.value),placeholder:"e.g., HP",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Model"}),e.jsx("input",{type:"text",value:q.model||"",onChange:J=>Z(H,"model",J.target.value),placeholder:"e.g., EliteBook 840 G8",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",max:"50",value:q.quantity||1,onChange:J=>Z(H,"quantity",parseInt(J.target.value)||1),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:(q.quantity||1)>1?"Base Serial Number (optional)":"Serial Number"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:q.serial_number||"",onChange:J=>Z(H,"serial_number",J.target.value),placeholder:(q.quantity||1)>1?"e.g., CN12345678 (for reference only)":"e.g., CN12345678",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx(Ga,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Diagnostic Template"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>Z(H,"template_id",""),className:`px-3 py-2 rounded-lg border text-sm font-medium transition-colors ${q.template_id?"bg-white text-gray-700 border-gray-300 hover:border-gray-400":"bg-green-500 text-white border-green-500"}`,children:"Auto-Select"}),x.map(J=>e.jsxs("button",{type:"button",onClick:()=>Z(H,"template_id",J.id),className:`px-3 py-2 rounded-lg border text-sm font-medium transition-colors ${q.template_id===J.id?"bg-blue-500 text-white border-blue-500":"bg-white text-gray-700 border-gray-300 hover:border-gray-400"}`,children:[J.device_type," (",J.checklist_items.length," tests)"]},J.id))]})]}),q.device_name&&e.jsxs("div",{className:"md:col-span-2 mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Diagnostic Tests Preview:"}),(()=>{const J=z(q);return J?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-blue-800 mb-2",children:[J.device_type," Template (",J.checklist_items.length," tests)"]}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:J.checklist_items.map((V,ge)=>e.jsxs("div",{className:"text-xs text-blue-700",children:["• ",V.name]},ge))})]}):e.jsxs("p",{className:"text-sm text-blue-700",children:['No template found for "',T(q.device_name),'"']})})()]}),(q.quantity||1)>1&&e.jsxs("div",{className:"md:col-span-2 mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("h4",{className:"text-sm font-medium text-yellow-900 mb-2",children:["Enter serial number for each device (",q.quantity," devices):"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:Array.from({length:q.quantity||1},(J,V)=>{var ge;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-yellow-700 font-medium",children:["#",V+1]}),e.jsx("input",{type:"text",value:((ge=q.individual_serials)==null?void 0:ge[V])||"",onChange:He=>_(H,V,He.target.value),placeholder:`Serial #${V+1}`,className:"flex-1 px-2 py-1 text-sm border border-yellow-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent"})]},V)})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("button",{type:"button",onClick:()=>L(J=>({...J,[H]:!J[H]})),className:"flex items-center justify-between w-full p-2 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Device Notes"}),F[H]?e.jsx(mn,{size:16,className:"text-gray-600"}):e.jsx(sa,{size:16,className:"text-gray-600"})]}),F[H]&&e.jsx("div",{className:"mt-2",children:e.jsx("textarea",{value:q.notes||"",onChange:J=>Z(H,"notes",J.target.value),placeholder:"e.g., Won't turn on, screen flickering",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})})]})]})]},H))})]}),e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>U(!v),className:"flex items-center justify-between w-full p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(pr,{size:20,className:"text-blue-600"}),"General Notes"]}),v?e.jsx(mn,{size:20,className:"text-gray-600"}):e.jsx(sa,{size:20,className:"text-gray-600"})]}),v&&e.jsx("div",{className:"mt-4",children:e.jsx("textarea",{value:k,onChange:q=>E(q.target.value),placeholder:"Add any general notes about this diagnostic request...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(X,{type:"button",onClick:()=>r("/dashboard"),className:"flex items-center gap-2",children:"Cancel"}),e.jsxs(X,{type:"submit",disabled:i,className:"flex items-center gap-2",children:[i?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsx(Hs,{size:20}),i?"Creating...":"Create Diagnostic Request"]})]})]})]})},Io=()=>{const r=hs(),{currentUser:a}=Wt(),[i,c]=g.useState(!0),[m,u]=g.useState([]),[x,j]=g.useState(null),[b,f]=g.useState(""),[y,N]=g.useState("all");if(!a||a.role!=="technician")return e.jsx("div",{className:"p-4 sm:p-6 max-w-4xl mx-auto",children:e.jsx(he,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"This page is only available for technicians."})]})})});g.useEffect(()=>{I()},[]);const I=async()=>{c(!0);try{const C={assigned_to:a==null?void 0:a.id,...y!=="all"&&{status:y}},[$,Y]=await Promise.all([En(C),fl()]);u($),j(Y)}catch(C){console.error("Error loading diagnostic data:",C),te.error("Failed to load diagnostic data")}finally{c(!1)}},R=m.filter(C=>{var $;return C.title.toLowerCase().includes(b.toLowerCase())||(($=C.notes)==null?void 0:$.toLowerCase().includes(b.toLowerCase()))}),k=C=>{if(!C)return e.jsx(Ft,{className:"h-4 w-4"});const $=C.toLowerCase();return $.includes("laptop")||$.includes("notebook")?e.jsx(Aa,{className:"h-4 w-4"}):$.includes("printer")||$.includes("print")?e.jsx(ra,{className:"h-4 w-4"}):$.includes("monitor")||$.includes("screen")?e.jsx(xr,{className:"h-4 w-4"}):$.includes("desktop")||$.includes("pc")?e.jsx(xr,{className:"h-4 w-4"}):$.includes("tablet")||$.includes("ipad")?e.jsx(Ea,{className:"h-4 w-4"}):$.includes("phone")||$.includes("mobile")?e.jsx(ns,{className:"h-4 w-4"}):e.jsx(Ft,{className:"h-4 w-4"})},E=C=>{switch(C){case"pending":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"in_progress":return"text-blue-600 bg-blue-50 border-blue-200";case"completed":return"text-green-600 bg-green-50 border-green-200";case"submitted_for_review":return"text-purple-600 bg-purple-50 border-purple-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},v=C=>{switch(C){case"pending":return e.jsx(ms,{size:16});case"in_progress":return e.jsx(xn,{size:16});case"completed":return e.jsx(yt,{size:16});case"submitted_for_review":return e.jsx(Ht,{size:16});default:return e.jsx(ms,{size:16})}},U=C=>new Date(C).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),F=C=>{r(`/diagnostics/request/${C}`)},L=C=>{r(`/diagnostics/request/${C}`)};return e.jsxs("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Assigned Diagnostics"}),e.jsx("p",{className:"text-gray-600",children:"View and work on your assigned diagnostic requests"})]}),e.jsxs(X,{onClick:()=>r("/diagnostics/new"),className:"flex items-center gap-2",children:[e.jsx(Ut,{size:20}),"New Request"]})]}),x&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(he,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:x.pending_requests}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pending Requests"})]}),e.jsxs(he,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:x.in_progress_requests}),e.jsx("div",{className:"text-sm text-gray-600",children:"In Progress"})]}),e.jsxs(he,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:x.completed_requests}),e.jsx("div",{className:"text-sm text-gray-600",children:"Completed"})]}),e.jsxs(he,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:x.total_devices}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Devices"})]})]})]}),e.jsx(he,{className:"p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Cr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search requests...",value:b,onChange:C=>f(C.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:y,onChange:C=>N(C.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]}),e.jsxs(X,{onClick:I,className:"flex items-center gap-2",children:[e.jsx(Rr,{size:16}),"Refresh"]})]})]})}),i?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading diagnostic requests..."})]}):R.length===0?e.jsxs(he,{className:"p-8 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(Ht,{size:48,className:"mx-auto"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Diagnostic Requests"}),e.jsx("p",{className:"text-gray-600",children:b||y!=="all"?"No requests match your current filters.":"You have no assigned diagnostic requests at the moment."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:R.map(C=>{var $;return e.jsxs(he,{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:C.title}),e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium border ${E(C.status)}`,children:[v(C.status),C.status.replace("_"," ")]})})]})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ws,{size:16}),e.jsxs("span",{children:["Created by: ",(($=C.created_by_user)==null?void 0:$.name)||"Unknown"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ws,{size:16}),e.jsxs("span",{children:["Created: ",U(C.created_at)]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ft,{size:16}),e.jsxs("span",{children:["Devices: ",C.device_count||0]})]}),C.devices&&C.devices.length>0&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Devices:"}),e.jsxs("div",{className:"space-y-1",children:[C.devices.slice(0,3).map((Y,A)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[k(Y.device_name),e.jsx("span",{className:"truncate",children:Y.device_name}),Y.serial_number&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",Y.serial_number,")"]})]},A)),C.devices.length>3&&e.jsxs("div",{className:"text-xs text-gray-500",children:["+",C.devices.length-3," more devices"]})]})]}),C.notes&&e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",C.notes]})]}),e.jsx("div",{className:"flex gap-2",children:C.status==="pending"?e.jsxs(X,{onClick:()=>F(C.id),className:"flex-1 flex items-center justify-center gap-2",children:[e.jsx(xn,{size:16}),"Start Diagnosis"]}):e.jsxs(X,{onClick:()=>L(C.id),className:"flex-1 flex items-center justify-center gap-2",children:[e.jsx(cs,{size:16}),"View Details"]})})]},C.id)})})]})},Ox=Dr.memo(({device:r,request:a,showDetails:i=!0})=>{var E;const c=hs(),{currentUser:m}=Wt(),u=v=>{if(!v)return"N/A";const U=new Date(v);if(isNaN(U.getTime()))return"N/A";const F={year:"2-digit",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};return U.toLocaleDateString(void 0,F)},x=v=>{if(!v)return e.jsx(Ft,{className:"h-6 w-6"});const U=v.toLowerCase();return U.includes("laptop")||U.includes("notebook")?e.jsx(Aa,{className:"h-6 w-6"}):U.includes("printer")||U.includes("print")?e.jsx(ra,{className:"h-6 w-6"}):U.includes("monitor")||U.includes("screen")?e.jsx(xr,{className:"h-6 w-6"}):U.includes("desktop")||U.includes("pc")?e.jsx(xr,{className:"h-6 w-6"}):U.includes("tablet")||U.includes("ipad")?e.jsx(Ea,{className:"h-6 w-6"}):U.includes("phone")||U.includes("mobile")?e.jsx(ns,{className:"h-6 w-6"}):e.jsx(Ft,{className:"h-6 w-6"})},j=v=>{switch(v){case"pending":return"text-yellow-700 bg-gradient-to-r from-yellow-50 to-orange-50 border-yellow-200";case"passed":return"text-green-700 bg-gradient-to-r from-green-50 to-emerald-50 border-green-200";case"failed":return"text-red-700 bg-gradient-to-r from-red-50 to-pink-50 border-red-200";case"partially_failed":return"text-orange-700 bg-gradient-to-r from-orange-50 to-amber-50 border-orange-200";case"submitted_for_review":return"text-purple-700 bg-gradient-to-r from-purple-50 to-indigo-50 border-purple-200";case"repair_complete":return"text-blue-700 bg-gradient-to-r from-blue-50 to-cyan-50 border-blue-200";case"repair_required":return"text-orange-700 bg-gradient-to-r from-orange-50 to-red-50 border-orange-200";case"replacement_required":return"text-red-700 bg-gradient-to-r from-red-50 to-pink-50 border-red-200";case"no_action_required":return"text-gray-700 bg-gradient-to-r from-gray-50 to-slate-50 border-gray-200";case"escalated":return"text-purple-700 bg-gradient-to-r from-purple-50 to-pink-50 border-purple-200";case"admin_reviewed":return"text-blue-700 bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200";default:return"text-gray-700 bg-gradient-to-r from-gray-50 to-slate-50 border-gray-200"}},b=v=>{switch(v){case"passed":return e.jsx(yt,{className:"h-5 w-5"});case"failed":return e.jsx(Fs,{className:"h-5 w-5"});case"partially_failed":return e.jsx(Ht,{className:"h-5 w-5"});case"repair_required":return e.jsx(Ss,{className:"h-5 w-5"});case"replacement_required":return e.jsx(us,{className:"h-5 w-5"});case"escalated":return e.jsx(js,{className:"h-5 w-5"});case"no_action_required":return e.jsx(cs,{className:"h-5 w-5"});case"admin_reviewed":return e.jsx(yt,{className:"h-5 w-5"});default:return e.jsx(ms,{className:"h-5 w-5"})}},f=v=>{switch(v){case"submitted_for_review":return"Review";case"partially_failed":return"Partial";case"repair_complete":return"Repaired";case"repair_required":return"Repair Required";case"replacement_required":return"Replacement Required";case"no_action_required":return"No Action Required";case"escalated":return"Escalated";case"admin_reviewed":return"Admin Reviewed";default:return v.replace("_"," ")}},y=()=>{const v=r.diagnostic_device_id||r.id||r.device_id,U=a.id||a.request_id||a.diagnostic_request_id;if(U&&v)try{c(`/diagnostics/device/${U}/${v}`)}catch(F){console.error("Navigation error:",F)}else console.warn("Missing request.id or device.id for navigation",{deviceId:v,requestId:U,device:r,request:a})},N=()=>r.model?`${r.device_name||"Unknown Device"} - ${r.model}`:r.device_name||"Unknown Device",I=()=>{if(r.checks&&r.checks.length>0){const v=r.checks.length,U=r.check_count||v;return`${v}/${U} tests completed`}return"No tests started"},R=()=>{if(r.checks&&r.checks.length>0){const v=r.checks.length,U=r.check_count||v;return U>0?v/U*100:0}return 0},k=()=>{const v=R();return v===100?"bg-gradient-to-r from-green-500 to-emerald-500":v>=50?"bg-gradient-to-r from-blue-500 to-cyan-500":v>0?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-gray-300 to-gray-400"};return e.jsxs(he,{onClick:y,className:"group transform transition-all duration-300 ease-in-out hover:scale-[1.02] hover:shadow-xl cursor-pointer relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/30 via-transparent to-purple-50/30 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),r.admin_feedback&&e.jsx("div",{className:"absolute top-3 left-3 z-20",children:e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center border-2 border-white shadow-lg animate-pulse",children:e.jsx(js,{className:"h-3 w-3"})}),e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white animate-ping"})]})}),e.jsx("div",{className:"absolute top-3 right-3 z-20",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-semibold border-2 shadow-lg backdrop-blur-sm ${j(r.result_status||"pending")}`,children:[b(r.result_status||"pending"),e.jsx("span",{className:"capitalize",children:f(r.result_status||"pending")})]})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4 pt-8 pr-20",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-100 to-purple-100 flex items-center justify-center border-2 border-blue-200 shadow-sm",children:x(r.device_name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-900 truncate",title:N(),children:N()}),r.serial_number&&e.jsxs("p",{className:"text-sm text-gray-600 font-mono truncate",title:`S/N: ${r.serial_number}`,children:["S/N: ",r.serial_number]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fr,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Progress"})]}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:I()})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ease-out ${k()}`,style:{width:`${R()}%`}})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-50/50 rounded-lg border border-blue-100",children:[e.jsx(ws,{className:"h-4 w-4 text-blue-600"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Created"}),e.jsx("p",{className:"text-sm font-semibold text-blue-700 truncate",children:u(r.created_at)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-purple-50/50 rounded-lg border border-purple-100",children:[e.jsx(Ws,{className:"h-4 w-4 text-purple-600"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Assigned"}),e.jsx("p",{className:"text-sm font-semibold text-purple-700 truncate",children:((E=a.assigned_to_user)==null?void 0:E.name)||"Unassigned"})]})]})]}),i&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mb-4 p-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ms,{className:"h-4 w-4 text-indigo-600"}),e.jsx("span",{className:"text-sm font-semibold text-indigo-800",children:"Request"})]}),e.jsx("p",{className:"text-sm text-indigo-700 font-medium truncate",children:a.title||"Untitled Request"})]})}),e.jsx("div",{className:"flex gap-2 pt-4 border-t border-gray-200",children:(()=>{const v=r.diagnostic_device_id||r.id||r.device_id,U=a.id||a.request_id||a.diagnostic_request_id,F=r.result_status||"pending",L=C=>{if(C.stopPropagation(),C.preventDefault(),U&&v)try{c(`/diagnostics/device/${U}/${v}`)}catch($){console.error("Navigation error:",$)}else console.warn("Missing request.id or device.id for navigation",{deviceId:v,requestId:U,device:r,request:a})};return(m==null?void 0:m.role)==="admin"?F==="submitted_for_review"?e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white rounded-lg font-medium shadow-sm transition-all duration-200 group-hover:shadow-md",children:[e.jsx(cs,{className:"h-4 w-4"}),"Review"]}):F==="failed"||F==="partially_failed"?e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white rounded-lg font-medium shadow-sm transition-all duration-200 group-hover:shadow-md",children:[e.jsx(Ht,{className:"h-4 w-4"}),"Assess"]}):F==="repair_required"?e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white rounded-lg font-medium shadow-sm transition-all duration-200 group-hover:shadow-md",children:[e.jsx(Ss,{className:"h-4 w-4"}),"Repair Assigned"]}):F==="replacement_required"?e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white rounded-lg font-medium shadow-sm transition-all duration-200 group-hover:shadow-md",children:[e.jsx(us,{className:"h-4 w-4"}),"Replacement Assigned"]}):F==="escalated"?e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-lg font-medium shadow-sm transition-all duration-200 group-hover:shadow-md",children:[e.jsx(js,{className:"h-4 w-4"}),"Escalated"]}):F==="no_action_required"?e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white rounded-lg font-medium shadow-sm transition-all duration-200 group-hover:shadow-md",children:[e.jsx(cs,{className:"h-4 w-4"}),"No Action Required"]}):e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white rounded-lg font-medium shadow-sm transition-all duration-200 group-hover:shadow-md",children:[e.jsx(cs,{className:"h-4 w-4"}),"View"]}):(m==null?void 0:m.role)==="technician"?F==="pending"?e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white rounded-lg font-medium shadow-sm transition-all duration-200 group-hover:shadow-md",children:[e.jsx(xn,{className:"h-4 w-4"}),"Start Tests"]}):F==="in_progress"||F==="partially_failed"?e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white rounded-lg font-medium shadow-sm transition-all duration-200 group-hover:shadow-md",children:[e.jsx(fr,{className:"h-4 w-4"}),"Continue"]}):F==="repair_required"||r.admin_feedback&&r.next_action==="repair"?e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white rounded-lg font-medium shadow-sm transition-all duration-200 group-hover:shadow-md",children:[e.jsx(Ss,{className:"h-4 w-4"}),"Repair Required"]}):F==="replacement_required"?e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white rounded-lg font-medium shadow-sm transition-all duration-200 group-hover:shadow-md",children:[e.jsx(us,{className:"h-4 w-4"}),"Replacement Required"]}):F==="escalated"?e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-lg font-medium shadow-sm transition-all duration-200 group-hover:shadow-md",children:[e.jsx(js,{className:"h-4 w-4"}),"Escalated"]}):F==="no_action_required"?e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white rounded-lg font-medium shadow-sm transition-all duration-200 group-hover:shadow-md",children:[e.jsx(cs,{className:"h-4 w-4"}),"No Action Required"]}):e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white rounded-lg font-medium shadow-sm transition-all duration-200 group-hover:shadow-md",children:[e.jsx(cs,{className:"h-4 w-4"}),"View"]}):e.jsxs("button",{onClick:L,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white rounded-lg font-medium shadow-sm transition-all duration-200 group-hover:shadow-md",children:[e.jsx(cs,{className:"h-4 w-4"}),"View"]})})()})]})]})}),Mo=()=>{var N;const{requestId:r}=ka(),a=hs(),{currentUser:i}=Wt(),[c,m]=g.useState(!0),[u,x]=g.useState(null);g.useEffect(()=>{r&&j()},[r]);const j=async()=>{m(!0);try{const I=await gl(r);if(!I){te.error("Diagnostic request not found"),a("/diagnostics/assigned");return}x(I)}catch(I){console.error("Error loading diagnostic request:",I),te.error("Failed to load diagnostic request")}finally{m(!1)}},b=I=>{switch(I){case"pending":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"passed":return"text-green-600 bg-green-50 border-green-200";case"failed":return"text-red-600 bg-red-50 border-red-200";case"partially_failed":return"text-orange-600 bg-orange-50 border-orange-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},f=I=>{switch(I){case"pending":return e.jsx(ms,{size:16});case"passed":return e.jsx(yt,{size:16});case"failed":return e.jsx(Fs,{size:16});case"partially_failed":return e.jsx(Ht,{size:16});default:return e.jsx(ms,{size:16})}},y=I=>new Date(I).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return c?e.jsx("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading diagnostic request..."})]})}):u?e.jsxs("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs(X,{onClick:()=>a("/diagnostics/assigned"),className:"flex items-center gap-2",children:[e.jsx(zs,{size:20}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Diagnostic Request"})]})}),e.jsxs(he,{className:"p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:u.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["Created: ",y(u.created_at)]}),u.created_by_user&&e.jsxs("span",{children:["By: ",u.created_by_user.name]}),u.assigned_to_user&&e.jsxs("span",{children:["Assigned to: ",u.assigned_to_user.name]})]})]}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium border ${b(u.status)}`,children:[f(u.status),u.status.replace("_"," ")]})]}),u.notes&&e.jsx("p",{className:"text-gray-600 mb-4",children:u.notes})]}),e.jsxs(he,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Devices (",((N=u.devices)==null?void 0:N.length)||0,")"]}),!u.devices||u.devices.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ft,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No devices in this request"})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:u.devices.map((I,R)=>e.jsx(Ox,{device:I,request:u,showDetails:!0},I.id||`device-${u.id}-${R}`))})]})]}):e.jsx("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto",children:e.jsx(he,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Request Not Found"}),e.jsx("p",{className:"text-gray-600",children:"The diagnostic request you're looking for doesn't exist."})]})})})},Ro=()=>{const{requestId:r,deviceId:a}=ka(),i=hs(),{currentUser:c}=Wt(),[m,u]=g.useState(!0),[x,j]=g.useState(null),[b,f]=g.useState(null),[y,N]=g.useState(null),[I,R]=g.useState([]),[k,E]=g.useState(!1),[v,U]=g.useState({});g.useEffect(()=>{r&&a&&F()},[r,a]);const F=async()=>{var se;u(!0);try{const q=await gl(r);if(!q){te.error("Diagnostic request not found"),i("/diagnostics/assigned");return}j(q);const H=(se=q.devices)==null?void 0:se.find(He=>He.id===a);if(!H){te.error("Device not found in request"),i("/diagnostics/assigned");return}f(H);const J=L(H.device_name),V=await Ic(J);N(V);const ge=await qi(a);R(ge)}catch(q){console.error("Error loading diagnostic data:",q),te.error("Failed to load diagnostic data")}finally{u(!1)}},L=se=>{const q=se.toLowerCase();return q.includes("laptop")||q.includes("notebook")?"laptop":q.includes("printer")||q.includes("print")?"printer":q.includes("monitor")||q.includes("screen")?"monitor":q.includes("desktop")||q.includes("pc")?"desktop":q.includes("tablet")||q.includes("ipad")?"tablet":q.includes("phone")||q.includes("mobile")?"phone":"other"},C=se=>{if(!se)return e.jsx(Ft,{className:"h-5 w-5"});const q=se.toLowerCase();return q.includes("laptop")||q.includes("notebook")?e.jsx(Aa,{className:"h-5 w-5"}):q.includes("printer")||q.includes("print")?e.jsx(ra,{className:"h-5 w-5"}):q.includes("monitor")||q.includes("screen")?e.jsx(xr,{className:"h-5 w-5"}):q.includes("desktop")||q.includes("pc")?e.jsx(xr,{className:"h-5 w-5"}):q.includes("tablet")||q.includes("ipad")?e.jsx(Ea,{className:"h-5 w-5"}):q.includes("phone")||q.includes("mobile")?e.jsx(ns,{className:"h-5 w-5"}):e.jsx(Ft,{className:"h-5 w-5"})},$=se=>{switch(se){case"pending":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"passed":return"text-green-600 bg-green-50 border-green-200";case"failed":return"text-red-600 bg-red-50 border-red-200";case"partially_failed":return"text-orange-600 bg-orange-50 border-orange-200";case"submitted":return"text-purple-600 bg-purple-50 border-purple-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},Y=async(se,q,H)=>{E(!0);try{const J=I.find(He=>He.test_item===se),V={test_item:se,result:q,remarks:H};J?await V0(J.id,V):await q0(a,V);const ge=await qi(a);R(ge),te.success(`Check result saved: ${q}`)}catch(J){console.error("Error saving check result:",J),te.error("Failed to save check result")}finally{E(!1)}},A=async()=>{E(!0);try{const se=(y==null?void 0:y.checklist_items.length)||0,q=I.filter(ge=>ge.result==="passed").length,H=I.filter(ge=>ge.result==="failed").length,J=I.filter(ge=>ge.result==="passed"||ge.result==="failed").length;let V="pending";J===se&&se>0&&(H===0?V="passed":q===0?V="failed":V="partially_failed"),await Si(a,{result_status:V}),V==="passed"?(await Si(a,{result_status:"sent_to_care"}),await wo(r,{status:"completed"}),te.success("All tests passed! Device sent to customer care.")):(await Si(a,{result_status:"submitted_for_review",submitted_at:new Date().toISOString()}),await wo(r,{status:"submitted_for_review"}),te.success("Diagnostic completed. Results sent to admin for review.")),i("/diagnostics/assigned")}catch(se){console.error("Error completing diagnosis:",se),te.error("Failed to complete diagnosis")}finally{E(!1)}},Z=se=>{var q;return(q=I.find(H=>H.test_item===se))==null?void 0:q.result},_=se=>{var q;return(q=I.find(H=>H.test_item===se))==null?void 0:q.remarks};if(m)return e.jsx("div",{className:"p-4 sm:p-6 max-w-4xl mx-auto",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading diagnostic device..."})]})});if(!x||!b||!y)return e.jsx("div",{className:"p-4 sm:p-6 max-w-4xl mx-auto",children:e.jsx(he,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Device Not Found"}),e.jsx("p",{className:"text-gray-600",children:"The requested diagnostic device could not be found."})]})})});const D=I.filter(se=>se.result==="passed"||se.result==="failed").length,T=y.checklist_items.length,z=T>0?D/T*100:0;return e.jsxs("div",{className:"p-4 sm:p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs(X,{onClick:()=>i("/diagnostics/assigned"),className:"flex items-center gap-2",children:[e.jsx(zs,{size:20}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Device Diagnosis"})]}),e.jsxs(he,{className:"p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[C(b.device_name),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:b.device_name}),b.model&&e.jsx("p",{className:"text-gray-600",children:b.model}),b.serial_number&&e.jsxs("p",{className:"text-sm text-gray-500",children:["S/N: ",b.serial_number]})]})]}),e.jsx("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium border ${$(b.result_status)}`,children:b.result_status.replace("_"," ")})]}),b.notes&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(Bs,{size:16}),e.jsx("span",{className:"font-medium",children:"Notes:"})]}),e.jsx("p",{className:"text-blue-700 mt-1",children:b.notes})]})]}),e.jsxs(he,{className:"p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Progress: ",D," / ",T," checks completed"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[Math.round(z),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all duration-300",style:{width:`${z}%`}})})]})]}),e.jsxs(he,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Diagnostic Checklist"}),e.jsx("div",{className:"space-y-4",children:y.checklist_items.map(se=>{const q=Z(se.id),H=_(se.id),J=v[se.id]||H||"";return e.jsxs("div",{className:`border rounded-lg p-4 transition-all duration-200 ${q==="passed"?"bg-green-50 border-green-200":q==="failed"?"bg-red-50 border-red-200":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:se.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:se.description})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs(X,{onClick:()=>Y(se.id,"passed",J),disabled:k,className:`flex items-center gap-2 ${q==="passed"?"bg-green-500 hover:bg-green-600 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:[e.jsx(yt,{size:16}),"Pass"]}),e.jsxs(X,{onClick:()=>Y(se.id,"failed",J),disabled:k,className:`flex items-center gap-2 ${q==="failed"?"bg-red-500 hover:bg-red-600 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:[e.jsx(Fs,{size:16}),"Fail"]})]})]}),H&&e.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Bs,{size:14,className:"text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Remarks:"})]}),e.jsx("p",{className:"text-sm text-yellow-700",children:H})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Remarks (optional)"}),e.jsx("textarea",{value:J,onChange:V=>U(ge=>({...ge,[se.id]:V.target.value})),placeholder:"Add notes about this test...",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]})]},se.id)})}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx(X,{onClick:()=>i("/diagnostics/assigned"),className:"flex items-center gap-2",children:"Cancel"}),e.jsxs(X,{onClick:A,disabled:k||D===0,className:"flex items-center gap-2",children:[k?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsx(Lr,{size:20}),k?"Processing...":"Complete Diagnosis"]})]})]})]})},cr={REPAIR:"repair",REPLACE:"replace",IGNORE:"ignore",ESCALATE:"escalate"},Px=({device:r,isOpen:a,onClose:i,onSuccess:c})=>{const[m,u]=g.useState(""),[x,j]=g.useState(""),[b,f]=g.useState(!1),y=v=>{switch(v){case cr.REPAIR:return`Device requires repair work. Please assess the following issues:

• ${r.device_name} has failed diagnostic tests
• Technician should perform detailed repair assessment
• Check for available parts and repair feasibility
• Estimate repair time and cost`;case cr.REPLACE:return`Device should be replaced due to diagnostic failures. Consider the following:

• ${r.device_name} has multiple critical failures
• Repair cost may exceed device value
• Check warranty status and replacement options
• Recommend suitable replacement model`;case cr.IGNORE:return`No action required for this device. Reasoning:

• ${r.device_name} has minor issues that don't affect functionality
• Device is working within acceptable parameters
• No immediate repair or replacement needed
• Monitor for future issues`;case cr.ESCALATE:return`Device requires escalation to senior technician or management. Issues:

• ${r.device_name} has complex technical problems
• Requires specialized expertise or equipment
• May need manufacturer support or warranty claim
• Decision needed on repair vs replacement`;default:return""}},N=v=>{u(v),j(y(v))},I=async v=>{if(v.preventDefault(),!m){te.error("Please select a next action");return}if(!x.trim()){te.error("Please provide feedback notes");return}f(!0);try{if(await Y0({device_id:r.id,next_action:m,admin_feedback:x.trim()})){const F={[cr.REPAIR]:'Device status updated to "Repair Required"',[cr.REPLACE]:'Device status updated to "Replacement Required"',[cr.IGNORE]:'Device status updated to "No Action Required"',[cr.ESCALATE]:'Device status updated to "Escalated"'};te.success(F[m]||"Action assigned successfully"),c(),i(),u(""),j("")}}catch(U){console.error("Error submitting feedback:",U)}finally{f(!1)}},R=()=>{b||(i(),u(""),j(""))},k=v=>{switch(v){case cr.REPAIR:return e.jsx(Ss,{className:"h-4 w-4"});case cr.REPLACE:return e.jsx(us,{className:"h-4 w-4"});case cr.IGNORE:return e.jsx(cs,{className:"h-4 w-4"});case cr.ESCALATE:return e.jsx(js,{className:"h-4 w-4"});default:return e.jsx(Ht,{className:"h-4 w-4"})}},E=v=>{switch(v){case cr.REPAIR:return"text-orange-600 bg-orange-50 border-orange-200";case cr.REPLACE:return"text-red-600 bg-red-50 border-red-200";case cr.IGNORE:return"text-gray-600 bg-gray-50 border-gray-200";case cr.ESCALATE:return"text-purple-600 bg-purple-50 border-purple-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs(he,{className:"w-full max-w-2xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Admin Feedback & Action"}),e.jsx(X,{onClick:R,disabled:b,className:"p-1 text-gray-500 hover:text-gray-700",children:e.jsx(tr,{size:20})})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:r.device_name}),r.model&&e.jsx("p",{className:"text-sm text-gray-600",children:r.model}),r.serial_number&&e.jsxs("p",{className:"text-xs text-gray-500",children:["S/N: ",r.serial_number]}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${r.result_status==="failed"?"text-red-600 bg-red-50 border border-red-200":"text-orange-600 bg-orange-50 border border-orange-200"}`,children:[e.jsx(Ht,{size:12}),r.result_status.replace("_"," ")]})})]}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Next Action *"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(cr).map(([v,U])=>e.jsxs("button",{type:"button",onClick:()=>N(U),className:`flex items-center gap-2 p-3 border rounded-lg transition-all duration-200 ${m===U?`${E(U)} border-2`:"border-gray-200 hover:border-gray-300 bg-white"}`,children:[k(U),e.jsx("span",{className:"font-medium",children:v.charAt(0).toUpperCase()+v.slice(1).toLowerCase()})]},U))})]}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"h-3 w-3 text-orange-500"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Repair:"})," Device needs repair work by technician"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-3 w-3 text-red-500"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Replace:"})," Device should be replaced due to failures"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"h-3 w-3 text-gray-500"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Ignore:"})," No action required, device is acceptable"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-3 w-3 text-purple-500"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Escalate:"})," Requires senior technician or management review"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Feedback Notes *"}),e.jsx("textarea",{value:x,onChange:v=>j(v.target.value),placeholder:"Provide detailed feedback and instructions for the technician...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:6,required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx(X,{type:"button",onClick:R,disabled:b,variant:"secondary",children:"Cancel"}),e.jsxs(X,{type:"submit",disabled:b||!m,className:"flex items-center gap-2",children:[b?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(Tr,{className:"h-4 w-4"}),b?"Submitting...":"Submit Action"]})]})]})]})}):null},Lo=()=>{const r=hs(),{currentUser:a}=Wt(),[i,c]=g.useState(!0),[m,u]=g.useState([]),[x,j]=g.useState(null),[b,f]=g.useState(""),[y,N]=g.useState("all"),[I,R]=g.useState("all"),[k,E]=g.useState(null),[v,U]=g.useState(!1);if(!a||a.role!=="admin")return e.jsx("div",{className:"p-4 sm:p-6 max-w-4xl mx-auto",children:e.jsx(he,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"This page is only available for administrators."})]})})});g.useEffect(()=>{F()},[]);const F=async()=>{c(!0);try{const z={...y!=="all"&&{status:y}},[se,q]=await Promise.all([En(z),fl()]);u(se),j(q)}catch(z){console.error("Error loading diagnostic data:",z),te.error("Failed to load diagnostic data")}finally{c(!1)}},L=m.filter(z=>{var H,J;const se=z.title.toLowerCase().includes(b.toLowerCase())||((H=z.notes)==null?void 0:H.toLowerCase().includes(b.toLowerCase())),q=I==="all"||((J=z.devices)==null?void 0:J.some(V=>V.result_status===I));return se&&q}),C=z=>{if(!z)return e.jsx(Ft,{className:"h-4 w-4"});const se=z.toLowerCase();return se.includes("laptop")||se.includes("notebook")?e.jsx(Aa,{className:"h-4 w-4"}):se.includes("printer")||se.includes("print")?e.jsx(ra,{className:"h-4 w-4"}):se.includes("monitor")||se.includes("screen")?e.jsx(xr,{className:"h-4 w-4"}):se.includes("desktop")||se.includes("pc")?e.jsx(xr,{className:"h-4 w-4"}):se.includes("tablet")||se.includes("ipad")?e.jsx(Ea,{className:"h-4 w-4"}):se.includes("phone")||se.includes("mobile")?e.jsx(ns,{className:"h-4 w-4"}):e.jsx(Ft,{className:"h-4 w-4"})},$=z=>{switch(z){case"pending":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"in_progress":return"text-blue-600 bg-blue-50 border-blue-200";case"submitted_for_review":return"text-purple-600 bg-purple-50 border-purple-200";case"completed":return"text-green-600 bg-green-50 border-green-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},Y=z=>{if(!z)return"text-gray-600 bg-gray-50 border-gray-200";switch(z){case"passed":return"text-green-600 bg-green-50 border-green-200";case"failed":return"text-red-600 bg-red-50 border-red-200";case"partially_failed":return"text-orange-600 bg-orange-50 border-orange-200";case"pending":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"submitted_for_review":return"text-purple-600 bg-purple-50 border-purple-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},A=z=>new Date(z).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Z=z=>{r(`/diagnostics/request/${z}`)},_=z=>{E(z),U(!0)},D=()=>{F()},T=()=>{te.info("Export feature coming soon")};return e.jsxs("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Diagnostic Reports"}),e.jsx("p",{className:"text-gray-600",children:"Review all diagnostic results and assign follow-up actions"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(X,{onClick:T,className:"flex items-center gap-2",children:[e.jsx(Br,{size:20}),"Export"]})})]}),x&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[e.jsxs(he,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:x.total_requests}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Requests"})]}),e.jsxs(he,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:x.passed_devices}),e.jsx("div",{className:"text-sm text-gray-600",children:"Passed Devices"})]}),e.jsxs(he,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:x.failed_devices}),e.jsx("div",{className:"text-sm text-gray-600",children:"Failed Devices"})]}),e.jsxs(he,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:x.partially_failed_devices}),e.jsx("div",{className:"text-sm text-gray-600",children:"Partial Failures"})]}),e.jsxs(he,{className:"p-4 text-center bg-purple-50 border-purple-200",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:m.reduce((z,se)=>{var q;return z+(((q=se.devices)==null?void 0:q.filter(H=>H.result_status==="submitted_for_review").length)||0)},0)}),e.jsx("div",{className:"text-sm text-purple-600 font-medium",children:"Needs Review"})]})]})]}),e.jsx(he,{className:"p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Cr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search requests or devices...",value:b,onChange:z=>f(z.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:y,onChange:z=>N(z.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"submitted_for_review",children:"Submitted for Review"}),e.jsx("option",{value:"completed",children:"Completed"})]}),e.jsxs("select",{value:I,onChange:z=>R(z.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Results"}),e.jsx("option",{value:"passed",children:"Passed"}),e.jsx("option",{value:"failed",children:"Failed"}),e.jsx("option",{value:"partially_failed",children:"Partially Failed"}),e.jsx("option",{value:"submitted_for_review",children:"Needs Review"})]}),e.jsxs(X,{onClick:F,className:"flex items-center gap-2",children:[e.jsx(Rr,{size:16}),"Refresh"]})]})]})}),i?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading diagnostic reports..."})]}):L.length===0?e.jsxs(he,{className:"p-8 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(zr,{size:48,className:"mx-auto"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Diagnostic Reports"}),e.jsx("p",{className:"text-gray-600",children:b||y!=="all"||I!=="all"?"No reports match your current filters.":"No diagnostic reports available."})]}):e.jsx("div",{className:"space-y-4",children:L.map(z=>{var se,q,H;return e.jsxs(he,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:z.title}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${$(z.status)}`,children:z.status.replace("_"," ")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Created by: ",e.jsx("span",{className:"font-medium",children:((se=z.created_by_user)==null?void 0:se.name)||"Unknown"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Assigned to: ",e.jsx("span",{className:"font-medium",children:((q=z.assigned_to_user)==null?void 0:q.name)||"Unassigned"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ws,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Created: ",e.jsx("span",{className:"font-medium",children:A(z.created_at)})]})]})]}),z.notes&&e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",z.notes]})}),z.devices&&z.devices.length>0&&e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(yt,{className:"h-4 w-4 text-green-500"}),e.jsxs("span",{className:"text-green-600",children:[z.passed_devices||0," passed"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fs,{className:"h-4 w-4 text-red-500"}),e.jsxs("span",{className:"text-red-600",children:[z.failed_devices||0," failed"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ht,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("span",{className:"text-yellow-600",children:[z.pending_devices||0," pending"]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2 ml-4",children:e.jsxs(X,{onClick:()=>Z(z.id),className:"flex items-center gap-2",children:[e.jsx(cs,{className:"h-4 w-4"}),"View Details"]})})]}),((H=z.devices)==null?void 0:H.filter(J=>J.result_status==="submitted_for_review").length)>0&&e.jsxs("div",{className:"mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-purple-900 mb-3",children:"Devices Needing Review:"}),e.jsx("div",{className:"space-y-2",children:z.devices.filter(J=>J.result_status==="submitted_for_review").map(J=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[C(J.device_name),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-900",children:J.device_name}),J.serial_number&&e.jsxs("p",{className:"text-sm text-gray-500",children:["S/N: ",J.serial_number]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${Y(J.result_status)}`,children:J.result_status.replace("_"," ")}),e.jsxs(X,{onClick:()=>_(J),className:"flex items-center gap-2 px-3 py-1 text-sm",children:[e.jsx(Ss,{className:"h-3 w-3"}),"Review"]})]})]},J.id))})]})]},z.id)})}),k&&e.jsx(Px,{device:k,isOpen:v,onClose:()=>{U(!1),E(null)},onSuccess:D})]})},Fx=()=>{const r=hs(),{currentUser:a}=Wt(),[i,c]=g.useState([]),[m,u]=g.useState(!0),[x,j]=g.useState(null),[b,f]=g.useState(!1),[y,N]=g.useState({device_type:"",checklist_items:[]});g.useEffect(()=>{I()},[]);const I=async()=>{u(!0);try{const $=await Tc();c($)}catch($){console.error("Error loading templates:",$),te.error("Failed to load diagnostic templates")}finally{u(!1)}},R=$=>{switch($.toLowerCase()){case"laptop":return e.jsx(Aa,{className:"h-5 w-5"});case"printer":return e.jsx(ra,{className:"h-5 w-5"});case"monitor":return e.jsx(xr,{className:"h-5 w-5"});case"desktop":return e.jsx(xr,{className:"h-5 w-5"});case"tablet":return e.jsx(Ea,{className:"h-5 w-5"});case"phone":return e.jsx(ns,{className:"h-5 w-5"});default:return e.jsx(Ft,{className:"h-5 w-5"})}},k=$=>{j($)},E=async $=>{try{await H0($.id,{device_type:$.device_type,checklist_items:$.checklist_items}),te.success("Template updated successfully"),j(null),I()}catch(Y){console.error("Error updating template:",Y),te.error("Failed to update template")}},v=async $=>{if(confirm("Are you sure you want to delete this template?"))try{await W0($),te.success("Template deleted successfully"),I()}catch(Y){console.error("Error deleting template:",Y),te.error("Failed to delete template")}},U=async()=>{if(!y.device_type.trim()){te.error("Please enter a device type");return}if(y.checklist_items.length===0){te.error("Please add at least one checklist item");return}try{await G0(y),te.success("Template created successfully"),f(!1),N({device_type:"",checklist_items:[]}),I()}catch($){console.error("Error creating template:",$),te.error("Failed to create template")}},F=$=>{const Y={id:`item_${Date.now()}`,name:"",description:""};x?j({...x,checklist_items:[...x.checklist_items,Y]}):N({...y,checklist_items:[...y.checklist_items,Y]})},L=($,Y)=>{x?j({...x,checklist_items:x.checklist_items.filter(A=>A.id!==Y)}):N({...y,checklist_items:y.checklist_items.filter(A=>A.id!==Y)})},C=($,Y,A,Z)=>{x?j({...x,checklist_items:x.checklist_items.map(_=>_.id===Y?{..._,[A]:Z}:_)}):N({...y,checklist_items:y.checklist_items.map(_=>_.id===Y?{..._,[A]:Z}:_)})};return!a||a.role!=="admin"?e.jsx("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto",children:e.jsx(he,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"This page is only available for administrators."})]})})}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(X,{onClick:()=>r("/diagnostics/reports"),className:"flex items-center gap-2",children:[e.jsx(zs,{size:20}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Diagnostic Templates"})]}),e.jsxs(X,{onClick:()=>f(!0),className:"flex items-center gap-2 bg-blue-500 hover:bg-blue-600 text-white",children:[e.jsx(Ut,{size:20}),"New Template"]})]}),e.jsx("p",{className:"text-gray-600",children:"Customize diagnostic checklists for different device types. These templates will be used when creating new diagnostic requests."})]}),b&&e.jsxs(he,{className:"p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Create New Template"}),e.jsxs(X,{onClick:()=>f(!1),className:"flex items-center gap-2",children:[e.jsx(tr,{size:20}),"Cancel"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Device Type"}),e.jsx("input",{type:"text",value:y.device_type,onChange:$=>N({...y,device_type:$.target.value}),placeholder:"e.g., laptop, printer, monitor",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Checklist Items"}),e.jsxs(X,{onClick:()=>F(),className:"flex items-center gap-2",children:[e.jsx(Ut,{size:16}),"Add Item"]})]}),e.jsx("div",{className:"space-y-3",children:y.checklist_items.map(($,Y)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Item ",Y+1]}),e.jsxs(X,{onClick:()=>L(y,$.id),className:"flex items-center gap-2 text-red-600 hover:text-red-700",children:[e.jsx(er,{size:16}),"Remove"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:$.name,onChange:A=>C(y,$.id,"name",A.target.value),placeholder:"e.g., Power Supply",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ID"}),e.jsx("input",{type:"text",value:$.id,onChange:A=>C(y,$.id,"id",A.target.value),placeholder:"e.g., power_supply",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:$.description,onChange:A=>C(y,$.id,"description",A.target.value),placeholder:"Describe what to check for this item...",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]})]},$.id))})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(X,{onClick:U,className:"flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white",children:[e.jsx(Hs,{size:16}),"Create Template"]})})]})]}),m?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading templates..."})]}):e.jsx("div",{className:"space-y-4",children:i.map($=>e.jsx(he,{className:"p-6",children:(x==null?void 0:x.id)===$.id?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[R($.device_type),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:$.device_type.charAt(0).toUpperCase()+$.device_type.slice(1)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(X,{onClick:()=>E(x),className:"flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white",children:[e.jsx(Hs,{size:16}),"Save"]}),e.jsxs(X,{onClick:()=>j(null),className:"flex items-center gap-2",children:[e.jsx(tr,{size:16}),"Cancel"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Checklist Items"}),e.jsxs(X,{onClick:()=>F(),className:"flex items-center gap-2",children:[e.jsx(Ut,{size:16}),"Add Item"]})]}),e.jsx("div",{className:"space-y-3",children:x.checklist_items.map((Y,A)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Item ",A+1]}),e.jsxs(X,{onClick:()=>L(x,Y.id),className:"flex items-center gap-2 text-red-600 hover:text-red-700",children:[e.jsx(er,{size:16}),"Remove"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:Y.name,onChange:Z=>C(x,Y.id,"name",Z.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ID"}),e.jsx("input",{type:"text",value:Y.id,onChange:Z=>C(x,Y.id,"id",Z.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:Y.description,onChange:Z=>C(x,Y.id,"description",Z.target.value),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]})]},Y.id))})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[R($.device_type),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:$.device_type.charAt(0).toUpperCase()+$.device_type.slice(1)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(X,{onClick:()=>k($),className:"flex items-center gap-2",children:[e.jsx(Ts,{size:16}),"Edit"]}),e.jsxs(X,{onClick:()=>v($.id),className:"flex items-center gap-2 text-red-600 hover:text-red-700",children:[e.jsx(er,{size:16}),"Delete"]})]})]}),e.jsx("div",{className:"space-y-2",children:$.checklist_items.map((Y,A)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-500 min-w-[60px]",children:[A+1,"."]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:Y.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:Y.description})]})]},Y.id))})]})},$.id))})]})},Oo=()=>{var J;const r=hs(),{currentUser:a}=Wt(),[i,c]=g.useState(!0),[m,u]=g.useState([]),[x,j]=g.useState(null),[b,f]=g.useState(""),[y,N]=g.useState("all"),[I,R]=g.useState("all"),[k,E]=g.useState(null),[v,U]=g.useState(!1),[F,L]=g.useState(!1);if(!a||!["admin","customer-care"].includes(a.role))return e.jsx("div",{className:"p-4 sm:p-6 max-w-4xl mx-auto",children:e.jsx(he,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You don't have permission to view diagnostic requests."})]})})});g.useEffect(()=>{Z(),C()},[y,I]);const C=()=>{if(!(a!=null&&a.id))return;const V=G.channel("customer-care-diagnostic-requests").on("postgres_changes",{event:"*",schema:"public",table:"diagnostic_requests",filter:`created_by=eq.${a.id}`},He=>{console.log("🔔 Diagnostic request update received:",He),$(He)}).subscribe(),ge=G.channel("customer-care-diagnostic-devices").on("postgres_changes",{event:"*",schema:"public",table:"diagnostic_devices"},He=>{console.log("🔔 Diagnostic device update received:",He),Y(He)}).subscribe();return()=>{V.unsubscribe(),ge.unsubscribe()}},$=V=>{var ge,He,B,fe;if(V.eventType==="UPDATE"){const re=V.new;if(u(ye=>ye.map(Q=>Q.id===re.id?{...Q,...re}:Q)),((ge=V.old)==null?void 0:ge.status)!==((He=V.new)==null?void 0:He.status)){const ye=z((B=V.new)==null?void 0:B.status);((fe=V.new)==null?void 0:fe.status)==="ready_for_customer_care"?te.success(`🎉 Device diagnostics completed! "${re.title}" is ready for customer care review.`,{icon:e.jsx(Mr,{className:"w-4 h-4"}),duration:6e3}):te.success(`Diagnostic request "${re.title}" status updated to ${ye}`,{icon:e.jsx(Mr,{className:"w-4 h-4"}),duration:4e3}),L(!0)}}else V.eventType==="INSERT"&&(Z(),te.success("New diagnostic request created!",{icon:e.jsx(Ut,{className:"w-4 h-4"}),duration:3e3}),L(!0))},Y=V=>{var ge,He,B;if(V.eventType==="UPDATE"){const fe=V.new;if(u(re=>re.map(ye=>ye)),((ge=V.old)==null?void 0:ge.result_status)!==((He=V.new)==null?void 0:He.result_status)){const re=A((B=V.new)==null?void 0:B.result_status);te.success(`Device "${fe.device_name}" status updated to ${re}`,{icon:e.jsx(ns,{className:"w-4 h-4"}),duration:4e3}),L(!0)}}},A=V=>{switch(V){case"pending":return"Pending";case"passed":return"Passed";case"failed":return"Failed";case"partially_failed":return"Partially Failed";case"submitted_for_review":return"Submitted for Review";case"ready_for_customer_care":return"Ready for Customer Care";case"repair_required":return"Repair Required";case"replacement_required":return"Replacement Required";case"no_action_required":return"No Action Required";case"escalated":return"Escalated";case"admin_reviewed":return"Admin Reviewed";default:return"Unknown"}},Z=async()=>{c(!0);try{const V={created_by:a.id};if(y!=="all"&&(V.status=y),I!=="all"){const B=new Date;let fe;switch(I){case"today":fe=new Date(B.getFullYear(),B.getMonth(),B.getDate());break;case"week":fe=new Date(B.getTime()-7*24*60*60*1e3);break;case"month":fe=new Date(B.getFullYear(),B.getMonth(),1);break;default:fe=new Date(0)}V.date_from=fe.toISOString()}const[ge,He]=await Promise.all([En(V),fl()]);u(ge),j(He),L(!1)}catch(V){console.error("Error loading diagnostic data:",V),te.error("Failed to load diagnostic data")}finally{c(!1)}},_=m.filter(V=>{var He,B;return V.title.toLowerCase().includes(b.toLowerCase())||((He=V.notes)==null?void 0:He.toLowerCase().includes(b.toLowerCase()))||((B=V.assigned_to_user)==null?void 0:B.name.toLowerCase().includes(b.toLowerCase()))}),D=V=>{switch(V){case"pending":return e.jsx(ms,{className:"h-5 w-5 text-yellow-500"});case"in_progress":return e.jsx(us,{className:"h-5 w-5 text-blue-500"});case"completed":return e.jsx(yt,{className:"h-5 w-5 text-green-500"});case"submitted_for_review":return e.jsx(cs,{className:"h-5 w-5 text-purple-500"});case"ready_for_customer_care":return e.jsx(_s,{className:"h-5 w-5 text-blue-500"});case"repair_required":return e.jsx(Ht,{className:"h-5 w-5 text-orange-500"});case"replacement_required":return e.jsx(us,{className:"h-5 w-5 text-red-500"});case"escalated":return e.jsx(js,{className:"h-5 w-5 text-purple-500"});case"no_action_required":return e.jsx(yt,{className:"h-5 w-5 text-gray-500"});case"admin_reviewed":return e.jsx(yt,{className:"h-5 w-5 text-blue-500"});default:return e.jsx(Ht,{className:"h-5 w-5 text-gray-500"})}},T=V=>{switch(V){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"in_progress":return"bg-blue-100 text-blue-800 border-blue-200";case"completed":return"bg-green-100 text-green-800 border-green-200";case"submitted_for_review":return"bg-purple-100 text-purple-800 border-purple-200";case"ready_for_customer_care":return"bg-blue-100 text-blue-800 border-blue-200";case"repair_required":return"bg-orange-100 text-orange-800 border-orange-200";case"replacement_required":return"bg-red-100 text-red-800 border-red-200";case"escalated":return"bg-purple-100 text-purple-800 border-purple-200";case"no_action_required":return"bg-gray-100 text-gray-800 border-gray-200";case"admin_reviewed":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},z=V=>{switch(V){case"pending":return"Pending";case"in_progress":return"In Progress";case"completed":return"Completed";case"submitted_for_review":return"Submitted for Review";case"ready_for_customer_care":return"Ready for Customer Care";case"repair_required":return"Repair Required";case"replacement_required":return"Replacement Required";case"escalated":return"Escalated";case"no_action_required":return"No Action Required";case"admin_reviewed":return"Admin Reviewed";default:return"Unknown"}},se=V=>new Date(V).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),q=V=>{E(V),U(!0)},H=()=>{Z(),te.success("Data refreshed")};return e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(X,{onClick:()=>r("/dashboard"),className:"flex items-center gap-2",children:[e.jsx(zs,{size:20}),"Back"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Diagnostic Requests"}),F&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",children:[e.jsx(Mr,{className:"w-4 h-4 animate-pulse"}),"Live Updates"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(X,{onClick:()=>r("/diagnostics/new"),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(Ut,{className:"w-4 h-4"}),"New Request"]}),e.jsxs(X,{onClick:H,className:"flex items-center gap-2",disabled:i,children:[e.jsx(us,{className:`w-4 h-4 ${i?"animate-spin":""}`}),i?"Refreshing...":"Refresh"]})]})]}),e.jsxs("p",{className:"text-gray-600",children:["View and track all diagnostic requests you've sent to technicians",F&&e.jsx("span",{className:"ml-2 text-green-600 font-medium",children:"• Real-time updates enabled"})]})]}),x&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(he,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ns,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Requests"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:x.totalRequests})]})]})}),e.jsx(he,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(ms,{className:"h-5 w-5 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:x.pendingRequests})]})]})}),e.jsx(he,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(us,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"In Progress"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:x.inProgressRequests})]})]})}),e.jsx(he,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(yt,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Completed"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:x.completedRequests})]})]})})]}),e.jsx(he,{className:"p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Cr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"text",placeholder:"Search requests...",value:b,onChange:V=>f(V.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:y,onChange:V=>N(V.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"ready_for_customer_care",children:"Ready for Customer Care"})]}),e.jsxs("select",{value:I,onChange:V=>R(V.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(X,{onClick:()=>r("/diagnostics/new"),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(Ut,{className:"h-4 w-4"}),"New Request"]}),e.jsxs(X,{onClick:H,className:"flex items-center gap-2",disabled:i,children:[e.jsx(us,{className:`h-4 w-4 ${i?"animate-spin":""}`}),"Refresh"]})]})]})}),_.filter(V=>V.status==="ready_for_customer_care").length>0&&e.jsxs(he,{className:"p-6 mb-6 border-2 border-blue-200 bg-blue-50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(_s,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:"Ready for Customer Care Review"}),e.jsxs("p",{className:"text-blue-700",children:[_.filter(V=>V.status==="ready_for_customer_care").length," device(s) completed diagnostics and ready for your review"]})]})]}),e.jsx("div",{className:"space-y-3",children:_.filter(V=>V.status==="ready_for_customer_care").map(V=>{var ge;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_s,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:V.title}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Completed by: ",((ge=V.assigned_to_user)==null?void 0:ge.name)||"Unknown"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(X,{onClick:()=>q(V),className:"flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white",children:[e.jsx(cs,{className:"h-4 w-4"}),"Review"]})})]},V.id)})})]}),e.jsx("div",{className:"space-y-4",children:i?e.jsx(he,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading diagnostic requests..."})]})}):_.length===0?e.jsx(he,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ns,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Diagnostic Requests"}),e.jsx("p",{className:"text-gray-600 mb-4",children:b||y!=="all"||I!=="all"?"No requests match your current filters.":"You haven't created any diagnostic requests yet."}),e.jsxs(X,{onClick:()=>r("/diagnostics/new"),className:"flex items-center gap-2",children:[e.jsx(Ut,{className:"h-4 w-4"}),"Create New Request"]})]})}):_.map(V=>{var ge;return e.jsx(he,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:V.title}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${T(V.status)}`,children:z(V.status)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Assigned to: ",e.jsx("span",{className:"font-medium",children:((ge=V.assigned_to_user)==null?void 0:ge.name)||"Unassigned"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Devices: ",e.jsx("span",{className:"font-medium",children:V.device_count||0})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ws,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Created: ",e.jsx("span",{className:"font-medium",children:se(V.created_at)})]})]})]}),V.notes&&e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",V.notes]})}),V.devices&&V.devices.length>0&&e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(yt,{className:"h-4 w-4 text-green-500"}),e.jsxs("span",{className:"text-green-600",children:[V.passed_devices||0," passed"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fs,{className:"h-4 w-4 text-red-500"}),e.jsxs("span",{className:"text-red-600",children:[V.failed_devices||0," failed"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ms,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("span",{className:"text-yellow-600",children:[V.pending_devices||0," pending"]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2 ml-4",children:e.jsxs(X,{onClick:()=>q(V),className:"flex items-center gap-2",variant:"secondary",children:[e.jsx(cs,{className:"h-4 w-4"}),"View Details"]})})]})},V.id)})}),v&&k&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Diagnostic Request Details"}),e.jsx("button",{onClick:()=>U(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(Fs,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Request Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Title"}),e.jsx("p",{className:"font-medium",children:k.title})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[D(k.status),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${T(k.status)}`,children:z(k.status)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Assigned To"}),e.jsx("p",{className:"font-medium",children:((J=k.assigned_to_user)==null?void 0:J.name)||"Unassigned"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Created"}),e.jsx("p",{className:"font-medium",children:se(k.created_at)})]})]}),k.notes&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Notes"}),e.jsx("p",{className:"font-medium",children:k.notes})]})]}),k.devices&&k.devices.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Devices"}),e.jsx("div",{className:"space-y-3",children:k.devices.map((V,ge)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:V.device_name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${V.result_status==="passed"?"bg-green-100 text-green-800 border-green-200":V.result_status==="failed"?"bg-red-100 text-red-800 border-red-200":V.result_status==="partially_failed"?"bg-yellow-100 text-yellow-800 border-yellow-200":"bg-gray-100 text-gray-800 border-gray-200"}`,children:V.result_status==="passed"?"Passed":V.result_status==="failed"?"Failed":V.result_status==="partially_failed"?"Partially Failed":"Pending"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600",children:[V.serial_number&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Serial:"})," ",V.serial_number]}),V.model&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Model:"})," ",V.model]})]}),V.notes&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-medium text-sm",children:"Notes:"}),e.jsx("p",{className:"text-sm text-gray-600",children:V.notes})]})]},V.id))})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-gray-200",children:[e.jsx(X,{onClick:()=>U(!1),variant:"secondary",children:"Close"}),e.jsx(X,{onClick:()=>{U(!1),r(`/diagnostics/request/${k.id}`)},children:"View Full Report"})]})]})})})]})},Bx=()=>{const{requestId:r,deviceName:a,model:i}=ka(),c=hs(),{currentUser:m}=Wt(),[u,x]=g.useState(!0),[j,b]=g.useState(null),[f,y]=g.useState([]),[N,I]=g.useState(null),[R,k]=g.useState({});g.useEffect(()=>{r&&a&&i&&E()},[r,a,i]);const E=async()=>{var D;x(!0);try{const T=await gl(r);if(!T){te.error("Diagnostic request not found"),c("/diagnostics/reports");return}b(T);const z=((D=T.devices)==null?void 0:D.filter(q=>q.device_name===a&&q.model===i))||[];if(y(z),z.length>0){const q=v(z[0].device_name),H=await Ic(q);I(H)}const se={};for(const q of z){const H=await qi(q.id);se[q.id]=H}k(se)}catch(T){console.error("Error loading diagnostic data:",T),te.error("Failed to load diagnostic data")}finally{x(!1)}},v=D=>{const T=D.toLowerCase();return T.includes("laptop")||T.includes("notebook")?"laptop":T.includes("printer")||T.includes("print")?"printer":T.includes("monitor")||T.includes("screen")?"monitor":T.includes("desktop")||T.includes("pc")?"desktop":T.includes("tablet")||T.includes("ipad")?"tablet":T.includes("phone")||T.includes("mobile")?"phone":"other"},U=D=>{if(!D)return e.jsx(Ft,{className:"h-6 w-6"});const T=D.toLowerCase();return T.includes("laptop")||T.includes("notebook")?e.jsx(Aa,{className:"h-6 w-6"}):T.includes("printer")||T.includes("print")?e.jsx(ra,{className:"h-6 w-6"}):T.includes("monitor")||T.includes("screen")?e.jsx(xr,{className:"h-6 w-6"}):T.includes("desktop")||T.includes("pc")?e.jsx(xr,{className:"h-6 w-6"}):T.includes("tablet")||T.includes("ipad")?e.jsx(Ea,{className:"h-6 w-6"}):T.includes("phone")||T.includes("mobile")?e.jsx(ns,{className:"h-6 w-6"}):e.jsx(Ft,{className:"h-6 w-6"})},F=D=>{switch(D){case"pending":return"text-yellow-700 bg-gradient-to-r from-yellow-50 to-orange-50 border-yellow-200";case"passed":return"text-green-700 bg-gradient-to-r from-green-50 to-emerald-50 border-green-200";case"failed":return"text-red-700 bg-gradient-to-r from-red-50 to-pink-50 border-red-200";case"partially_failed":return"text-orange-700 bg-gradient-to-r from-orange-50 to-amber-50 border-orange-200";case"submitted_for_review":return"text-purple-700 bg-gradient-to-r from-purple-50 to-indigo-50 border-purple-200";case"repair_complete":return"text-blue-700 bg-gradient-to-r from-blue-50 to-cyan-50 border-blue-200";case"repair_required":return"text-orange-700 bg-gradient-to-r from-orange-50 to-red-50 border-orange-200";case"replacement_required":return"text-red-700 bg-gradient-to-r from-red-50 to-pink-50 border-red-200";case"escalated":return"text-purple-700 bg-gradient-to-r from-purple-50 to-pink-50 border-purple-200";case"no_action_required":return"text-gray-700 bg-gradient-to-r from-gray-50 to-slate-50 border-gray-200";default:return"text-gray-700 bg-gradient-to-r from-gray-50 to-slate-50 border-gray-200"}},L=D=>{switch(D){case"passed":return e.jsx(yt,{className:"h-5 w-5"});case"failed":return e.jsx(Fs,{className:"h-5 w-5"});case"partially_failed":return e.jsx(Ht,{className:"h-5 w-5"});case"repair_required":return e.jsx(Ss,{className:"h-5 w-5"});case"replacement_required":return e.jsx(us,{className:"h-5 w-5"});case"escalated":return e.jsx(js,{className:"h-5 w-5"});case"no_action_required":return e.jsx(cs,{className:"h-5 w-5"});default:return e.jsx(fr,{className:"h-5 w-5"})}},C=D=>{switch(D){case"submitted_for_review":return"Review";case"partially_failed":return"Partial";case"repair_complete":return"Repaired";case"repair_required":return"Repair Required";case"replacement_required":return"Replacement Required";case"escalated":return"Escalated";case"no_action_required":return"No Action Required";default:return D.replace("_"," ")}},$=D=>{const z=(R[D.id]||[]).length,se=D.check_count||z;return`${z}/${se} tests completed`},Y=D=>{const z=(R[D.id]||[]).length,se=D.check_count||z;return se>0?z/se*100:0},A=D=>D===100?"bg-gradient-to-r from-green-500 to-emerald-500":D>=50?"bg-gradient-to-r from-blue-500 to-cyan-500":D>0?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-gray-300 to-gray-400",Z=D=>{const T=D.diagnostic_device_id||D.id||D.device_id;r&&T&&c(`/diagnostics/device/${r}/${T}`)},_=D=>{const T=D.result_status||"pending";return(m==null?void 0:m.role)==="admin"?T==="submitted_for_review"?e.jsxs(X,{onClick:()=>Z(D),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white text-sm",children:[e.jsx(cs,{className:"h-4 w-4"}),"Review"]}):T==="failed"||T==="partially_failed"?e.jsxs(X,{onClick:()=>Z(D),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white text-sm",children:[e.jsx(Ht,{className:"h-4 w-4"}),"Assess"]}):T==="repair_required"?e.jsxs(X,{onClick:()=>Z(D),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white text-sm",children:[e.jsx(Ss,{className:"h-4 w-4"}),"Repair Assigned"]}):T==="replacement_required"?e.jsxs(X,{onClick:()=>Z(D),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white text-sm",children:[e.jsx(us,{className:"h-4 w-4"}),"Replacement Assigned"]}):T==="escalated"?e.jsxs(X,{onClick:()=>Z(D),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white text-sm",children:[e.jsx(js,{className:"h-4 w-4"}),"Escalated"]}):T==="no_action_required"?e.jsxs(X,{onClick:()=>Z(D),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white text-sm",children:[e.jsx(cs,{className:"h-4 w-4"}),"No Action Required"]}):e.jsxs(X,{onClick:()=>Z(D),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white text-sm",children:[e.jsx(cs,{className:"h-4 w-4"}),"View"]}):(m==null?void 0:m.role)==="technician"?T==="pending"?e.jsxs(X,{onClick:()=>Z(D),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white text-sm",children:[e.jsx(xn,{className:"h-4 w-4"}),"Start Tests"]}):T==="in_progress"||T==="partially_failed"?e.jsxs(X,{onClick:()=>Z(D),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white text-sm",children:[e.jsx(fr,{className:"h-4 w-4"}),"Continue"]}):T==="repair_required"||D.admin_feedback&&D.next_action==="repair"?e.jsxs(X,{onClick:()=>Z(D),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white text-sm",children:[e.jsx(Ss,{className:"h-4 w-4"}),"Repair Required"]}):T==="replacement_required"?e.jsxs(X,{onClick:()=>Z(D),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white text-sm",children:[e.jsx(us,{className:"h-4 w-4"}),"Replacement Required"]}):T==="escalated"?e.jsxs(X,{onClick:()=>Z(D),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white text-sm",children:[e.jsx(js,{className:"h-4 w-4"}),"Escalated"]}):T==="no_action_required"?e.jsxs(X,{onClick:()=>Z(D),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white text-sm",children:[e.jsx(cs,{className:"h-4 w-4"}),"No Action Required"]}):e.jsxs(X,{onClick:()=>Z(D),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white text-sm",children:[e.jsx(cs,{className:"h-4 w-4"}),"View"]}):e.jsxs(X,{onClick:()=>Z(D),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white text-sm",children:[e.jsx(cs,{className:"h-4 w-4"}),"View"]})};return u?e.jsx("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading grouped devices..."})]})}):!j||f.length===0?e.jsx("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto",children:e.jsx(he,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Devices Not Found"}),e.jsx("p",{className:"text-gray-600",children:"The requested grouped devices could not be found."})]})})}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs(X,{onClick:()=>c((m==null?void 0:m.role)==="admin"?"/diagnostics/reports":"/diagnostics/assigned"),className:"flex items-center gap-2",children:[e.jsx(zs,{size:20}),"Back"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[a," - ",i]}),e.jsx("p",{className:"text-gray-600",children:j.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[f.length," device",f.length>1?"s":""]}),j.assigned_to_user&&e.jsxs("span",{className:"text-sm text-blue-600",children:["• Technician: ",j.assigned_to_user.name]})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map((D,T)=>e.jsxs(he,{className:"p-6 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-100 to-purple-100 flex items-center justify-center border-2 border-blue-200",children:U(D.device_name)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:D.serial_number||`Device ${T+1}`}),e.jsxs("p",{className:"text-sm text-gray-600",children:["#",T+1]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[D.admin_feedback&&e.jsxs("div",{className:"relative",children:[e.jsx(js,{className:"h-4 w-4 text-blue-600"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full animate-ping"})]}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium border ${F(D.result_status||"pending")}`,children:[L(D.result_status||"pending"),e.jsx("span",{className:"capitalize",children:C(D.result_status||"pending")})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Progress"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:$(D)})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ease-out ${A(Y(D))}`,style:{width:`${Y(D)}%`}})})})]}),D.admin_feedback&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(js,{size:14,className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Admin Feedback:"})]}),e.jsx("p",{className:"text-sm text-blue-700 line-clamp-2",children:D.admin_feedback}),D.next_action&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:"text-xs font-medium text-blue-600",children:"Action:"}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${D.next_action==="repair"?"bg-orange-100 text-orange-700":D.next_action==="replace"?"bg-red-100 text-red-700":D.next_action==="ignore"?"bg-gray-100 text-gray-700":"bg-purple-100 text-purple-700"}`,children:D.next_action.charAt(0).toUpperCase()+D.next_action.slice(1)})]})]}),e.jsx("div",{className:"flex justify-center",children:_(D)})]},D.id||T))})]})},zx=()=>{const{currentUser:r}=Wt(),a=hs(),i=g.useMemo(()=>({Smartphone:ns,UserPlus:Ca,Package:Ft,BarChart3:zr,Zap:Kr,Settings:Fr,ShoppingCart:Kd,RotateCcw:Zi,PieChart:Qi,MessageCircle:Xr,Database:Ar,Target:Cn,Navigation:Xd,FileText:pr,Cog:Vo,Stethoscope:Nr,Upload:Lr}),[]),c=g.useCallback(E=>i[E]||Fr,[i]),m=E=>E.requiresPermission?r?E.requiresPermission==="customer"?r.role==="customer-care":E.requiresPermission==="admin"?r.role==="admin":r.role==="admin"||E.requiresPermission==="all":!1:!0,u=[{id:"new-device",name:"New Device",description:"Add new device for repair",icon:"Smartphone",path:"/devices/new",color:"bg-blue-500 hover:bg-blue-600",isEnabled:!0,order:1,category:"action",requiresPermission:"customer"},{id:"request-diagnostics",name:"Request Diagnostics",description:"Submit devices for diagnostic testing",icon:"Stethoscope",path:"/diagnostics/new",color:"bg-purple-500 hover:bg-purple-600",isEnabled:!0,order:2,category:"action",requiresPermission:"customer"},{id:"inventory-management",name:"Inventory",description:"Manage products and stock",icon:"Package",path:"/inventory",color:"bg-indigo-500 hover:bg-indigo-600",isEnabled:!0,order:3,category:"navigation"},{id:"customer-hub",name:"Customer Hub",description:"Manage customer hub",icon:"UserPlus",path:"/customers",color:"bg-green-500 hover:bg-green-600",isEnabled:!0,order:4,category:"navigation"},{id:"import-customers",name:"Import Customers",description:"Import customers from Excel",icon:"Upload",path:"/customers/import",color:"bg-emerald-500 hover:bg-emerald-600",isEnabled:!0,order:5,category:"action",requiresPermission:"customer"},{id:"view-inventory",name:"View Inventory",description:"Check stock levels",icon:"Package",path:"/inventory",color:"bg-purple-500 hover:bg-purple-600",isEnabled:!0,order:6,category:"navigation"},{id:"sales-report",name:"Sales Report",description:"View sales analytics",icon:"BarChart3",path:"/sales-report",color:"bg-orange-500 hover:bg-orange-600",isEnabled:!0,order:7,category:"report"},{id:"settings",name:"Settings",description:"System configuration",icon:"Settings",path:"/settings",color:"bg-gray-500 hover:bg-gray-600",isEnabled:!0,order:9,category:"settings"}],x=g.useMemo(()=>u.filter(E=>!(!E.isEnabled||!m(E))).sort((E,v)=>E.order-v.order).slice(0,12).map(E=>({...E,iconComponent:c(E.icon),action:()=>a(E.path)})),[r==null?void 0:r.id,a,c]);return{quickActions:x,getActionsByCategory:E=>x.filter(v=>v.category===E),getLayoutConfig:()=>({layout:"grid",showDescriptions:!0,showIcons:!0,allowDragDrop:!0,autoHide:!1,hideThreshold:6}),shouldHideQuickActions:()=>!1,getGridClasses:()=>"grid-cols-2 md:grid-cols-3 lg:grid-cols-6",getActionButtonClasses:(E,v=!1)=>{const U=`${E.color} text-white rounded-lg hover:shadow-lg transition-all duration-200 group`;return v?`${U} p-2`:`${U} p-4`},getIconSize:()=>20,getTextSize:()=>"text-sm",shouldShowDescription:E=>!0,isEnabled:!0,totalActions:u.length,enabledActions:x.length}},Gs=r=>{if(r===null||typeof r!="object")return r;if(Array.isArray(r))return r.map(Gs);const a={};for(const[i,c]of Object.entries(r))if(i==="assigned_to")a[i]=Gs(c);else if(i==="diagnosis_required")a.diagnosisRequired=typeof c=="boolean"?c:c==null?null:!!c;else{const m=i.replace(/_([a-z])/g,(u,x)=>x.toUpperCase());a[m]=Gs(c)}return a},Jn=r=>{if(r===null||typeof r!="object")return r;if(Array.isArray(r))return r.map(Jn);const a={};for(const[i,c]of Object.entries(r)){const m=i.replace(/[A-Z]/g,u=>`_${u.toLowerCase()}`);a[m]=Jn(c)}return a},Ux=["id","customer_id","brand","model","serial_number","issue_description","status","assigned_to","estimated_hours","expected_return_date","created_at","updated_at","device_type","priority_level","issue_type","repair_cost","labor_cost","parts_cost","deposit_amount","payment_status","symptoms","possible_causes","additional_notes","issue_confirmed","physical_check","diagnosis_required"];function $x(r){const a={};for(const i of Ux)r[i]!==void 0&&(a[i]=r[i]);return a}const ki={async getAllDevices(){try{console.log("🔍 deviceServices.getAllDevices() called");const{data:r,error:a}=await G.from("devices").select(`
          id,
          customer_id,
          brand,
          model,
          serial_number,
          issue_description,
          status,
          assigned_to,
          estimated_hours,
          expected_return_date,
          created_at,
          updated_at,
          customers(*),
          device_checklists(*),
          device_remarks(*),
          device_transitions(*),
          device_ratings(*)
        `).order("created_at",{ascending:!1});if(a)throw console.error("❌ Database error:",a),new Error(`Failed to fetch devices: ${a.message}`);return console.log("📱 Database query successful, devices found:",(r==null?void 0:r.length)||0),(r==null?void 0:r.map(Gs))||[]}catch(r){throw console.error("❌ Network error in getAllDevices:",r),new Error("Network error: Unable to connect to database")}},async getDeviceById(r){try{const{data:a,error:i}=await G.from("devices").select(`
          id,
          customer_id,
          brand,
          model,
          serial_number,
          issue_description,
          status,
          assigned_to,
          estimated_hours,
          expected_return_date,
          created_at,
          updated_at,
          customers(*),
          device_checklists(*),
          device_remarks(*),
          device_transitions(*),
          device_ratings(*)
        `).eq("id",r).single();if(i)throw new Error(`Failed to fetch device: ${i.message}`);return Gs(a)}catch{throw new Error("Network error: Unable to connect to database")}},async createDevice(r){try{const a=$x(r),i=Jn(a),{id:c,...m}=i;m.status||(m.status="received"),console.log("Inserting sanitized device:",m);const{data:u,error:x}=await G.from("devices").insert(m).select("*").single();if(x)throw new Error(`Failed to create device: ${x.message}`);return Gs(u)}catch{throw new Error("Network error: Unable to connect to database")}},async updateDevice(r,a){const i=Object.fromEntries(Object.entries(a).map(([u,x])=>[Jn(u),x])),{data:c,error:m}=await G.from("devices").update(i).eq("id",r).select().single();if(m)throw m;return a.status&&await G.from("device_notifications").insert({device_id:r,type:"info",title:"Device Status Updated",message:`Device status changed to ${a.status}`,sent_at:new Date().toISOString(),is_read:!1}),c},async deleteDevice(r){try{const{error:a}=await G.from("devices").delete().eq("id",r);if(a)throw new Error(`Failed to delete device: ${a.message}`);return!0}catch{throw new Error("Network error: Unable to connect to database")}},async addDeviceChecklist(r){try{const{data:a,error:i}=await G.from("device_checklists").insert(r).select().single();if(i)throw console.error("Error adding device checklist:",i),new Error(`Failed to add device checklist: ${i.message}`);return a}catch(a){throw console.error("Network error adding device checklist:",a),new Error("Network error: Unable to connect to database")}},async updateDeviceChecklist(r,a){try{const{data:i,error:c}=await G.from("device_checklists").update({...a,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(c)throw console.error("Error updating device checklist:",c),new Error(`Failed to update device checklist: ${c.message}`);return i}catch(i){throw console.error("Network error updating device checklist:",i),new Error("Network error: Unable to connect to database")}},async addDeviceRemark(r){try{const{data:a,error:i}=await G.from("device_remarks").insert(r).select().single();if(i)throw console.error("Error adding device remark:",i),new Error(`Failed to add device remark: ${i.message}`);return await G.from("device_notifications").insert({device_id:r.device_id,type:"info",title:"New Device Remark",message:`A new remark/message was added to device ${r.device_id}.`,sent_at:new Date().toISOString(),is_read:!1}),a}catch(a){throw console.error("Network error adding device remark:",a),new Error("Network error: Unable to connect to database")}},async addDeviceTransition(r){try{const{data:a,error:i}=await G.from("device_transitions").insert(r).select().single();if(i)throw console.error("Error adding device transition:",i),new Error(`Failed to add device transition: ${i.message}`);return await G.from("device_notifications").insert({device_id:r.device_id,type:"info",title:"Device Status Updated",message:`Device ${r.device_id} status changed from ${r.from_status} to ${r.to_status}.`,sent_at:new Date().toISOString(),is_read:!1}),a}catch(a){throw console.error("Network error adding device transition:",a),new Error("Network error: Unable to connect to database")}},async addDeviceRating(r){try{const{data:a,error:i}=await G.from("device_ratings").insert(r).select().single();if(i)throw console.error("Error adding device rating:",i),new Error(`Failed to add device rating: ${i.message}`);return a}catch(a){throw console.error("Network error adding device rating:",a),new Error("Network error: Unable to connect to database")}},async searchDevices(r){try{const{data:a,error:i}=await G.from("devices").select(`
          *,
          diagnosis_required,
          customers(*)
        `).or(`brand.ilike.%${r}%,model.ilike.%${r}%,serial_number.ilike.%${r}%,id.ilike.%${r}%`).order("created_at",{ascending:!1});if(i)throw console.error("Error searching devices:",i),new Error(`Failed to search devices: ${i.message}`);return Gs(a||[])}catch(a){throw console.error("Network error searching devices:",a),new Error("Network error: Unable to connect to database")}},async filterDevicesByStatus(r){try{const{data:a,error:i}=await G.from("devices").select(`
          *,
          device_checklists(*),
          device_remarks(*),
          device_transitions(*),
          device_ratings(*),
          customers(*)
        `).eq("status",r).order("created_at",{ascending:!1});if(i)throw console.error("Error filtering devices by status:",i),new Error(`Failed to filter devices: ${i.message}`);return Gs(a||[])}catch(a){throw console.error("Network error filtering devices by status:",a),new Error("Network error: Unable to connect to database")}},async getDevicesByTechnician(r){try{console.log("🔧 Fetching devices for technician:",r);const{data:a,error:i}=await G.from("devices").select(`
          *,
          device_checklists(*),
          device_remarks(*),
          device_transitions(*),
          device_ratings(*),
          customers(*)
        `).eq("assigned_to",r).order("created_at",{ascending:!1});if(i)throw console.error("❌ Error fetching devices by technician:",i),new Error(`Failed to fetch devices: ${i.message}`);return console.log("✅ Devices fetched for technician:",(a==null?void 0:a.length)||0),Gs(a||[])}catch(a){throw console.error("❌ Network error fetching devices by technician:",a),new Error("Network error: Unable to connect to database")}},async getDevicesByCustomer(r){try{const{data:a,error:i}=await G.from("devices").select(`
          *,
          device_checklists(*),
          device_remarks(*),
          device_transitions(*),
          device_ratings(*),
          customers(*)
        `).eq("customer_id",r).order("created_at",{ascending:!1});if(i)throw console.error("Error fetching devices by customer:",i),new Error(`Failed to fetch devices: ${i.message}`);return Gs(a||[])}catch(a){throw console.error("Network error fetching devices by customer:",a),new Error("Network error: Unable to connect to database")}},async getDevicePaymentRecords(r){try{const{data:a,error:i}=await G.from("customer_payments").select(`
          *,
          devices(brand, model),
          customers(name, phone, email)
        `).eq("device_id",r).order("payment_date",{ascending:!1});if(i)throw console.error("Error fetching device payment records:",i),new Error(`Failed to fetch payment records: ${i.message}`);const c=(a||[]).map(m=>{var u;return{...m,device_name:m.devices?`${m.devices.brand||""} ${m.devices.model||""}`.trim():void 0,customer_name:((u=m.customers)==null?void 0:u.name)||void 0}});return Gs(c)}catch(a){throw console.error("Network error fetching device payment records:",a),new Error("Network error: Unable to connect to database")}},async getCustomerPaymentRecords(r){try{const{data:a,error:i}=await G.from("customer_payments").select(`
          *,
          devices(brand, model)
        `).eq("customer_id",r).order("payment_date",{ascending:!1});if(i)throw console.error("Error fetching customer payment records:",i),new Error(`Failed to fetch customer payment records: ${i.message}`);const c=(a||[]).map(m=>({...m,device_name:m.devices?`${m.devices.brand||""} ${m.devices.model||""}`.trim():void 0}));return Gs(c)}catch(a){throw console.error("Network error fetching customer payment records:",a),new Error("Network error: Unable to connect to database")}},async addPaymentRecord(r){try{const{data:a,error:i}=await G.from("customer_payments").insert([r]).select().single();if(i)throw console.error("Error adding payment record:",i),new Error(`Failed to add payment record: ${i.message}`);return await G.from("device_notifications").insert({device_id:r.device_id,type:r.status==="failed"?"error":"info",title:r.status==="failed"?"Payment Failed":"Payment Received",message:r.status==="failed"?`A payment for device ${r.device_id} failed.`:`Payment received for device ${r.device_id}.`,sent_at:new Date().toISOString(),is_read:!1}),Gs(a)}catch(a){throw console.error("Network error adding payment record:",a),new Error("Network error: Unable to connect to database")}},async getDeviceStatistics(){try{const{data:r,error:a}=await G.from("devices").select("id",{count:"exact"}),{data:i,error:c}=await G.from("devices").select("id",{count:"exact"}).in("status",["received","in_progress"]),{data:m,error:u}=await G.from("devices").select("id",{count:"exact"}).eq("status","completed"),{data:x,error:j}=await G.from("devices").select("id",{count:"exact"}).eq("status","completed");if(a||c||u||j)throw console.error("Error fetching device statistics:",{totalError:a,repairError:c,pickupError:u,completedError:j}),new Error("Failed to fetch device statistics");return{totalDevices:(r==null?void 0:r.length)||0,inRepair:(i==null?void 0:i.length)||0,readyForPickup:(m==null?void 0:m.length)||0,completed:(x==null?void 0:x.length)||0}}catch(r){throw console.error("Network error fetching device statistics:",r),new Error("Network error: Unable to connect to database")}},async getTechnicianRating(r){try{const{data:a,error:i}=await G.from("device_ratings").select("score").eq("technician_id",r);if(i)throw console.error("Error getting technician rating:",i),new Error(`Failed to get technician rating: ${i.message}`);return!a||a.length===0?0:a.reduce((m,u)=>m+u.score,0)/a.length}catch(a){throw console.error("Network error getting technician rating:",a),new Error("Network error: Unable to connect to database")}},async updateDeviceReturnDate(r,a){try{const{data:i,error:c}=await G.from("devices").update({expected_return_date:a,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(c)throw console.error("Error updating device return date:",c),new Error(`Failed to update device return date: ${c.message}`);return Gs(i)}catch(i){throw console.error("Network error updating device return date:",i),new Error("Network error: Unable to connect to database")}},async sendCustomerNotification(r,a){try{const{error:i}=await G.from("device_notifications").insert({device_id:r,message:a,sent_at:new Date().toISOString(),is_read:!1});if(i)throw i;return!0}catch(i){return console.error("Error sending customer notification:",i),!1}},async assignTechnicianToDevice(r,a){try{const{data:i,error:c}=await G.from("devices").update({assigned_to:a,updated_at:new Date().toISOString()}).eq("id",r).select(`
          *,
          device_checklists(*),
          device_remarks(*),
          device_transitions(*),
          device_ratings(*),
          customers(*)
        `).single();if(c)throw console.error("Error assigning technician to device:",c),new Error(`Failed to assign technician: ${c.message}`);return await G.from("device_notifications").insert({device_id:r,type:"info",title:"Technician Assigned",message:`A technician has been assigned to device ${r}.`,sent_at:new Date().toISOString(),is_read:!1}),Gs(i)}catch(i){throw console.error("Network error assigning technician to device:",i),new Error("Network error: Unable to assign technician")}},async saveReceipt(r){try{const{data:a,error:i}=await G.from("receipts").insert({receipt_number:`RCP-${Date.now()}-${Math.random().toString(36).substr(2,9).toUpperCase()}`,device_id:r.deviceId,customer_id:r.customerId,payment_id:r.paymentId,technician_id:r.technicianId,device_brand:r.deviceBrand,device_model:r.deviceModel,device_serial_number:r.deviceSerialNumber,device_issue:r.deviceIssue,customer_name:r.customerName,customer_phone:r.customerPhone,customer_email:r.customerEmail,payment_method:r.paymentMethod,payment_reference:r.paymentReference,payment_amount:r.paymentAmount,total_cost:r.totalCost,deposit_amount:r.depositAmount,remaining_balance:r.remainingBalance,repair_cost:r.repairCost,labor_cost:r.laborCost,parts_cost:r.partsCost,device_status:r.deviceStatus,generated_by:r.generatedBy,receipt_content:r.receiptContent}).select().single();if(i)throw console.error("Error saving receipt:",i),new Error(`Failed to save receipt: ${i.message}`);return Gs(a)}catch(a){throw console.error("Network error saving receipt:",a),new Error("Network error: Unable to connect to database")}},async getReceipt(r){try{const{data:a,error:i}=await G.from("receipts").select(`
          *,
          devices(*),
          customers(*),
          customer_payments(*),
          auth_users!receipts_technician_id_fkey(*),
          auth_users!receipts_generated_by_fkey(*)
        `).eq("id",r).single();if(i)throw console.error("Error fetching receipt:",i),new Error(`Failed to fetch receipt: ${i.message}`);return Gs(a)}catch(a){throw console.error("Network error fetching receipt:",a),new Error("Network error: Unable to connect to database")}},async getDeviceReceipts(r){try{const{data:a,error:i}=await G.from("receipts").select(`
          *,
          customers(*),
          customer_payments(*),
          auth_users!receipts_technician_id_fkey(*)
        `).eq("device_id",r).order("receipt_date",{ascending:!1});if(i)throw console.error("Error fetching device receipts:",i),new Error(`Failed to fetch device receipts: ${i.message}`);return Gs(a||[])}catch(a){throw console.error("Network error fetching device receipts:",a),new Error("Network error: Unable to connect to database")}},async getCustomerReceipts(r){try{const{data:a,error:i}=await G.from("receipts").select(`
          *,
          devices(*),
          customer_payments(*),
          auth_users!receipts_technician_id_fkey(*)
        `).eq("customer_id",r).order("receipt_date",{ascending:!1});if(i)throw console.error("Error fetching customer receipts:",i),new Error(`Failed to fetch customer receipts: ${i.message}`);return Gs(a||[])}catch(a){throw console.error("Network error fetching customer receipts:",a),new Error("Network error: Unable to connect to database")}},async markReceiptPrinted(r){try{const{data:a,error:i}=await G.from("receipts").update({is_printed:!0}).eq("id",r).select().single();if(i)throw console.error("Error marking receipt as printed:",i),new Error(`Failed to mark receipt as printed: ${i.message}`);return Gs(a)}catch(a){throw console.error("Network error marking receipt as printed:",a),new Error("Network error: Unable to connect to database")}},async markReceiptSent(r,a){try{const{data:i,error:c}=await G.from("receipts").update({is_sent_to_customer:!0,sent_via:a,sent_at:new Date().toISOString()}).eq("id",r).select().single();if(c)throw console.error("Error marking receipt as sent:",c),new Error(`Failed to mark receipt as sent: ${c.message}`);return Gs(i)}catch(i){throw console.error("Network error marking receipt as sent:",i),new Error("Network error: Unable to connect to database")}}},Di={async getComprehensiveAnalytics(){try{const[r,a,i,c,m,u,x,j,b]=await Promise.all([this.getDeviceStatistics(),this.getRevenueAnalytics(),this.getCustomerAnalytics(),this.getTopTechnicians(10),this.getMonthlyTrends(),this.getDailyTrends(),this.getDeviceTypeDistribution(),this.getStatusDistribution(),this.getReturnAnalytics()]);let f=i;return i||(console.log("Customer analytics view failed, trying direct method..."),f=await this.getCustomerStatsDirect()),!r||!a||!f?(console.error("Failed to fetch required analytics data"),null):{device_stats:r,revenue_stats:a,customer_stats:f,technician_stats:{top_technicians:c.map(y=>({id:y.id,name:y.name,completed_devices:y.completed_devices,avg_repair_time:y.avg_repair_time_days||0,total_revenue:y.total_revenue_generated})),performance_summary:{total_technicians:c.length,avg_completion_rate:c.length>0?c.reduce((y,N)=>y+N.completed_devices/Math.max(N.total_assigned,1),0)/c.length:0,avg_repair_time:c.length>0?c.reduce((y,N)=>y+(N.avg_repair_time_days||0),0)/c.length:0}},trends:{monthly:m.map(y=>({month:new Date(y.month).toISOString(),devices:y.devices_count,revenue:y.revenue,customers:y.unique_customers})),daily:u.map(y=>({day:new Date(y.day).toISOString(),devices:y.devices_count,revenue:y.revenue,customers:y.unique_customers})),device_types:x,status_distribution:j},return_stats:b||{pending:0,escalated:0,completedToday:0,avgResolutionTime:"0h",totalReturns:0,returnRate:0,topReturnReasons:[]}}}catch(r){return console.error("Error in getComprehensiveAnalytics:",r),null}},async getAnalyticsForPeriod(r){try{const a=new Date;a.setDate(a.getDate()-r);const{data:i,error:c}=await G.from("devices").select("created_at, repair_cost, customer_id").gte("created_at",a.toISOString());if(c)return console.error("Error fetching period analytics:",c),null;const m={devices:(i==null?void 0:i.length)||0,revenue:(i==null?void 0:i.reduce((x,j)=>x+(typeof j.repair_cost=="number"?j.repair_cost:0),0))||0,customers:new Set(i==null?void 0:i.map(x=>x.customer_id).filter(Boolean)).size,avg_repair_time:0},u=(i==null?void 0:i.reduce((x,j)=>{const b=new Date(typeof j.created_at=="string"?j.created_at:new Date).toDateString();return x[b]||(x[b]={devices:0,revenue:0}),x[b].devices++,x[b].revenue+=typeof j.repair_cost=="number"?j.repair_cost:0,x},{}))||{};return{period_stats:m,period_trends:Object.entries(u).map(([x,j])=>({date:x,devices:j.devices,revenue:j.revenue}))}}catch(a){return console.error("Error in getAnalyticsForPeriod:",a),null}},async getDeviceStatistics(){try{const{data:r,error:a}=await G.from("devices").select("*");if(a)return console.error("Error fetching devices for statistics:",a),null;if(!r||r.length===0)return{total:0,in_repair:0,completed:0,pending:0,overdue:0,new_this_month:0,new_this_week:0,new_today:0};const i=new Date,c=new Date(i.getFullYear(),i.getMonth(),1),m=new Date(i.getTime()-7*24*60*60*1e3),u=new Date(i.getFullYear(),i.getMonth(),i.getDate()),x=r.length,j=r.filter(k=>k.status==="in-repair").length,b=r.filter(k=>k.status==="done").length,f=r.filter(k=>k.status==="assigned").length,y=r.filter(k=>{if(!k.created_at)return!1;const E=new Date(k.created_at);return(i.getTime()-E.getTime())/(1e3*60*60*24)>7}).length,N=r.filter(k=>k.created_at&&new Date(k.created_at)>=c).length,I=r.filter(k=>k.created_at&&new Date(k.created_at)>=m).length,R=r.filter(k=>k.created_at&&new Date(k.created_at)>=u).length;return console.log("📊 Device statistics:",{total:x,in_repair:j,completed:b,pending:f,overdue:y,new_this_month:N,new_this_week:I,new_today:R}),{total:x,in_repair:j,completed:b,pending:f,overdue:y,new_this_month:N,new_this_week:I,new_today:R}}catch(r){return console.error("Error in getDeviceStatistics:",r),null}},async getRevenueAnalytics(){try{const{data:r,error:a}=await G.from("devices").select("repair_cost, device_cost, created_at");if(a)return console.error("Error fetching devices for revenue analytics:",a),null;if(!r||r.length===0)return{total:0,this_month:0,last_month:0,this_week:0,today:0,growth_percentage:0};const i=new Date,c=new Date(i.getFullYear(),i.getMonth(),1),m=new Date(i.getFullYear(),i.getMonth()-1,1),u=new Date(i.getFullYear(),i.getMonth(),0),x=new Date(i.getTime()-7*24*60*60*1e3),j=new Date(i.getFullYear(),i.getMonth(),i.getDate());let b=0,f=0,y=0,N=0,I=0;r.forEach(k=>{const E=(k.repair_cost||0)+(k.device_cost||0);if(b+=E,k.created_at){const v=new Date(k.created_at);v>=c&&(f+=E),v>=m&&v<=u&&(y+=E),v>=x&&(N+=E),v>=j&&(I+=E)}});const R=y>0?(f-y)/y*100:0;return{total:b,this_month:f,last_month:y,this_week:N,today:I,growth_percentage:R}}catch(r){return console.error("Error in getRevenueAnalytics:",r),null}},async getCustomerAnalytics(){try{const{data:r,error:a}=await G.from("customers").select("*");if(a)return console.error("Error fetching customers for analytics:",a),null;if(!r||r.length===0)return{total:0,new_this_month:0,active:0,returning:0,avg_devices:0,avg_spent:0};const i=new Date,c=new Date(i.getFullYear(),i.getMonth(),1),m=new Date(i.getTime()-90*24*60*60*1e3),u=r.length,x=r.filter(R=>R.created_at&&new Date(R.created_at)>=c).length,j=r.filter(R=>R.is_active).length,b=r.filter(R=>R.last_visit&&new Date(R.last_visit)>=m).length,f=r.reduce((R,k)=>R+(k.total_spent||0),0),y=u>0?f/u:0,{data:N,error:I}=await G.from("devices").select("customer_id");if(!I&&N){const R=N.reduce((v,U)=>(v[U.customer_id]=(v[U.customer_id]||0)+1,v),{}),k=Object.values(R).reduce((v,U)=>v+U,0),E=u>0?k/u:0;return{total:u,new_this_month:x,active:j,returning:b,avg_devices:E,avg_spent:y}}return{total:u,new_this_month:x,active:j,returning:b,avg_devices:0,avg_spent:y}}catch(r){return console.error("Error in getCustomerAnalytics:",r),null}},async getCustomerStatsDirect(){try{const r=new Date,a=new Date(r.getFullYear(),r.getMonth(),1),i=a.toISOString(),{data:c,error:m}=await G.from("customers").select("id, created_at, last_visit, is_active, total_spent, points");if(m)return console.error("Error fetching customers for stats:",m),null;if(!c||c.length===0)return{total:0,new_this_month:0,active:0,returning:0,avg_devices:0,avg_spent:0};const u=c.length,x=c.filter(N=>N.created_at&&new Date(N.created_at)>=a).length,j=c.filter(N=>N.is_active).length,b=c.filter(N=>N.last_visit&&new Date(N.last_visit)>=new Date(r.getTime()-90*24*60*60*1e3)).length,f=c.reduce((N,I)=>N+(I.total_spent||0),0),y=u>0?f/u:0;return{total:u,new_this_month:x,active:j,returning:b,avg_devices:0,avg_spent:y}}catch(r){return console.error("Error in getCustomerStatsDirect:",r),null}},async getTechnicianPerformance(){try{const{data:r,error:a}=await G.from("technician_performance_view").select("*").order("completed_devices",{ascending:!1});return a?(console.error("Error fetching technician performance:",a),[]):r||[]}catch(r){return console.error("Error in getTechnicianPerformance:",r),[]}},async getTopCustomers(r=10){try{const{data:a,error:i}=await G.from("customers").select("id, name, email, total_spent, last_visit");if(i)return console.error("Error fetching customers for top customers:",i),[];if(!a||a.length===0)return[];const{data:c,error:m}=await G.from("devices").select("customer_id");if(m)return console.error("Error fetching devices for customer stats:",m),[];const u=c.reduce((j,b)=>(j[b.customer_id]=(j[b.customer_id]||0)+1,j),{});return a.map(j=>({id:j.id,name:j.name||j.email||`Customer ${j.id}`,total_devices:u[j.id]||0,total_spent:j.total_spent||0,last_visit:j.last_visit})).sort((j,b)=>b.total_spent-j.total_spent).slice(0,r)}catch(a){return console.error("Error in getTopCustomers:",a),[]}},async getTopTechnicians(r=10){try{const{data:a,error:i}=await G.from("devices").select("assigned_to, status, created_at, updated_at, repair_cost, device_cost");if(i)return console.error("Error fetching devices for technician stats:",i),[];if(!a||a.length===0)return[];const c=a.reduce((u,x)=>{const j=x.assigned_to;if(!j)return u;u[j]||(u[j]={id:j,name:`Technician ${j}`,completed_devices:0,total_assigned:0,avg_repair_time_days:0,total_revenue_generated:0}),u[j].total_assigned++,x.status==="done"&&u[j].completed_devices++;const b=(x.repair_cost||0)+(x.device_cost||0);return u[j].total_revenue_generated+=b,u},{});return Object.values(c).map(u=>{const x=u.total_assigned>0?u.total_assigned*2:0;return{...u,avg_repair_time_days:x}}).sort((u,x)=>x.completed_devices-u.completed_devices).slice(0,r)}catch(a){return console.error("Error in getTopTechnicians:",a),[]}},async getDeviceTypeDistribution(){try{const{data:r,error:a}=await G.from("devices").select("brand, model");if(a)return console.error("Error fetching devices for type distribution:",a),[];if(!r||r.length===0)return[];const i=r.reduce((m,u)=>{const x=u.brand||"Unknown";return m[x]=(m[x]||0)+1,m},{}),c=r.length;return Object.entries(i).map(([m,u])=>({type:m,count:u,percentage:c>0?u/c*100:0}))}catch(r){return console.error("Error in getDeviceTypeDistribution:",r),[]}},async getStatusDistribution(){try{const{data:r,error:a}=await G.from("devices").select("status");if(a)return console.error("Error fetching devices for status distribution:",a),[];if(!r||r.length===0)return[];const i=r.reduce((m,u)=>{const x=u.status||"unknown";return m[x]=(m[x]||0)+1,m},{}),c=r.length;return Object.entries(i).map(([m,u])=>({status:m,count:u,percentage:c>0?u/c*100:0}))}catch(r){return console.error("Error in getStatusDistribution:",r),[]}},async getMonthlyTrends(){try{const{data:r,error:a}=await G.from("devices").select("created_at, repair_cost, device_cost");if(a)return console.error("Error fetching devices for monthly trends:",a),[];if(!r||r.length===0)return[];const i=r.reduce((c,m)=>{if(!m.created_at)return c;const u=new Date(m.created_at),x=`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}`;return c[x]||(c[x]={month:x,devices_count:0,revenue:0,unique_customers:0}),c[x].devices_count++,c[x].revenue+=(m.repair_cost||0)+(m.device_cost||0),c},{});return Object.values(i)}catch(r){return console.error("Error in getMonthlyTrends:",r),[]}},async getDailyTrends(){try{const{data:r,error:a}=await G.from("devices").select("created_at, repair_cost, device_cost");if(a)return console.error("Error fetching devices for daily trends:",a),[];if(!r||r.length===0)return[];const i=new Date,c=new Date(i.getTime()-30*24*60*60*1e3),m=r.reduce((u,x)=>{if(!x.created_at)return u;const j=new Date(x.created_at);if(j<c)return u;const b=j.toISOString().split("T")[0];return u[b]||(u[b]={day:b,devices_count:0,revenue:0,unique_customers:0}),u[b].devices_count++,u[b].revenue+=(x.repair_cost||0)+(x.device_cost||0),u},{});return Object.values(m)}catch(r){return console.error("Error in getDailyTrends:",r),[]}},async getReturnAnalytics(){try{const r=new Date;r.setHours(0,0,0,0);const{data:a,error:i}=await G.from("returns").select("*");if(i)throw i;if(!a)return null;const c=a.filter(y=>y.status==="pending"||y.status==="under-return-review").length,m=a.filter(y=>y.escalation_required||y.status==="escalated").length,u=a.filter(y=>{const N=new Date(y.updated_at);return y.status==="completed"&&N>=r}).length,x=a.filter(y=>y.status==="completed"&&y.created_at&&y.updated_at);let j="0h";if(x.length>0){const y=x.reduce((N,I)=>{const R=new Date(I.created_at),E=(new Date(I.updated_at).getTime()-R.getTime())/(1e3*60*60);return N+E},0);j=`${Math.round(y/x.length)}h`}const b={};a.forEach(y=>{y.reason&&(b[y.reason]=(b[y.reason]||0)+1)});const f=Object.entries(b).map(([y,N])=>({reason:y,count:N,percentage:Math.round(N/a.length*100)})).sort((y,N)=>N.count-y.count).slice(0,5);return{pending:c,escalated:m,completedToday:u,avgResolutionTime:j,totalReturns:a.length,returnRate:a.length>0?Math.round(a.length/100*100):0,topReturnReasons:f}}catch(r){return console.error("Error fetching return analytics:",r),null}},async refreshAnalyticsSummary(){try{return!0}catch(r){return console.error("Error in refreshAnalyticsSummary:",r),!1}},async getAnalyticsSummary(){try{const{data:r,error:a}=await G.from("analytics_summary_view").select("*").single();return a?(console.error("Error fetching analytics summary:",a),null):r}catch(r){return console.error("Error in getAnalyticsSummary:",r),null}}};class qx{static async getTagStatistics(){try{const{data:a,error:i}=await G.from("customers").select("id, color_tag").not("color_tag","is",null);if(i)return console.error("Error fetching customer tag statistics:",i),{};const c={};return a==null||a.forEach(m=>{const u=m.color_tag||"normal";c[u]=(c[u]||0)+1}),c}catch(a){return console.error("Error in getTagStatistics:",a),{}}}static async updateCustomerTag(a,i){try{const{error:c}=await G.from("customers").update({color_tag:i}).eq("id",a);return c?(console.error("Error updating customer tag:",c),!1):!0}catch(c){return console.error("Error in updateCustomerTag:",c),!1}}static async getCustomersByTag(a){try{const{data:i,error:c}=await G.from("customers").select("*").eq("color_tag",a);return c?(console.error("Error fetching customers by tag:",c),[]):i||[]}catch(i){return console.error("Error in getCustomersByTag:",i),[]}}}const Vx={vip:"VIP",loyal:"Loyal",new:"New","at-risk":"At-Risk",complainer:"Complainer",purchased:"Purchased"},Gx={vip:"bg-yellow-100 text-yellow-800",loyal:"bg-green-100 text-green-800",new:"bg-blue-100 text-blue-800","at-risk":"bg-orange-100 text-orange-800",complainer:"bg-red-100 text-red-800",purchased:"bg-emerald-100 text-emerald-800"},Hx=()=>{const[r,a]=g.useState({});g.useEffect(()=>{qx.getTagStatistics().then(a)},[]);const i=Object.values(r).reduce((c,m)=>c+m,0);return e.jsxs(he,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Customer Tag Distribution"}),e.jsx("div",{className:"space-y-2",children:Object.entries(r).length===0?e.jsx("div",{className:"text-gray-400 text-center py-4",children:"No data"}):Object.entries(r).sort(([,c],[,m])=>m-c).map(([c,m])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${Gx[c]||"bg-gray-100 text-gray-700"}`,children:Vx[c]||c}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[m," ",e.jsxs("span",{className:"text-xs text-gray-500",children:["(",i>0?(m/i*100).toFixed(1):0,"%)"]})]})]},c))})]})},Wx=()=>{const r=hs(),{currentUser:a}=Wt(),i={devices:{total:0,completed:0,inProgress:0,overdue:0,pending:0},customers:{total:0,newThisMonth:0,returning:0,active:0},revenue:{total:0,thisMonth:0,lastMonth:0,growth:0},performance:{avgRepairTime:0,successRate:0,customerSatisfaction:0,technicianEfficiency:0},trends:{monthly:[],daily:[],deviceTypes:[],statusDistribution:[]},topTechnicians:[],topCustomers:[]},[c,m]=g.useState(i),[u,x]=g.useState(!1),[j,b]=g.useState(!1),[f,y]=g.useState("30d"),[N,I]=g.useState(!1),[R,k]=g.useState(""),[E,v]=g.useState("all"),[U,F]=g.useState([]),[L,C]=g.useState([]),[$,Y]=g.useState(!1),[A,Z]=g.useState(new Date),[_,D]=g.useState(new Map),[T,z]=g.useState(!1),[se,q]=g.useState(!1),[H,J]=g.useState(null),[V,ge]=g.useState([]),[He,B]=g.useState(!0),[fe,re]=g.useState(null),[ye,Q]=g.useState(null),[Le,Ue]=g.useState([]),[Ct,Re]=g.useState(!0),[ut,Ee]=g.useState(null),[Oe,Xe]=g.useState(!1),[Be,Ce]=g.useState(""),[Ze,$e]=g.useState(""),[K,be]=g.useState(!1),[ue,Ye]=g.useState(navigator.onLine),ae=24*60*60*1e3,ke=7*24*60*60*1e3,Ke=g.useMemo(()=>`analytics_${f}`,[f]),le=g.useCallback(xe=>Date.now()-xe<ae,[]),Ne=g.useCallback(async()=>{const xe=_.get(Ke);if(xe&&le(xe.timestamp))return xe.data;try{const pt=localStorage.getItem(`offline_analytics_${Ke}`);if(pt){const lt=JSON.parse(pt);if(Date.now()-lt.timestamp<ke)return console.log("[Analytics] Using offline cached data"),lt.data}}catch(pt){console.error("[Analytics] Error reading offline cache:",pt)}return null},[_,Ke,le]),Te=g.useCallback(xe=>{const pt=Date.now();D(lt=>new Map(lt).set(Ke,{data:xe,timestamp:pt}));try{localStorage.setItem(`offline_analytics_${Ke}`,JSON.stringify({data:xe,timestamp:pt})),console.log("[Analytics] Data saved to offline cache")}catch(lt){console.error("[Analytics] Error saving to offline cache:",lt)}},[Ke]),{quickActions:Qe,getGridClasses:vt,getActionButtonClasses:Rt,getIconSize:ht,getTextSize:Se,shouldShowDescription:ve,isEnabled:de}=zx(),me=(a==null?void 0:a.role)==="admin",Ae=(a==null?void 0:a.role)==="customer-care",it=(a==null?void 0:a.role)==="technician",St=me||Ae||it,kt=me||Ae;if(!St)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-red-100 rounded-full p-4 w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:e.jsx(Ht,{className:"text-red-600",size:32})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"You don't have permission to view the admin dashboard."}),e.jsx(X,{onClick:()=>r("/dashboard"),variant:"primary",children:"Go to Dashboard"})]})});g.useEffect(()=>{},[de,Qe]),g.useCallback(xe=>{console.error("[AdminDashboard] Data loading error:",xe),J(xe.message||"Failed to load dashboard data"),x(!1),z(!1)},[]);const et=g.useCallback(async()=>{try{const xe=[];c!=null&&c.devices.overdue&&c.devices.overdue>0&&xe.push({id:"1",type:"warning",message:`${c.devices.overdue} devices are overdue`,time:"2 min ago",read:!1}),c!=null&&c.customers.newThisMonth&&c.customers.newThisMonth>0&&xe.push({id:"2",type:"info",message:`${c.customers.newThisMonth} new customers this month`,time:"5 min ago",read:!1}),c!=null&&c.revenue.growth&&c.revenue.growth>10&&xe.push({id:"3",type:"success",message:`Revenue growth: +${c.revenue.growth.toFixed(1)}%`,time:"10 min ago",read:!1}),F(xe)}catch(xe){console.error("Error loading notifications:",xe)}},[c]),xs=g.useCallback(async()=>{try{const xe=await ki.getAllDevices(),pt=[];xe.sort((rt,wt)=>new Date(wt.created_at).getTime()-new Date(rt.created_at).getTime()).slice(0,10).forEach(rt=>{var tt;const wt=((tt=rt.customers)==null?void 0:tt.name)||"Unknown Customer",Ot=`${rt.brand} ${rt.model}`;let Gt="device_added",we=e.jsx(ns,{size:16}),Ge="text-blue-500";rt.status==="done"?(Gt="repair_completed",we=e.jsx(un,{size:16}),Ge="text-green-500"):rt.status==="in-repair"&&(Gt="device_added",we=e.jsx(ns,{size:16}),Ge="text-orange-500"),pt.push({id:`device_${rt.id}`,type:Gt,message:`${Ot} ${Gt==="repair_completed"?"completed":"added"} by ${wt}`,time:Nt(rt.created_at),icon:we,color:Ge})}),C(pt)}catch(xe){console.error("Error loading recent activities:",xe),C([])}},[]),Nt=xe=>{const pt=new Date,lt=new Date(xe),rt=pt.getTime()-lt.getTime(),wt=Math.floor(rt/(1e3*60*60*24)),Ot=Math.floor(rt/(1e3*60*60)),Gt=Math.floor(rt/(1e3*60));return wt>0?`${wt} day${wt>1?"s":""} ago`:Ot>0?`${Ot} hour${Ot>1?"s":""} ago`:Gt>0?`${Gt} minute${Gt>1?"s":""} ago`:"Just now"},ss=g.useCallback(async(xe=!1)=>{var pt,lt,rt,wt,Ot,Gt,we,Ge,tt,dt,jt,bt,Xt,ds,fs,We,M,ce,Je,_t,Dt,at,Et,sr,gr,Ie,ze;if(!xe){const ft=await Ne();if(ft){m(ft),b(!0),x(!1);return}}!j&&!Ne()&&x(!0),z(!0),J(null);try{const ft=await Di.getComprehensiveAnalytics();if(!ft){console.log("[AdvancedAnalytics] Using fallback analytics method");const De=await ki.getDeviceStatistics(),Fe=bs({deviceStats:De,customersCount:0,newCustomers:[],totalRevenue:0,thisMonthRevenue:0,lastMonthRevenue:0,devicesData:[],trendsSalesData:[],salesTableExists:!1});m(Fe),Te(Fe);return}const oe={devices:{total:((pt=ft.device_stats)==null?void 0:pt.total)||0,completed:((lt=ft.device_stats)==null?void 0:lt.completed)||0,inProgress:((rt=ft.device_stats)==null?void 0:rt.in_repair)||0,overdue:((wt=ft.device_stats)==null?void 0:wt.overdue)||0,pending:((Ot=ft.device_stats)==null?void 0:Ot.pending)||0},customers:{total:((Gt=ft.customer_stats)==null?void 0:Gt.total)||0,newThisMonth:((we=ft.customer_stats)==null?void 0:we.new_this_month)||0,returning:((Ge=ft.customer_stats)==null?void 0:Ge.returning)||0,active:((tt=ft.customer_stats)==null?void 0:tt.active)||0},revenue:{total:((dt=ft.revenue_stats)==null?void 0:dt.total)||0,thisMonth:((jt=ft.revenue_stats)==null?void 0:jt.this_month)||0,lastMonth:((bt=ft.revenue_stats)==null?void 0:bt.last_month)||0,growth:((Xt=ft.revenue_stats)==null?void 0:Xt.growth_percentage)||0},performance:{avgRepairTime:((fs=(ds=ft.technician_stats)==null?void 0:ds.performance_summary)==null?void 0:fs.avg_repair_time)||0,successRate:((We=ft.device_stats)==null?void 0:We.total)>0?ft.device_stats.completed/ft.device_stats.total*100:0,customerSatisfaction:((M=ft.device_stats)==null?void 0:M.total)>0?ft.device_stats.completed/ft.device_stats.total*100:0,technicianEfficiency:((Je=(ce=ft.technician_stats)==null?void 0:ce.performance_summary)==null?void 0:Je.avg_repair_time)>0?Math.max(0,100-ft.technician_stats.performance_summary.avg_repair_time*10):0},trends:{monthly:((Dt=(_t=ft.trends)==null?void 0:_t.monthly)==null?void 0:Dt.map(De=>({month:new Date(De.month).toLocaleDateString("en-US",{month:"short",year:"numeric"}),devices:De.devices,revenue:De.revenue})))||[],daily:((Et=(at=ft.trends)==null?void 0:at.daily)==null?void 0:Et.map(De=>({date:new Date(De.day).toLocaleDateString("en-US",{month:"short",day:"numeric"}),devices:De.devices,revenue:De.revenue})))||[],deviceTypes:((sr=ft.trends)==null?void 0:sr.device_types)||[],statusDistribution:((gr=ft.trends)==null?void 0:gr.status_distribution)||[]},topTechnicians:((ze=(Ie=ft.technician_stats)==null?void 0:Ie.top_technicians)==null?void 0:ze.map(De=>({id:De.id,name:De.name,completedDevices:De.completed_devices,avgTime:De.avg_repair_time,satisfaction:De.completed_devices>0?Math.min(5,3+De.completed_devices/10):3})))||[],topCustomers:[]};if(f==="7d"||f==="30d"){const De=await Di.getTopCustomers(5);oe.topCustomers=De.map(Fe=>({id:Fe.id,name:Fe.name||Fe.email||`Customer ${Fe.id}`,totalDevices:Fe.total_devices,totalSpent:Fe.total_spent,lastVisit:Fe.last_visit}))}m(oe),Te(oe),b(!0),Z(new Date),setTimeout(()=>et(),100)}catch(ft){console.error("[AdvancedAnalytics] Error loading analytics:",ft),te.error("Failed to load analytics data")}finally{x(!1),z(!1)}},[f,Ne,Te,j,et]),gt=g.useCallback(()=>{ss(!0),te.success("Analytics data refreshed")},[ss]),Is=g.useCallback(()=>{te("Auto-refresh is disabled")},[]),ts=g.useCallback(async()=>{var xe,pt,lt,rt,wt,Ot,Gt,we,Ge,tt,dt,jt,bt,Xt,ds,fs,We,M,ce,Je,_t,Dt,at,Et,sr,gr,Ie;try{x(!0),te("Downloading analytics data for offline use...");const ze=["7d","30d","90d","1y"];for(const ft of ze){const oe=`analytics_${ft}`,De=await Di.getComprehensiveAnalytics();if(De){const Fe={devices:{total:((xe=De.device_stats)==null?void 0:xe.total)||0,completed:((pt=De.device_stats)==null?void 0:pt.completed)||0,inProgress:((lt=De.device_stats)==null?void 0:lt.in_repair)||0,overdue:((rt=De.device_stats)==null?void 0:rt.overdue)||0,pending:((wt=De.device_stats)==null?void 0:wt.pending)||0},customers:{total:((Ot=De.customer_stats)==null?void 0:Ot.total)||0,newThisMonth:((Gt=De.customer_stats)==null?void 0:Gt.new_this_month)||0,returning:((we=De.customer_stats)==null?void 0:we.returning)||0,active:((Ge=De.customer_stats)==null?void 0:Ge.active)||0},revenue:{total:((tt=De.revenue_stats)==null?void 0:tt.total)||0,thisMonth:((dt=De.revenue_stats)==null?void 0:dt.this_month)||0,lastMonth:((jt=De.revenue_stats)==null?void 0:jt.last_month)||0,growth:((bt=De.revenue_stats)==null?void 0:bt.growth_percentage)||0},performance:{avgRepairTime:((ds=(Xt=De.technician_stats)==null?void 0:Xt.performance_summary)==null?void 0:ds.avg_repair_time)||0,successRate:((fs=De.device_stats)==null?void 0:fs.total)>0?De.device_stats.completed/De.device_stats.total*100:0,customerSatisfaction:((We=De.device_stats)==null?void 0:We.total)>0?De.device_stats.completed/De.device_stats.total*100:0,technicianEfficiency:((ce=(M=De.technician_stats)==null?void 0:M.performance_summary)==null?void 0:ce.avg_repair_time)>0?Math.max(0,100-De.technician_stats.performance_summary.avg_repair_time*10):0},trends:{monthly:((_t=(Je=De.trends)==null?void 0:Je.monthly)==null?void 0:_t.map(Bt=>({month:new Date(Bt.month).toLocaleDateString("en-US",{month:"short",year:"numeric"}),devices:Bt.devices,revenue:Bt.revenue})))||[],daily:((at=(Dt=De.trends)==null?void 0:Dt.daily)==null?void 0:at.map(Bt=>({date:new Date(Bt.day).toLocaleDateString("en-US",{month:"short",day:"numeric"}),devices:Bt.devices,revenue:Bt.revenue})))||[],deviceTypes:((Et=De.trends)==null?void 0:Et.device_types)||[],statusDistribution:((sr=De.trends)==null?void 0:sr.status_distribution)||[]},topTechnicians:((Ie=(gr=De.technician_stats)==null?void 0:gr.top_technicians)==null?void 0:Ie.map(Bt=>({id:Bt.id,name:Bt.name,completedDevices:Bt.completed_devices,avgTime:Bt.avg_repair_time,satisfaction:Bt.completed_devices>0?Math.min(5,3+Bt.completed_devices/10):3})))||[],topCustomers:[]};localStorage.setItem(`offline_analytics_${oe}`,JSON.stringify({data:Fe,timestamp:Date.now()}))}}te.success("Analytics data downloaded for offline use!"),x(!1)}catch(ze){console.error("[Analytics] Error pre-downloading data:",ze),te.error("Failed to download offline data"),x(!1)}},[]),bs=xe=>{const pt=new Date;new Date(pt.getFullYear(),pt.getMonth(),1),new Date(pt.getFullYear(),pt.getMonth()-1,1);const lt=xe.deviceStats||{},rt=0,wt=xe.newCustomers||[],Ot=0,Gt=0,we=0,Ge=xe.devicesData||[],tt=xe.trendsSalesData||[],dt=Ge.length>0?Qt(Ge,tt):[],jt=Ge.length>0?Pe(Ge,tt,f):[],bt=Ge.length>0?ot(Ge):[],Xt=Ge.length>0?$t(Ge):[],ds=Ge.length>0?gs(Ge):[],fs=Ge.length>0?Jt(wt,Ge):[];return{devices:{total:lt.totalDevices||0,completed:lt.completed||0,inProgress:lt.inRepair||0,overdue:lt.overdue||0,pending:lt.pending||0},customers:{total:rt,newThisMonth:wt.length,returning:0,active:0},revenue:{total:Ot,thisMonth:Gt,lastMonth:we,growth:0},performance:{avgRepairTime:0,successRate:lt.totalDevices>0?lt.completed/lt.totalDevices*100:0,customerSatisfaction:lt.totalDevices>0?lt.completed/lt.totalDevices*100:0,technicianEfficiency:0},trends:{monthly:dt,daily:jt,deviceTypes:bt,statusDistribution:Xt},topTechnicians:ds,topCustomers:fs}},Qt=(xe,pt)=>{const lt=[];for(let rt=5;rt>=0;rt--){const wt=new Date;wt.setMonth(wt.getMonth()-rt);const Ot=wt.toLocaleDateString("en-US",{month:"short",year:"numeric"}),Gt=xe.filter(Ge=>{const tt=new Date(Ge.created_at);return tt.getMonth()===wt.getMonth()&&tt.getFullYear()===wt.getFullYear()}).length,we=pt.length>0?pt.filter(Ge=>{const tt=new Date(Ge.created_at);return tt.getMonth()===wt.getMonth()&&tt.getFullYear()===wt.getFullYear()}).reduce((Ge,tt)=>Ge+(tt.total||0),0):xe.filter(Ge=>{const tt=new Date(Ge.created_at);return tt.getMonth()===wt.getMonth()&&tt.getFullYear()===wt.getFullYear()}).reduce((Ge,tt)=>Ge+(tt.repair_cost||0),0);lt.push({month:Ot,devices:Gt,revenue:we})}return lt},Pe=(xe,pt,lt)=>{const rt=[],wt=lt==="7d"?7:lt==="30d"?30:lt==="90d"?90:365;for(let Ot=wt-1;Ot>=0;Ot--){const Gt=new Date;Gt.setDate(Gt.getDate()-Ot);const we=Gt.toLocaleDateString("en-US",{month:"short",day:"numeric"}),Ge=xe.filter(dt=>new Date(dt.created_at).toDateString()===Gt.toDateString()).length,tt=pt.length>0?pt.filter(dt=>new Date(dt.created_at).toDateString()===Gt.toDateString()).reduce((dt,jt)=>dt+(jt.total||0),0):xe.filter(dt=>new Date(dt.created_at).toDateString()===Gt.toDateString()).reduce((dt,jt)=>dt+(jt.repair_cost||0),0);rt.push({date:we,devices:Ge,revenue:tt})}return rt},ot=xe=>{const pt=xe.reduce((rt,wt)=>{const Ot=wt.device_type||"Unknown";return rt[Ot]=(rt[Ot]||0)+1,rt},{}),lt=xe.length;return Object.entries(pt).map(([rt,wt])=>({type:rt,count:Number(wt),percentage:Number(wt)/lt*100}))},$t=xe=>{const pt=xe.reduce((rt,wt)=>(rt[wt.status]=(rt[wt.status]||0)+1,rt),{}),lt=xe.length;return Object.entries(pt).map(([rt,wt])=>({status:rt,count:Number(wt),percentage:Number(wt)/lt*100}))},gs=xe=>{const pt=xe.reduce((lt,rt)=>{const wt=typeof rt.technician_id=="string"?rt.technician_id:"unknown";if(lt[wt]||(lt[wt]={id:wt,name:`Technician ${wt}`,completedDevices:0,totalTime:0,deviceCount:0}),rt.status==="completed"&&lt[wt].completedDevices++,rt.completed_at&&rt.created_at&&typeof rt.completed_at=="string"&&typeof rt.created_at=="string"){const Ot=new Date(rt.completed_at).getTime()-new Date(rt.created_at).getTime();lt[wt].totalTime+=Ot/864e5}return lt[wt].deviceCount++,lt},{});return Object.values(pt).map(lt=>({id:lt.id,name:lt.name,completedDevices:lt.completedDevices,avgTime:lt.completedDevices>0?lt.totalTime/lt.completedDevices:0,satisfaction:lt.completedDevices>0?Math.min(5,3+lt.completedDevices/10):3})).sort((lt,rt)=>rt.completedDevices-lt.completedDevices).slice(0,3)},Jt=(xe,pt)=>xe.map(lt=>{const rt=Array.isArray(pt)?pt.filter(Ot=>Ot.customer_id===lt.id):[],wt=rt.reduce((Ot,Gt)=>Ot+(Gt.repair_cost||0),0);return{id:lt.id,name:lt.name||lt.email||`Customer ${lt.id}`,totalDevices:typeof lt.total_devices=="number"?lt.total_devices:rt.length,totalSpent:wt,lastVisit:lt.last_visit||lt.created_at}}).sort((lt,rt)=>rt.totalSpent-lt.totalSpent).slice(0,5),Es=()=>{if(!c)return;const xe=[["Metric","Value"],["Total Devices",c.devices.total],["Completed Devices",c.devices.completed],["In Progress",c.devices.inProgress],["Overdue",c.devices.overdue],["Total Customers",c.customers.total],["New This Month",c.customers.newThisMonth],["Total Revenue",c.revenue.total],["This Month Revenue",c.revenue.thisMonth],["Revenue Growth",`${c.revenue.growth.toFixed(2)}%`],["Average Repair Time",`${c.performance.avgRepairTime.toFixed(1)} days`],["Success Rate",`${c.performance.successRate.toFixed(1)}%`]].map(wt=>wt.join(",")).join(`
`),pt=new Blob([xe],{type:"text/csv"}),lt=window.URL.createObjectURL(pt),rt=document.createElement("a");rt.href=lt,rt.download=`analytics-${new Date().toISOString().split("T")[0]}.csv`,rt.click(),window.URL.revokeObjectURL(lt),te.success("Analytics exported successfully!")},as=xe=>{F(pt=>pt.map(lt=>lt.id===xe?{...lt,read:!0}:lt))};g.useEffect(()=>{ss(),xs()},[]),g.useEffect(()=>{c&&et()},[c]),g.useEffect(()=>{(async()=>{try{const pt=await ki.getAllDevices();ge(pt.filter(lt=>lt.status==="ready-for-pickup"))}catch{ge([])}})()},[]);const Us=g.useCallback(async()=>{B(!0);try{const xe=await Ps.getSMSStats();re(xe);const pt=await Ps.checkBalance();Q(pt.success?parseFloat(pt.balance||"0"):0)}catch(xe){console.error("Error loading SMS analytics:",xe),te.error("Failed to load SMS analytics.")}finally{B(!1)}},[]),ys=g.useCallback(async()=>{Re(!0);try{const xe=await Ps.getSMSLogs();Ue(xe)}catch{te.error("Failed to load SMS logs.")}finally{Re(!1)}},[]);return g.useEffect(()=>{Us(),ys()},[]),g.useEffect(()=>{const xe=()=>{Ye(!0),console.log("🌐 Back online - refreshing data..."),setTimeout(()=>{ss(!0)},1e3)},pt=()=>{Ye(!1),console.log("📴 Going offline - using cached data")};return window.addEventListener("online",xe),window.addEventListener("offline",pt),()=>{window.removeEventListener("online",xe),window.removeEventListener("offline",pt)}},[]),u?e.jsx("div",{className:"min-h-screen",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Loading dashboard..."})]})})}):H?e.jsx("div",{className:"min-h-screen",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ht,{size:48,className:"mx-auto text-red-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Dashboard Error"}),e.jsx("p",{className:"text-red-600 mb-4",children:H}),e.jsx("button",{onClick:()=>{J(null),ss(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Try Again"})]})})}):c?e.jsxs("div",{className:"min-h-screen",children:[!ue&&e.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-yellow-500 text-yellow-900 px-4 py-2 text-center font-medium",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ht,{size:16}),e.jsx("span",{children:"You're offline. Some features may be limited. Data will sync when connection is restored."})]})}),e.jsx("div",{className:"relative z-10 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-white/20 backdrop-blur-lg rounded-2xl border border-white/30 shadow-xl p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold bg-gradient-to-r from-gray-900 via-blue-800 to-indigo-900 bg-clip-text text-transparent mb-2",children:"Admin Dashboard"}),e.jsx("p",{className:"text-gray-600 text-sm lg:text-base",children:me?"Welcome back! Here's your comprehensive overview":Ae?"Welcome back! Here's your customer care overview":"Welcome back! Here's your technician overview (customer data hidden for privacy)"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ms,{size:12}),e.jsxs("span",{children:["Updated: ",A.toLocaleTimeString()]})]}),e.jsxs("div",{className:`flex items-center gap-1 ${ue?"text-green-600":"text-red-600"}`,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${ue?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"font-medium",children:ue?"Online":"Offline"})]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Cr,{size:18,className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search analytics, devices, customers, or reports...",value:R,onChange:xe=>k(xe.target.value),className:"w-full pl-12 pr-4 py-3 bg-white/70 backdrop-blur-sm border border-white/40 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent shadow-sm hover:shadow-md transition-all duration-300 text-gray-800 placeholder-gray-500"})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:gt,disabled:T,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(us,{size:16,className:T?"animate-spin":""}),e.jsx("span",{children:T?"Refreshing...":"Refresh Data"})]}),e.jsxs("button",{onClick:Is,className:`flex items-center gap-2 px-4 py-2 rounded-lg shadow-sm transition-all duration-300 font-medium ${se?"bg-green-500 text-white shadow-md hover:shadow-lg":"bg-white/60 backdrop-blur-sm border border-white/30 text-gray-700 hover:bg-white/70 hover:shadow-md"}`,children:[e.jsx(ms,{size:16}),e.jsx("span",{children:se?"Auto On":"Auto Off"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>I(!N),className:"flex items-center gap-2 px-4 py-2 bg-white/60 backdrop-blur-sm border border-white/30 rounded-lg shadow-sm hover:bg-white/70 hover:shadow-md transition-all duration-300 text-gray-700 font-medium",children:[e.jsx(Rr,{size:16}),e.jsx("span",{children:"Filters"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>Y(!$),className:"relative p-2 bg-white/60 backdrop-blur-sm border border-white/30 rounded-lg shadow-sm hover:bg-white/70 transition-all duration-300 hover:shadow-md",children:[e.jsx(Mr,{size:16,className:"text-gray-600"}),U.filter(xe=>!xe.read).length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center animate-pulse",children:U.filter(xe=>!xe.read).length})]}),$&&e.jsxs("div",{className:"absolute right-0 mt-2 w-72 bg-white/90 backdrop-blur-xl rounded-xl shadow-2xl border border-white/30 z-50",children:[e.jsx("div",{className:"p-3 border-b border-gray-100",children:e.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:"Notifications"})}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:U.length===0?e.jsx("div",{className:"p-3 text-center text-gray-500 text-sm",children:"No notifications"}):U.map(xe=>e.jsx("div",{className:`p-3 border-b border-gray-50 hover:bg-gray-50/50 cursor-pointer transition-colors ${xe.read?"":"bg-blue-50/50"}`,onClick:()=>as(xe.id),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:`mt-0.5 p-1 rounded-full ${xe.type==="warning"?"bg-yellow-100 text-yellow-600":xe.type==="error"?"bg-red-100 text-red-600":xe.type==="success"?"bg-green-100 text-green-600":"bg-blue-100 text-blue-600"}`,children:xe.type==="warning"?e.jsx(dr,{size:12}):xe.type==="error"?e.jsx(Ht,{size:12}):xe.type==="success"?e.jsx(yt,{size:12}):e.jsx(Bs,{size:12})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-900",children:xe.message}),e.jsx("p",{className:"text-xs text-gray-500",children:xe.time})]})]})},xe.id))})]})]})]}),me&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:Es,className:"flex items-center gap-2 px-4 py-2 bg-orange-500 text-white rounded-lg shadow-sm hover:bg-orange-600 hover:shadow-md transition-all duration-300 font-medium",children:[e.jsx(Br,{size:16}),e.jsx("span",{children:"Export Data"})]}),e.jsxs("button",{onClick:ts,disabled:u,className:"flex items-center gap-2 px-4 py-2 bg-purple-500 text-white rounded-lg shadow-sm hover:bg-purple-600 hover:shadow-md transition-all duration-300 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Br,{size:16}),e.jsx("span",{children:u?"Downloading...":"Offline Mode"})]})]})]})]})}),it&&e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Bs,{size:20,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"Privacy Notice"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Customer information has been hidden to protect privacy. You can still view device status and repair progress."})]})]})})}),Qe.length>0&&e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"bg-white/20 backdrop-blur-lg rounded-2xl border border-white/30 shadow-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg",children:e.jsx(Cn,{size:20,className:"text-white"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Quick Actions"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Access frequently used features"})]}),e.jsx("div",{className:`grid gap-4 ${vt()}`,children:Qe.filter(xe=>me?!0:Ae?!xe.name.toLowerCase().includes("admin")&&!xe.name.toLowerCase().includes("system"):it?xe.name.toLowerCase().includes("device")||xe.name.toLowerCase().includes("repair")||xe.name.toLowerCase().includes("assessment"):!1).map((xe,pt)=>{const lt=xe.iconComponent;return e.jsx("button",{onClick:xe.action,className:`${Rt(xe)} rounded-xl hover:shadow-xl transition-all duration-300 group transform hover:scale-105 hover:-translate-y-1`,children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"group-hover:scale-110 transition-transform duration-300",children:e.jsx(lt,{size:ht()})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:`font-medium ${Se()}`,children:xe.name}),ve(xe)&&e.jsx("p",{className:"text-xs opacity-90 mt-1",children:xe.description})]})]})},xe.id)})})]})}),N&&e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"bg-white/20 backdrop-blur-lg rounded-2xl border border-white/30 shadow-xl p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Range"}),e.jsxs("select",{value:f,onChange:xe=>y(xe.target.value),className:"w-full p-3 bg-white/60 backdrop-blur-sm border border-white/30 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent shadow-sm",children:[e.jsx("option",{value:"7d",children:"Last 7 Days"}),e.jsx("option",{value:"30d",children:"Last 30 Days"}),e.jsx("option",{value:"90d",children:"Last 90 Days"}),e.jsx("option",{value:"1y",children:"Last Year"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status Filter"}),e.jsxs("select",{value:E,onChange:xe=>v(xe.target.value),className:"w-full p-3 bg-white/60 backdrop-blur-sm border border-white/30 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent shadow-sm",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"received",children:"Received"}),e.jsx("option",{value:"in-repair",children:"In Repair"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[(me||Ae)&&e.jsx("div",{className:"bg-white/20 backdrop-blur-lg rounded-2xl border border-white/30 shadow-xl p-6 hover:shadow-2xl transition-all duration-300 transform hover:scale-105",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl shadow-lg",children:e.jsx(Ns,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",(c==null?void 0:c.revenue.total.toLocaleString())||""]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[(c==null?void 0:c.revenue.growth)!==void 0&&(c==null?void 0:c.revenue.growth)>=0?e.jsx(vr,{size:16,className:"text-green-500"}):e.jsx(Sa,{size:16,className:"text-red-500"}),e.jsxs("span",{className:`text-sm font-medium ${(c==null?void 0:c.revenue.growth)!==void 0&&(c==null?void 0:c.revenue.growth)>=0?"text-green-600":"text-red-600"}`,children:[(c==null?void 0:c.revenue.growth)!==void 0?((c==null?void 0:c.revenue.growth)>=0?"+":"")+(c==null?void 0:c.revenue.growth.toFixed(1)):"","%"]})]})]})]})}),e.jsx("div",{className:"bg-white/20 backdrop-blur-lg rounded-2xl border border-white/30 shadow-xl p-6 hover:shadow-2xl transition-all duration-300 transform hover:scale-105",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl shadow-lg",children:e.jsx(ns,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Devices"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(c==null?void 0:c.devices.total)||""}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[c==null?void 0:c.devices.completed," completed"]})]})]})}),kt&&e.jsx("div",{className:"bg-white/20 backdrop-blur-lg rounded-2xl border border-white/30 shadow-xl p-6 hover:shadow-2xl transition-all duration-300 transform hover:scale-105",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-500 to-violet-600 rounded-xl shadow-lg",children:e.jsx(_s,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Customers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(c==null?void 0:c.customers.total)||""}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[c==null?void 0:c.customers.newThisMonth," new this month"]})]})]})}),e.jsx("div",{className:"bg-white/20 backdrop-blur-lg rounded-2xl border border-white/30 shadow-xl p-6 hover:shadow-2xl transition-all duration-300 transform hover:scale-105",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-orange-500 to-red-600 rounded-xl shadow-lg",children:e.jsx(ms,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Repair Time"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[(c==null?void 0:c.performance.avgRepairTime.toFixed(1))||"","d"]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[(c==null?void 0:c.performance.successRate.toFixed(1))||"","% success rate"]})]})]})}),e.jsx(Hx,{}),e.jsxs("div",{className:"bg-white/20 backdrop-blur-lg rounded-2xl border border-white/30 shadow-xl p-6 hover:shadow-2xl transition-all duration-300 transform hover:scale-105",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl shadow-lg",children:e.jsx(Ft,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Repair Status"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[(c==null?void 0:c.devices.inProgress)||0," Active"]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[(c==null?void 0:c.devices.completed)||0," completed today"]})]})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"In Progress"}),e.jsx("span",{className:"font-medium",children:(c==null?void 0:c.devices.inProgress)||0})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${c!=null&&c.devices.total?(c.devices.inProgress||0)/c.devices.total*100:0}%`}})}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Completed"}),e.jsx("span",{className:"font-medium",children:(c==null?void 0:c.devices.completed)||0})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-green-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${c!=null&&c.devices.total?(c.devices.completed||0)/c.devices.total*100:0}%`}})}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Overdue"}),e.jsx("span",{className:"font-medium",children:(c==null?void 0:c.devices.overdue)||0})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-red-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${c!=null&&c.devices.total?(c.devices.overdue||0)/c.devices.total*100:0}%`}})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Activity"}),e.jsx(fr,{size:20,className:"text-gray-400"})]}),e.jsx("div",{className:"space-y-3",children:L.filter(xe=>it?!xe.type.includes("customer")&&!xe.message.toLowerCase().includes("customer"):!0).map(xe=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:`p-2 rounded-full bg-gray-100 ${xe.color}`,children:xe.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:xe.message}),e.jsx("p",{className:"text-xs text-gray-500",children:xe.time})]})]},xe.id))})]}),e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Device Status"}),e.jsx(Qi,{size:20,className:"text-gray-400"})]}),e.jsx("div",{className:"space-y-3",children:c==null?void 0:c.trends.statusDistribution.map(xe=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${xe.status==="completed"?"bg-green-500":xe.status==="in-repair"?"bg-blue-500":xe.status==="received"?"bg-yellow-500":"bg-gray-500"}`}),e.jsx("span",{className:"text-sm font-medium capitalize",children:xe.status})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-bold",children:xe.count}),e.jsxs("p",{className:"text-xs text-gray-500",children:[xe.percentage.toFixed(1),"%"]})]})]},xe.status))})]}),e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Performance"}),e.jsx(Va,{size:20,className:"text-gray-400"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Success Rate"}),e.jsxs("span",{children:[(c==null?void 0:c.performance.successRate.toFixed(1))||"","%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${(c==null?void 0:c.performance.successRate)||0}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Customer Satisfaction"}),e.jsxs("span",{children:[(c==null?void 0:c.performance.customerSatisfaction)||"","%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${(c==null?void 0:c.performance.customerSatisfaction)||0}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Technician Efficiency"}),e.jsxs("span",{children:[(c==null?void 0:c.performance.technicianEfficiency)||"","%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-500 h-2 rounded-full",style:{width:`${(c==null?void 0:c.performance.technicianEfficiency)||0}%`}})})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Technicians"}),e.jsx(_s,{size:20,className:"text-gray-400"})]}),e.jsx("div",{className:"space-y-3",children:c!=null&&c.topTechnicians&&c.topTechnicians.length>0?c.topTechnicians.map((xe,pt)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-blue-600",children:pt+1})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:xe.name||"Unknown Technician"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[xe.completedDevices||0," devices"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold",children:[(xe.avgTime||0).toFixed(1),"d avg"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["⭐ ",(xe.satisfaction||0).toFixed(1)]})]})]},xe.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_s,{size:32,className:"mx-auto text-gray-300 mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No top technicians data available"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Check if technicians exist and have completed repairs"})]})})]}),kt&&e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Customers"}),e.jsx(_s,{size:20,className:"text-gray-400"})]}),e.jsx("div",{className:"space-y-3",children:c!=null&&c.topCustomers&&c.topCustomers.length>0?c.topCustomers.map((xe,pt)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-green-600",children:pt+1})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:xe.name||"Unknown Customer"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[xe.totalDevices||0," devices"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold",children:["$",(xe.totalSpent||0).toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500",children:xe.lastVisit?new Date(xe.lastVisit).toLocaleDateString():"N/A"})]})]},xe.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_s,{size:32,className:"mx-auto text-gray-300 mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No top customers data available"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Check if top_customers_view exists in database"})]})})]})]}),e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Revenue & Device Trends"}),e.jsx(zr,{size:20,className:"text-gray-400"})]}),e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(zr,{size:48,className:"mx-auto text-gray-300 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Interactive charts coming soon"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Revenue trends and device processing analytics"})]})})]}),me&&e.jsxs(he,{className:"mb-6",children:[e.jsxs("h2",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Xr,{size:20})," SMS Analytics"]}),He?e.jsx("div",{className:"p-4",children:e.jsx("span",{children:"Loading SMS stats..."})}):fe?e.jsxs("div",{className:"flex flex-wrap gap-6 p-4",children:[e.jsxs("div",{className:"min-w-[120px]",children:[e.jsx(Tr,{size:18})," Sent: ",e.jsx("b",{children:fe.sent})]}),e.jsxs("div",{className:"min-w-[120px]",children:[e.jsx(Ht,{size:18,className:"text-yellow-500"})," Failed: ",e.jsx("b",{children:fe.failed})]}),e.jsxs("div",{className:"min-w-[120px]",children:[e.jsx(yt,{size:18,className:"text-green-500"})," Delivered: ",e.jsx("b",{children:fe.delivered})]})]}):e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx(Xr,{size:32,className:"mx-auto mb-2"}),e.jsx("p",{children:"No SMS data available"})]})]}),e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Activity"}),e.jsx(fr,{size:20,className:"text-gray-400"})]}),e.jsx("div",{className:"space-y-3",children:L.length>0?L.map(xe=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:`p-2 rounded-full ${xe.color}`,children:xe.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:xe.message}),e.jsx("p",{className:"text-xs text-gray-500",children:xe.time})]})]},xe.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fr,{size:32,className:"mx-auto text-gray-300 mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No recent activity"})]})})]})]})})]}):e.jsx("div",{className:"min-h-screen",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ht,{size:48,className:"mx-auto text-red-500 mb-4"}),e.jsx("p",{className:"text-red-600",children:"No analytics data loaded. Click Refresh to load."}),e.jsxs(X,{onClick:gt,className:"mt-4",children:[e.jsx(us,{size:16}),"Refresh"]})]})})})},Yx=()=>e.jsxs("div",{children:[e.jsx(Go,{position:"top-right"}),e.jsx(Wx,{})]}),Xx=()=>{var m,u;const[r,a]=g.useState("default"),i=[{id:"default",name:"Default Main Background",class:""},{id:"s-curve-red-blue",name:"S-Curve Red-Blue",class:"s-curve-red-blue"},{id:"warm-gradient",name:"Warm Gradient",class:"warm-gradient"},{id:"cool-gradient",name:"Cool Gradient",class:"cool-gradient"},{id:"sunset",name:"Sunset",class:"sunset"},{id:"ocean",name:"Ocean",class:"ocean"},{id:"forest",name:"Forest",class:"forest"},{id:"animated-gradient",name:"Animated Gradient",class:"animated-gradient"},{id:"dark-mode",name:"Dark Mode",class:"dark-mode"},{id:"pos-wallpaper",name:"POS Page",class:"pos-wallpaper"},{id:"database-wallpaper",name:"Database Setup",class:"database-wallpaper"},{id:"admin-wallpaper",name:"Admin Dashboard",class:"admin-wallpaper"},{id:"mobile-wallpaper",name:"Mobile Optimized",class:"mobile-wallpaper"},{id:"glass-overlay",name:"Glass Morphism Overlay",class:"glass-overlay"}],c=((m=i.find(x=>x.id===r))==null?void 0:m.class)||"";return e.jsx("div",{className:`min-h-screen transition-all duration-500 ${c}`,style:{backgroundAttachment:"fixed",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"glass rounded-lg p-6 mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-4",children:"🎨 Wallpaper Preview"}),e.jsx("p",{className:"text-white/80 mb-6",children:"Click on any wallpaper to see it applied to the background"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:i.map(x=>e.jsx("button",{onClick:()=>a(x.id),className:`p-4 rounded-lg transition-all duration-300 ${r===x.id?"ring-4 ring-white ring-opacity-50 scale-105":"hover:scale-105"}`,style:{background:x.id==="default"?"radial-gradient(ellipse at center, #e0f7fa 0%, #b3e5fc 40%, #039be5 80%, #01579b 100%)":x.id==="s-curve-red-blue"?"radial-gradient(ellipse at 20% 80%, #ff4757 0%, #ff6b6b 25%, #ee5a52 50%, #c44569 75%, #2f3542 100%), radial-gradient(ellipse at 80% 20%, #00d2d3 0%, #00b894 25%, #00a8ff 50%, #0984e3 75%, #0652dd 100%)":x.id==="warm-gradient"?"linear-gradient(135deg, #ff6b35 0%, #f7931e 15%, #ffb3ba 30%, #87ceeb 50%, #dda0dd 70%, #e6e6fa 85%, #f0f8ff 100%)":x.id==="cool-gradient"?"linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%)":x.id==="sunset"?"linear-gradient(135deg, #ff9a9e 0%, #fecfef 25%, #fecfef 50%, #ffc3a0 75%, #ffafbd 100%)":x.id==="ocean"?"linear-gradient(135deg, #667db6 0%, #0082c8 25%, #0082c8 50%, #667db6 75%, #0082c8 100%)":x.id==="forest"?"linear-gradient(135deg, #134e5e 0%, #71b280 25%, #71b280 50%, #134e5e 75%, #71b280 100%)":x.id==="animated-gradient"?"linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab)":x.id==="dark-mode"?"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)":x.id==="pos-wallpaper"?"#668CB5":x.id==="database-wallpaper"?"linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%)":x.id==="admin-wallpaper"?"linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%)":x.id==="mobile-wallpaper"?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":x.id==="glass-overlay"?"radial-gradient(circle at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%), radial-gradient(circle at 40% 60%, rgba(16, 185, 129, 0.1) 0%, transparent 50%)":"transparent"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-white font-semibold text-sm",children:x.name}),r===x.id&&e.jsx("div",{className:"text-white/80 text-xs mt-1",children:"✓ Active"})]})},x.id))})]}),e.jsxs("div",{className:"glass rounded-lg p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-4",children:["Current Wallpaper: ",(u=i.find(x=>x.id===r))==null?void 0:u.name]}),e.jsxs("div",{className:"text-white/80",children:[e.jsx("p",{className:"mb-2",children:"This preview shows how the wallpaper looks in your app."}),e.jsxs("p",{className:"mb-4",children:["To use this wallpaper in your app, add the class ",e.jsx("code",{className:"bg-white/20 px-2 py-1 rounded",children:c||"default"})," to your body element."]}),e.jsxs("div",{className:"bg-white/10 rounded p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"CSS Class:"}),e.jsx("code",{className:"text-sm",children:c||"default (no class needed)"})]})]})]})]})})},Kx=()=>{const{currentUser:r}=Wt(),[a,i]=g.useState([]),[c,m]=g.useState([]),[u,x]=g.useState(!0),[j,b]=g.useState(""),[f,y]=g.useState("all"),[N,I]=g.useState(!1),[R,k]=g.useState(!1),[E,v]=g.useState(null),[U,F]=g.useState(!1),[L,C]=g.useState(!1),[$,Y]=g.useState({name:"",logo_url:"",description:"",category:"phone",categories:["phone"]}),[A,Z]=g.useState(""),[_,D]=g.useState(""),T=[{value:"all",label:"All Categories"},{value:"phone",label:"Phone"},{value:"laptop",label:"Laptop"},{value:"tablet",label:"Tablet"},{value:"desktop",label:"Desktop"},{value:"printer",label:"Printer"},{value:"smartwatch",label:"Smartwatch"},{value:"headphones",label:"Headphones"},{value:"speaker",label:"Speaker"},{value:"camera",label:"Camera"},{value:"gaming",label:"Gaming"},{value:"accessories",label:"Accessories"},{value:"monitor",label:"Monitor"},{value:"keyboard",label:"Keyboard"},{value:"mouse",label:"Mouse"},{value:"webcam",label:"Webcam"},{value:"microphone",label:"Microphone"},{value:"router",label:"Router"},{value:"modem",label:"Modem"},{value:"scanner",label:"Scanner"},{value:"projector",label:"Projector"},{value:"server",label:"Server"},{value:"network",label:"Network"},{value:"storage",label:"Storage"},{value:"other",label:"Other"}];g.useEffect(()=>{z()},[U]),g.useEffect(()=>{const ye=Q=>{Q.key==="Escape"&&R&&B()};return R&&document.addEventListener("keydown",ye),()=>{document.removeEventListener("keydown",ye)}},[R]),g.useEffect(()=>{se()},[a,j,f]);const z=async()=>{try{x(!0);const ye=U?await Pc():await wl();i(ye)}catch(ye){Z("Failed to fetch brands"),console.error("Error fetching brands:",ye)}finally{x(!1)}},se=()=>{let ye=a;j&&(ye=ye.filter(Le=>{var Ue;return Le.name.toLowerCase().includes(j.toLowerCase())||((Ue=Le.description)==null?void 0:Ue.toLowerCase().includes(j.toLowerCase()))})),f!=="all"&&(ye=ye.filter(Le=>(Array.isArray(Le.category)?Le.category:Le.category?[Le.category]:[]).includes(f)||Le.categories&&Le.categories.includes(f)));const Q=["Apple","Samsung","Google","Microsoft","Lenovo","HP","Dell","Huawei","Xiaomi","OnePlus","Sony","LG","Motorola","Nokia","Tecno","Infinix","Itel","HTC","Asus","Acer","Canon","Epson","Brother"];ye.sort((Le,Ue)=>{const Ct=Q.indexOf(Le.name),Re=Q.indexOf(Ue.name);return Ct!==-1&&Re!==-1?Ct-Re:Ct!==-1&&Re===-1?-1:Ct===-1&&Re!==-1?1:Le.name.localeCompare(Ue.name)}),m(ye)},q=async ye=>{if(b(ye),ye.length>2)try{const Q=await $c(ye);m(Q)}catch(Q){console.error("Error searching brands:",Q)}},H=async ye=>{ye.preventDefault();try{Z(""),await Fc($),D("Brand created successfully"),I(!1),fe(),z()}catch(Q){Z(Q.message||"Failed to create brand")}},J=async ye=>{if(ye.preventDefault(),!!E)try{C(!0),Z(""),await Bc(E.id,$),D("Brand updated successfully"),v(null),k(!1),fe(),z()}catch(Q){Z(Q.message||"Failed to update brand")}finally{C(!1)}},V=async ye=>{if(confirm(`Are you sure you want to delete "${ye.name}"?`))try{Z(""),await zc(ye.id),D("Brand deleted successfully"),z()}catch(Q){Z(Q.message||"Failed to delete brand")}},ge=async ye=>{if(confirm(`Are you sure you want to restore "${ye.name}"?`))try{Z(""),await Uc(ye.id),D("Brand restored successfully"),z()}catch(Q){Z(Q.message||"Failed to restore brand")}},He=ye=>{var Q;v(ye),Y({name:ye.name,logo_url:ye.logo_url||"",description:ye.description||"",category:((Q=ye.category)==null?void 0:Q[0])||"phone",categories:ye.category||ye.categories||["phone"]}),k(!0)},B=()=>{v(null),k(!1),fe()},fe=()=>{Y({name:"",logo_url:"",description:"",category:"phone",categories:["phone"]})},re=ye=>{const Q={phone:"bg-blue-100 text-blue-800",laptop:"bg-green-100 text-green-800",tablet:"bg-purple-100 text-purple-800",desktop:"bg-orange-100 text-orange-800",printer:"bg-red-100 text-red-800",smartwatch:"bg-pink-100 text-pink-800",headphones:"bg-indigo-100 text-indigo-800",speaker:"bg-yellow-100 text-yellow-800",camera:"bg-teal-100 text-teal-800",gaming:"bg-cyan-100 text-cyan-800",accessories:"bg-amber-100 text-amber-800",monitor:"bg-emerald-100 text-emerald-800",keyboard:"bg-violet-100 text-violet-800",mouse:"bg-slate-100 text-slate-800",webcam:"bg-rose-100 text-rose-800",microphone:"bg-sky-100 text-sky-800",router:"bg-lime-100 text-lime-800",modem:"bg-fuchsia-100 text-fuchsia-800",scanner:"bg-orange-100 text-orange-800",projector:"bg-indigo-100 text-indigo-800",server:"bg-gray-100 text-gray-800",network:"bg-blue-100 text-blue-800",storage:"bg-green-100 text-green-800",other:"bg-gray-100 text-gray-800"};return Q[ye]||Q.other};return u?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"p-2 rounded-lg bg-white/50 backdrop-blur-sm hover:bg-white/70 transition-colors",children:e.jsx(zs,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Brand Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage device brands used in the system"}),e.jsx("div",{className:"mt-2",children:e.jsx("a",{href:"/category-management",className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Manage Categories →"})})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:U,onChange:ye=>F(ye.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Show deleted brands"})]}),e.jsxs("button",{onClick:()=>I(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Ut,{size:20}),"Add Brand"]})]})]}),A&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:A}),_&&e.jsx("div",{className:"mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg",children:_}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Cr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search brands...",value:j,onChange:ye=>q(ye.target.value),className:"w-full pl-12 pr-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Rr,{size:20,className:"text-gray-500"}),e.jsx("select",{value:f,onChange:ye=>y(ye.target.value),className:"px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",children:T.map(ye=>e.jsx("option",{value:ye.value,children:ye.label},ye.value))})]})]})}),N&&e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Add New Brand"}),e.jsx("button",{onClick:()=>I(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(tr,{size:20})})]}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Brand Name *"}),e.jsx("input",{type:"text",value:$.name,onChange:ye=>Y({...$,name:ye.target.value}),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",placeholder:"Enter brand name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categories"}),e.jsx("div",{className:"space-y-2",children:T.slice(1).map(ye=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:$.categories.includes(ye.value),onChange:Q=>{Q.target.checked?Y({...$,categories:[...$.categories,ye.value]}):Y({...$,categories:$.categories.filter(Le=>Le!==ye.value)})},className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:ye.label})]},ye.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Logo URL"}),e.jsx("input",{type:"url",value:$.logo_url,onChange:ye=>Y({...$,logo_url:ye.target.value}),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",placeholder:"https://example.com/logo.svg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:$.description,onChange:ye=>Y({...$,description:ye.target.value}),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",placeholder:"Enter brand description",rows:4})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"submit",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Hs,{size:20}),"Create Brand"]}),e.jsx("button",{type:"button",onClick:()=>I(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:c.map(ye=>e.jsxs("div",{className:`bg-white/90 backdrop-blur-sm rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow ${ye.is_active?"":"opacity-60 border-2 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[ye.logo_url?e.jsx("img",{src:ye.logo_url,alt:ye.name,className:"w-12 h-12 object-contain",onError:Q=>{Q.currentTarget.src="/logos/placeholder.svg"}}):e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 font-semibold text-lg",children:ye.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:ye.name}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[ye.category&&Array.isArray(ye.category)&&ye.category.length>0?ye.category.map((Q,Le)=>e.jsx("span",{className:`inline-block px-2 py-1 text-xs rounded-full ${re(Q)}`,children:Q},Le)):ye.categories&&ye.categories.length>0?ye.categories.map((Q,Le)=>e.jsx("span",{className:`inline-block px-2 py-1 text-xs rounded-full ${re(Q)}`,children:Q},Le)):e.jsx("span",{className:"inline-block px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800",children:"other"}),!ye.is_active&&e.jsx("span",{className:"inline-block px-2 py-1 text-xs rounded-full bg-red-100 text-red-800",children:"Deleted"})]})]})]}),e.jsx("div",{className:"flex gap-1",children:ye.is_active?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>He(ye),className:"p-1 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Edit brand",children:e.jsx(Ts,{size:16})}),e.jsx("button",{onClick:()=>V(ye),className:"p-1 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Delete brand",children:e.jsx(er,{size:16})})]}):e.jsx("button",{onClick:()=>ge(ye),className:"p-1 text-green-600 hover:bg-green-50 rounded transition-colors",title:"Restore brand",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),e.jsx("path",{d:"M21 3v5h-5"}),e.jsx("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),e.jsx("path",{d:"M3 21v-5h5"})]})})})]}),ye.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:ye.description}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Created: ",new Date(ye.created_at).toLocaleDateString()]})]},ye.id))}),c.length===0&&!u&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-500 text-lg",children:"No brands found"}),e.jsx("p",{className:"text-gray-400 mt-2",children:j||f!=="all"?"Try adjusting your search or filters":"Add your first brand to get started"})]}),R&&E&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:ye=>{ye.target===ye.currentTarget&&B()},children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Edit Brand: ",E.name]}),e.jsx("button",{onClick:B,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(tr,{size:20})})]}),e.jsxs("form",{onSubmit:J,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Brand Name *"}),e.jsx("input",{type:"text",value:$.name,onChange:ye=>Y({...$,name:ye.target.value}),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",placeholder:"Enter brand name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categories"}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:T.slice(1).map(ye=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:$.categories.includes(ye.value),onChange:Q=>{Q.target.checked?Y({...$,categories:[...$.categories,ye.value]}):Y({...$,categories:$.categories.filter(Le=>Le!==ye.value)})},className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:ye.label})]},ye.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Logo URL"}),e.jsx("input",{type:"url",value:$.logo_url,onChange:ye=>Y({...$,logo_url:ye.target.value}),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",placeholder:"https://example.com/logo.svg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:$.description,onChange:ye=>Y({...$,description:ye.target.value}),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",placeholder:"Enter brand description",rows:4})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"submit",disabled:L,className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${L?"bg-gray-400 text-white cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:L?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Updating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Hs,{size:20}),e.jsx("span",{children:"Update Brand"})]})}),e.jsx("button",{type:"button",onClick:B,disabled:L,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})]})})]})})},Zx=async()=>{try{const{data:r,error:a}=await G.from("inventory_categories").select("*").order("name");if(a)throw a;return r||[]}catch(r){throw console.error("Error fetching categories:",r),r}},Qx=async()=>{try{const{data:r,error:a}=await G.from("inventory_categories").select("*").eq("is_active",!0).order("name");if(a)throw a;return r||[]}catch(r){throw console.error("Error fetching active categories:",r),r}},Jx=async r=>{try{const{data:a,error:i}=await G.from("inventory_categories").insert([{...r,is_active:r.is_active??!0}]).select().single();if(i)throw i;return a}catch(a){throw console.error("Error creating category:",a),a}},eg=async(r,a)=>{try{const{data:i,error:c}=await G.from("inventory_categories").update({...a,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(c)throw c;return i}catch(i){throw console.error("Error updating category:",i),i}},tg=async r=>{try{const{error:a}=await G.from("inventory_categories").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",r);if(a)throw a}catch(a){throw console.error("Error deleting category:",a),a}},sg=async r=>{try{const{error:a}=await G.from("inventory_categories").update({is_active:!0,updated_at:new Date().toISOString()}).eq("id",r);if(a)throw a}catch(a){throw console.error("Error restoring category:",a),a}},rg=()=>{const[r,a]=g.useState([]),[i,c]=g.useState([]),[m,u]=g.useState(!0),[x,j]=g.useState(""),[b,f]=g.useState(""),[y,N]=g.useState(""),[I,R]=g.useState(!1),[k,E]=g.useState(!1),[v,U]=g.useState(null),[F,L]=g.useState(!1),[C,$]=g.useState(!1),[Y,A]=g.useState({name:"",description:"",color:"#3B82F6"}),Z=[{value:"#3B82F6",label:"Blue"},{value:"#10B981",label:"Green"},{value:"#8B5CF6",label:"Purple"},{value:"#F59E0B",label:"Orange"},{value:"#EF4444",label:"Red"},{value:"#EC4899",label:"Pink"},{value:"#6366F1",label:"Indigo"},{value:"#EAB308",label:"Yellow"},{value:"#14B8A6",label:"Teal"},{value:"#06B6D4",label:"Cyan"},{value:"#F97316",label:"Amber"},{value:"#059669",label:"Emerald"},{value:"#7C3AED",label:"Violet"},{value:"#475569",label:"Slate"},{value:"#E11D48",label:"Rose"},{value:"#0284C7",label:"Sky"},{value:"#84CC16",label:"Lime"},{value:"#C026D3",label:"Fuchsia"},{value:"#EA580C",label:"Orange"},{value:"#4F46E5",label:"Indigo"},{value:"#6B7280",label:"Gray"}];g.useEffect(()=>{_()},[C]),g.useEffect(()=>{const B=fe=>{fe.key==="Escape"&&k&&V()};return k&&document.addEventListener("keydown",B),()=>{document.removeEventListener("keydown",B)}},[k]),g.useEffect(()=>{D()},[r,y]);const _=async()=>{try{u(!0),j("");const B=C?await Zx():await Qx();a(B),c(B)}catch(B){j("Failed to fetch categories"),console.error("Error fetching categories:",B)}finally{u(!1)}},D=()=>{let B=r;y&&(B=B.filter(fe=>{var re;return fe.name.toLowerCase().includes(y.toLowerCase())||((re=fe.description)==null?void 0:re.toLowerCase().includes(y.toLowerCase()))})),c(B)},T=B=>{N(B)},z=async B=>{B.preventDefault();try{j("");const fe={name:Y.name.trim(),description:Y.description.trim(),color:Y.color},re=await Jx(fe);a(ye=>[re,...ye]),c(ye=>[re,...ye]),f("Category created successfully"),R(!1),ge()}catch(fe){j(fe.message||"Failed to create category")}},se=async B=>{if(B.preventDefault(),!!v)try{L(!0),j("");const fe={name:Y.name.trim(),description:Y.description.trim(),color:Y.color},re=await eg(v.id,fe);a(ye=>ye.map(Q=>Q.id===v.id?re:Q)),c(ye=>ye.map(Q=>Q.id===v.id?re:Q)),f("Category updated successfully"),U(null),E(!1),ge()}catch(fe){j(fe.message||"Failed to update category")}finally{L(!1)}},q=async B=>{if(confirm(`Are you sure you want to delete "${B.name}"?`))try{j(""),await tg(B.id),a(fe=>fe.map(re=>re.id===B.id?{...re,is_active:!1,updated_at:new Date().toISOString()}:re)),c(fe=>fe.map(re=>re.id===B.id?{...re,is_active:!1,updated_at:new Date().toISOString()}:re)),f("Category deleted successfully")}catch(fe){j(fe.message||"Failed to delete category")}},H=async B=>{try{j(""),await sg(B.id),a(fe=>fe.map(re=>re.id===B.id?{...re,is_active:!0,updated_at:new Date().toISOString()}:re)),c(fe=>fe.map(re=>re.id===B.id?{...re,is_active:!0,updated_at:new Date().toISOString()}:re)),f("Category restored successfully")}catch(fe){j(fe.message||"Failed to restore category")}},J=B=>{U(B),A({name:B.name,description:B.description||"",color:B.color}),E(!0)},V=()=>{U(null),E(!1),ge()},ge=()=>{A({name:"",description:"",color:"#3B82F6"})},He=B=>{const fe={"#3B82F6":"bg-blue-100 text-blue-800","#10B981":"bg-green-100 text-green-800","#8B5CF6":"bg-purple-100 text-purple-800","#F59E0B":"bg-orange-100 text-orange-800","#EF4444":"bg-red-100 text-red-800","#EC4899":"bg-pink-100 text-pink-800","#6366F1":"bg-indigo-100 text-indigo-800","#EAB308":"bg-yellow-100 text-yellow-800","#14B8A6":"bg-teal-100 text-teal-800","#06B6D4":"bg-cyan-100 text-cyan-800","#F97316":"bg-amber-100 text-amber-800","#059669":"bg-emerald-100 text-emerald-800","#7C3AED":"bg-violet-100 text-violet-800","#475569":"bg-slate-100 text-slate-800","#E11D48":"bg-rose-100 text-rose-800","#0284C7":"bg-sky-100 text-sky-800","#84CC16":"bg-lime-100 text-lime-800","#C026D3":"bg-fuchsia-100 text-fuchsia-800","#EA580C":"bg-orange-100 text-orange-800","#4F46E5":"bg-indigo-100 text-indigo-800","#6B7280":"bg-gray-100 text-gray-800"};return fe[B]||fe["#6B7280"]};return m?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"p-2 rounded-lg bg-white/50 backdrop-blur-sm hover:bg-white/70 transition-colors",children:e.jsx(zs,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Category Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage device categories used in the system"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:B=>$(B.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Show deleted categories"})]}),e.jsxs("button",{onClick:()=>R(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Ut,{size:20}),"Add Category"]})]})]}),x&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:x}),b&&e.jsx("div",{className:"mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg",children:b}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-lg p-4 mb-6",children:e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Cr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search categories...",value:y,onChange:B=>T(B.target.value),className:"w-full pl-12 pr-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"})]})})})}),I&&e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Add New Category"}),e.jsx("button",{onClick:()=>R(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(tr,{size:20})})]}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category Name *"}),e.jsx("input",{type:"text",value:Y.name,onChange:B=>A({...Y,name:B.target.value}),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",placeholder:"Enter category name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Color"}),e.jsx("select",{value:Y.color,onChange:B=>A({...Y,color:B.target.value}),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",children:Z.map(B=>e.jsx("option",{value:B.value,children:B.label},B.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:Y.description,onChange:B=>A({...Y,description:B.target.value}),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",placeholder:"Enter category description",rows:3})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Add Category"}),e.jsx("button",{type:"button",onClick:()=>R(!1),className:"px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors",children:"Cancel"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:i.map(B=>e.jsxs("div",{className:`bg-white/90 backdrop-blur-sm rounded-lg p-6 shadow-sm hover:shadow-md transition-all duration-200 ${B.is_active?"":"opacity-60 border-2 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:B.name}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`inline-block px-3 py-1 text-sm rounded-full ${He(B.color)}`,style:{backgroundColor:B.color+"20",color:B.color},children:B.name}),!B.is_active&&e.jsx("span",{className:"inline-block px-2 py-1 text-xs rounded-full bg-red-100 text-red-800",children:"Deleted"})]})]}),e.jsx("div",{className:"flex gap-1",children:B.is_active?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>J(B),className:"p-1 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Edit category",children:e.jsx(Ts,{size:16})}),e.jsx("button",{onClick:()=>q(B),className:"p-1 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Delete category",children:e.jsx(er,{size:16})})]}):e.jsx("button",{onClick:()=>H(B),className:"p-1 text-green-600 hover:bg-green-50 rounded transition-colors",title:"Restore category",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),e.jsx("path",{d:"M21 3v5h-5"}),e.jsx("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),e.jsx("path",{d:"M3 21v-5h5"})]})})})]}),B.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:B.description}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Created: ",new Date(B.created_at).toLocaleDateString()]})]},B.id))}),i.length===0&&!m&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-500 text-lg",children:"No categories found"}),e.jsx("p",{className:"text-gray-400 mt-2",children:y?"Try adjusting your search":"Add your first category to get started"})]}),k&&v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:B=>{B.target===B.currentTarget&&V()},children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Edit Category: ",v.name]}),e.jsx("button",{onClick:V,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(tr,{size:20})})]}),e.jsxs("form",{onSubmit:se,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category Name *"}),e.jsx("input",{type:"text",value:Y.name,onChange:B=>A({...Y,name:B.target.value}),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",placeholder:"Enter category name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Color"}),e.jsx("select",{value:Y.color,onChange:B=>A({...Y,color:B.target.value}),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",children:Z.map(B=>e.jsx("option",{value:B.value,children:B.label},B.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:Y.description,onChange:B=>A({...Y,description:B.target.value}),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",placeholder:"Enter category description",rows:3})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"submit",disabled:F,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:F?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Updating..."]}):"Update Category"}),e.jsx("button",{type:"button",onClick:V,disabled:F,className:"px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors disabled:opacity-50",children:"Cancel"})]})]})]})})]})})},ag=()=>{const[r,a]=g.useState(!1),[i,c]=g.useState(null),m=async()=>{a(!0),c(null);try{const{error:j}=await G.rpc("exec_sql",{sql:`
          CREATE TABLE IF NOT EXISTS brands (
            id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
            name TEXT NOT NULL UNIQUE,
            logo_url TEXT,
            description TEXT,
            category TEXT CHECK (category IN ('phone', 'laptop', 'tablet', 'desktop', 'printer', 'other')),
            is_active BOOLEAN NOT NULL DEFAULT true,
            created_by UUID REFERENCES auth_users(id),
            created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
            updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
          );
        `});if(j)throw new Error(`Table creation failed: ${j.message}`);const{error:b}=await G.rpc("exec_sql",{sql:`
          CREATE INDEX IF NOT EXISTS idx_brands_name ON brands(name);
          CREATE INDEX IF NOT EXISTS idx_brands_category ON brands(category);
          CREATE INDEX IF NOT EXISTS idx_brands_active ON brands(is_active);
        `});b&&console.warn("Index creation failed:",b.message);const{error:f}=await G.rpc("exec_sql",{sql:`
          INSERT INTO brands (name, logo_url, category, description) VALUES
            ('Apple', '/logos/apple.svg', 'phone', 'Apple Inc. devices including iPhone, iPad, and Mac'),
            ('Samsung', '/logos/samsung.svg', 'phone', 'Samsung Electronics devices'),
            ('Google', '/logos/google.svg', 'phone', 'Google Pixel devices'),
            ('Microsoft', '/logos/microsoft.svg', 'laptop', 'Microsoft Surface and Windows devices'),
            ('Lenovo', '/logos/lenovo.svg', 'laptop', 'Lenovo laptops and desktops'),
            ('HP', '/logos/hp.svg', 'laptop', 'Hewlett-Packard devices'),
            ('Dell', '/logos/dell.svg', 'laptop', 'Dell computers and laptops'),
            ('Huawei', '/logos/huawei.svg', 'phone', 'Huawei smartphones and tablets'),
            ('Xiaomi', '/logos/xiaomi.svg', 'phone', 'Xiaomi smartphones and IoT devices'),
            ('OnePlus', '/logos/oneplus.svg', 'phone', 'OnePlus smartphones'),
            ('Sony', '/logos/sony.svg', 'phone', 'Sony mobile devices'),
            ('LG', '/logos/lg.svg', 'phone', 'LG smartphones and TVs'),
            ('Motorola', '/logos/motorola.svg', 'phone', 'Motorola smartphones'),
            ('Nokia', '/logos/nokia.svg', 'phone', 'Nokia mobile devices'),
            ('Tecno', '/logos/tecno.svg', 'phone', 'Tecno mobile devices'),
            ('Infinix', '/logos/infinix.svg', 'phone', 'Infinix smartphones'),
            ('Itel', '/logos/itel.svg', 'phone', 'Itel mobile devices'),
            ('HTC', '/logos/htc.svg', 'phone', 'HTC smartphones'),
            ('Asus', '/logos/asus.svg', 'laptop', 'ASUS laptops and computers'),
            ('Acer', '/logos/acer.svg', 'laptop', 'Acer laptops and desktops'),
            ('Canon', '/logos/canon.svg', 'printer', 'Canon printers and cameras'),
            ('Epson', '/logos/epson.svg', 'printer', 'Epson printers and scanners'),
            ('Brother', '/logos/brother.svg', 'printer', 'Brother printers and scanners')
          ON CONFLICT (name) DO NOTHING;
        `});f&&console.warn("Default brands insertion failed:",f.message);const{error:y}=await G.rpc("exec_sql",{sql:`
          CREATE OR REPLACE FUNCTION update_brands_updated_at()
          RETURNS TRIGGER AS $$
          BEGIN
            NEW.updated_at = NOW();
            RETURN NEW;
          END;
          $$ LANGUAGE plpgsql;

          CREATE TRIGGER trigger_update_brands_updated_at
            BEFORE UPDATE ON brands
            FOR EACH ROW
            EXECUTE FUNCTION update_brands_updated_at();
        `});y&&console.warn("Trigger creation failed:",y.message),c({success:!0,message:"Brands table created successfully with default data!"})}catch(j){console.error("Database setup error:",j),c({success:!1,message:`Failed to create brands table: ${j.message}`})}finally{a(!1)}},u=async()=>{a(!0),c(null);try{const{error:j}=await G.rpc("exec_sql",{sql:`
          -- First, let's create a backup of the current brands data
          CREATE TABLE IF NOT EXISTS brands_backup AS SELECT * FROM brands;

          -- Update the brands table to use categories as JSON array
          ALTER TABLE brands 
          DROP CONSTRAINT IF EXISTS brands_category_check;

          -- Change category column to JSON type to store multiple categories
          ALTER TABLE brands 
          ALTER COLUMN category TYPE JSONB USING 
            CASE 
              WHEN category IS NULL THEN '[]'::jsonb
              WHEN category = '' THEN '[]'::jsonb
              ELSE jsonb_build_array(category)
            END;

          -- Add a check constraint to ensure categories is always an array
          ALTER TABLE brands 
          ADD CONSTRAINT brands_categories_check 
          CHECK (jsonb_typeof(category) = 'array');

          -- Update existing brands with common multiple categories
          UPDATE brands SET category = '["phone", "laptop", "tablet"]'::jsonb WHERE name ILIKE '%Apple%';
          UPDATE brands SET category = '["phone", "laptop", "tablet", "desktop"]'::jsonb WHERE name ILIKE '%Samsung%';
          UPDATE brands SET category = '["phone", "laptop", "tablet"]'::jsonb WHERE name ILIKE '%Google%';
          UPDATE brands SET category = '["laptop", "desktop", "tablet"]'::jsonb WHERE name ILIKE '%Microsoft%';
          UPDATE brands SET category = '["laptop", "desktop"]'::jsonb WHERE name ILIKE '%Lenovo%';
          UPDATE brands SET category = '["laptop", "desktop", "printer"]'::jsonb WHERE name ILIKE '%HP%';
          UPDATE brands SET category = '["laptop", "desktop"]'::jsonb WHERE name ILIKE '%Dell%';
          UPDATE brands SET category = '["phone", "laptop", "tablet"]'::jsonb WHERE name ILIKE '%Huawei%';
          UPDATE brands SET category = '["phone", "laptop", "tablet"]'::jsonb WHERE name ILIKE '%Xiaomi%';
          UPDATE brands SET category = '["phone"]'::jsonb WHERE name ILIKE '%OnePlus%';
          UPDATE brands SET category = '["phone", "laptop", "tablet"]'::jsonb WHERE name ILIKE '%Sony%';
          UPDATE brands SET category = '["phone", "laptop", "tablet"]'::jsonb WHERE name ILIKE '%LG%';
          UPDATE brands SET category = '["phone"]'::jsonb WHERE name ILIKE '%Motorola%';
          UPDATE brands SET category = '["phone"]'::jsonb WHERE name ILIKE '%Nokia%';
          UPDATE brands SET category = '["phone"]'::jsonb WHERE name ILIKE '%Tecno%';
          UPDATE brands SET category = '["phone"]'::jsonb WHERE name ILIKE '%Infinix%';
          UPDATE brands SET category = '["phone"]'::jsonb WHERE name ILIKE '%Itel%';
          UPDATE brands SET category = '["phone"]'::jsonb WHERE name ILIKE '%HTC%';
          UPDATE brands SET category = '["laptop", "desktop"]'::jsonb WHERE name ILIKE '%Asus%';
          UPDATE brands SET category = '["laptop", "desktop"]'::jsonb WHERE name ILIKE '%Acer%';
          UPDATE brands SET category = '["printer"]'::jsonb WHERE name ILIKE '%Canon%';
          UPDATE brands SET category = '["printer"]'::jsonb WHERE name ILIKE '%Epson%';
          UPDATE brands SET category = '["printer"]'::jsonb WHERE name ILIKE '%Brother%';

          -- Update any remaining brands that don't have categories set
          UPDATE brands SET category = '["other"]'::jsonb WHERE category IS NULL OR category = '[]'::jsonb;

          -- Create an index for better performance when querying by categories
          CREATE INDEX IF NOT EXISTS idx_brands_categories ON brands USING GIN (category);

          -- Add a function to check if a brand has a specific category
          CREATE OR REPLACE FUNCTION brand_has_category(brand_categories JSONB, search_category TEXT)
          RETURNS BOOLEAN AS $$
          BEGIN
            RETURN brand_categories ? search_category;
          END;
          $$ LANGUAGE plpgsql IMMUTABLE;
        `});if(j)throw new Error(`Migration failed: ${j.message}`);c({success:!0,message:"Successfully updated brands table to support multiple categories!"})}catch(j){c({success:!1,message:`Migration error: ${j.message}`})}finally{a(!1)}},x=async()=>{a(!0),c(null);try{const{error:j}=await G.rpc("exec_sql",{sql:`
          CREATE TABLE IF NOT EXISTS categories (
            id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
            name TEXT NOT NULL UNIQUE,
            description TEXT,
            color TEXT NOT NULL DEFAULT '#6B7280',
            is_active BOOLEAN NOT NULL DEFAULT true,
            created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
            updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
          );
        `});if(j)throw new Error(`Table creation failed: ${j.message}`);const{error:b}=await G.rpc("exec_sql",{sql:`
          CREATE INDEX IF NOT EXISTS idx_categories_name ON categories(name);
          CREATE INDEX IF NOT EXISTS idx_categories_active ON categories(is_active);
        `});b&&console.warn("Index creation failed:",b.message);const{error:f}=await G.rpc("exec_sql",{sql:`
          INSERT INTO categories (name, description, color) VALUES
            ('Phone', 'Mobile phones and smartphones', '#3B82F6'),
            ('Laptop', 'Portable computers and notebooks', '#10B981'),
            ('Tablet', 'Tablet computers and iPads', '#8B5CF6'),
            ('Desktop', 'Desktop computers and workstations', '#F59E0B'),
            ('Printer', 'Printers and scanners', '#EF4444'),
            ('Smartwatch', 'Smartwatches and fitness trackers', '#EC4899'),
            ('Headphones', 'Headphones and earphones', '#6366F1'),
            ('Speaker', 'Speakers and audio devices', '#EAB308'),
            ('Camera', 'Cameras and photography equipment', '#14B8A6'),
            ('Gaming', 'Gaming consoles and accessories', '#06B6D4'),
            ('Accessories', 'Device accessories and peripherals', '#F97316'),
            ('Monitor', 'Computer monitors and displays', '#059669'),
            ('Keyboard', 'Computer keyboards and input devices', '#7C3AED'),
            ('Mouse', 'Computer mice and pointing devices', '#475569'),
            ('Webcam', 'Web cameras and video devices', '#E11D48'),
            ('Microphone', 'Microphones and audio input devices', '#0284C7'),
            ('Router', 'Network routers and networking equipment', '#84CC16'),
            ('Modem', 'Internet modems and connectivity devices', '#C026D3'),
            ('Scanner', 'Document scanners and scanning devices', '#EA580C'),
            ('Projector', 'Projectors and display devices', '#4F46E5'),
            ('Server', 'Server computers and enterprise hardware', '#6B7280'),
            ('Network', 'Network equipment and infrastructure', '#3B82F6'),
            ('Storage', 'Storage devices and data solutions', '#10B981'),
            ('Other', 'Other device categories', '#6B7280')
          ON CONFLICT (name) DO NOTHING;
        `});f&&console.warn("Default categories insertion failed:",f.message);const{error:y}=await G.rpc("exec_sql",{sql:`
          CREATE OR REPLACE FUNCTION update_categories_updated_at()
          RETURNS TRIGGER AS $$
          BEGIN
            NEW.updated_at = NOW();
            RETURN NEW;
          END;
          $$ LANGUAGE plpgsql;

          CREATE TRIGGER trigger_update_categories_updated_at
            BEFORE UPDATE ON categories
            FOR EACH ROW
            EXECUTE FUNCTION update_categories_updated_at();
        `});y&&console.warn("Trigger creation failed:",y.message);const{error:N}=await G.rpc("exec_sql",{sql:`
          ALTER TABLE categories ENABLE ROW LEVEL SECURITY;

          -- Create policies
          CREATE POLICY "Categories are viewable by authenticated users" ON categories
            FOR SELECT USING (auth.role() = 'authenticated');

          CREATE POLICY "Categories are insertable by admin users" ON categories
            FOR INSERT WITH CHECK (auth.role() = 'authenticated');

          CREATE POLICY "Categories are updatable by admin users" ON categories
            FOR UPDATE USING (auth.role() = 'authenticated');

          CREATE POLICY "Categories are deletable by admin users" ON categories
            FOR DELETE USING (auth.role() = 'authenticated');
        `});N&&console.warn("RLS setup failed:",N.message),c({success:!0,message:"Categories table created successfully with default categories!"})}catch(j){c({success:!1,message:`Error: ${j instanceof Error?j.message:"Unknown error"}`})}finally{a(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"p-2 rounded-lg bg-white/50 backdrop-blur-sm hover:bg-white/70 transition-colors",children:e.jsx(zs,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Database Setup"}),e.jsx("p",{className:"text-gray-600",children:"Set up required database tables for the application"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ar,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Brands Table"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Create brands table for brand management"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{className:"mb-2",children:"This will create:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-gray-500",children:[e.jsx("li",{children:"Brands table with all necessary fields"}),e.jsx("li",{children:"Indexes for fast lookups"}),e.jsx("li",{children:"Default brands (Apple, Samsung, Google, etc.)"}),e.jsx("li",{children:"Automatic timestamp updates"})]})]}),e.jsx("button",{onClick:m,disabled:r,className:`w-full flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-colors ${r?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Creating Table..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ar,{className:"h-5 w-5"}),e.jsx("span",{children:"Create Brands Table"})]})})]})]}),e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(yt,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Setup Status"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Check database table status"})]})]}),e.jsxs("div",{className:"space-y-4",children:[i&&e.jsx("div",{className:`p-4 rounded-lg ${i.success?"bg-green-100 border border-green-300 text-green-800":"bg-red-100 border border-red-300 text-red-800"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[i.success?e.jsx(yt,{className:"h-5 w-5 text-green-600"}):e.jsx(dr,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:"font-medium",children:i.message})]})}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{className:"mb-2",children:"After setup, you can:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-gray-500",children:[e.jsx("li",{children:"Access brand management at /brand-management"}),e.jsx("li",{children:"Add and edit brands through the UI"}),e.jsx("li",{children:"Use brand suggestions in device forms"}),e.jsx("li",{children:"Filter brands by category"})]})]})]})]}),e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ar,{className:"h-8 w-8 text-orange-500"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Multiple Categories"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Update brands to support multiple categories"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{className:"mb-2",children:"This will update:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-gray-500",children:[e.jsx("li",{children:"Convert single category to JSON array"}),e.jsx("li",{children:"Update existing brands with multiple categories"}),e.jsx("li",{children:"Add proper indexing for performance"}),e.jsx("li",{children:"Create backup of current data"})]})]}),e.jsx("button",{onClick:u,disabled:r,className:`w-full flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-colors ${r?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-orange-600 text-white hover:bg-orange-700"}`,children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Updating Categories..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ar,{className:"h-5 w-5"}),e.jsx("span",{children:"Update to Multiple Categories"})]})})]})]})]}),e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ar,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Categories Table"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Create categories table for category management"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{className:"mb-2",children:"This will create:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-gray-500",children:[e.jsx("li",{children:"Categories table with all necessary fields"}),e.jsx("li",{children:"Indexes for fast lookups"}),e.jsx("li",{children:"Default categories (Phone, Laptop, Tablet, etc.)"}),e.jsx("li",{children:"Automatic timestamp updates"}),e.jsx("li",{children:"Row Level Security (RLS) policies"})]})]}),e.jsx("button",{onClick:x,disabled:r,className:"w-full flex items-center justify-center gap-2 bg-green-500 hover:bg-green-600 disabled:bg-green-300 text-white font-medium py-3 px-4 rounded-lg transition-colors",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Creating Categories Table..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ar,{className:"h-5 w-5"}),e.jsx("span",{children:"Create Categories Table"})]})})]})]}),e.jsxs("div",{className:"mt-8 bg-white/90 backdrop-blur-sm rounded-lg p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Setup Instructions"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("p",{children:["1. ",e.jsx("strong",{children:'Click "Create Brands Table"'})," to set up the brands database table"]}),e.jsxs("p",{children:["2. ",e.jsx("strong",{children:'Click "Create Categories Table"'})," to set up the categories database table"]}),e.jsxs("p",{children:["3. ",e.jsx("strong",{children:"Wait for completion"})," - the process may take a few seconds"]}),e.jsxs("p",{children:["4. ",e.jsx("strong",{children:"Check the status"})," - you'll see a success or error message"]}),e.jsxs("p",{children:["5. ",e.jsx("strong",{children:"Navigate to brand management"})," at /brand-management to start using the feature"]}),e.jsxs("p",{children:["6. ",e.jsx("strong",{children:"Navigate to category management"})," at /category-management to manage categories"]})]})]})]})})},ng=({isOpen:r,onClose:a,onImportComplete:i})=>{const{currentUser:c}=Wt(),[m,u]=g.useState(null),[x,j]=g.useState([]),[b,f]=g.useState([]),[y,N]=g.useState(!1),[I,R]=g.useState(!1),[k,E]=g.useState("upload"),[v,U]=g.useState(0),[F,L]=g.useState([]),[C,$]=g.useState([]),[Y,A]=g.useState(!1),[Z,_]=g.useState([]),[D,T]=g.useState(!1),[z,se]=g.useState(new Set),[q,H]=g.useState(new Map),[J,V]=g.useState(!0),[ge,He]=g.useState([]),[B,fe]=g.useState([]),[re,ye]=g.useState(null),[Q,Le]=g.useState(""),[Ue,Ct]=g.useState(!0),Re=g.useRef(null),ut=Sn,Ee=ol,Oe=Se=>{if(!Se)return"";const ve=Se.trim();return ve===ve.toUpperCase()&&ve.length>1?ve.toLowerCase().replace(/\b\w/g,de=>de.toUpperCase()):ve===ve.toUpperCase()?ve.toLowerCase().replace(/\b\w/g,de=>de.toUpperCase()):ve},Xe=Se=>{const ve=Se.trim().toLowerCase();return ve==="male"||ve==="m"?"male":ve==="female"||ve==="f"?"female":"other"},Be=Se=>{if(!Se)return"";const ve=Se.trim(),de={instagram:"Instagram",mtandaoni:"Social Media",physically:"Walk-in",recommendation:"Friend","social media":"Social Media",facebook:"Facebook",google:"Google",friend:"Friend",family:"Family",colleague:"Colleague",advertisement:"Advertisement",website:"Website","walk-in":"Walk-in",referral:"Referral",other:"Other"},me=ve.toLowerCase();return de[me]?de[me]:ve===ve.toUpperCase()&&ve.length>1?ve.toLowerCase().replace(/\b\w/g,Ae=>Ae.toUpperCase()):ve},Ce=Se=>{if(!Se)return"";const ve=Se.trim(),de={dsm:"Dar es Salaam",dar:"Dar es Salaam","dar es":"Dar es Salaam","dar es salaam":"Dar es Salaam",mara:"Mara",moro:"Morogoro",arusha:"Arusha",mwanza:"Mwanza",dodoma:"Dodoma",tanga:"Tanga",mbeya:"Mbeya",morogoro:"Morogoro",tabora:"Tabora",singida:"Singida",kigoma:"Kigoma",shinyanga:"Shinyanga",kagera:"Kagera",manyara:"Manyara",njombe:"Njombe",katavi:"Katavi",geita:"Geita",simiyu:"Simiyu",songwe:"Songwe"},me=ve.toLowerCase();return de[me]?de[me]:ve},Ze=Se=>{if(!Se)return{month:"",day:""};const ve=Se.trim().toLowerCase(),de=/^(\d{1,2})-([a-z]{3,})$/,me=ve.match(de);if(me){const St=me[1],kt=me[2],xs={jan:"January",feb:"February",mar:"March",apr:"April",may:"May",jun:"June",jul:"July",aug:"August",sep:"September",oct:"October",nov:"November",dec:"December"}[kt];if(xs)return{month:xs,day:St}}const Ae=/^([a-z]{3,})-(\d{1,2})$/,it=ve.match(Ae);if(it){const St=it[1],kt=it[2],xs={jan:"January",feb:"February",mar:"March",apr:"April",may:"May",jun:"June",jul:"July",aug:"August",sep:"September",oct:"October",nov:"November",dec:"December"}[St];if(xs)return{month:xs,day:kt}}return{month:"",day:""}},$e=Se=>{const ve=Se.trim().toLowerCase();return{new:"new",vip:"vip",complainer:"complainer",purchased:"purchased","not new":"new",normal:"new",regular:"new",standard:"new",basic:"new",premium:"vip",important:"vip",priority:"vip",problem:"complainer",issue:"complainer",buyer:"purchased",customer:"purchased",buying:"purchased"}[ve]||"new"},K=async Se=>{const ve=new Map;try{const de=Se.map(me=>ut(me.phone)).filter(me=>me);if(de.length>0){const{data:me,error:Ae}=await G.from("customers").select("id, name, phone").in("phone",de);!Ae&&me&&me.forEach(it=>{ve.set(it.phone,it)})}}catch(de){console.error("Error checking existing customers:",de)}return ve},be=(Se,ve)=>{var me,Ae;const de=[];if((me=Se.name)!=null&&me.trim()||de.push(`Row ${ve}: Name is required`),(Ae=Se.phone)!=null&&Ae.trim()?/^[\+]?[0-9\s\-\(\)]{8,}$/.test(Se.phone)||de.push(`Row ${ve}: Invalid phone number format`):de.push(`Row ${ve}: Phone number is required`),Se.gender&&!["male","female","other"].includes(Se.gender)&&de.push(`Row ${ve}: Gender must be male, female, or other`),Se.loyaltyLevel&&!["bronze","silver","gold","platinum"].includes(Se.loyaltyLevel)&&de.push(`Row ${ve}: Invalid loyalty level`),Se.birthMonth&&!Se.birthDay&&de.push(`Row ${ve}: Birth day is required if birth month is provided`),Se.birthDay&&!Se.birthMonth&&de.push(`Row ${ve}: Birth month is required if birth day is provided`),Se.birthDay){const it=parseInt(Se.birthDay);(isNaN(it)||it<1||it>31)&&de.push(`Row ${ve}: Birth day must be a number between 1-31`)}return de},ue=Se=>{const ve=new Map,de=[];return Se.forEach((me,Ae)=>{const it=ut(me.phone);it&&(ve.has(it)||ve.set(it,[]),ve.get(it).push(Ae+2))}),ve.forEach((me,Ae)=>{me.length>1&&de.push(`Duplicate phone number "${Ae}" found in rows: ${me.join(", ")}`)}),de},Ye=(Se,ve)=>be(Se,ve+2),ae=(Se,ve,de)=>Ye(Se,ve).some(Ae=>Ae.toLowerCase().includes(de.toLowerCase())||de==="name"&&Ae.includes("Name is required")||de==="phone"&&(Ae.includes("Phone number is required")||Ae.includes("Invalid phone number format"))),ke=(Se,ve,de)=>Ye(Se,ve).find(Ae=>Ae.toLowerCase().includes(de.toLowerCase())||de==="name"&&Ae.includes("Name is required")||de==="phone"&&(Ae.includes("Phone number is required")||Ae.includes("Invalid phone number format")))||"",Ke=Se=>{var de;const ve=(de=Se.target.files)==null?void 0:de[0];if(ve){if(ve.size>5*1024*1024){te.error("File size must be less than 5MB");return}u(ve),le(ve)}},le=async Se=>{var ve;try{N(!0),$([]);const me=(await Se.text()).split(`
`).filter(Nt=>Nt.trim());if(me.length<2){te.error("File must contain at least a header row and one data row");return}const Ae=((ve=me[0])==null?void 0:ve.split(",").map(Nt=>Nt.trim().toLowerCase()))||[],it=[],St=[];for(let Nt=1;Nt<me.length;Nt++){const ss=me[Nt].trim();if(!ss)continue;const gt=ss.split(",").map(ot=>ot.trim().replace(/^"|"$/g,"")),Is=gt[Ae.indexOf("phone")]||gt[Ae.indexOf("phone number")]||gt[Ae.indexOf("mobile")]||gt[Ae.indexOf("mobile phone")]||gt[Ae.indexOf("primary phone")]||gt[Ae.indexOf("phone 1 - value")]||"",ts=gt[Ae.indexOf("whatsapp")]||gt[Ae.indexOf("whatsapp number")]||"",bs={name:Oe(gt[Ae.indexOf("name")]||gt[Ae.indexOf("full name")]||gt[Ae.indexOf("customer name")]||gt[Ae.indexOf("first name")]||""),email:"",phone:ut(Is),gender:Xe(gt[Ae.indexOf("gender")]||"other"),city:Ce(gt[Ae.indexOf("city")]||gt[Ae.indexOf("location")]||gt[Ae.indexOf("home city")]||gt[Ae.indexOf("business city")]||""),whatsapp:Ee(ts),notes:gt[Ae.indexOf("notes")]||gt[Ae.indexOf("comments")]||"",loyaltyLevel:gt[Ae.indexOf("loyalty")]||gt[Ae.indexOf("loyalty level")]||"bronze",colorTag:$e(gt[Ae.indexOf("color tag")]||gt[Ae.indexOf("tag")]||"new"),birthMonth:gt[Ae.indexOf("birth month")]||gt[Ae.indexOf("month")]||"",birthDay:gt[Ae.indexOf("birth day")]||gt[Ae.indexOf("day")]||"",referralSource:Be(gt[Ae.indexOf("referral source")]||gt[Ae.indexOf("referral")]||gt[Ae.indexOf("referred by")]||gt[Ae.indexOf("referral resource")]||""),referralSourceCustom:gt[Ae.indexOf("referral source custom")]||gt[Ae.indexOf("custom referral")]||"",locationDescription:gt[Ae.indexOf("location description")]||gt[Ae.indexOf("address")]||gt[Ae.indexOf("home address")]||gt[Ae.indexOf("business address")]||"",nationalId:gt[Ae.indexOf("national id")]||gt[Ae.indexOf("id number")]||"",referredBy:gt[Ae.indexOf("referred by")]||gt[Ae.indexOf("referrer")]||"",totalSpent:parseFloat(gt[Ae.indexOf("total spent")]||gt[Ae.indexOf("spent")]||"0")||0,points:parseInt(gt[Ae.indexOf("points")]||"0")||0,isActive:gt[Ae.indexOf("is active")]!=="false",profileImage:gt[Ae.indexOf("profile image")]||gt[Ae.indexOf("image")]||""},Qt=gt[Ae.indexOf("birthday")]||gt[Ae.indexOf("birth day")]||gt[Ae.indexOf("birth")]||gt[Ae.indexOf("birth date")]||"";if(Qt){const ot=Ze(Qt);ot.month&&ot.day&&(bs.birthMonth=ot.month,bs.birthDay=ot.day)}if(bs.birthMonth&&bs.birthMonth.includes("-")){const ot=Ze(bs.birthMonth);ot.month&&ot.day&&(bs.birthMonth=ot.month,bs.birthDay=ot.day)}const Pe=be(bs,Nt+1);St.push(...Pe),bs.name&&bs.phone&&it.push(bs)}const kt=ue(it),et=[...St,...kt],xs=await K(it);if(H(xs),$(St),fe(kt),j(it),_([...it]),f(it),He(it),E("preview"),et.length>0){const Nt=St.length,ss=kt.length;te.error(`Found ${Nt} validation errors and ${ss} duplicate entries. Please review before importing.`)}else{const Nt=xs.size,ss=it.length-Nt;te.success(`Processed ${it.length} customers. ${ss} new, ${Nt} existing will be skipped.`)}}catch(de){console.error("Error processing file:",de),te.error("Error processing file. Please ensure it's a valid CSV/Excel file.")}finally{N(!1)}},Ne=async()=>{if((c==null?void 0:c.role)!=="admin"){te.error("Only administrators can import customers. You can view the preview and results.");return}const Se=Y?Z:x;if(Se.length===0){te.error("No data to import. Please add at least one customer.");return}C.length>0&&te.error(`Found ${C.length} validation errors. Invalid rows will be skipped.`);try{R(!0),U(0),L([]);const de=[],me=[];for(let kt=0;kt<Se.length;kt++){const et=Se[kt],xs=ut(et.phone),Nt=be(et,kt+2);if(Nt.length>0){me.push({success:!1,skipped:!0,reason:`Validation errors: ${Nt.join(", ")}`,rowNumber:kt+2});continue}const ss=q.get(xs);if(ss){const gt=ss;me.push({success:!1,skipped:!0,reason:"Phone number already exists",rowNumber:kt+2})}else try{const gt=await ll({id:crypto.randomUUID(),name:et.name,email:et.email,phone:xs,gender:et.gender,city:et.city,whatsapp:Ee(et.whatsapp||""),initialNotes:et.notes,loyaltyLevel:et.loyaltyLevel||"bronze",colorTag:et.colorTag||"new",birthMonth:et.birthMonth,birthDay:et.birthDay,referralSource:et.referralSource,joinedDate:new Date().toISOString(),totalSpent:et.totalSpent||0,points:et.points||0,lastVisit:new Date().toISOString(),isActive:et.isActive!==!1,notes:[],referrals:[]});gt?(de.push(gt),me.push({success:!0,customer:gt,rowNumber:kt+2})):me.push({success:!1,error:"Failed to create customer",rowNumber:kt+2})}catch(gt){console.error(`Error creating customer ${et.name}:`,gt),me.push({success:!1,error:gt instanceof Error?gt.message:"Unknown error",rowNumber:kt+2})}U((kt+1)/Se.length*100),L(me)}const Ae=me.filter(kt=>kt.success).length,it=me.filter(kt=>kt.skipped).length,St=me.filter(kt=>!kt.success&&!kt.skipped).length;Ae>0&&(te.success(`Successfully imported ${Ae} customers!`),i(de)),it>0&&te.success(`Skipped ${it} rows (validation errors or existing customers).`),St>0&&te.error(`${St} customers failed to import. Check the results below.`),E("import")}catch(de){console.error("Import error:",de),te.error("Error importing customers. Please try again.")}finally{R(!1)}},Te=()=>{u(null),j([]),_([]),f([]),He([]),E("upload"),N(!1),R(!1),A(!1),T(!1),se(new Set),U(0),L([]),$([]),fe([]),H(new Map),V(!1),Re.current&&(Re.current.value=""),a()},Qe=()=>{const ve=`name,email,phone,gender,city,whatsapp,birth month,birth day,referral source,notes,loyalty level,color tag
John Doe,john@example.com,748757641,male,DSM,748757641,January,15,MTANDAONI,New customer,bronze,new
Jane Smith,jane@example.com,717377078,female,MARA,717377078,March,22,RECOMMENDATION,VIP customer,silver,vip
Mike Johnson,mike@example.com,676947420,male,MORO,676947420,December,5,PHYSICALLY,Regular customer,gold,new
Alice Brown,alice@example.com,655123456,female,DSM,655123456,June,10,INSTAGRAM,Social media customer,platinum,purchased`,de=new Blob([ve],{type:"text/csv;charset=utf-8;"}),me=window.URL.createObjectURL(de),Ae=document.createElement("a");Ae.href=me,Ae.download="customer_import_template.csv",Ae.click(),window.URL.revokeObjectURL(me),te.success("Template downloaded! To add dropdowns in Excel: Select column → Data → Data Validation → List → Enter values separated by commas")};g.useEffect(()=>{const Se=()=>{const ve=document.body,de=ve.classList.contains("sidebar-open")||ve.classList.contains("sidebar-visible")||document.querySelector(".sidebar:not(.hidden)")!==null;Ct(de)};return Se(),window.addEventListener("resize",Se),document.addEventListener("DOMContentLoaded",Se),()=>{window.removeEventListener("resize",Se),document.removeEventListener("DOMContentLoaded",Se)}},[]);const vt=(Se,ve,de)=>{(re==null?void 0:re.row)===Se&&(re==null?void 0:re.field)===ve||(re&&(re.row!==Se||re.field!==ve)&&Rt(Q),ye({row:Se,field:ve}),Le(de),setTimeout(()=>{const me=document.querySelector(`input[data-row="${Se}"][data-field="${ve}"], select[data-row="${Se}"][data-field="${ve}"], textarea[data-row="${Se}"][data-field="${ve}"]`);me&&(me.focus(),(me instanceof HTMLInputElement||me instanceof HTMLTextAreaElement)&&me.setSelectionRange(me.value.length,me.value.length))},0))},Rt=Se=>{if(re){const ve=[...ge],{row:de,field:me}=re;if(me==="birthday"){const Ae=Se.trim().split(" ");Ae.length===2&&(ve[de].birthMonth=Ae[0],ve[de].birthDay=Ae[1])}else me==="gender"?["male","female","other"].includes(Se.toLowerCase())&&(ve[de].gender=Se.toLowerCase()):me==="loyaltyLevel"?["bronze","silver","gold","platinum"].includes(Se.toLowerCase())&&(ve[de].loyaltyLevel=Se.toLowerCase()):me==="colorTag"?["new","vip","complainer","purchased"].includes(Se.toLowerCase())&&(ve[de].colorTag=Se.toLowerCase()):ve[de][me]=Se;He(ve),j(ve)}ye(null),Le("")},ht=Se=>{Se.key==="Enter"?Rt(Q):Se.key==="Escape"&&(ye(null),Le(""))};return!r||!["admin","customer-care"].includes((c==null?void 0:c.role)||"")?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4 transition-all duration-300 ml-0",style:{marginLeft:Ue?"280px":"0px",left:"0",right:"0"},children:e.jsxs(he,{className:"w-full max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(Nn,{className:"w-5 h-5 text-green-500"}),"Import Customers from Excel (Skip Existing)"]}),e.jsx("button",{onClick:Te,className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(tr,{className:"w-5 h-5"})})]}),k==="upload"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(Lr,{className:"w-12 h-12 mx-auto text-blue-500 mb-2"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Upload Customer Data"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Import customers from Excel/CSV file. Download the template below for the correct format."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>{var Se;return(Se=Re.current)==null?void 0:Se.click()},disabled:y,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium transition-colors",children:[e.jsx(Lr,{className:"w-4 h-4 mr-2 inline"}),y?"Processing...":"Choose File"]}),e.jsxs("button",{onClick:()=>{E("preview"),A(!0),_([{name:"",email:"",phone:"",gender:"other",city:"",whatsapp:"",birthMonth:"",birthDay:"",referralSource:"",notes:"",loyaltyLevel:"bronze",colorTag:"new"}])},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[e.jsx(Ca,{className:"w-4 h-4 mr-2 inline"}),"Manual Entry"]}),e.jsxs("button",{onClick:Qe,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:[e.jsx(Br,{className:"w-4 h-4 mr-2 inline"}),"Download Template"]}),e.jsx("div",{className:"flex items-center justify-center text-sm text-gray-500",children:"or"})]}),e.jsx("input",{ref:Re,type:"file",accept:".csv,.xlsx,.xls",onChange:Ke,className:"hidden"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-blue-800 mb-2 flex items-center gap-2",children:[e.jsx(Bs,{className:"w-4 h-4"}),"Import Features:"]}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Auto-skip existing customers"})," - Based on phone number or email"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Duplicate detection"})," - Checks for duplicate phones/emails within Excel file"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Required fields:"})," name, phone"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Optional fields:"})," email, gender, city, whatsapp, birth month/day, referral source, notes, loyalty level, color tag, location description, national id, referred by, total spent, points, is active, profile image"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Tanzania phone formatting:"})," Automatically adds +255 country code to all numbers"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Validation:"})," Checks for valid email format and required fields"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Scroll to view all customers"}),' - Click "Show All Customers" to see complete list']})]})]})]}),k==="preview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 rounded-2xl p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"📈"})}),"Import Summary"]}),e.jsx("div",{className:"text-sm text-gray-600 font-medium",children:"Ready to Import"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-lg border border-blue-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"👥"})}),e.jsx("div",{className:"text-xs text-blue-600 font-medium",children:"TOTAL"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-1",children:x.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Customers Found"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-lg border border-yellow-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"⏭️"})}),e.jsx("div",{className:"text-xs text-yellow-600 font-medium",children:"SKIP"})]}),e.jsx("div",{className:"text-3xl font-bold text-yellow-600 mb-1",children:q.size}),e.jsx("div",{className:"text-xs text-gray-500",children:"Already Exist"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-lg border border-green-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("div",{className:"text-xs text-green-600 font-medium",children:"IMPORT"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-600 mb-1",children:x.length-q.size}),e.jsx("div",{className:"text-xs text-gray-500",children:"New Customers"})]})]})]}),C.length>0&&e.jsx("div",{className:"space-y-4",children:C.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-yellow-800 mb-2 flex items-center gap-2",children:[e.jsx(dr,{className:"w-4 h-4"}),"Validation Warnings (",C.length," rows will be skipped):"]}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:e.jsx("ul",{className:"text-sm text-yellow-700 space-y-1",children:C.map((Se,ve)=>e.jsxs("li",{className:"py-1 border-b border-yellow-100 last:border-b-0",children:["• ",Se]},ve))})}),e.jsxs("div",{className:"mt-3 p-2 bg-yellow-100 rounded text-sm text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," Rows with validation errors will be automatically skipped during import. Valid customers will still be imported successfully."]})]})}),C.length>0&&e.jsxs("div",{className:"mb-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-yellow-800 mb-3 flex items-center gap-2",children:[e.jsx(dr,{className:"w-4 h-4"}),"Field Validation Summary:"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),e.jsxs("span",{className:"text-yellow-700",children:["Name: ",C.filter(Se=>Se.includes("Name is required")).length," missing"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),e.jsxs("span",{className:"text-yellow-700",children:["Phone: ",C.filter(Se=>Se.includes("Phone")).length," issues"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsxs("span",{className:"text-green-700",children:["Valid rows: ",x.length-C.filter(Se=>Se.includes("Row")).length," ready"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsxs("span",{className:"text-blue-700",children:["Total rows: ",x.length]})]})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-green-800 mb-2 flex items-center gap-2",children:[e.jsx(Bs,{className:"w-4 h-4"}),"Dropdown Values for Excel:"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-green-700",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Gender:"})," male, female, other"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Loyalty Level:"})," bronze, silver, gold, platinum"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Color Tag:"})," new, vip, complainer, purchased"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Referral Source:"})," MTANDAONI, RECOMMENDATION, PHYSICALLY, INSTAGRAM, FACEBOOK, GOOGLE, FRIEND, FAMILY, OTHER"]})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-yellow-800 mb-2 flex items-center gap-2",children:[e.jsx(Bs,{className:"w-4 h-4"}),"How to Add Dropdowns in Excel:"]}),e.jsxs("ol",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:"1. Select the column you want to add dropdown to (e.g., Gender column)"}),e.jsxs("li",{children:["2. Go to ",e.jsx("strong",{children:"Data"})," tab → ",e.jsx("strong",{children:"Data Validation"})]}),e.jsxs("li",{children:["3. Choose ",e.jsx("strong",{children:"List"}),' from "Allow" dropdown']}),e.jsx("li",{children:'4. In "Source" field, enter values separated by commas (e.g., male,female,other)'}),e.jsxs("li",{children:["5. Click ",e.jsx("strong",{children:"OK"})," to apply"]})]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto border border-gray-200 rounded-lg",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm min-w-full",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Name"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Phone"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"City"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Gender"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"WhatsApp"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Birthday"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Notes"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Loyalty"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Tag"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:ge.map((Se,ve)=>{var kt;const de=ut(Se.phone),me=(kt=Se.email)==null?void 0:kt.toLowerCase(),Ae=q.get(de),it=me?q.get(me):null,St=Ae||it;return e.jsxs("tr",{className:`hover:bg-gray-50 transition-colors ${Ye(Se,ve).length>0?"bg-yellow-50":""}`,children:[e.jsxs("td",{className:`p-3 font-medium cursor-pointer hover:bg-blue-50 relative ${ae(Se,ve,"name")?"bg-yellow-100 border-l-4 border-yellow-500":"text-gray-900"}`,onClick:et=>{et.stopPropagation(),vt(ve,"name",Se.name)},title:ae(Se,ve,"name")?ke(Se,ve,"name"):"",children:[ae(Se,ve,"name")&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"⚠️"})}),(re==null?void 0:re.row)===ve&&(re==null?void 0:re.field)==="name"?e.jsx("input",{type:"text",value:Q,onChange:et=>Le(et.target.value),onKeyDown:ht,onBlur:()=>Rt(Q),className:"w-full h-full bg-transparent border-none outline-none text-sm font-medium text-gray-900 p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":ve,"data-field":"name",autoFocus:!0}):e.jsx("span",{className:ae(Se,ve,"name")?"text-yellow-800":"",children:Se.name||(ae(Se,ve,"name")?"⚠️ Required":"")})]}),e.jsxs("td",{className:`p-3 cursor-pointer hover:bg-blue-50 relative ${ae(Se,ve,"phone")?"bg-yellow-100 border-l-4 border-yellow-500":"text-gray-700"}`,onClick:et=>{et.stopPropagation(),vt(ve,"phone",Se.phone)},title:ae(Se,ve,"phone")?ke(Se,ve,"phone"):"",children:[ae(Se,ve,"phone")&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"⚠️"})}),(re==null?void 0:re.row)===ve&&(re==null?void 0:re.field)==="phone"?e.jsx("input",{type:"text",value:Q,onChange:et=>Le(et.target.value),onKeyDown:ht,onBlur:()=>Rt(Q),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":ve,"data-field":"phone",autoFocus:!0}):e.jsx("span",{className:ae(Se,ve,"phone")?"text-yellow-800":"",children:Se.phone||(ae(Se,ve,"phone")?"⚠️ Required":"")})]}),e.jsx("td",{className:"p-3 text-gray-700 cursor-pointer hover:bg-blue-50",onClick:et=>{et.stopPropagation(),vt(ve,"city",Se.city||"")},children:(re==null?void 0:re.row)===ve&&(re==null?void 0:re.field)==="city"?e.jsx("input",{type:"text",value:Q,onChange:et=>Le(et.target.value),onKeyDown:ht,onBlur:()=>Rt(Q),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":ve,"data-field":"city",autoFocus:!0}):Se.city||"-"}),e.jsx("td",{className:"p-3 text-gray-700 capitalize cursor-pointer hover:bg-blue-50",onClick:et=>{et.stopPropagation(),vt(ve,"gender",Se.gender||"")},children:(re==null?void 0:re.row)===ve&&(re==null?void 0:re.field)==="gender"?e.jsxs("select",{value:Q,onChange:et=>Le(et.target.value),onKeyDown:ht,onBlur:()=>Rt(Q),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 capitalize p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":ve,"data-field":"gender",autoFocus:!0,children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]}):Se.gender||"-"}),e.jsx("td",{className:"p-3 text-gray-700 cursor-pointer hover:bg-blue-50",onClick:et=>{et.stopPropagation(),vt(ve,"whatsapp",Se.whatsapp||"")},children:(re==null?void 0:re.row)===ve&&(re==null?void 0:re.field)==="whatsapp"?e.jsx("input",{type:"text",value:Q,onChange:et=>Le(et.target.value),onKeyDown:ht,onBlur:()=>Rt(Q),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":ve,"data-field":"whatsapp",autoFocus:!0}):Se.whatsapp||"-"}),e.jsx("td",{className:"p-3 text-gray-700 cursor-pointer hover:bg-blue-50",onClick:et=>{et.stopPropagation(),vt(ve,"birthday",Se.birthMonth&&Se.birthDay?`${Se.birthMonth} ${Se.birthDay}`:"")},children:(re==null?void 0:re.row)===ve&&(re==null?void 0:re.field)==="birthday"?e.jsx("input",{type:"text",value:Q,onChange:et=>Le(et.target.value),onKeyDown:ht,onBlur:()=>Rt(Q),placeholder:"e.g., January 15",className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":ve,"data-field":"birthday",autoFocus:!0}):Se.birthMonth&&Se.birthDay?`${Se.birthMonth} ${Se.birthDay}`:"-"}),e.jsx("td",{className:"p-3 text-gray-700 max-w-xs truncate cursor-pointer hover:bg-blue-50",title:Se.notes||"",onClick:et=>{et.stopPropagation(),vt(ve,"notes",Se.notes||"")},children:(re==null?void 0:re.row)===ve&&(re==null?void 0:re.field)==="notes"?e.jsx("textarea",{value:Q,onChange:et=>Le(et.target.value),onKeyDown:ht,onBlur:()=>Rt(Q),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 p-0 m-0 resize-none",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":ve,"data-field":"notes",rows:1,autoFocus:!0}):Se.notes||"-"}),e.jsx("td",{className:"p-3 text-gray-700 capitalize cursor-pointer hover:bg-blue-50",onClick:et=>{et.stopPropagation(),vt(ve,"loyaltyLevel",Se.loyaltyLevel||"")},children:(re==null?void 0:re.row)===ve&&(re==null?void 0:re.field)==="loyaltyLevel"?e.jsxs("select",{value:Q,onChange:et=>Le(et.target.value),onKeyDown:ht,onBlur:()=>Rt(Q),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 capitalize p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":ve,"data-field":"loyaltyLevel",autoFocus:!0,children:[e.jsx("option",{value:"",children:"Select Level"}),e.jsx("option",{value:"bronze",children:"Bronze"}),e.jsx("option",{value:"silver",children:"Silver"}),e.jsx("option",{value:"gold",children:"Gold"}),e.jsx("option",{value:"platinum",children:"Platinum"})]}):Se.loyaltyLevel||"bronze"}),e.jsx("td",{className:"p-3 text-gray-700 capitalize cursor-pointer hover:bg-blue-50",onClick:et=>{et.stopPropagation(),vt(ve,"colorTag",Se.colorTag||"")},children:(re==null?void 0:re.row)===ve&&(re==null?void 0:re.field)==="colorTag"?e.jsxs("select",{value:Q,onChange:et=>Le(et.target.value),onKeyDown:ht,onBlur:()=>Rt(Q),className:"w-full h-full bg-transparent border-none outline-none text-sm text-gray-700 capitalize p-0 m-0",style:{fontSize:"inherit",fontFamily:"inherit",lineHeight:"inherit"},"data-row":ve,"data-field":"colorTag",autoFocus:!0,children:[e.jsx("option",{value:"",children:"Select Tag"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"vip",children:"VIP"}),e.jsx("option",{value:"complainer",children:"Complainer"}),e.jsx("option",{value:"purchased",children:"Purchased"})]}):Se.colorTag||"normal"}),e.jsx("td",{className:"p-3",children:St?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:[e.jsx($n,{className:"w-3 h-3"}),"Skip"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:[e.jsx(yt,{className:"w-3 h-3"}),"Import"]})})]},ve)})})]})})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>E("upload"),className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors",children:"Back"}),e.jsx("button",{onClick:()=>{E("import"),setTimeout(()=>{Ne()},100)},className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm font-medium transition-colors",children:C.length>0?"Continue (Skip Invalid Rows)":"Continue to Import"})]})]}),k==="import"&&e.jsxs("div",{className:"space-y-6",children:[I?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Importing Customers"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Progress: ",Math.round(v),"% (",F.length,"/",x.length,")"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${v}%`}})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(yt,{className:"w-12 h-12 mx-auto text-green-500 mb-2"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Import Complete"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Import results for ",x.length," customers"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-1",children:"Imported"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:F.filter(Se=>Se.success).length})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-yellow-800 mb-1",children:"Skipped"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:F.filter(Se=>Se.skipped).length})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-1",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:F.filter(Se=>!Se.success&&!Se.skipped).length})]})]}),F.filter(Se=>Se.skipped).length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"Skipped Customers:"}),e.jsx("div",{className:"max-h-32 overflow-y-auto",children:e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[F.filter(Se=>Se.skipped).slice(0,10).map((Se,ve)=>e.jsxs("li",{children:["Row ",Se.rowNumber,": ",Se.reason]},ve)),F.filter(Se=>Se.skipped).length>10&&e.jsxs("li",{className:"text-yellow-600",children:["... and ",F.filter(Se=>Se.skipped).length-10," more skipped"]})]})})]}),F.filter(Se=>!Se.success&&!Se.skipped).length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-2",children:"Failed Imports:"}),e.jsx("div",{className:"max-h-32 overflow-y-auto",children:e.jsx("ul",{className:"text-sm text-red-700 space-y-1",children:F.filter(Se=>!Se.success&&!Se.skipped).map((Se,ve)=>e.jsxs("li",{children:["Row ",Se.rowNumber,": ",Se.error]},ve))})})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(X,{onClick:()=>E("preview"),variant:"secondary",className:"flex-1",disabled:I,children:"Back"}),e.jsx(X,{onClick:Te,disabled:I,className:"flex-1",children:I?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(yt,{className:"w-4 h-4 mr-2"}),"Close"]})})]})]})]})})},Po=()=>{const r=hs(),{currentUser:a}=Wt(),[i,c]=g.useState(!1),[m,u]=g.useState([]),x=j=>{const b={imported:j,skipped:0,failed:0,timestamp:new Date().toLocaleString()};u(f=>[b,...f.slice(0,4)])};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("button",{onClick:()=>r("/customers"),className:"mr-4 p-2 hover:bg-white/50 rounded-lg transition-colors",children:e.jsx(zs,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Import Customers from Excel"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(he,{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[(a==null?void 0:a.role)==="admin"?e.jsx(Lr,{className:"w-16 h-16 mx-auto text-blue-500 mb-4"}):e.jsx(cs,{className:"w-16 h-16 mx-auto text-green-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:(a==null?void 0:a.role)==="admin"?"Bulk Import Customers":"View Import Results"}),e.jsx("p",{className:"text-gray-600 mb-4",children:(a==null?void 0:a.role)==="admin"?"Import customers from Excel/CSV files. Existing customers will be automatically skipped.":"View import results and customer data. Only administrators can perform imports."})]}),e.jsx("div",{className:"space-y-4 mb-6",children:(a==null?void 0:a.role)==="admin"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg",children:[e.jsx(yt,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Auto-skip existing customers"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Based on phone number or email"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 rounded-lg",children:[e.jsx(_s,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-green-900",children:"Bulk processing"}),e.jsx("p",{className:"text-sm text-green-700",children:"Import hundreds of customers at once"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-yellow-50 rounded-lg",children:[e.jsx($n,{className:"w-5 h-5 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-900",children:"Smart validation"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Automatic phone formatting and validation"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 rounded-lg",children:[e.jsx(cs,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-green-900",children:"View import results"}),e.jsx("p",{className:"text-sm text-green-700",children:"See what passed and failed"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg",children:[e.jsx(yt,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Track progress"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Monitor import status and results"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-yellow-50 rounded-lg",children:[e.jsx(dr,{className:"w-5 h-5 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-900",children:"Read-only access"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"View data without import permissions"})]})]})]})}),e.jsx(X,{onClick:()=>c(!0),className:"w-full",children:(a==null?void 0:a.role)==="admin"?e.jsxs(e.Fragment,{children:[e.jsx(Lr,{className:"w-4 h-4 mr-2"}),"Start Import"]}):e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"View Import"]})})]}),e.jsxs(he,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:(a==null?void 0:a.role)==="admin"?"How to Import":"How to View Results"}),e.jsx("div",{className:"space-y-4",children:(a==null?void 0:a.role)==="admin"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Prepare your file"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Use CSV format with headers: name, phone, email, gender, city, etc."})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Upload and preview"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Review the data and see which customers will be imported vs skipped"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Import and confirm"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Start the import process and review results"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"View import status"}),e.jsx("p",{className:"text-sm text-gray-600",children:"See which customers were imported, skipped, or failed"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Review results"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Check detailed information about import outcomes"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold mt-0.5",children:"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Monitor progress"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Track import progress and final results"})]})]})]})}),(a==null?void 0:a.role)==="admin"&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Required Fields:"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"name"})," - Customer's full name"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"phone"})," - Phone number (auto-formats with 255 prefix)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"email"})," - Email address (optional)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"gender"})," - male, female, or other"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"city"})," - City/location"]})]})]})]})]}),m.length>0&&e.jsxs(he,{className:"mt-6 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Recent Imports"}),e.jsx("div",{className:"space-y-3",children:m.map((j,b)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(yt,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Import completed"}),e.jsx("p",{className:"text-sm text-gray-600",children:j.timestamp})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-green-600",children:[j.imported.length," imported"]}),j.skipped>0&&e.jsxs("span",{className:"text-yellow-600",children:[j.skipped," skipped"]}),j.failed>0&&e.jsxs("span",{className:"text-red-600",children:[j.failed," failed"]})]})]},b))})]})]}),e.jsx(ng,{isOpen:i,onClose:()=>c(!1),onImportComplete:x})]})},ed=async()=>{try{const{data:r,error:a}=await G.from("inventory_categories").select("*").eq("is_active",!0).order("name");if(a)throw a;return r||[]}catch(r){return console.error("Error fetching inventory categories:",r),[]}},ig=async r=>{try{const{data:a,error:i}=await G.from("inventory_categories").insert([r]).select().single();if(i)throw i;return a}catch(a){throw console.error("Error creating inventory category:",a),a}},lg=async r=>{try{const{error:a}=await G.from("inventory_categories").update({is_active:!1}).eq("id",r);if(a)throw a}catch(a){throw console.error("Error deleting inventory category:",a),a}},td=async()=>{try{const{data:r,error:a}=await G.from("suppliers").select("*").eq("is_active",!0).order("name");if(a)throw a;return r||[]}catch(r){return console.error("Error fetching suppliers:",r),[]}},og=async r=>{try{const{data:a,error:i}=await G.from("suppliers").insert([r]).select().single();if(i)throw i;return a}catch(a){throw console.error("Error creating supplier:",a),a}},cg=async r=>{try{const{error:a}=await G.from("suppliers").update({is_active:!1}).eq("id",r);if(a)throw a}catch(a){throw console.error("Error deleting supplier:",a),a}},sd=async()=>{try{const{data:r,error:a}=await G.from("products").select(`
        *,
        variants:product_variants(*)
      `).eq("is_active",!0).order("name");if(a)throw a;return r||[]}catch(r){throw console.error("Error fetching products:",r),r}},rd=async r=>{try{const{data:a,error:i}=await G.from("products").select(`
        *,
        variants:product_variants(*)
      `).eq("id",r).single();if(i)throw i;return a}catch(a){throw console.error("Error fetching product:",a),a}},dg=async r=>{try{const a=r.product_code||`PROD-${Date.now()}`,{data:i,error:c}=await G.from("products").insert([{name:r.name,description:r.description,brand:r.brand,model:r.model,category_id:r.category_id,supplier_id:r.supplier_id,product_code:a,barcode:r.barcode,minimum_stock_level:r.minimum_stock_level||5,maximum_stock_level:r.maximum_stock_level||100,reorder_point:r.reorder_point||10,tags:r.tags,specifications:r.specifications,warranty_period_months:r.warranty_period_months||12}]).select().single();if(c)throw c;const m=r.variants.map((x,j)=>({product_id:i.id,sku:`${a}-V${j+1}`,variant_name:x.variant_name,attributes:x.attributes,cost_price:x.cost_price,selling_price:x.selling_price,quantity_in_stock:x.quantity_in_stock,weight_kg:x.weight_kg,dimensions_cm:x.dimensions_cm})),{error:u}=await G.from("product_variants").insert(m);if(u)throw u;return await rd(i.id)}catch(a){throw console.error("Error creating product:",a),a}},ug=async(r,a,i,c,m,u)=>{try{const{data:{user:x}}=await G.auth.getUser(),{data:j,error:b}=await G.rpc("update_stock_level",{p_variant_id:r,p_movement_type:a,p_quantity:i,p_reference_type:m,p_reference_id:u,p_reason:c,p_performed_by:x==null?void 0:x.id});if(b)throw b;return!0}catch(x){throw console.error("Error updating stock:",x),x}},mg=async r=>{try{return console.log("Stock movements not available yet"),[]}catch(a){return console.error("Error fetching stock movements:",a),[]}},hg=async()=>{try{return console.log("Low stock items not available yet"),[]}catch(r){return console.error("Error fetching low stock items:",r),[]}},xg=async r=>{try{return console.log("Searching products for:",r),[]}catch(a){return console.error("Error searching products:",a),[]}},gg=async r=>{try{return console.log("Searching product variants for:",r),[]}catch(a){return console.error("Error searching product variants:",a),[]}},fg=async()=>{const{data:r,error:a}=await G.from("spare_parts").select("*").order("name");if(a)throw a;return r||[]},pg=async r=>{const{data:a,error:i}=await G.from("spare_parts").select("*").eq("id",r).single();if(i)throw i;return a},bg=async r=>{const{data:a,error:i}=await G.from("spare_parts").insert(r).select().single();if(i)throw i;return a},yg=async(r,a)=>{const{data:i,error:c}=await G.from("spare_parts").update(a).eq("id",r).select().single();if(c)throw c;return i},wg=async()=>{const{data:r,error:a}=await G.from("spare_parts").select("*").eq("is_active",!0).order("stock_quantity");if(a)throw a;return(r==null?void 0:r.filter(c=>c.stock_quantity<=c.min_stock_level))||[]},jg=async()=>{const{data:r,error:a}=await G.from("spare_parts").select("*").eq("stock_quantity",0).eq("is_active",!0).order("name");if(a)throw a;return r||[]},Ng=async r=>{const{data:a,error:i}=await G.from("spare_parts_usage").insert(r).select().single();if(i)throw i;return a},vg=async r=>{let a=G.from("spare_parts_usage").select(`
      *,
      spare_part:spare_parts(*),
      device:devices(id, brand, model, customer_id)
    `).order("used_at",{ascending:!1});r&&(a=a.eq("spare_part_id",r));const{data:i,error:c}=await a;if(c)throw c;return i||[]},Cg=async()=>{const{data:r,error:a}=await G.from("spare_parts").select("*").eq("is_active",!0);if(a)throw a;const{data:i,error:c}=await G.from("spare_parts_usage").select("*, spare_part:spare_parts(name)").order("used_at",{ascending:!1}).limit(10);if(c)throw c;const m=(r==null?void 0:r.length)||0,u=(r==null?void 0:r.reduce((y,N)=>y+N.stock_quantity*N.cost,0))||0,x=(r==null?void 0:r.filter(y=>y.stock_quantity<=y.min_stock_level).length)||0,j=(r==null?void 0:r.filter(y=>y.stock_quantity===0).length)||0,b=(r==null?void 0:r.reduce((y,N)=>{const I=y.find(R=>R.category===N.category);return I?(I.count++,I.value+=N.stock_quantity*N.cost):y.push({category:N.category,count:1,value:N.stock_quantity*N.cost}),y},[]))||[],f=(i==null?void 0:i.map(y=>{var N;return{part_name:((N=y.spare_part)==null?void 0:N.name)||"Unknown",quantity:y.quantity_used,used_at:y.used_at}}))||[];return{total_parts:m,total_value:u,low_stock_count:x,out_of_stock_count:j,category_breakdown:b,recent_usage:f}},Sg=async(r,a,i)=>{const{data:c,error:m}=await G.from("spare_parts").select("stock_quantity").eq("id",r).single();if(m)throw m;const u=Math.max(0,c.stock_quantity-a),{data:x,error:j}=await G.from("spare_parts").update({stock_quantity:u}).eq("id",r).select().single();if(j)throw j;return x},_g=async()=>{const{data:r,error:a}=await G.from("spare_parts").select("category").eq("is_active",!0);if(a)throw a;return Array.from(new Set((r==null?void 0:r.map(c=>c.category))||[])).sort()},Eg=async()=>{const{data:r,error:a}=await G.from("spare_parts").select("brand").not("brand","is",null).eq("is_active",!0);if(a)throw a;return Array.from(new Set((r==null?void 0:r.map(c=>c.brand).filter(Boolean))||[])).sort()},Ag=()=>{const r=hs(),{currentUser:a}=Wt(),[i,c]=g.useState([]),[m,u]=g.useState([]),[x,j]=g.useState([]),[b,f]=g.useState(!0),[y,N]=g.useState(""),[I,R]=g.useState("all"),[k,E]=g.useState("all"),[v,U]=g.useState("grid");g.useEffect(()=>{F()},[]);const F=async()=>{f(!0);try{const[T,z,se]=await Promise.all([sd(),ed(),hg()]);c(T),u(z),j(se),console.log("📦 Inventory data loaded:",{products:T.length,categories:z.length,lowStock:se.length})}catch(T){console.error("Error loading inventory data:",T),te.error("Failed to load inventory data")}finally{f(!1)}},L=i.filter(T=>{var H,J,V,ge,He,B;const z=y===""||T.name.toLowerCase().includes(y.toLowerCase())||((H=T.brand)==null?void 0:H.toLowerCase().includes(y.toLowerCase()))||((J=T.model)==null?void 0:J.toLowerCase().includes(y.toLowerCase()))||((V=T.product_code)==null?void 0:V.toLowerCase().includes(y.toLowerCase())),se=I==="all"||T.category_id===I,q=k==="all"||k==="low"&&((ge=T.variants)==null?void 0:ge.some(fe=>fe.quantity_in_stock<=T.reorder_point))||k==="out"&&((He=T.variants)==null?void 0:He.every(fe=>fe.quantity_in_stock===0))||k==="in"&&((B=T.variants)==null?void 0:B.some(fe=>fe.quantity_in_stock>0));return z&&se&&q}),C=i.length,$=i.reduce((T,z)=>{var se;return T+(((se=z.variants)==null?void 0:se.length)||0)},0),Y=i.reduce((T,z)=>{var se;return T+(((se=z.variants)==null?void 0:se.reduce((q,H)=>q+H.quantity_in_stock*H.cost_price,0))||0)},0),A=x.length,Z=T=>{if(!T.variants||T.variants.length===0)return{status:"unknown",color:"bg-gray-100 text-gray-800"};const z=T.variants.reduce((q,H)=>q+H.quantity_in_stock,0),se=T.variants.some(q=>q.quantity_in_stock<=T.reorder_point);return z===0?{status:"Out of Stock",color:"bg-red-100 text-red-800"}:se?{status:"Low Stock",color:"bg-yellow-100 text-yellow-800"}:{status:"In Stock",color:"bg-green-100 text-green-800"}},_=T=>{var z;return((z=T.variants)==null?void 0:z.reduce((se,q)=>se+q.quantity_in_stock,0))||0},D=T=>!T.variants||T.variants.length===0?0:T.variants.reduce((se,q)=>se+q.selling_price,0)/T.variants.length;return b?e.jsx("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading inventory..."})]})})}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Inventory Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your products, variants, and stock levels"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(X,{onClick:()=>r("/inventory/new"),className:"flex items-center gap-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:[e.jsx(Ut,{size:18}),"Add Product"]}),e.jsxs(X,{onClick:()=>r("/inventory/management"),className:"flex items-center gap-2",children:[e.jsx(Fr,{size:18}),"Manage"]}),e.jsxs(X,{onClick:()=>r("/inventory/purchase-orders"),className:"flex items-center gap-2",children:[e.jsx(Zr,{size:18}),"Purchase Orders"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(he,{className:"bg-gradient-to-br from-blue-50 to-blue-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Products"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:C})]}),e.jsx("div",{className:"p-3 bg-blue-50/20 rounded-full",children:e.jsx(Ft,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx(he,{className:"bg-gradient-to-br from-green-50 to-green-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Total Variants"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:$})]}),e.jsx("div",{className:"p-3 bg-green-50/20 rounded-full",children:e.jsx(Js,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx(he,{className:"bg-gradient-to-br from-purple-50 to-purple-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Total Value"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:Y.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]}),e.jsx("div",{className:"p-3 bg-purple-50/20 rounded-full",children:e.jsx(Ns,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx(he,{className:"bg-gradient-to-br from-red-50 to-red-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-600",children:"Low Stock Items"}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:A})]}),e.jsx("div",{className:"p-3 bg-red-50/20 rounded-full",children:e.jsx(Ht,{className:"w-6 h-6 text-red-600"})})]})})]}),x.length>0&&e.jsxs(he,{className:"bg-red-50 border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ht,{className:"w-6 h-6 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-900",children:"Low Stock Alert"}),e.jsxs("p",{className:"text-red-700",children:[x.length," items need restocking"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:x.slice(0,6).map((T,z)=>e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-red-200",children:[e.jsx("div",{className:"font-medium text-gray-900",children:T.product_name}),e.jsx("div",{className:"text-sm text-gray-600",children:T.variant_name}),e.jsxs("div",{className:"text-sm text-red-600 font-medium",children:["Stock: ",T.current_stock," / Min: ",T.minimum_level]})]},z))}),x.length>6&&e.jsx("div",{className:"mt-3 text-center",children:e.jsxs(X,{onClick:()=>r("/inventory/low-stock"),variant:"secondary",className:"text-sm",children:["View All ",x.length," Items"]})})]}),e.jsx(he,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 flex-1",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(ga,{onSearch:N,placeholder:"Search products, brands, models, SKUs...",className:"w-full"})}),e.jsxs("select",{value:I,onChange:T=>R(T.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Categories"}),m.map(T=>e.jsx("option",{value:T.id,children:T.name},T.id))]}),e.jsxs("select",{value:k,onChange:T=>E(T.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Stock Levels"}),e.jsx("option",{value:"in",children:"In Stock"}),e.jsx("option",{value:"low",children:"Low Stock"}),e.jsx("option",{value:"out",children:"Out of Stock"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(X,{onClick:()=>U("grid"),variant:v==="grid"?"primary":"secondary",className:"flex items-center gap-2",children:[e.jsx(Ho,{size:16}),"Grid"]}),e.jsxs(X,{onClick:()=>U("list"),variant:v==="list"?"primary":"secondary",className:"flex items-center gap-2",children:[e.jsx(Wo,{size:16}),"List"]})]})]})}),v==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:L.map(T=>{var H;const z=Z(T),se=_(T),q=D(T);return e.jsxs(he,{onClick:()=>r(`/inventory/products/${T.id}`),className:"cursor-pointer hover:scale-105 transition-transform duration-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white",children:e.jsx(Ft,{size:24})}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${z.color}`,children:z.status})]}),e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:T.name}),T.brand&&e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[T.brand," ",T.model]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Variants:"}),e.jsx("span",{className:"font-medium",children:((H=T.variants)==null?void 0:H.length)||0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Stock:"}),e.jsx("span",{className:"font-medium",children:se})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Avg Price:"}),e.jsx("span",{className:"font-medium",children:q.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsxs(X,{onClick:J=>{J.stopPropagation(),r(`/inventory/products/${T.id}`)},variant:"secondary",className:"flex-1 text-sm",children:[e.jsx(cs,{size:14}),"View"]}),e.jsxs(X,{onClick:J=>{J.stopPropagation(),r(`/inventory/products/${T.id}/edit`)},variant:"secondary",className:"flex-1 text-sm",children:[e.jsx(Ts,{size:14}),"Edit"]})]})]},T.id)})}):e.jsx(he,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Product"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Brand/Model"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Category"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",children:"Variants"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",children:"Total Stock"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-700",children:"Avg Price"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:L.map(T=>{var H,J;const z=Z(T),se=_(T),q=D(T);return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-blue-50 cursor-pointer",onClick:()=>r(`/inventory/products/${T.id}`),children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white",children:e.jsx(Ft,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:T.name}),T.product_code&&e.jsx("div",{className:"text-xs text-gray-500",children:T.product_code})]})]})}),e.jsxs("td",{className:"py-3 px-4 text-gray-600",children:[T.brand," ",T.model]}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:((H=T.category)==null?void 0:H.name)||"Uncategorized"}),e.jsx("td",{className:"py-3 px-4 text-center font-medium",children:((J=T.variants)==null?void 0:J.length)||0}),e.jsx("td",{className:"py-3 px-4 text-center font-medium",children:se}),e.jsx("td",{className:"py-3 px-4 text-right font-medium",children:q.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${z.color}`,children:z.status})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:V=>{V.stopPropagation(),r(`/inventory/products/${T.id}`)},className:"p-1 text-gray-500 hover:text-blue-600 transition-colors",title:"View Product",children:e.jsx(cs,{size:16})}),e.jsx("button",{onClick:V=>{V.stopPropagation(),r(`/inventory/products/${T.id}/edit`)},className:"p-1 text-gray-500 hover:text-green-600 transition-colors",title:"Edit Product",children:e.jsx(Ts,{size:16})})]})})]},T.id)})})]})})}),L.length===0&&e.jsxs(he,{className:"text-center py-12",children:[e.jsx(Ft,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No products found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:y||I!=="all"||k!=="all"?"Try adjusting your search or filter criteria":"Get started by adding your first product to inventory"}),e.jsxs(X,{onClick:()=>r("/inventory/new"),className:"flex items-center gap-2",children:[e.jsx(Ut,{size:18}),"Add Your First Product"]})]})]})},kg=()=>{var re,ye;const r=hs(),{currentUser:a}=Wt(),[i,c]=g.useState(!1),[m,u]=g.useState([]),[x,j]=g.useState([]),[b,f]=g.useState(!1),[y,N]=g.useState(!1),[I,R]=g.useState(!1),[k,E]=g.useState(!1),[v,U]=g.useState({name:"",description:"",brand:"",model:"",category_id:"",supplier_id:"",cost_price:0,selling_price:0,quantity_in_stock:0,weight_kg:void 0,dimensions_cm:"",product_code:"",barcode:"",minimum_stock_level:0,reorder_point:0,maximum_stock_level:0,warranty_period_months:0}),[F,L]=g.useState([{id:"1",variant_name:"Default",attributes:{},cost_price:0,selling_price:0,quantity_in_stock:0}]),[C,$]=g.useState({name:"",description:"",color:"#3B82F6"}),[Y,A]=g.useState({name:"",contact_person:"",email:"",phone:"",address:"",city:"",payment_terms:"",lead_time_days:7});g.useEffect(()=>{Z()},[]);const Z=async()=>{try{u([{id:"1",name:"Phone Parts",description:"Mobile phone components",color:"#3B82F6",is_active:!0},{id:"2",name:"Laptop Parts",description:"Laptop components",color:"#10B981",is_active:!0},{id:"3",name:"Accessories",description:"Device accessories",color:"#8B5CF6",is_active:!0}]),j([{id:"1",name:"TechParts Tanzania",contact_person:"John Doe",email:"john@techparts.co.tz",phone:"+255712345678",address:"Dar es Salaam",city:"Dar es Salaam",country:"Tanzania",payment_terms:"Net 30",lead_time_days:7,is_active:!0},{id:"2",name:"Mobile Solutions Ltd",contact_person:"Jane Smith",email:"jane@mobile.co.tz",phone:"+255723456789",address:"Arusha",city:"Arusha",country:"Tanzania",payment_terms:"Net 15",lead_time_days:5,is_active:!0}])}catch(Q){console.error("Error loading data:",Q),te.error("Failed to load categories and suppliers")}},_=(Q,Le)=>{U(Ue=>({...Ue,[Q]:Le}))},D=(Q,Le)=>{if(Q<=0||Le<=0)return null;const Ue=Le-Q,Ct=Ue/Le*100,Re=Ue/Q*100;return{profit:Ue,margin:Ct,markup:Re}},T=()=>v.name.trim()?v.cost_price<0||v.selling_price<0?(te.error("Prices cannot be negative"),!1):v.cost_price>v.selling_price?(te.error("Selling price should be higher than cost price"),!1):v.quantity_in_stock<0?(te.error("Quantity cannot be negative"),!1):!0:(te.error("Product name is required"),!1),z=()=>{if(k){if(F.length>1){te.error("Please remove extra variants before switching to simple product mode");return}const Q=F[0];U(Le=>({...Le,cost_price:Q.cost_price,selling_price:Q.selling_price,quantity_in_stock:Q.quantity_in_stock,weight_kg:Q.weight_kg,dimensions_cm:Q.dimensions_cm||""}))}else L([{id:"1",variant_name:"Default",attributes:{},cost_price:v.cost_price,selling_price:v.selling_price,quantity_in_stock:v.quantity_in_stock,weight_kg:v.weight_kg,dimensions_cm:v.dimensions_cm}]);E(!k)},se=()=>{const Q={id:Date.now().toString(),variant_name:`Variant ${F.length+1}`,attributes:{},cost_price:0,selling_price:0,quantity_in_stock:0};L([...F,Q])},q=Q=>{F.length>1&&L(F.filter(Le=>Le.id!==Q))},H=(Q,Le,Ue)=>{L(F.map(Ct=>Ct.id===Q?{...Ct,[Le]:Ue}:Ct))},J=(Q,Le,Ue)=>{L(F.map(Ct=>Ct.id===Q?{...Ct,attributes:{...Ct.attributes,[Le]:Ue}}:Ct))},V=(Q,Le)=>{L(F.map(Ue=>Ue.id===Q?{...Ue,attributes:Object.fromEntries(Object.entries(Ue.attributes).filter(([Ct])=>Ct!==Le))}:Ue))},ge=async()=>{try{const Q=await ig({name:C.name,description:C.description,color:C.color,is_active:!0});u([...m,Q]),U(Le=>({...Le,category_id:Q.id})),$({name:"",description:"",color:"#3B82F6"}),N(!1),te.success("Category created successfully")}catch{te.error("Failed to create category")}},He=async()=>{try{const Q=await og({name:Y.name,contact_person:Y.contact_person,email:Y.email,phone:Y.phone,address:Y.address,city:Y.city,country:"Tanzania",payment_terms:Y.payment_terms,lead_time_days:Y.lead_time_days,is_active:!0});j([...x,Q]),U(Le=>({...Le,supplier_id:Q.id})),A({name:"",contact_person:"",email:"",phone:"",address:"",city:"",payment_terms:"",lead_time_days:7}),R(!1),te.success("Supplier created successfully")}catch{te.error("Failed to create supplier")}},B=async Q=>{if(Q.preventDefault(),k){if(F.some(Le=>!Le.variant_name.trim())){te.error("All variants must have a name");return}if(F.some(Le=>Le.cost_price<0||Le.selling_price<0)){te.error("Prices cannot be negative");return}}else if(!T())return;c(!0);try{let Le;k?Le={...v,variants:F.map(({id:Ue,...Ct})=>({variant_name:Ct.variant_name,attributes:Ct.attributes,cost_price:Ct.cost_price,selling_price:Ct.selling_price,quantity_in_stock:Ct.quantity_in_stock,weight_kg:Ct.weight_kg,dimensions_cm:Ct.dimensions_cm}))}:Le={...v,variants:[{variant_name:"Default",attributes:{},cost_price:v.cost_price,selling_price:v.selling_price,quantity_in_stock:v.quantity_in_stock,weight_kg:v.weight_kg,dimensions_cm:v.dimensions_cm}]},await dg(Le),te.success("Product created successfully!"),r("/inventory")}catch(Le){console.error("Error creating product:",Le),te.error(Le.message||"Failed to create product")}finally{c(!1)}},fe=[{value:"#3B82F6",label:"Blue"},{value:"#10B981",label:"Green"},{value:"#8B5CF6",label:"Purple"},{value:"#F59E0B",label:"Orange"},{value:"#EF4444",label:"Red"},{value:"#EC4899",label:"Pink"},{value:"#6366F1",label:"Indigo"},{value:"#EAB308",label:"Yellow"},{value:"#14B8A6",label:"Teal"},{value:"#6B7280",label:"Gray"}];return e.jsxs("div",{className:"p-4 sm:p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(X,{onClick:()=>r("/inventory"),className:"flex items-center gap-2",children:[e.jsx(zs,{size:20}),"Back to Inventory"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Add New Product"}),e.jsx("p",{className:"text-gray-600",children:"Create a new product with or without variants for your inventory"})]})]}),e.jsx("form",{onSubmit:B,children:e.jsxs(he,{className:"mb-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ft,{size:20,className:"text-blue-600"}),"Product Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:v.name,onChange:Q=>_("name",Q.target.value),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg pl-12 bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",placeholder:"Enter product name",required:!0}),e.jsx(Ft,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brand"}),e.jsx(qc,{value:v.brand,onChange:Q=>_("brand",Q),placeholder:"Select or enter brand"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Model"}),e.jsx(Oc,{value:v.model,onChange:Q=>_("model",Q),placeholder:"Select or enter model",brand:v.brand})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:v.category_id,onChange:Q=>_("category_id",Q.target.value),className:"flex-1 px-4 py-3 text-lg border-2 border-gray-300 rounded-lg bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",children:[e.jsx("option",{value:"",children:"Select category"}),m.map(Q=>e.jsx("option",{value:Q.id,children:Q.name},Q.id))]}),e.jsxs(X,{type:"button",onClick:()=>N(!0),className:"flex items-center gap-2",children:[e.jsx(Ut,{size:16}),"New"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:v.supplier_id,onChange:Q=>_("supplier_id",Q.target.value),className:"flex-1 px-4 py-3 text-lg border-2 border-gray-300 rounded-lg bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",children:[e.jsx("option",{value:"",children:"Select supplier"}),x.map(Q=>e.jsx("option",{value:Q.id,children:Q.name},Q.id))]}),e.jsxs(X,{type:"button",onClick:()=>R(!0),className:"flex items-center gap-2",children:[e.jsx(Ut,{size:16}),"New"]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:v.description,onChange:Q=>_("description",Q.target.value),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200 resize-none",placeholder:"Enter product description",rows:3})]})]})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(hn,{size:20,className:"text-blue-600"}),"Product Configuration"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Simple Product"}),e.jsx("button",{type:"button",onClick:z,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${k?"bg-blue-600":"bg-gray-200"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${k?"translate-x-6":"translate-x-1"}`})}),e.jsx("span",{className:"text-sm text-gray-600",children:"With Variants"})]})]}),!k&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Bs,{className:"text-blue-600 mt-0.5",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Simple Product Mode"}),e.jsx("p",{className:"text-sm text-blue-700",children:"This product doesn't have variants. You can add essential fields like cost price, selling price, and quantity directly."})]})]})})]}),!k&&e.jsxs("div",{className:"border-b border-gray-200 pb-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ns,{size:20,className:"text-green-600"}),"Product Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost Price (TZS) *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",step:"0.01",value:v.cost_price,onChange:Q=>_("cost_price",parseFloat(Q.target.value)||0),className:"w-full pl-10 pr-4 py-3 text-lg border-2 border-gray-300 rounded-lg bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",placeholder:"0.00",required:!0}),e.jsx(Ns,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:20})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"The price you paid for this product"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selling Price (TZS) *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",step:"0.01",value:v.selling_price,onChange:Q=>_("selling_price",parseFloat(Q.target.value)||0),className:"w-full pl-10 pr-4 py-3 text-lg border-2 border-gray-300 rounded-lg bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",placeholder:"0.00",required:!0}),e.jsx(Ns,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:20})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"The price you'll sell this product for"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity in Stock *"}),e.jsx("input",{type:"number",min:"0",value:v.quantity_in_stock,onChange:Q=>_("quantity_in_stock",parseInt(Q.target.value)||0),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",placeholder:"0",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Current stock level"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Weight (kg)"}),e.jsx("input",{type:"number",min:"0",step:"0.001",value:v.weight_kg||"",onChange:Q=>_("weight_kg",parseFloat(Q.target.value)||void 0),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",placeholder:"0.000"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Product weight for shipping calculations"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dimensions (cm)"}),e.jsx("input",{type:"text",value:v.dimensions_cm,onChange:Q=>_("dimensions_cm",Q.target.value),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",placeholder:"L x W x H (e.g., 10x5x2)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Product dimensions for storage and shipping"})]})]}),v.cost_price>0&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 mb-2",children:[e.jsx(Bs,{size:16}),e.jsx("span",{className:"font-medium text-sm",children:"Quick Price Calculator"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[10,20,30,50].map(Q=>e.jsxs("button",{type:"button",onClick:()=>{const Le=v.cost_price*(1+Q/100);_("selling_price",Math.round(Le))},className:"px-3 py-2 text-xs bg-blue-100 hover:bg-blue-200 text-blue-800 rounded border border-blue-200 transition-colors",children:[Q,"% Markup"]},Q))})]}),(()=>{const Q=D(v.cost_price,v.selling_price);return Q&&e.jsxs("div",{className:"mt-4 p-4 bg-gradient-to-r from-blue-50 to-green-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800 mb-3",children:[e.jsx(Bs,{size:16}),e.jsx("span",{className:"font-medium",children:"Profit Analysis"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-blue-100",children:[e.jsx("span",{className:"text-blue-600 text-sm font-medium",children:"Profit per Unit"}),e.jsx("p",{className:"font-bold text-blue-900 text-lg",children:Q.profit.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-blue-100",children:[e.jsx("span",{className:"text-blue-600 text-sm font-medium",children:"Profit Margin"}),e.jsxs("p",{className:"font-bold text-blue-900 text-lg",children:[Q.margin.toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-blue-100",children:[e.jsx("span",{className:"text-blue-600 text-sm font-medium",children:"Markup"}),e.jsxs("p",{className:"font-bold text-blue-900 text-lg",children:[Q.markup.toFixed(1),"%"]})]})]}),v.quantity_in_stock>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Total Stock Value:"}),e.jsx("span",{className:"font-bold text-blue-900",children:(v.selling_price*v.quantity_in_stock).toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Total Profit Potential:"}),e.jsx("span",{className:"font-bold text-green-700",children:(Q.profit*v.quantity_in_stock).toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]})]})]})})(),v.name.trim()&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Ft,{size:16}),"Product Summary"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Product Name:"}),e.jsx("p",{className:"font-medium text-gray-900",children:v.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Brand:"}),e.jsx("p",{className:"font-medium text-gray-900",children:v.brand||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Model:"}),e.jsx("p",{className:"font-medium text-gray-900",children:v.model||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("p",{className:"font-medium text-gray-900",children:((re=m.find(Q=>Q.id===v.category_id))==null?void 0:re.name)||"Not selected"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Supplier:"}),e.jsx("p",{className:"font-medium text-gray-900",children:((ye=x.find(Q=>Q.id===v.supplier_id))==null?void 0:ye.name)||"Not selected"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Stock Level:"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[v.quantity_in_stock," units"]})]})]})]})]}),k&&e.jsxs("div",{className:"border-b border-gray-200 pb-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(hn,{size:20,className:"text-blue-600"}),"Product Variants (",F.length,")"]}),e.jsxs(X,{type:"button",onClick:se,className:"flex items-center gap-2",children:[e.jsx(Ut,{size:16}),"Add Variant"]})]}),e.jsx("div",{className:"space-y-4",children:F.map((Q,Le)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:["Variant ",Le+1]}),F.length>1&&e.jsxs(X,{type:"button",onClick:()=>q(Q.id),variant:"danger",className:"flex items-center gap-2",children:[e.jsx(er,{size:16}),"Remove"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Variant Name *"}),e.jsx("input",{type:"text",value:Q.variant_name,onChange:Ue=>H(Q.id,"variant_name",Ue.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Red 128GB, Large, etc.",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity in Stock *"}),e.jsx("input",{type:"number",min:"0",value:Q.quantity_in_stock,onChange:Ue=>H(Q.id,"quantity_in_stock",parseInt(Ue.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost Price (TZS) *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",step:"0.01",value:Q.cost_price,onChange:Ue=>H(Q.id,"cost_price",parseFloat(Ue.target.value)||0),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",required:!0}),e.jsx(Ns,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selling Price (TZS) *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",step:"0.01",value:Q.selling_price,onChange:Ue=>H(Q.id,"selling_price",parseFloat(Ue.target.value)||0),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",required:!0}),e.jsx(Ns,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Weight (kg)"}),e.jsx("input",{type:"number",min:"0",step:"0.001",value:Q.weight_kg||"",onChange:Ue=>H(Q.id,"weight_kg",parseFloat(Ue.target.value)||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dimensions (cm)"}),e.jsx("input",{type:"text",value:Q.dimensions_cm,onChange:Ue=>H(Q.id,"dimensions_cm",Ue.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"L x W x H (e.g., 10x5x2)"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Attributes (Color, Size, Storage, etc.)"}),e.jsxs(X,{type:"button",onClick:()=>{const Ue=prompt("Enter attribute name (e.g., Color, Size, Storage):");Ue&&J(Q.id,Ue,"")},className:"flex items-center gap-2 text-sm",children:[e.jsx(Ut,{size:14}),"Add Attribute"]})]}),e.jsxs("div",{className:"space-y-2",children:[Object.entries(Q.attributes).map(([Ue,Ct])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:Ue,readOnly:!0,className:"w-1/3 px-3 py-2 bg-gray-100 border border-gray-300 rounded-lg text-sm"}),e.jsx("input",{type:"text",value:Ct,onChange:Re=>J(Q.id,Ue,Re.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:`Enter ${Ue.toLowerCase()}`}),e.jsx(X,{type:"button",onClick:()=>V(Q.id,Ue),variant:"danger",className:"flex items-center gap-2 text-sm",children:e.jsx(er,{size:14})})]},Ue)),Object.keys(Q.attributes).length===0&&e.jsx("div",{className:"text-sm text-gray-500 italic",children:'No attributes added. Click "Add Attribute" to add variant properties.'})]})]}),Q.cost_price>0&&Q.selling_price>0&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(Bs,{size:16}),e.jsx("span",{className:"font-medium",children:"Profit Analysis:"})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600",children:"Profit:"}),e.jsx("p",{className:"font-semibold text-blue-900",children:(Q.selling_price-Q.cost_price).toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600",children:"Margin:"}),e.jsxs("p",{className:"font-semibold text-blue-900",children:[((Q.selling_price-Q.cost_price)/Q.selling_price*100).toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600",children:"Markup:"}),e.jsxs("p",{className:"font-semibold text-blue-900",children:[((Q.selling_price-Q.cost_price)/Q.cost_price*100).toFixed(1),"%"]})]})]})]})]},Q.id))})]}),e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>f(!b),className:"flex items-center justify-between w-full p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Js,{size:20,className:"text-blue-600"}),"Advanced Settings"]}),b?e.jsx(mn,{size:20,className:"text-gray-600"}):e.jsx(sa,{size:20,className:"text-gray-600"})]}),b&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Code"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:v.product_code,onChange:Q=>_("product_code",Q.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Auto-generated if empty"}),e.jsx(Ga,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Barcode"}),e.jsx("input",{type:"text",value:v.barcode,onChange:Q=>_("barcode",Q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter barcode"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Stock Level"}),e.jsx("input",{type:"number",min:"0",value:v.minimum_stock_level,onChange:Q=>_("minimum_stock_level",parseInt(Q.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reorder Point"}),e.jsx("input",{type:"number",min:"0",value:v.reorder_point,onChange:Q=>_("reorder_point",parseInt(Q.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maximum Stock Level"}),e.jsx("input",{type:"number",min:"0",value:v.maximum_stock_level,onChange:Q=>_("maximum_stock_level",parseInt(Q.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Warranty Period (months)"}),e.jsx("input",{type:"number",min:"0",value:v.warranty_period_months,onChange:Q=>_("warranty_period_months",parseInt(Q.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(X,{type:"button",onClick:()=>r("/inventory"),variant:"secondary",children:"Cancel"}),e.jsxs(X,{type:"submit",disabled:i,className:"flex items-center gap-2",children:[i?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsx(Hs,{size:20}),i?"Creating...":"Create Product"]})]})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(he,{className:"w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add New Category"}),e.jsx(X,{onClick:()=>N(!1),className:"p-1",children:"✕"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Name *"}),e.jsx("input",{type:"text",value:C.name,onChange:Q=>$(Le=>({...Le,name:Q.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter category name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Color"}),e.jsx("select",{value:C.color,onChange:Q=>$(Le=>({...Le,color:Q.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:fe.map(Q=>e.jsx("option",{value:Q.value,children:Q.label},Q.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:C.description,onChange:Q=>$(Le=>({...Le,description:Q.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:3,placeholder:"Enter category description"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(X,{onClick:ge,disabled:!C.name.trim(),className:"flex-1",children:"Create Category"}),e.jsx(X,{onClick:()=>N(!1),variant:"secondary",children:"Cancel"})]})]})]})}),I&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(he,{className:"w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add New Supplier"}),e.jsx(X,{onClick:()=>R(!1),className:"p-1",children:"✕"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier Name *"}),e.jsx("input",{type:"text",value:Y.name,onChange:Q=>A(Le=>({...Le,name:Q.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter supplier name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Person"}),e.jsx("input",{type:"text",value:Y.contact_person,onChange:Q=>A(Le=>({...Le,contact_person:Q.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Contact person name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:Y.email,onChange:Q=>A(Le=>({...Le,email:Q.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"supplier@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),e.jsx("input",{type:"tel",value:Y.phone,onChange:Q=>A(Le=>({...Le,phone:Q.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+255..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City"}),e.jsx("input",{type:"text",value:Y.city,onChange:Q=>A(Le=>({...Le,city:Q.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Dar es Salaam"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lead Time (days)"}),e.jsx("input",{type:"number",min:"1",value:Y.lead_time_days,onChange:Q=>A(Le=>({...Le,lead_time_days:parseInt(Q.target.value)||7})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),e.jsx("textarea",{value:Y.address,onChange:Q=>A(Le=>({...Le,address:Q.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:2,placeholder:"Enter supplier address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Terms"}),e.jsx("input",{type:"text",value:Y.payment_terms,onChange:Q=>A(Le=>({...Le,payment_terms:Q.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Net 30, COD"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(X,{onClick:He,disabled:!Y.name.trim(),className:"flex-1",children:"Create Supplier"}),e.jsx(X,{onClick:()=>R(!1),variant:"secondary",children:"Cancel"})]})]})]})})]})},Dg=()=>{const r=hs(),{currentUser:a}=Wt(),[i,c]=g.useState("categories"),[m,u]=g.useState(!0),[x,j]=g.useState(""),[b,f]=g.useState([]),[y,N]=g.useState(!1),[I,R]=g.useState(null),[k,E]=g.useState({name:"",description:"",color:"#3B82F6"}),[v,U]=g.useState([]),[F,L]=g.useState(!1),[C,$]=g.useState(null),[Y,A]=g.useState({name:"",contact_person:"",email:"",phone:"",address:"",city:"",country:"Tanzania",payment_terms:"",lead_time_days:7,notes:""}),[Z,_]=g.useState([{id:"1",name:"Apple",description:"Apple Inc. - Premium electronics manufacturer",category:"Electronics",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"2",name:"Samsung",description:"Samsung Electronics - Global technology leader",category:"Electronics",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"3",name:"Generic",description:"Generic/Third-party replacement parts",category:"Parts",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]);g.useEffect(()=>{D()},[]);const D=async()=>{u(!0);try{const[J,V]=await Promise.all([ed(),td()]);f(J),U(V)}catch(J){console.error("Error loading management data:",J),te.error("Failed to load management data")}finally{u(!1)}},T=async J=>{if(confirm("Are you sure you want to delete this category?"))try{await lg(J),f(b.filter(V=>V.id!==J)),te.success("Category deleted successfully")}catch{te.error("Failed to delete category")}},z=async J=>{if(confirm("Are you sure you want to delete this supplier?"))try{await cg(J),U(v.filter(V=>V.id!==J)),te.success("Supplier deleted successfully")}catch{te.error("Failed to delete supplier")}},se=b.filter(J=>{var V;return J.name.toLowerCase().includes(x.toLowerCase())||((V=J.description)==null?void 0:V.toLowerCase().includes(x.toLowerCase()))}),q=v.filter(J=>{var V,ge;return J.name.toLowerCase().includes(x.toLowerCase())||((V=J.contact_person)==null?void 0:V.toLowerCase().includes(x.toLowerCase()))||((ge=J.email)==null?void 0:ge.toLowerCase().includes(x.toLowerCase()))}),H=Z.filter(J=>{var V;return J.name.toLowerCase().includes(x.toLowerCase())||((V=J.description)==null?void 0:V.toLowerCase().includes(x.toLowerCase()))});return m?e.jsx("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading inventory management..."})]})})}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-4",children:[e.jsx("strong",{children:"Inventory Management Page Loaded!"})," You should see tabs below."]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(X,{onClick:()=>r("/inventory"),className:"flex items-center gap-2",children:[e.jsx(zs,{size:20}),"Back to Inventory"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Inventory Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage categories, brands, suppliers, and settings"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx(ga,{value:x,onChange:j,placeholder:`Search ${i}...`})}),e.jsxs("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1 mb-6",children:[e.jsxs("button",{onClick:()=>c("categories"),className:`flex items-center gap-2 px-4 py-2 rounded-md transition-colors ${i==="categories"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Js,{size:16}),"Categories (",b.length,")"]}),e.jsxs("button",{onClick:()=>c("brands"),className:`flex items-center gap-2 px-4 py-2 rounded-md transition-colors ${i==="brands"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Ft,{size:16}),"Brands (",Z.length,")"]}),e.jsxs("button",{onClick:()=>c("suppliers"),className:`flex items-center gap-2 px-4 py-2 rounded-md transition-colors ${i==="suppliers"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Zr,{size:16}),"Suppliers (",v.length,")"]}),e.jsxs("button",{onClick:()=>c("settings"),className:`flex items-center gap-2 px-4 py-2 rounded-md transition-colors ${i==="settings"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Fr,{size:16}),"Settings"]})]}),e.jsxs("div",{className:"space-y-6",children:[i==="categories"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Product Categories"}),e.jsxs(X,{onClick:()=>N(!0),className:"flex items-center gap-2",children:[e.jsx(Ut,{size:16}),"Add Category"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:se.map(J=>e.jsxs(he,{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:J.color}}),e.jsx("h3",{className:"font-semibold text-gray-900",children:J.name})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>R(J),className:"p-1 text-gray-400 hover:text-blue-600",children:e.jsx(Ts,{size:14})}),e.jsx("button",{onClick:()=>T(J.id),className:"p-1 text-gray-400 hover:text-red-600",children:e.jsx(er,{size:14})})]})]}),J.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:J.description}),e.jsx("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:e.jsx("span",{className:`px-2 py-1 rounded-full ${J.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:J.is_active?"Active":"Inactive"})})]},J.id))})]}),i==="brands"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Product Brands"}),e.jsxs(X,{onClick:()=>te.info("Brand management coming soon!"),className:"flex items-center gap-2",children:[e.jsx(Ut,{size:16}),"Add Brand"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:H.map(J=>e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:J.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>te.info("Edit brand coming soon!"),className:"p-1 text-gray-400 hover:text-blue-600",children:e.jsx(Ts,{size:14})}),e.jsx("button",{onClick:()=>te.info("Delete brand coming soon!"),className:"p-1 text-gray-400 hover:text-red-600",children:e.jsx(er,{size:14})})]})]}),J.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:J.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full",children:J.category}),e.jsx("span",{className:`px-2 py-1 rounded-full ${J.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:J.is_active?"Active":"Inactive"})]})]},J.id))})]}),i==="suppliers"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Suppliers"}),e.jsxs(X,{onClick:()=>L(!0),className:"flex items-center gap-2",children:[e.jsx(Ut,{size:16}),"Add Supplier"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:q.map(J=>e.jsxs(he,{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:J.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>$(J),className:"p-1 text-gray-400 hover:text-blue-600",children:e.jsx(Ts,{size:14})}),e.jsx("button",{onClick:()=>z(J.id),className:"p-1 text-gray-400 hover:text-red-600",children:e.jsx(er,{size:14})})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[J.contact_person&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(_s,{size:14}),e.jsx("span",{children:J.contact_person})]}),J.email&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(da,{size:14}),e.jsx("span",{children:J.email})]}),J.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Qr,{size:14}),e.jsx("span",{children:J.phone})]}),J.city&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(ei,{size:14}),e.jsx("span",{children:J.city})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(ms,{size:14}),e.jsxs("span",{children:[J.lead_time_days," days lead time"]})]})]}),e.jsx("div",{className:"flex items-center gap-2 mt-3 text-xs",children:e.jsx("span",{className:`px-2 py-1 rounded-full ${J.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:J.is_active?"Active":"Inactive"})})]},J.id))})]}),i==="settings"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Inventory Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ht,{className:"text-orange-600",size:20}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Low Stock Alerts"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Configure automatic alerts for products running low on stock."}),e.jsx(X,{variant:"secondary",onClick:()=>te.info("Low stock settings coming soon!"),children:"Configure Alerts"})]}),e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ns,{className:"text-green-600",size:20}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Pricing Rules"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Set up automatic pricing rules and markup percentages."}),e.jsx(X,{variant:"secondary",onClick:()=>te.info("Pricing rules coming soon!"),children:"Configure Rules"})]})]})]})]})]})},Tg=()=>{var Y,A,Z,_,D,T;const{id:r}=ka(),a=hs(),{currentUser:i}=Wt(),[c,m]=g.useState(null),[u,x]=g.useState([]),[j,b]=g.useState(!0),[f,y]=g.useState(!1),[N,I]=g.useState(null),[R,k]=g.useState({type:"in",quantity:0,reason:""});g.useEffect(()=>{r&&E()},[r]);const E=async()=>{b(!0);try{const z=await rd(r);if(!z){te.error("Product not found"),a("/inventory");return}m(z);const q=(await mg()).filter(H=>{var J;return(J=z.variants)==null?void 0:J.some(V=>V.id===H.variant_id)});x(q)}catch(z){console.error("Error loading product:",z),te.error("Failed to load product data")}finally{b(!1)}},v=async()=>{if(N)try{await ug(N.id,R.type,R.quantity,R.reason),te.success("Stock updated successfully"),y(!1),k({type:"in",quantity:0,reason:""}),I(null),E()}catch(z){te.error(z.message||"Failed to update stock")}},U=(z,se)=>{I(z),k({type:se,quantity:0,reason:""}),y(!0)},F=z=>z.quantity_in_stock===0?"bg-red-100 text-red-800 border-red-200":z.quantity_in_stock<=((c==null?void 0:c.reorder_point)||10)?"bg-yellow-100 text-yellow-800 border-yellow-200":"bg-green-100 text-green-800 border-green-200",L=z=>new Date(z).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});if(j)return e.jsx("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})})});if(!c)return e.jsx("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto",children:e.jsxs(he,{className:"text-center py-8",children:[e.jsx(Ft,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Product not found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"The product you're looking for doesn't exist."}),e.jsx(X,{onClick:()=>a("/inventory"),children:"Back to Inventory"})]})});const C=((Y=c.variants)==null?void 0:Y.reduce((z,se)=>z+se.quantity_in_stock,0))||0,$=((A=c.variants)==null?void 0:A.reduce((z,se)=>z+se.quantity_in_stock*se.cost_price,0))||0;return e.jsxs("div",{className:"p-4 sm:p-6 max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(X,{onClick:()=>a("/inventory"),className:"flex items-center gap-2",children:[e.jsx(zs,{size:20}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:c.name}),e.jsxs("p",{className:"text-gray-600",children:[c.brand," ",c.model]})]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(X,{onClick:()=>a(`/inventory/products/${c.id}/edit`),className:"flex items-center gap-2",children:[e.jsx(Ts,{size:18}),"Edit Product"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(he,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Product Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Code"}),e.jsx("p",{className:"text-gray-900 font-mono",children:c.product_code||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Category"}),e.jsx("p",{className:"text-gray-900",children:((Z=c.category)==null?void 0:Z.name)||"Uncategorized"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Supplier"}),e.jsx("p",{className:"text-gray-900",children:((_=c.supplier)==null?void 0:_.name)||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Warranty Period"}),e.jsxs("p",{className:"text-gray-900",children:[c.warranty_period_months," months"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Reorder Point"}),e.jsxs("p",{className:"text-gray-900",children:[c.reorder_point," units"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Min/Max Stock"}),e.jsxs("p",{className:"text-gray-900",children:[c.minimum_stock_level," / ",c.maximum_stock_level]})]})]}),c.description&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-900",children:c.description})]})]})}),e.jsx("div",{children:e.jsxs(he,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Stock Summary"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ft,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:"Total Stock"})]}),e.jsx("span",{className:"text-xl font-bold text-blue-900",children:C})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900",children:"Total Value"})]}),e.jsx("span",{className:"text-xl font-bold text-green-900",children:$.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Js,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-900",children:"Variants"})]}),e.jsx("span",{className:"text-xl font-bold text-purple-900",children:((D=c.variants)==null?void 0:D.length)||0})]})]})]})})]}),e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Product Variants"}),e.jsxs(X,{onClick:()=>a(`/inventory/products/${c.id}/variants/new`),className:"flex items-center gap-2",children:[e.jsx(Ut,{size:16}),"Add Variant"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(T=c.variants)==null?void 0:T.map(z=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white/50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:z.variant_name}),e.jsx("p",{className:"text-sm text-gray-600 font-mono",children:z.sku})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${F(z)}`,children:z.quantity_in_stock>0?"In Stock":"Out of Stock"})]}),Object.keys(z.attributes).length>0&&e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(z.attributes).map(([se,q])=>e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded-full",children:[se,": ",q]},se))})}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Stock:"}),e.jsx("span",{className:"font-medium",children:z.quantity_in_stock})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Cost:"}),e.jsx("span",{className:"font-medium",children:z.cost_price.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Price:"}),e.jsx("span",{className:"font-medium",children:z.selling_price.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Profit:"}),e.jsx("span",{className:"font-medium text-green-600",children:(z.selling_price-z.cost_price).toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsxs(X,{onClick:()=>U(z,"in"),variant:"success",className:"flex-1 text-sm",children:[e.jsx(Ut,{size:14}),"Add"]}),e.jsxs(X,{onClick:()=>U(z,"out"),variant:"danger",className:"flex-1 text-sm",disabled:z.quantity_in_stock===0,children:[e.jsx($o,{size:14}),"Remove"]}),e.jsxs(X,{onClick:()=>U(z,"adjustment"),variant:"secondary",className:"flex-1 text-sm",children:[e.jsx(zr,{size:14}),"Adjust"]})]})]},z.id))}),(!c.variants||c.variants.length===0)&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Js,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No variants found for this product"}),e.jsxs(X,{onClick:()=>a(`/inventory/products/${c.id}/variants/new`),className:"flex items-center gap-2",children:[e.jsx(Ut,{size:16}),"Add First Variant"]})]})]}),e.jsxs(he,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Stock Movement History"}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium text-gray-700",children:"Date"}),e.jsx("th",{className:"text-left py-2 px-3 font-medium text-gray-700",children:"Variant"}),e.jsx("th",{className:"text-left py-2 px-3 font-medium text-gray-700",children:"Type"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-gray-700",children:"Quantity"}),e.jsx("th",{className:"text-left py-2 px-3 font-medium text-gray-700",children:"Reason"}),e.jsx("th",{className:"text-left py-2 px-3 font-medium text-gray-700",children:"By"})]})}),e.jsx("tbody",{children:u.map(z=>{var se,q,H;return e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("td",{className:"py-2 px-3 text-sm text-gray-600",children:L(z.performed_at)}),e.jsxs("td",{className:"py-2 px-3 text-sm",children:[e.jsx("div",{className:"font-medium text-gray-900",children:(se=z.variant)==null?void 0:se.variant_name}),e.jsx("div",{className:"text-xs text-gray-500",children:(q=z.variant)==null?void 0:q.sku})]}),e.jsx("td",{className:"py-2 px-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[z.movement_type==="in"&&e.jsx(vr,{className:"w-4 h-4 text-green-500"}),z.movement_type==="out"&&e.jsx(Sa,{className:"w-4 h-4 text-red-500"}),z.movement_type==="adjustment"&&e.jsx(zr,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm capitalize",children:z.movement_type})]})}),e.jsx("td",{className:"py-2 px-3 text-center",children:e.jsxs("span",{className:`font-medium ${z.movement_type==="in"?"text-green-600":z.movement_type==="out"?"text-red-600":"text-blue-600"}`,children:[z.movement_type==="out"?"-":"+",z.quantity]})}),e.jsx("td",{className:"py-2 px-3 text-sm text-gray-600",children:z.reason||"No reason provided"}),e.jsx("td",{className:"py-2 px-3 text-sm text-gray-600",children:((H=z.performed_by_user)==null?void 0:H.name)||"System"})]},z.id)})})]}),u.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No stock movements recorded yet"})]})]}),f&&N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(he,{className:"w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:R.type==="in"?"Add Stock":R.type==="out"?"Remove Stock":"Adjust Stock"}),e.jsx(X,{onClick:()=>y(!1),className:"p-1",children:"✕"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"font-medium text-blue-900",children:N.variant_name}),e.jsxs("div",{className:"text-sm text-blue-700",children:["Current Stock: ",N.quantity_in_stock]}),e.jsxs("div",{className:"text-sm text-blue-700",children:["SKU: ",N.sku]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[R.type==="adjustment"?"New Stock Level":"Quantity"," *"]}),e.jsx("input",{type:"number",min:R.type==="out"?1:0,max:R.type==="out"?N.quantity_in_stock:void 0,value:R.quantity,onChange:z=>k(se=>({...se,quantity:parseInt(z.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter quantity",required:!0}),R.type==="adjustment"&&e.jsxs("div",{className:"mt-1 text-sm text-gray-600",children:["Change: ",R.quantity-N.quantity_in_stock>0?"+":"",R.quantity-N.quantity_in_stock]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason *"}),e.jsx("textarea",{value:R.reason,onChange:z=>k(se=>({...se,reason:z.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:3,placeholder:"Enter reason for stock change",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(X,{onClick:v,disabled:R.quantity<=0||!R.reason.trim(),className:"flex-1",children:"Update Stock"}),e.jsx(X,{onClick:()=>y(!1),variant:"secondary",children:"Cancel"})]})]})]})})]})},Ig=()=>{const r=hs(),{currentUser:a}=Wt(),[i,c]=g.useState([]),[m,u]=g.useState(!0),[x,j]=g.useState(""),[b,f]=g.useState("all");g.useEffect(()=>{setTimeout(()=>{const v=[{id:"1",po_number:"PO-2024-001",supplier_name:"TechParts Tanzania",status:"confirmed",order_date:"2024-01-15",expected_delivery_date:"2024-01-22",total_amount:25e5,items_count:15,created_by:(a==null?void 0:a.name)||"Admin"},{id:"2",po_number:"PO-2024-002",supplier_name:"Mobile Solutions Ltd",status:"draft",order_date:"2024-01-20",total_amount:18e5,items_count:8,created_by:(a==null?void 0:a.name)||"Admin"},{id:"3",po_number:"PO-2024-003",supplier_name:"Computer World",status:"received",order_date:"2024-01-10",expected_delivery_date:"2024-01-18",total_amount:32e5,items_count:22,created_by:(a==null?void 0:a.name)||"Admin"}];c(v),u(!1)},500)},[a]);const y=v=>{switch(v){case"draft":return e.jsx(Ts,{className:"h-4 w-4 text-gray-500"});case"sent":return e.jsx(Ol,{className:"h-4 w-4 text-blue-500"});case"confirmed":return e.jsx(yt,{className:"h-4 w-4 text-green-500"});case"received":return e.jsx(Ft,{className:"h-4 w-4 text-purple-500"});case"cancelled":return e.jsx(Fs,{className:"h-4 w-4 text-red-500"});default:return e.jsx(ms,{className:"h-4 w-4 text-gray-500"})}},N=v=>{switch(v){case"draft":return"bg-gray-100 text-gray-800 border-gray-200";case"sent":return"bg-blue-100 text-blue-800 border-blue-200";case"confirmed":return"bg-green-100 text-green-800 border-green-200";case"received":return"bg-purple-100 text-purple-800 border-purple-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},I=v=>new Intl.NumberFormat("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0}).format(v),R=v=>new Date(v).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),k=i.filter(v=>{const U=x===""||v.po_number.toLowerCase().includes(x.toLowerCase())||v.supplier_name.toLowerCase().includes(x.toLowerCase()),F=b==="all"||v.status===b;return U&&F}),E={total:i.length,draft:i.filter(v=>v.status==="draft").length,confirmed:i.filter(v=>v.status==="confirmed").length,received:i.filter(v=>v.status==="received").length,totalValue:i.reduce((v,U)=>v+U.total_amount,0)};return m?e.jsx("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading purchase orders..."})]})})}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(X,{onClick:()=>r("/inventory"),className:"flex items-center gap-2",children:[e.jsx(zs,{size:20}),"Back to Inventory"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Purchase Orders"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage supplier orders and inventory restocking"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsxs(X,{onClick:()=>r("/inventory/purchase-orders/new"),className:"flex items-center gap-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:[e.jsx(Ut,{size:18}),"New Purchase Order"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(he,{className:"bg-gradient-to-br from-blue-50 to-blue-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:E.total})]}),e.jsx("div",{className:"p-3 bg-blue-50/20 rounded-full",children:e.jsx(Zr,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx(he,{className:"bg-gradient-to-br from-gray-50 to-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Draft"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:E.draft})]}),e.jsx("div",{className:"p-3 bg-gray-50/20 rounded-full",children:e.jsx(Ts,{className:"w-6 h-6 text-gray-600"})})]})}),e.jsx(he,{className:"bg-gradient-to-br from-green-50 to-green-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Confirmed"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:E.confirmed})]}),e.jsx("div",{className:"p-3 bg-green-50/20 rounded-full",children:e.jsx(yt,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx(he,{className:"bg-gradient-to-br from-purple-50 to-purple-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Received"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:E.received})]}),e.jsx("div",{className:"p-3 bg-purple-50/20 rounded-full",children:e.jsx(Ft,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx(he,{className:"bg-gradient-to-br from-amber-50 to-amber-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-amber-600",children:"Total Value"}),e.jsx("p",{className:"text-2xl font-bold text-amber-900",children:I(E.totalValue)})]}),e.jsx("div",{className:"p-3 bg-amber-50/20 rounded-full",children:e.jsx(Ns,{className:"w-6 h-6 text-amber-600"})})]})})]}),e.jsx(he,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Cr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search purchase orders...",value:x,onChange:v=>j(v.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:b,onChange:v=>f(v.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"sent",children:"Sent"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"received",children:"Received"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})})]})}),e.jsx("div",{className:"space-y-4",children:k.map(v=>e.jsx(he,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:v.po_number}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium border ${N(v.status)}`,children:[y(v.status),e.jsx("span",{className:"capitalize",children:v.status})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zr,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Supplier: ",e.jsx("span",{className:"font-medium",children:v.supplier_name})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ws,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Order Date: ",e.jsx("span",{className:"font-medium",children:R(v.order_date)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ft,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Items: ",e.jsx("span",{className:"font-medium",children:v.items_count})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Total: ",e.jsx("span",{className:"font-medium",children:I(v.total_amount)})]})]})]}),v.expected_delivery_date&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ol,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:["Expected Delivery: ",e.jsx("span",{className:"font-medium",children:R(v.expected_delivery_date)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsxs(X,{onClick:()=>r(`/inventory/purchase-orders/${v.id}`),className:"flex items-center gap-2",variant:"secondary",children:[e.jsx(cs,{className:"h-4 w-4"}),"View"]}),v.status==="draft"&&e.jsxs(X,{onClick:()=>r(`/inventory/purchase-orders/${v.id}/edit`),className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"h-4 w-4"}),"Edit"]})]})]})},v.id))}),k.length===0&&e.jsxs(he,{className:"text-center py-12",children:[e.jsx(Zr,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No purchase orders found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:x||b!=="all"?"Try adjusting your search or filter criteria":"Create your first purchase order to start managing supplier orders"}),e.jsxs(X,{onClick:()=>r("/inventory/purchase-orders/new"),className:"flex items-center gap-2",children:[e.jsx(Ut,{size:18}),"Create Purchase Order"]})]})]})},Mg=({value:r,onChange:a,placeholder:i="Search products...",className:c="",allowNewProduct:m=!0})=>{const[u,x]=g.useState(""),[j,b]=g.useState(!1),[f,y]=g.useState([]),[N,I]=g.useState([]),[R,k]=g.useState(!1),[E,v]=g.useState(!1),U=g.useRef(null),F=g.useRef(null);g.useEffect(()=>{function A(Z){U.current&&!U.current.contains(Z.target)&&F.current&&!F.current.contains(Z.target)&&b(!1)}return j&&document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)}},[j]);const L=async A=>{if(x(A),A.length<2){y([]),I([]),b(!1);return}k(!0),b(!0);try{const[Z,_]=await Promise.all([xg(A),gg(A)]);y(Z),I(_)}catch(Z){console.error("Error searching products:",Z)}finally{k(!1)}},C=(A,Z)=>{a({product:A,variant:Z}),x(`${A.name} - ${Z.variant_name}`),b(!1)},$=()=>{a(null),x(""),b(!1)},Y=r?`${r.product.name} - ${r.variant.variant_name} (${r.variant.sku})`:u;return e.jsxs("div",{className:`relative ${c}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:U,type:"text",value:Y,onChange:A=>L(A.target.value),onFocus:()=>{u.length>=2&&b(!0)},className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:i}),e.jsx(Cr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),r&&e.jsx("button",{type:"button",onClick:$,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:"✕"})]}),j&&e.jsx("div",{ref:F,className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-xl max-h-80 overflow-y-auto",children:R?e.jsx("div",{className:"p-4 text-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500 mx-auto"})}):e.jsxs(e.Fragment,{children:[f.map(A=>{var Z;return e.jsxs("div",{children:[e.jsx("div",{className:"px-4 py-2 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ft,{size:16,className:"text-blue-500"}),e.jsx("span",{className:"font-medium text-gray-900",children:A.name}),A.brand&&e.jsxs("span",{className:"text-sm text-gray-500",children:["(",A.brand,")"]})]})}),(Z=A.variants)==null?void 0:Z.map(_=>e.jsx("button",{type:"button",onClick:()=>C(A,_),className:"w-full px-6 py-3 text-left hover:bg-blue-50 border-b border-gray-100 last:border-b-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:_.variant_name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["SKU: ",_.sku," • Stock: ",_.quantity_in_stock," • Price: ",_.selling_price.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})]})]}),e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${_.quantity_in_stock>10?"bg-green-100 text-green-800":_.quantity_in_stock>0?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:_.quantity_in_stock>0?"In Stock":"Out of Stock"})]})},_.id))]},A.id)}),N.filter(A=>!f.some(Z=>Z.id===A.product_id)).map(A=>e.jsx("button",{type:"button",onClick:()=>A.product&&C(A.product,A),className:"w-full px-4 py-3 text-left hover:bg-blue-50 border-b border-gray-100 last:border-b-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:A.variant_name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["SKU: ",A.sku," • Stock: ",A.quantity_in_stock]})]}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:A.selling_price.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]})},A.id)),!R&&f.length===0&&N.length===0&&u.length>=2&&e.jsxs("div",{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-gray-500 mb-2",children:['No products found for "',u,'"']}),m&&e.jsxs(X,{onClick:()=>v(!0),className:"flex items-center gap-2",children:[e.jsx(Ut,{size:16}),"Add New Product"]})]}),m&&(f.length>0||N.length>0)&&e.jsx("div",{className:"border-t border-gray-200 p-2",children:e.jsxs(X,{onClick:()=>v(!0),className:"w-full flex items-center justify-center gap-2",variant:"secondary",children:[e.jsx(Ut,{size:16}),"Add New Product"]})})]})}),E&&e.jsx(es,{isOpen:E,onClose:()=>v(!1),title:"Add New Product",maxWidth:"4xl",children:e.jsx("div",{className:"max-h-[80vh] overflow-y-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"This will open the new product creation form. After creating the product, it will be automatically selected in the dropdown."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(X,{onClick:()=>{v(!1),window.open("/inventory/new","_blank")},className:"flex items-center gap-2",children:[e.jsx(Ut,{size:16}),"Open New Product Form"]}),e.jsx(X,{onClick:()=>v(!1),variant:"secondary",children:"Cancel"})]})]})})})]})},Rg=()=>{const r=hs(),{currentUser:a}=Wt(),[i,c]=g.useState(!1),[m,u]=g.useState([]),[x,j]=g.useState([]),[b,f]=g.useState({supplier_id:"",order_date:new Date().toISOString().split("T")[0],expected_delivery_date:"",notes:"",payment_terms:""}),[y,N]=g.useState([]);g.useEffect(()=>{I()},[]);const I=async()=>{try{const[Y,A]=await Promise.all([td(),sd()]);u(Y),j(A)}catch(Y){console.error("Error loading data:",Y),te.error("Failed to load suppliers and products")}},R=()=>{const Y={id:Date.now().toString(),quantity:1,unit_cost:0,total_cost:0};N([...y,Y])},k=Y=>{N(y.filter(A=>A.id!==Y))},E=(Y,A,Z)=>{N(y.map(_=>{if(_.id===Y){const D={..._,[A]:Z};return(A==="quantity"||A==="unit_cost")&&(D.total_cost=D.quantity*D.unit_cost),D}return _}))},v=(Y,A)=>{A&&N(y.map(Z=>Z.id===Y?{...Z,product:A.product,variant:A.variant,unit_cost:A.variant.cost_price,total_cost:Z.quantity*A.variant.cost_price}:Z))},U=()=>{const Y=y.reduce((_,D)=>_+D.total_cost,0),A=Y*.18,Z=Y+A;return{subtotal:Y,tax:A,total:Z}},F=async Y=>{if(Y.preventDefault(),!b.supplier_id){te.error("Please select a supplier");return}if(y.length===0){te.error("Please add at least one item");return}if(y.some(A=>!A.product||!A.variant)){te.error("Please select products for all items");return}c(!0);try{await new Promise(A=>setTimeout(A,1e3)),te.success("Purchase order created successfully!"),r("/inventory/purchase-orders")}catch(A){console.error("Error creating purchase order:",A),te.error(A.message||"Failed to create purchase order")}finally{c(!1)}},{subtotal:L,tax:C,total:$}=U();return e.jsxs("div",{className:"p-4 sm:p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(X,{onClick:()=>r("/inventory/purchase-orders"),className:"flex items-center gap-2",children:[e.jsx(zs,{size:20}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"New Purchase Order"}),e.jsx("p",{className:"text-gray-600",children:"Create a new purchase order for inventory restocking"})]})]}),e.jsx("form",{onSubmit:F,children:e.jsxs(he,{className:"mb-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(pr,{size:20,className:"text-blue-600"}),"Order Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier *"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:b.supplier_id,onChange:Y=>f(A=>({...A,supplier_id:Y.target.value})),className:"w-full pl-12 pr-4 py-3 text-lg border-2 border-gray-300 rounded-lg bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",required:!0,children:[e.jsx("option",{value:"",children:"Select supplier"}),m.map(Y=>e.jsx("option",{value:Y.id,children:Y.name},Y.id))]}),e.jsx(Zr,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Order Date *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:b.order_date,onChange:Y=>f(A=>({...A,order_date:Y.target.value})),className:"w-full pl-12 pr-4 py-3 text-lg border-2 border-gray-300 rounded-lg bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",required:!0}),e.jsx(ws,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expected Delivery Date"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:b.expected_delivery_date,onChange:Y=>f(A=>({...A,expected_delivery_date:Y.target.value})),className:"w-full pl-12 pr-4 py-3 text-lg border-2 border-gray-300 rounded-lg bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200"}),e.jsx(ws,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Terms"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:b.payment_terms,onChange:Y=>f(A=>({...A,payment_terms:Y.target.value})),className:"w-full pl-12 pr-4 py-3 text-lg border-2 border-gray-300 rounded-lg bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",placeholder:"e.g., Net 30, COD"}),e.jsx(Ns,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:20})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:b.notes,onChange:Y=>f(A=>({...A,notes:Y.target.value})),className:"w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg bg-white/30 backdrop-blur-md focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200 resize-none",placeholder:"Add any notes for this purchase order",rows:3})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ft,{size:20,className:"text-blue-600"}),"Order Items (",y.length,")"]}),e.jsxs(X,{type:"button",onClick:R,className:"flex items-center gap-2",children:[e.jsx(Ut,{size:20}),"Add Item"]})]}),e.jsxs("div",{className:"space-y-4",children:[y.map((Y,A)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:["Item ",A+1]}),y.length>0&&e.jsxs(X,{type:"button",onClick:()=>k(Y.id),variant:"danger",className:"flex items-center gap-2",children:[e.jsx(er,{size:16}),"Remove"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product *"}),e.jsx(Mg,{value:Y.product&&Y.variant?{product:Y.product,variant:Y.variant}:null,onChange:Z=>v(Y.id,Z),placeholder:"Search and select product...",allowNewProduct:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity *"}),e.jsx("input",{type:"number",min:"1",value:Y.quantity||"",onChange:Z=>E(Y.id,"quantity",parseInt(Z.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Unit Cost (TZS) *"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:Y.unit_cost||"",onChange:Z=>E(Y.id,"unit_cost",parseFloat(Z.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",required:!0})]})]}),Y.product&&Y.variant&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-blue-900",children:[Y.product.name," - ",Y.variant.variant_name]}),e.jsxs("p",{className:"text-sm text-blue-700",children:["SKU: ",Y.variant.sku]}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Current Stock: ",Y.variant.quantity_in_stock]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-lg font-bold text-blue-900",children:["Total: ",(Y.total_cost||0).toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})]})})]})})]},Y.id)),y.length===0&&e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx(Ft,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No items added yet"}),e.jsxs(X,{type:"button",onClick:R,className:"flex items-center gap-2",children:[e.jsx(Ut,{size:16}),"Add First Item"]})]})]})]}),y.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(dn,{size:20,className:"text-blue-600"}),"Order Summary"]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:L.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"VAT (18%):"}),e.jsx("span",{className:"font-medium",children:C.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t border-gray-300 pt-2",children:[e.jsx("span",{className:"text-gray-900",children:"Total:"}),e.jsx("span",{className:"text-blue-600",children:$.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(X,{type:"button",onClick:()=>r("/inventory/purchase-orders"),variant:"secondary",children:"Cancel"}),e.jsxs(X,{type:"submit",disabled:i||y.length===0,className:"flex items-center gap-2",children:[i?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsx(Hs,{size:20}),i?"Creating...":"Create Purchase Order"]})]})]})})]})},Lg=({isOpen:r,onClose:a,sparePart:i,deviceId:c,deviceInfo:m})=>{const{currentUser:u}=Wt(),[x,j]=g.useState(!1),[b,f]=g.useState([]),[y,N]=g.useState({quantity_used:1,notes:"",device_id:c||""});g.useEffect(()=>{r&&i&&I()},[r,i]);const I=async()=>{if(i){j(!0);try{const E=await vg(i.id);f(E)}catch(E){console.error("Error loading usage history:",E),te.error("Failed to load usage history")}finally{j(!1)}}},R=async E=>{if(E.preventDefault(),!(!i||!u)){if(y.quantity_used>i.stock_quantity){te.error("Cannot use more parts than available in stock");return}j(!0);try{await Ng({spare_part_id:i.id,device_id:y.device_id||null,quantity_used:y.quantity_used,used_by:u.name||u.username,notes:y.notes}),await Sg(i.id,y.quantity_used,"subtract"),te.success("Part usage recorded successfully"),a()}catch(v){console.error("Error recording usage:",v),te.error("Failed to record usage")}finally{j(!1)}}},k=E=>new Date(E).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return!r||!i?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx(he,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900 rounded-lg",children:e.jsx(Ft,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Record Part Usage"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Track usage of ",i.name]})]})]}),e.jsx(X,{variant:"ghost",size:"sm",onClick:a,children:e.jsx(tr,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(he,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx(Sa,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Record Usage"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Track part consumption"})]})]}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Quantity Used *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"1",max:i.stock_quantity,value:y.quantity_used,onChange:E=>N(v=>({...v,quantity_used:parseInt(E.target.value)||1})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("span",{className:"absolute right-3 top-2 text-sm text-gray-500",children:["/ ",i.stock_quantity," available"]})]})]}),m&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ft,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"font-medium text-blue-800 dark:text-blue-200",children:"Device Information"})]}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Device:"})," ",m.brand," ",m.model]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Customer:"})," ",m.customer_name]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes"}),e.jsx("textarea",{value:y.notes,onChange:E=>N(v=>({...v,notes:E.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Additional notes about the usage..."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(X,{type:"submit",disabled:x||y.quantity_used>i.stock_quantity,className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700",children:[x?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(Hs,{className:"w-4 h-4 mr-2"}),x?"Recording...":"Record Usage"]}),e.jsx(X,{type:"button",variant:"outline",onClick:a,children:"Cancel"})]})]})]}),e.jsxs(he,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900 rounded-lg",children:e.jsx(Ft,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Part Details"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Current information"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Name:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:i.name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Category:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white capitalize",children:i.category})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Brand:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:i.brand||"N/A"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Price:"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:["$",i.price.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Stock:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:i.stock_quantity}),i.stock_quantity===0?e.jsx(Ht,{className:"w-4 h-4 text-red-500"}):i.stock_quantity<=i.min_stock_level?e.jsx(Ht,{className:"w-4 h-4 text-yellow-500"}):e.jsx(yt,{className:"w-4 h-4 text-green-500"})]})]})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(he,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900 rounded-lg",children:e.jsx(zr,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Usage History"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Recent usage records"})]})]}),x?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):b.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ft,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No usage history yet"})]}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:b.map(E=>e.jsxs("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ga,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[E.quantity_used," used"]})]}),e.jsx("span",{className:"text-sm text-gray-500",children:k(E.used_at)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ws,{className:"w-3 h-3"}),e.jsx("span",{children:E.used_by})]}),E.device&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ft,{className:"w-3 h-3"}),e.jsxs("span",{children:[E.device.brand," ",E.device.model]})]})]}),E.notes&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-800 rounded text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(pr,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Notes:"})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:E.notes})]})]},E.id))})]})})]})]})})})},Og=()=>{const r=hs(),{currentUser:a}=Wt(),[i,c]=g.useState([]),[m,u]=g.useState(null),[x,j]=g.useState(!0),[b,f]=g.useState(""),[y,N]=g.useState("all"),[I,R]=g.useState("all"),[k,E]=g.useState("all"),[v,U]=g.useState("grid"),[F,L]=g.useState(!1),[C,$]=g.useState([]),[Y,A]=g.useState([]),[Z,_]=g.useState([]),[D,T]=g.useState([]),[z,se]=g.useState(null),[q,H]=g.useState(!1);g.useEffect(()=>{J()},[a]);const J=async()=>{j(!0);try{const[B,fe,re,ye,Q,Le]=await Promise.all([fg(),Cg(),_g(),Eg(),wg(),jg()]);c(B),u(fe),$(re),A(ye),_(Q),T(Le)}catch(B){console.error("Error loading spare parts data:",B),te.error("Failed to load spare parts data")}finally{j(!1)}},V=B=>{switch(B){case"screen":return e.jsx(ns,{className:"w-5 h-5"});case"battery":return e.jsx(ti,{className:"w-5 h-5"});case"camera":return e.jsx(vn,{className:"w-5 h-5"});case"speaker":return e.jsx(si,{className:"w-5 h-5"});case"microphone":return e.jsx(Wi,{className:"w-5 h-5"});case"charging_port":return e.jsx(Kr,{className:"w-5 h-5"});case"motherboard":return e.jsx(ri,{className:"w-5 h-5"});default:return e.jsx(Ft,{className:"w-5 h-5"})}},ge=B=>B.stock_quantity===0?{status:"Out of Stock",color:"bg-red-100 text-red-800"}:B.stock_quantity<=B.min_stock_level?{status:"Low Stock",color:"bg-yellow-100 text-yellow-800"}:{status:"In Stock",color:"bg-green-100 text-green-800"},He=i.filter(B=>{var Le,Ue,Ct;const fe=b===""||B.name.toLowerCase().includes(b.toLowerCase())||((Le=B.brand)==null?void 0:Le.toLowerCase().includes(b.toLowerCase()))||((Ue=B.part_number)==null?void 0:Ue.toLowerCase().includes(b.toLowerCase()))||((Ct=B.description)==null?void 0:Ct.toLowerCase().includes(b.toLowerCase())),re=y==="all"||B.category===y,ye=I==="all"||B.brand===I,Q=k==="all"||k==="low"&&B.stock_quantity<=B.min_stock_level||k==="out"&&B.stock_quantity===0||k==="in"&&B.stock_quantity>B.min_stock_level;return fe&&re&&ye&&Q});return x?e.jsx("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading spare parts..."})]})})}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Spare Parts Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your repair parts inventory and track usage"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(X,{onClick:()=>r("/spare-parts/new"),className:"flex items-center gap-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:[e.jsx(Ut,{size:18}),"Add Spare Part"]}),e.jsxs(X,{onClick:()=>r("/spare-parts/import"),className:"flex items-center gap-2",children:[e.jsx(Lr,{size:18}),"Import"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(he,{className:"bg-gradient-to-br from-blue-50 to-blue-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Parts"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:(m==null?void 0:m.total_parts)||0})]}),e.jsx("div",{className:"p-3 bg-blue-50/20 rounded-full",children:e.jsx(Ft,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx(he,{className:"bg-gradient-to-br from-green-50 to-green-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Total Value"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:((m==null?void 0:m.total_value)||0).toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]}),e.jsx("div",{className:"p-3 bg-green-50/20 rounded-full",children:e.jsx(Ns,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx(he,{className:"bg-gradient-to-br from-purple-50 to-purple-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Categories"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:(m==null?void 0:m.total_categories)||0})]}),e.jsx("div",{className:"p-3 bg-purple-50/20 rounded-full",children:e.jsx(Js,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx(he,{className:"bg-gradient-to-br from-red-50 to-red-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-600",children:"Low Stock Items"}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:Z.length})]}),e.jsx("div",{className:"p-3 bg-red-50/20 rounded-full",children:e.jsx(Ht,{className:"w-6 h-6 text-red-600"})})]})})]}),Z.length>0&&e.jsxs(he,{className:"bg-red-50 border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ht,{className:"w-6 h-6 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-900",children:"Low Stock Alert"}),e.jsxs("p",{className:"text-red-700",children:[Z.length," parts need restocking"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:Z.slice(0,6).map((B,fe)=>e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[V(B.category),e.jsx("div",{className:"font-medium text-gray-900",children:B.name})]}),e.jsx("div",{className:"text-sm text-gray-600",children:B.brand}),e.jsxs("div",{className:"text-sm text-red-600 font-medium",children:["Stock: ",B.stock_quantity," / Min: ",B.min_stock_level]})]},B.id))}),Z.length>6&&e.jsx("div",{className:"mt-3 text-center",children:e.jsxs(X,{onClick:()=>E("low"),variant:"secondary",className:"text-sm",children:["View All ",Z.length," Items"]})})]}),D.length>0&&e.jsxs(he,{className:"bg-orange-50 border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ht,{className:"w-6 h-6 text-orange-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-900",children:"Out of Stock Alert"}),e.jsxs("p",{className:"text-orange-700",children:[D.length," parts are completely out of stock"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:D.slice(0,6).map((B,fe)=>e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[V(B.category),e.jsx("div",{className:"font-medium text-gray-900",children:B.name})]}),e.jsx("div",{className:"text-sm text-gray-600",children:B.brand}),e.jsxs("div",{className:"text-sm text-orange-600 font-medium",children:["Stock: ",B.stock_quantity," / Min: ",B.min_stock_level]})]},B.id))}),D.length>6&&e.jsx("div",{className:"mt-3 text-center",children:e.jsxs(X,{onClick:()=>E("out"),variant:"secondary",className:"text-sm",children:["View All ",D.length," Items"]})})]}),e.jsx(he,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 flex-1",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(ga,{onSearch:f,placeholder:"Search parts, brands, part numbers...",className:"w-full"})}),e.jsxs("select",{value:y,onChange:B=>N(B.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Categories"}),C.map(B=>e.jsx("option",{value:B,children:B.charAt(0).toUpperCase()+B.slice(1)},B))]}),e.jsxs("select",{value:I,onChange:B=>R(B.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Brands"}),Y.map(B=>e.jsx("option",{value:B,children:B},B))]}),e.jsxs("select",{value:k,onChange:B=>E(B.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Stock Levels"}),e.jsx("option",{value:"in",children:"In Stock"}),e.jsx("option",{value:"low",children:"Low Stock"}),e.jsx("option",{value:"out",children:"Out of Stock"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(X,{onClick:()=>U("grid"),variant:v==="grid"?"primary":"secondary",className:"flex items-center gap-2",children:[e.jsx(Ho,{size:16}),"Grid"]}),e.jsxs(X,{onClick:()=>U("list"),variant:v==="list"?"primary":"secondary",className:"flex items-center gap-2",children:[e.jsx(Wo,{size:16}),"List"]})]})]})}),v==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:He.map(B=>{const fe=ge(B);return e.jsxs(he,{onClick:()=>r(`/spare-parts/${B.id}`),className:"cursor-pointer hover:scale-105 transition-transform duration-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white",children:V(B.category)}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${fe.color}`,children:fe.status})]}),e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:B.name}),B.brand&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:B.brand}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Stock:"}),e.jsx("span",{className:"font-medium",children:B.stock_quantity})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Price:"}),e.jsx("span",{className:"font-medium",children:B.price.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("span",{className:"font-medium capitalize",children:B.category})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsxs(X,{onClick:re=>{re.stopPropagation(),se(B),H(!0)},variant:"secondary",className:"flex-1 text-sm",children:[e.jsx(Ft,{size:14}),"Use"]}),e.jsxs(X,{onClick:re=>{re.stopPropagation(),r(`/spare-parts/${B.id}/edit`)},variant:"secondary",className:"flex-1 text-sm",children:[e.jsx(Ts,{size:14}),"Edit"]})]})]},B.id)})}):e.jsx(he,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Part"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Brand"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Category"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",children:"Stock"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-700",children:"Price"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:He.map(B=>{const fe=ge(B);return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-blue-50 cursor-pointer",onClick:()=>r(`/spare-parts/${B.id}`),children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white",children:V(B.category)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:B.name}),B.part_number&&e.jsx("div",{className:"text-xs text-gray-500",children:B.part_number})]})]})}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:B.brand||"N/A"}),e.jsx("td",{className:"py-3 px-4 text-gray-600 capitalize",children:B.category}),e.jsx("td",{className:"py-3 px-4 text-center font-medium",children:B.stock_quantity}),e.jsx("td",{className:"py-3 px-4 text-right font-medium",children:B.price.toLocaleString("en-TZ",{style:"currency",currency:"TZS",minimumFractionDigits:0})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${fe.color}`,children:fe.status})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:re=>{re.stopPropagation(),se(B),H(!0)},className:"p-1 text-gray-500 hover:text-blue-600 transition-colors",title:"Use Part",children:e.jsx(Ft,{size:16})}),e.jsx("button",{onClick:re=>{re.stopPropagation(),r(`/spare-parts/${B.id}`)},className:"p-1 text-gray-500 hover:text-blue-600 transition-colors",title:"View Part",children:e.jsx(cs,{size:16})}),e.jsx("button",{onClick:re=>{re.stopPropagation(),r(`/spare-parts/${B.id}/edit`)},className:"p-1 text-gray-500 hover:text-green-600 transition-colors",title:"Edit Part",children:e.jsx(Ts,{size:16})})]})})]},B.id)})})]})})}),He.length===0&&e.jsxs(he,{className:"text-center py-12",children:[e.jsx(Ft,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No spare parts found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:b||y!=="all"||I!=="all"||k!=="all"?"Try adjusting your search or filter criteria":"Get started by adding your first spare part to inventory"}),e.jsxs(X,{onClick:()=>r("/spare-parts/new"),className:"flex items-center gap-2",children:[e.jsx(Ut,{size:18}),"Add Your First Spare Part"]})]}),z&&e.jsx(Lg,{isOpen:q,onClose:()=>{H(!1),se(null)},sparePart:z,onRefresh:J})]})},Fo=()=>{const r=hs(),{id:a}=ka(),{currentUser:i}=Wt(),[c,m]=g.useState(!1),[u,x]=g.useState(!1),[j,b]=g.useState(!1),[f,y]=g.useState({name:"",description:"",category:"other",brand:"",model_compatibility:[],price:0,cost:0,stock_quantity:0,min_stock_level:5,supplier:"",part_number:"",is_active:!0}),[N,I]=g.useState(""),[R,k]=g.useState({}),[E,v]=g.useState({});g.useEffect(()=>{a&&(b(!0),U())},[a]);const U=async()=>{if(a){m(!0);try{const D=await pg(a);D&&y({name:D.name,description:D.description||"",category:D.category,brand:D.brand||"",model_compatibility:D.model_compatibility||[],price:D.price,cost:D.cost,stock_quantity:D.stock_quantity,min_stock_level:D.min_stock_level,supplier:D.supplier||"",part_number:D.part_number||"",is_active:D.is_active})}catch(D){console.error("Error loading spare part:",D),te.error("Failed to load spare part details")}finally{m(!1)}}},F=()=>{const D={},T={};return f.name.trim()||(D.name="Name is required",T.name=!0),f.price<0&&(D.price="Price must be positive",T.price=!0),f.cost<0&&(D.cost="Cost must be positive",T.cost=!0),f.stock_quantity<0&&(D.stock_quantity="Stock quantity must be positive",T.stock_quantity=!0),f.min_stock_level<0&&(D.min_stock_level="Minimum stock level must be positive",T.min_stock_level=!0),k(D),v(T),Object.keys(D).length===0},L=async D=>{if(D.preventDefault(),!F()){te.error("Please fix the errors before saving");return}x(!0);try{j&&a?(await yg(a,f),te.success("Spare part updated successfully")):(await bg(f),te.success("Spare part created successfully")),r("/spare-parts")}catch(T){console.error("Error saving spare part:",T),te.error("Failed to save spare part")}finally{x(!1)}},C=(D,T)=>{y(z=>({...z,[D]:T})),R[D]&&k(z=>({...z,[D]:void 0})),E[D]&&v(z=>({...z,[D]:!1}))},$=()=>{N.trim()&&!f.model_compatibility.includes(N.trim())&&(C("model_compatibility",[...f.model_compatibility,N.trim()]),I(""))},Y=D=>{const T=f.model_compatibility.filter((z,se)=>se!==D);C("model_compatibility",T)},A=[{value:"screen",label:"Screen",icon:e.jsx(ns,{className:"w-4 h-4"})},{value:"battery",label:"Battery",icon:e.jsx(ti,{className:"w-4 h-4"})},{value:"camera",label:"Camera",icon:e.jsx(vn,{className:"w-4 h-4"})},{value:"speaker",label:"Speaker",icon:e.jsx(si,{className:"w-4 h-4"})},{value:"microphone",label:"Microphone",icon:e.jsx(Wi,{className:"w-4 h-4"})},{value:"charging_port",label:"Charging Port",icon:e.jsx(Kr,{className:"w-4 h-4"})},{value:"motherboard",label:"Motherboard",icon:e.jsx(ri,{className:"w-4 h-4"})},{value:"other",label:"Other",icon:e.jsx(Ft,{className:"w-4 h-4"})}],_=(()=>{const D=[f.name?1:0,f.category?1:0,f.price>0?1:0,f.cost>0?1:0,f.stock_quantity>=0?1:0,f.min_stock_level>=0?1:0];return Math.round(D.reduce((T,z)=>T+z,0)/D.length*100)})();return c?e.jsx("div",{className:"p-4 sm:p-6 h-full overflow-y-auto pt-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading spare part details..."})]})})})}):e.jsx("div",{className:"p-4 sm:p-6 h-full overflow-y-auto pt-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"bg-white/50 backdrop-blur-md rounded-xl p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Spare Part Form"}),e.jsx("div",{className:"text-sm text-gray-600",children:j?"Editing Existing Part":"Creating New Part"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:`flex items-center space-x-2 ${f.name?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${f.name?"bg-green-500 text-white":"bg-gray-200 text-gray-500"}`,children:f.name?e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx(Ft,{size:16})}),e.jsx("span",{className:"text-sm font-medium",children:"Basic Info"})]}),e.jsx("div",{className:"flex-1 h-1 bg-gray-200 rounded",children:e.jsx("div",{className:`h-1 rounded transition-all duration-300 ${f.name?"bg-green-500":"bg-gray-200"}`,style:{width:f.name?"100%":"0%"}})}),e.jsxs("div",{className:`flex items-center space-x-2 ${f.price>0&&f.cost>0?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${f.price>0&&f.cost>0?"bg-green-500 text-white":"bg-gray-200 text-gray-500"}`,children:f.price>0&&f.cost>0?e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx(Ns,{size:16})}),e.jsx("span",{className:"text-sm font-medium",children:"Pricing"})]}),e.jsx("div",{className:"flex-1 h-1 bg-gray-200 rounded",children:e.jsx("div",{className:`h-1 rounded transition-all duration-300 ${f.price>0&&f.cost>0?"bg-green-500":"bg-gray-200"}`,style:{width:f.price>0&&f.cost>0?"100%":"0%"}})}),e.jsxs("div",{className:`flex items-center space-x-2 ${f.stock_quantity>=0&&f.min_stock_level>=0?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${f.stock_quantity>=0&&f.min_stock_level>=0?"bg-green-500 text-white":"bg-gray-200 text-gray-500"}`,children:f.stock_quantity>=0&&f.min_stock_level>=0?e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx(Ft,{size:16})}),e.jsx("span",{className:"text-sm font-medium",children:"Stock"})]})]}),e.jsx("div",{className:"mt-3 text-xs text-gray-500",children:f.name&&f.price>0&&f.cost>0&&f.stock_quantity>=0&&f.min_stock_level>=0?e.jsx("span",{className:"text-green-600 font-medium",children:"✓ Ready to submit"}):e.jsx("span",{children:"Complete all sections to submit"})}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-1",children:[e.jsx("span",{children:"Form completion"}),e.jsxs("span",{children:[_,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1",children:e.jsx("div",{className:"bg-blue-500 h-1 rounded-full transition-all duration-300",style:{width:`${_}%`}})})]})]}),e.jsx(he,{className:"mb-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ft,{size:20,className:"text-blue-600"}),"Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:`block mb-2 font-medium ${E.name?"text-red-600":"text-gray-700"}`,children:["Part Name *",!f.name&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Required)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:f.name,onChange:D=>C("name",D.target.value),className:`w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none ${E.name?"border-red-500 focus:border-red-600":f.name?"border-gray-300 focus:border-blue-500":"border-yellow-300 focus:border-yellow-500"}`,placeholder:"e.g., iPhone 15 Pro Screen",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Ft,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]}),E.name&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:"Part name is required"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Category *"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:A.map(D=>e.jsxs("button",{type:"button",onClick:()=>C("category",D.value),className:`flex items-center gap-2 p-3 border rounded-lg transition-all duration-200 focus:outline-none ${f.category===D.value?"bg-gradient-to-br from-blue-100 to-blue-200 border-blue-500 ring-2 ring-blue-400 scale-105":"bg-white border-gray-200 hover:shadow-lg hover:scale-105"}`,children:[D.icon,e.jsx("span",{className:"text-sm font-medium",children:D.label})]},D.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Brand"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:f.brand,onChange:D=>C("brand",D.target.value),className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"e.g., Apple, Samsung",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Zr,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Part Number"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:f.part_number,onChange:D=>C("part_number",D.target.value),className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"e.g., IP15P-SCR-001",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Ga,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Description"}),e.jsx("textarea",{value:f.description,onChange:D=>C("description",D.target.value),className:"w-full py-3 pl-4 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none resize-none",placeholder:"Detailed description of the spare part...",rows:3,autoComplete:"off",autoCorrect:"off",spellCheck:!1})]})]})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ns,{size:20,className:"text-green-600"}),"Pricing & Stock"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:`block mb-2 font-medium ${E.price?"text-red-600":"text-gray-700"}`,children:["Selling Price *",!f.price&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Required)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",value:f.price,onChange:D=>C("price",parseFloat(D.target.value)||0),className:`w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none ${E.price?"border-red-500 focus:border-red-600":f.price?"border-gray-300 focus:border-blue-500":"border-yellow-300 focus:border-yellow-500"}`,placeholder:"0.00",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Ns,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]}),E.price&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:"Price must be positive"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block mb-2 font-medium ${E.cost?"text-red-600":"text-gray-700"}`,children:["Cost Price *",!f.cost&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Required)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",value:f.cost,onChange:D=>C("cost",parseFloat(D.target.value)||0),className:`w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none ${E.cost?"border-red-500 focus:border-red-600":f.cost?"border-gray-300 focus:border-blue-500":"border-yellow-300 focus:border-yellow-500"}`,placeholder:"0.00",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Ns,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]}),E.cost&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:"Cost must be positive"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block mb-2 font-medium ${E.stock_quantity?"text-red-600":"text-gray-700"}`,children:["Stock Quantity *",f.stock_quantity<0&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Required)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:f.stock_quantity,onChange:D=>C("stock_quantity",parseInt(D.target.value)||0),className:`w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none ${E.stock_quantity?"border-red-500 focus:border-red-600":f.stock_quantity<0?"border-yellow-300 focus:border-yellow-500":"border-gray-300 focus:border-blue-500"}`,placeholder:"0",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Ft,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]}),E.stock_quantity&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:"Stock quantity must be positive"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block mb-2 font-medium ${E.min_stock_level?"text-red-600":"text-gray-700"}`,children:["Min Stock Level *",f.min_stock_level<0&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Required)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:f.min_stock_level,onChange:D=>C("min_stock_level",parseInt(D.target.value)||0),className:`w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 rounded-lg focus:outline-none ${E.min_stock_level?"border-red-500 focus:border-red-600":f.min_stock_level<0?"border-yellow-300 focus:border-yellow-500":"border-gray-300 focus:border-blue-500"}`,placeholder:"5",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Ht,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]}),E.min_stock_level&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:"Minimum stock level must be positive"})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[f.stock_quantity===0?e.jsx(Ht,{className:"w-5 h-5 text-red-500"}):f.stock_quantity<=f.min_stock_level?e.jsx(Ht,{className:"w-5 h-5 text-yellow-500"}):e.jsx(yt,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Stock Status: ",f.stock_quantity===0?"Out of Stock":f.stock_quantity<=f.min_stock_level?"Low Stock":"In Stock"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[f.stock_quantity," units available"]})]})]})})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Js,{size:20,className:"text-purple-600"}),"Model Compatibility"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:N,onChange:D=>I(D.target.value),onKeyPress:D=>D.key==="Enter"&&(D.preventDefault(),$()),className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"e.g., iPhone 15 Pro, Galaxy S24",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Js,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]}),e.jsx("button",{type:"button",onClick:$,disabled:!N.trim(),className:"px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(Ut,{className:"w-4 h-4"})})]}),f.model_compatibility.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:f.model_compatibility.map((D,T)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-800 rounded-full",children:[e.jsx("span",{className:"text-sm",children:D}),e.jsx("button",{type:"button",onClick:()=>Y(T),className:"text-blue-600 hover:text-blue-800",children:e.jsx(tr,{className:"w-3 h-3"})})]},T))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Zr,{size:20,className:"text-orange-600"}),"Supplier Information"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:"Supplier"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:f.supplier,onChange:D=>C("supplier",D.target.value),className:"w-full py-3 pl-12 pr-4 bg-white/30 backdrop-blur-md border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"e.g., TechParts Inc, MobileParts Co",autoComplete:"off",autoCorrect:"off",spellCheck:!1}),e.jsx(Zr,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx("button",{type:"button",className:"px-6 py-3 rounded-lg bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition",onClick:()=>r("/spare-parts"),disabled:u,children:"Cancel"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:f.is_active,onChange:D=>C("is_active",D.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Active"})]}),e.jsx("button",{type:"button",className:`px-6 py-3 rounded-lg font-semibold transition-all duration-200 ${_===100?"bg-green-600 text-white hover:bg-green-700 shadow-lg":_>=70?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-400 text-gray-600 cursor-not-allowed"}`,onClick:L,disabled:u||_<100,children:u?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):_===100?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Hs,{size:16}),j?"Update Part":"Create Part"]}):_>=70?e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:["Almost Ready (",_,"%)"]})}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{children:["Complete Form (",_,"%)"]})})})]})]})]})})]})})},Pg=()=>{const[r,a]=g.useState([]),[i,c]=g.useState(!1),[m,u]=g.useState(null),[x,j]=g.useState(!1),[b,f]=g.useState(""),[y,N]=g.useState(""),[I,R]=g.useState("name"),k=g.useRef(null),E=async()=>{c(!0);try{const{data:C,error:$}=await G.from("customers").select("*").order("name");if($)throw $;a(C||[]),te.success(`Loaded ${(C==null?void 0:C.length)||0} customers`)}catch(C){console.error("Error loading customers:",C),te.error("Failed to load customers")}finally{c(!1)}},v=C=>{var A;const $=(A=C.target.files)==null?void 0:A[0];if(!$)return;const Y=new FileReader;Y.onload=Z=>{var _;try{const T=((_=Z.target)==null?void 0:_.result).split(`
`),z=T[0].split(",").map(q=>q.trim().replace(/"/g,"")),se=[];for(let q=1;q<T.length;q++)if(T[q].trim()){const H=T[q].split(",").map(V=>V.trim().replace(/"/g,"")),J={};z.forEach((V,ge)=>{J[V.toLowerCase().replace(/\s+/g,"_")]=H[ge]||""}),se.push(J)}a(se),te.success(`Imported ${se.length} customers from CSV`)}catch(D){console.error("Error parsing CSV:",D),te.error("Failed to parse CSV file")}},Y.readAsText($)},U=async C=>{try{const{error:$}=await G.from("customers").update({name:C.name,email:C.email,phone:C.phone,gender:C.gender,city:C.city,whatsapp:C.whatsapp,referral_source:C.referral_source,birth_month:C.birth_month,birth_day:C.birth_day,total_returns:C.total_returns,initial_notes:C.initial_notes,location_description:C.location_description,national_id:C.national_id,points:C.points,total_spent:C.total_spent,loyalty_level:C.loyalty_level,color_tag:C.color_tag,customer_tag:C.customer_tag,notes:C.notes,is_active:C.is_active,updated_at:new Date().toISOString()}).eq("id",C.id);if($)throw $;a(Y=>Y.map(A=>A.id===C.id?C:A)),j(!1),u(null),te.success("Customer updated successfully")}catch($){console.error("Error updating customer:",$),te.error("Failed to update customer")}},F=()=>{const $=[["ID","Name","Email","Phone","Gender","City","WhatsApp","Referral Source","Birth Month","Birth Day","Total Returns","Initial Notes","Location Description","National ID","Points","Total Spent","Loyalty Level","Color Tag","Customer Tag","Notes","Is Active","Joined Date","Last Visit"].join(","),...r.map(_=>[_.id,`"${(_.name||"").replace(/"/g,'""')}"`,`"${(_.email||"").replace(/"/g,'""')}"`,`"${(_.phone||"").replace(/"/g,'""')}"`,`"${(_.gender||"").replace(/"/g,'""')}"`,`"${(_.city||"").replace(/"/g,'""')}"`,`"${(_.whatsapp||"").replace(/"/g,'""')}"`,`"${(_.referral_source||"").replace(/"/g,'""')}"`,`"${(_.birth_month||"").replace(/"/g,'""')}"`,`"${(_.birth_day||"").replace(/"/g,'""')}"`,_.total_returns||0,`"${(_.initial_notes||"").replace(/"/g,'""')}"`,`"${(_.location_description||"").replace(/"/g,'""')}"`,`"${(_.national_id||"").replace(/"/g,'""')}"`,_.points||0,_.total_spent||0,`"${(_.loyalty_level||"").replace(/"/g,'""')}"`,`"${(_.color_tag||"").replace(/"/g,'""')}"`,`"${(_.customer_tag||"").replace(/"/g,'""')}"`,`"${(_.notes||"").replace(/"/g,'""')}"`,_.is_active?"Yes":"No"].join(","))].join(`
`),Y=new Blob([$],{type:"text/csv"}),A=window.URL.createObjectURL(Y),Z=document.createElement("a");Z.href=A,Z.download=`customer_data_updated_${new Date().toISOString().split("T")[0]}.csv`,Z.click(),window.URL.revokeObjectURL(A),te.success("CSV exported successfully")},L=r.filter(C=>{var $,Y,A,Z;return(($=C.name)==null?void 0:$.toLowerCase().includes(b.toLowerCase()))||((Y=C.email)==null?void 0:Y.toLowerCase().includes(b.toLowerCase()))||((A=C.phone)==null?void 0:A.includes(b))||((Z=C.whatsapp)==null?void 0:Z.includes(b))}).filter(C=>!y||C.customer_tag===y).sort((C,$)=>{switch(I){case"points":return($.points||0)-(C.points||0);case"total_spent":return($.total_spent||0)-(C.total_spent||0);default:return(C.name||"").localeCompare($.name||"")}});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Customer Data Update"}),e.jsx("p",{className:"text-gray-600",children:"Update customer information, import/export data, and manage customer records"})]}),e.jsx(he,{className:"mb-6 p-6",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsx(X,{onClick:E,disabled:i,className:"bg-blue-500 hover:bg-blue-600",children:i?"Loading...":"Load Customers"}),e.jsx(X,{onClick:()=>{var C;return(C=k.current)==null?void 0:C.click()},className:"bg-green-500 hover:bg-green-600",children:"Import CSV"}),e.jsx(X,{onClick:F,disabled:r.length===0,className:"bg-purple-500 hover:bg-purple-600",children:"Export CSV"}),e.jsx("input",{ref:k,type:"file",accept:".csv",onChange:v,className:"hidden"})]})}),e.jsx(he,{className:"mb-6 p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),e.jsx("input",{type:"text",placeholder:"Search by name, email, phone...",value:b,onChange:C=>f(C.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Tag"}),e.jsxs("select",{value:y,onChange:C=>N(C.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Tags"}),e.jsx("option",{value:"vip",children:"VIP"}),e.jsx("option",{value:"regular",children:"Regular"}),e.jsx("option",{value:"new",children:"New"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),e.jsxs("select",{value:I,onChange:C=>R(C.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"points",children:"Points"}),e.jsx("option",{value:"total_spent",children:"Total Spent"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("span",{className:"text-sm text-gray-600",children:[L.length," customers"]})})]})}),e.jsx("div",{className:"grid gap-4",children:L.map(C=>e.jsx(he,{className:"p-4 hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-800",children:C.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[C.email," • ",C.phone]}),C.whatsapp&&e.jsxs("p",{className:"text-sm text-green-600",children:["WhatsApp: ",C.whatsapp]})]}),e.jsxs("div",{className:"flex gap-2",children:[C.birth_month&&e.jsxs("span",{className:"px-2 py-1 bg-pink-100 text-pink-800 text-xs rounded-full",children:["🎂 ",C.birth_month," ",C.birth_day]}),C.referral_source&&e.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:["📱 ",C.referral_source]}),C.points&&C.points>100&&e.jsxs("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:["⭐ ",C.points," pts"]})]})]})}),e.jsx(X,{onClick:()=>{u(C),j(!0)},className:"bg-blue-500 hover:bg-blue-600",children:"Edit"})]})},C.id))}),L.length===0&&e.jsx(he,{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:r.length===0?'No customers loaded. Click "Load Customers" to start.':"No customers match your filters."})})]}),m&&e.jsx(es,{isOpen:x,onClose:()=>{j(!1),u(null)},title:"Edit Customer",children:e.jsx(Fg,{customer:m,onSave:U,onCancel:()=>{j(!1),u(null)}})})]})},Fg=({customer:r,onSave:a,onCancel:i})=>{const[c,m]=g.useState(r),u=x=>{x.preventDefault(),a(c)};return e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:c.name||"",onChange:x=>m({...c,name:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:c.email||"",onChange:x=>m({...c,email:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:c.phone||"",onChange:x=>m({...c,phone:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"WhatsApp"}),e.jsx("input",{type:"tel",value:c.whatsapp||"",onChange:x=>m({...c,whatsapp:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("input",{type:"text",value:c.city||"",onChange:x=>m({...c,city:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Gender"}),e.jsxs("select",{value:c.gender||"",onChange:x=>m({...c,gender:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Birth Month"}),e.jsxs("select",{value:c.birth_month||"",onChange:x=>m({...c,birth_month:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Month"}),["January","February","March","April","May","June","July","August","September","October","November","December"].map(x=>e.jsx("option",{value:x,children:x},x))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Birth Day"}),e.jsxs("select",{value:c.birth_day||"",onChange:x=>m({...c,birth_day:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Day"}),Array.from({length:31},(x,j)=>j+1).map(x=>e.jsx("option",{value:x.toString(),children:x},x))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Referral Source"}),e.jsx("input",{type:"text",value:c.referral_source||"",onChange:x=>m({...c,referral_source:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Instagram, Friend, Walk-in..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Points"}),e.jsx("input",{type:"number",value:c.points||0,onChange:x=>m({...c,points:parseInt(x.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total Spent"}),e.jsx("input",{type:"number",value:c.total_spent||0,onChange:x=>m({...c,total_spent:parseFloat(x.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total Returns"}),e.jsx("input",{type:"number",value:c.total_returns||0,onChange:x=>m({...c,total_returns:parseInt(x.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:c.notes||"",onChange:x=>m({...c,notes:x.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Initial Notes"}),e.jsx("textarea",{value:c.initial_notes||"",onChange:x=>m({...c,initial_notes:x.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(X,{type:"submit",className:"bg-blue-500 hover:bg-blue-600",children:"Save Changes"}),e.jsx(X,{type:"button",onClick:i,className:"bg-gray-500 hover:bg-gray-600",children:"Cancel"})]})]})},Bg=()=>{const r=hs(),a=[{id:1,title:"Navigate to Add New Product",description:"Go to Inventory → Add New Product in the sidebar",action:()=>r("/inventory/new"),icon:e.jsx(Ft,{size:20})},{id:2,title:"Check Default Mode",description:'Verify the form starts in "Simple Product" mode (toggle should be gray, not blue)',icon:e.jsx(yt,{size:20})},{id:3,title:"Verify Product Details Section",description:'Look for the "Product Details" section with cost price, selling price, and quantity fields',icon:e.jsx(Ns,{size:20})},{id:4,title:"Test Quick Price Calculator",description:"Enter a cost price and try the markup buttons (10%, 20%, 30%, 50%)",icon:e.jsx(dn,{size:20})},{id:5,title:"Check Profit Analysis",description:"Enter both cost and selling prices to see the enhanced profit analysis",icon:e.jsx(vr,{size:20})},{id:6,title:"Test Mode Toggle",description:"Try switching between Simple Product and With Variants modes",icon:e.jsx(Bs,{size:20})}],i=["✅ Form starts in Simple Product mode (hasVariants = false)","✅ Product Details section visible by default","✅ Helpful tooltips under each field","✅ Quick price calculator buttons","✅ Enhanced profit analysis with better styling","✅ Product summary section","✅ Smart toggle between modes"],c=["Hard refresh the browser (Cmd+Shift+R on Mac, Ctrl+F5 on Windows)","Clear browser cache","Check browser console for any errors","Verify the development server is running","Try opening in an incognito/private window"];return e.jsxs("div",{className:"p-4 sm:p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(X,{onClick:()=>r("/inventory"),className:"flex items-center gap-2",children:[e.jsx(zs,{size:20}),"Back to Inventory"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Inventory Form Test"}),e.jsx("p",{className:"text-gray-600",children:"Test and verify the new inventory form features"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(he,{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(yt,{size:20,className:"text-green-600"}),"Test Steps"]}),e.jsx("div",{className:"space-y-4",children:a.map(m=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-white/50 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold text-sm",children:m.id})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.icon,e.jsx("h3",{className:"font-medium text-gray-900",children:m.title})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:m.description}),m.action&&e.jsx(X,{onClick:m.action,className:"text-sm",children:"Go to Form"})]})]},m.id))})]}),e.jsxs(he,{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(vr,{size:20,className:"text-blue-600"}),"Expected Changes"]}),e.jsx("div",{className:"space-y-2",children:i.map((m,u)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-green-50 rounded-lg border border-green-200",children:[e.jsx(yt,{size:16,className:"text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:m})]},u))})]}),e.jsxs(he,{className:"lg:col-span-2",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(dr,{size:20,className:"text-orange-600"}),"Troubleshooting"]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-orange-800 mb-3",children:"If you don't see the expected changes, try these steps:"}),e.jsx("ul",{className:"space-y-1",children:c.map((m,u)=>e.jsxs("li",{className:"text-sm text-orange-700 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-orange-400 rounded-full"}),m]},u))})]})]}),e.jsxs(he,{className:"lg:col-span-2",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Bs,{size:20,className:"text-blue-600"}),"Quick Actions"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(X,{onClick:()=>r("/inventory/new"),className:"flex items-center gap-2",children:[e.jsx(Ft,{size:16}),"Test New Product Form"]}),e.jsxs(X,{onClick:()=>window.open("http://localhost:5173","_blank"),className:"flex items-center gap-2",children:[e.jsx(Bs,{size:16}),"Open Application"]}),e.jsxs(X,{onClick:()=>window.open("test-inventory-form.html","_blank"),className:"flex items-center gap-2",children:[e.jsx(yt,{size:16}),"View Test Instructions"]})]})]})]})]})},zg=({isOnline:r,isSyncing:a})=>{const{addCustomer:i}=Ur(),{assignToTechnician:c,updateDeviceStatus:m}=na();return g.useEffect(()=>{async function u(){const x=await sh();for(const j of x)if(j.type==="submitData")await fetch("/api/endpoint",{method:"POST",body:JSON.stringify(j.payload)});else if(j.type==="createCustomerFromSearch")await i(j.payload);else if(j.type==="adjustPoints"){const{operation:b,pointsToAdjust:f,reason:y,customerId:N}=j.payload,I=b==="add"?Math.abs(f):-Math.abs(f),{data:R,error:k}=await G.from("customers").select("points").eq("id",N).single();if(!k&&R){const E=(R.points||0)+I;await G.from("customers").update({points:E}).eq("id",N),await G.from("customer_notes").insert({id:`note-${Date.now()}`,content:`${b==="add"?"Added":"Subtracted"} ${Math.abs(f)} points - ${y}`,created_by:"system",created_at:new Date().toISOString(),customer_id:N})}}else if(j.type==="assignTechnician"){const{deviceId:b,selectedTechId:f}=j.payload;await c(b,f,"")}else if(j.type==="markDeviceFailed"){const{deviceId:b,remark:f}=j.payload;await m(b,"failed",f||"")}x.length>0&&await rh()}r&&u()},[r,i,c,m]),e.jsxs(e.Fragment,{children:[!r&&e.jsx("div",{style:{background:"#f87171",color:"white",padding:"8px",textAlign:"center"},children:"You are offline. Changes will be saved and synced when you are back online."}),r&&a&&e.jsx("div",{style:{background:"#fbbf24",color:"black",padding:"8px",textAlign:"center"},children:"Syncing your offline changes..."}),e.jsxs(tm,{children:[e.jsx(zt,{path:"/login",element:e.jsx(s0,{})}),e.jsxs(zt,{path:"/",element:e.jsx(Ug,{children:e.jsx(Hh,{})}),children:[e.jsx(zt,{index:!0,element:e.jsx(pn,{to:"/dashboard",replace:!0})}),e.jsx(zt,{path:"/dashboard",element:e.jsx(eh,{})}),e.jsx(zt,{path:"/admin-dashboard",element:e.jsx(os,{allowedRoles:["admin"],children:e.jsx(Yx,{})})}),e.jsx(zt,{path:"/wallpaper-preview",element:e.jsx(Xx,{})}),e.jsx(zt,{path:"/devices/new",element:e.jsx(Sh,{})}),e.jsx(zt,{path:"/devices/:id",element:e.jsx(Ih,{})}),e.jsx(zt,{path:"/brand-management",element:e.jsx(os,{allowedRoles:["admin"],children:e.jsx(Kx,{})})}),e.jsx(zt,{path:"/category-management",element:e.jsx(os,{allowedRoles:["admin"],children:e.jsx(rg,{})})}),e.jsx(zt,{path:"/database-setup",element:e.jsx(os,{allowedRoles:["admin"],children:e.jsx(ag,{})})}),e.jsx(zt,{path:"/customers/import",element:e.jsx(os,{allowedRoles:["admin","customer-care"],children:e.jsx(Po,{})})}),e.jsx(zt,{path:"/excel-import",element:e.jsx(os,{allowedRoles:["admin"],children:e.jsx(Po,{})})}),e.jsx(zt,{path:"/customers/new",element:e.jsx(_h,{})}),e.jsx(zt,{path:"/customers",element:e.jsx(Fh,{})}),e.jsx(zt,{path:"/customers/:id",element:e.jsx(Vh,{})}),e.jsx(zt,{path:"/customers/update-data",element:e.jsx(os,{allowedRoles:["admin","customer-care"],children:e.jsx(Pg,{})})}),e.jsx(zt,{path:"/settings",element:e.jsx(hx,{})}),e.jsx(zt,{path:"/inventory",element:e.jsx(Ag,{})}),e.jsx(zt,{path:"/inventory/new",element:e.jsx(kg,{})}),e.jsx(zt,{path:"/inventory/test-form",element:e.jsx(os,{allowedRoles:["admin","customer-care"],children:e.jsx(Bg,{})})}),e.jsx(zt,{path:"/inventory/management",element:e.jsx(os,{allowedRoles:["admin"],children:e.jsx(Dg,{})})}),e.jsx(zt,{path:"/inventory/products/:id",element:e.jsx(Tg,{})}),e.jsx(zt,{path:"/inventory/purchase-orders",element:e.jsx(os,{allowedRoles:["admin","customer-care"],children:e.jsx(Ig,{})})}),e.jsx(zt,{path:"/inventory/purchase-orders/new",element:e.jsx(os,{allowedRoles:["admin","customer-care"],children:e.jsx(Rg,{})})}),e.jsx(zt,{path:"/spare-parts",element:e.jsx(os,{allowedRoles:["admin","technician"],children:e.jsx(Og,{})})}),e.jsx(zt,{path:"/spare-parts/new",element:e.jsx(os,{allowedRoles:["admin","technician"],children:e.jsx(Fo,{})})}),e.jsx(zt,{path:"/spare-parts/:id/edit",element:e.jsx(os,{allowedRoles:["admin","technician"],children:e.jsx(Fo,{})})}),e.jsx(zt,{path:"/sms",element:e.jsx(os,{allowedRoles:["admin"],children:e.jsx(px,{})})}),e.jsx(zt,{path:"/points-management",element:e.jsx(os,{allowedRoles:["admin"],children:e.jsx(bx,{})})}),e.jsx(zt,{path:"/payments-report",element:e.jsx(os,{allowedRoles:["admin"],children:e.jsx(yx,{})})}),e.jsx(zt,{path:"/audit-logs",element:e.jsx(os,{allowedRoles:["admin"],children:e.jsx(wx,{})})}),e.jsx(zt,{path:"/finance",element:e.jsx(os,{allowedRoles:["admin"],children:e.jsx(Nx,{})})}),e.jsx(zt,{path:"/whatsapp",element:e.jsx(os,{allowedRoles:["admin"],children:e.jsx(To,{})})}),e.jsx(zt,{path:"/whatsapp-manager",element:e.jsx(os,{allowedRoles:["admin","customer-care"],children:e.jsx(To,{})})}),e.jsx(zt,{path:"/diagnostics/new",element:e.jsx(os,{allowedRoles:["admin","customer-care"],children:e.jsx(Ai,{})})}),e.jsx(zt,{path:"/diagnostics/my-requests",element:e.jsx(os,{allowedRoles:["admin","customer-care"],children:e.jsx(Oo,{})})}),e.jsx(zt,{path:"/diagnostics/assigned",element:e.jsx(os,{allowedRoles:["technician"],children:e.jsx(Io,{})})}),e.jsx(zt,{path:"/diagnostics/request/:requestId",element:e.jsx(os,{allowedRoles:["admin","technician"],children:e.jsx(Mo,{})})}),e.jsx(zt,{path:"/diagnostics/device/:requestId/:deviceId",element:e.jsx(os,{allowedRoles:["admin","technician"],children:e.jsx(Ro,{})})}),e.jsx(zt,{path:"/diagnostics/reports",element:e.jsx(os,{allowedRoles:["admin","technician"],children:e.jsx(Lo,{})})}),e.jsx(zt,{path:"/diagnostics/new",element:e.jsx(os,{allowedRoles:["admin","customer-care"],children:e.jsx(Ai,{})})}),e.jsx(zt,{path:"/diagnostics/new-request",element:e.jsx(os,{allowedRoles:["admin","customer-care"],children:e.jsx(Ai,{})})}),e.jsx(zt,{path:"/diagnostics/my-requests",element:e.jsx(os,{allowedRoles:["admin","customer-care"],children:e.jsx(Oo,{})})}),e.jsx(zt,{path:"/diagnostics/assigned",element:e.jsx(os,{allowedRoles:["technician"],children:e.jsx(Io,{})})}),e.jsx(zt,{path:"/diagnostics/request/:requestId",element:e.jsx(os,{allowedRoles:["admin","technician"],children:e.jsx(Mo,{})})}),e.jsx(zt,{path:"/diagnostics/device/:requestId/:deviceId",element:e.jsx(os,{allowedRoles:["admin","technician"],children:e.jsx(Ro,{})})}),e.jsx(zt,{path:"/diagnostics/grouped/:requestId/:deviceName/:model",element:e.jsx(os,{allowedRoles:["admin","technician"],children:e.jsx(Bx,{})})}),e.jsx(zt,{path:"/diagnostics/reports",element:e.jsx(os,{allowedRoles:["admin","technician"],children:e.jsx(Lo,{})})}),e.jsx(zt,{path:"/diagnostics/templates",element:e.jsx(os,{allowedRoles:["admin"],children:e.jsx(Fx,{})})})]}),e.jsx(zt,{path:"*",element:e.jsx(pn,{to:"/dashboard",replace:!0})})]})]})},Ug=({children:r})=>{const{isAuthenticated:a,loading:i}=Wt();return i?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):a?e.jsx(e.Fragment,{children:r}):(localStorage.setItem("postLoginRedirect",window.location.pathname),e.jsx(pn,{to:"/login"}))},os=({children:r,allowedRoles:a})=>{const{isAuthenticated:i,loading:c,currentUser:m}=Wt();return c?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):i?!m||!a.includes(m.role)?e.jsx(pn,{to:"/dashboard",replace:!0}):e.jsx(e.Fragment,{children:r}):(localStorage.setItem("postLoginRedirect",window.location.pathname),e.jsx(pn,{to:"/login"}))};function $g(){const[r,a]=g.useState(navigator.onLine),[i,c]=g.useState(!1);return g.useEffect(()=>{const m=sessionStorage.getItem(`scroll-pos-${window.location.pathname}`);m&&window.scrollTo(0,parseInt(m,10));const u=()=>{sessionStorage.setItem(`scroll-pos-${window.location.pathname}`,String(window.scrollY))};return window.addEventListener("beforeunload",u),window.addEventListener("popstate",u),()=>{window.removeEventListener("beforeunload",u),window.removeEventListener("popstate",u),u()}},[]),g.useEffect(()=>(ko.start(),()=>{ko.stop()}),[]),g.useEffect(()=>{mc()},[]),g.useEffect(()=>{function m(){a(!0)}function u(){a(!1)}return window.addEventListener("online",m),window.addEventListener("offline",u),()=>{window.removeEventListener("online",m),window.removeEventListener("offline",u)}},[]),e.jsxs(Wh,{children:[e.jsx(om,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsx(xm,{children:e.jsx(Gm,{children:e.jsx(Ym,{children:e.jsx(Jm,{children:e.jsx(e0,{children:e.jsx(zg,{isOnline:r,isSyncing:i})})})})})})}),e.jsx(Go,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"},success:{duration:3e3,iconTheme:{primary:"#10B981",secondary:"#fff"}},error:{duration:5e3,iconTheme:{primary:"#EF4444",secondary:"#fff"}}}})]})}Ri.createRoot(document.getElementById("root")).render(e.jsx(Dr.StrictMode,{children:e.jsx($g,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(r=>{console.log("Service Worker registered successfully:",r)}).catch(r=>{console.warn("Service Worker registration failed:",r)})});
