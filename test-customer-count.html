<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Count Test</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Customer Count Test</h1>
    <div id="results"></div>

    <script>
        const supabaseUrl = 'https://jxhzveborezjhsmzsgbc.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp4aHp2ZWJvcmV6amhzbXpzZ2JjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3MTE1MjQsImV4cCI6MjA2ODI4NzUyNH0.pIug4PlJ3Q14GxcYilW-u0blByYoyeOfN3q9RNIjgfw';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        async function testCustomerCount() {
            const resultsDiv = document.getElementById('results');
            
            try {
                // Test 1: Count all customers
                console.log('Testing customer count...');
                const { count, error: countError } = await supabase
                    .from('customers')
                    .select('*', { count: 'exact', head: true });
                
                if (countError) {
                    resultsDiv.innerHTML += `<p style="color: red;">Count Error: ${countError.message}</p>`;
                    console.error('Count error:', countError);
                } else {
                    resultsDiv.innerHTML += `<p style="color: green;">Total customers in database: ${count}</p>`;
                    console.log('Total customers:', count);
                }

                // Test 2: Get all customers (limited to see if there's a default limit)
                console.log('Testing customer fetch...');
                const { data: customers, error: fetchError } = await supabase
                    .from('customers')
                    .select('id, name, email, phone');
                
                if (fetchError) {
                    resultsDiv.innerHTML += `<p style="color: red;">Fetch Error: ${fetchError.message}</p>`;
                    console.error('Fetch error:', fetchError);
                } else {
                    resultsDiv.innerHTML += `<p style="color: green;">Fetched customers: ${customers.length}</p>`;
                    console.log('Fetched customers:', customers.length);
                    
                    if (customers.length < count) {
                        resultsDiv.innerHTML += `<p style="color: orange;">⚠️ Warning: Fetched ${customers.length} customers but database has ${count} total</p>`;
                    }
                }

                // Test 3: Check if there are any filters or RLS policies
                console.log('Testing RLS policies...');
                const { data: policies, error: policyError } = await supabase
                    .rpc('get_policies', { table_name: 'customers' })
                    .catch(() => ({ data: null, error: { message: 'RPC not available' } }));
                
                if (policyError) {
                    resultsDiv.innerHTML += `<p style="color: blue;">Policy check: ${policyError.message}</p>`;
                } else {
                    resultsDiv.innerHTML += `<p style="color: blue;">RLS policies: ${policies ? policies.length : 'None'}</p>`;
                }

                // Test 4: Check for any active filters
                const { data: activeCustomers, error: activeError } = await supabase
                    .from('customers')
                    .select('id')
                    .eq('is_active', true);
                
                if (activeError) {
                    resultsDiv.innerHTML += `<p style="color: red;">Active customers error: ${activeError.message}</p>`;
                } else {
                    resultsDiv.innerHTML += `<p style="color: green;">Active customers: ${activeCustomers.length}</p>`;
                }

            } catch (error) {
                resultsDiv.innerHTML += `<p style="color: red;">General error: ${error.message}</p>`;
                console.error('General error:', error);
            }
        }

        // Run the test when page loads
        window.addEventListener('load', testCustomerCount);
    </script>
</body>
</html> 